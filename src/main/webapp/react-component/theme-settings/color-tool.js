import { __assign, __read } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/**
 * Adapted from https://github.com/mui-org/material-ui/blob/master/docs/src/pages/customization/color/ColorTool.js
 */
import * as React from 'react';
import { rgbToHex, useTheme } from '@mui/material/styles';
import colors from './typed-colors';
import Grid from '@mui/material/Grid';
import Input from '@mui/material/Input';
import Radio from '@mui/material/Radio';
import Tooltip from '@mui/material/Tooltip';
import Typography from '@mui/material/Typography';
import Button from '@mui/material/Button';
import _ from 'lodash';
import CheckIcon from '@mui/icons-material/Check';
import Slider from '@mui/material/Slider';
import user from '../../component/singletons/user-instance';
import { capitalize } from '@mui/material/utils';
var shades = [
    900,
    800,
    700,
    600,
    500,
    400,
    300,
    200,
    100,
    50,
    'A700',
    'A400',
    'A200',
    'A100',
];
var containsShades = function (color, shades) {
    return shades.every(function (shade) { return Object.keys(color).includes(shade.toString()); });
};
var getHues = function () {
    var hues = Object.keys(colors).filter(function (hue) {
        return containsShades(colors[hue], shades);
    });
    return hues.slice(1, 17);
};
var hues = getHues();
/**
 * Costly to update, so let them settle on a color first
 */
var updateTheme = _.debounce(function (state) {
    user.get('user').get('preferences').get('theme').set({
        primary: state.primary,
        secondary: state.secondary,
    });
}, 0);
var getDefaults = function () {
    return __assign({ primary: '#2196f3', secondary: '#f50057' }, user.get('user').get('preferences').get('theme').toJSON());
};
function ColorTool(props) {
    var classes = props.classes;
    var theme = useTheme();
    var defaults = getDefaults();
    var _a = __read(React.useState({
        primary: defaults.primary,
        secondary: defaults.secondary,
        primaryInput: defaults.primary,
        secondaryInput: defaults.secondary,
        primaryHue: 'blue',
        secondaryHue: 'pink',
        primaryShade: 4,
        secondaryShade: 11,
    }), 2), state = _a[0], setState = _a[1];
    var handleChangeColor = function (name) { return function (event) {
        var isRgb = function (string) {
            return /rgb\([0-9]{1,3}\s*,\s*[0-9]{1,3}\s*,\s*[0-9]{1,3}\)/i.test(string);
        };
        var isHex = function (string) {
            return /^#?([0-9a-f]{3})$|^#?([0-9a-f]){6}$/i.test(string);
        };
        var color = event.target.value;
        setState(function (prevState) {
            var _a;
            return (__assign(__assign({}, prevState), (_a = {}, _a["".concat(name, "Input")] = color, _a)));
        });
        var isValidColor = false;
        if (isRgb(color)) {
            isValidColor = true;
        }
        else if (isHex(color)) {
            isValidColor = true;
            if (color.indexOf('#') === -1) {
                color = "#".concat(color);
            }
        }
        if (isValidColor) {
            setState(function (prevState) {
                var _a;
                return (__assign(__assign({}, prevState), (_a = {}, _a[name] = color, _a)));
            });
        }
    }; };
    var handleChangeHue = function (name) { return function (event) {
        var _a;
        var hue = event.target.value;
        var shade = state["".concat(name, "Shade")];
        // @ts-expect-error ts-migrate(7015) FIXME: Element implicitly has an 'any' type because index... Remove this comment to see the full error message
        var color = colors[hue][shades[shade]];
        if (color) {
            setState(__assign(__assign({}, state), (_a = {}, _a["".concat(name, "Hue")] = hue, _a[name] = color, _a["".concat(name, "Input")] = color, _a)));
        }
    }; };
    var handleChangeShade = function (name) { return function (_event, shade) {
        var _a;
        // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message
        var color = colors[state["".concat(name, "Hue")]][shades[shade]];
        setState(__assign(__assign({}, state), (_a = {}, _a["".concat(name, "Shade")] = shade, _a[name] = color, _a["".concat(name, "Input")] = color, _a)));
    }; };
    React.useEffect(function () {
        updateTheme(state);
    }, [state]);
    var colorBar = function (color, intent) {
        var background = theme.palette.augmentColor({
            color: {
                main: color,
            },
        });
        return (_jsx(Grid, { container: true, sx: { marginTop: theme.spacing(2) }, children: ['dark', 'main', 'light'].map(function (key) {
                var backgroundColor = background[key];
                return (_jsx(Tooltip, { placement: "right", title: (function () {
                        switch (key) {
                            case 'dark':
                                return 'Go darker';
                            case 'light':
                                return 'Go lighter';
                            default:
                                return 'Current shade';
                        }
                    })(), children: _jsx(Button, { sx: {
                            width: 64,
                            height: 64,
                            display: 'flex',
                            justifyContent: 'center',
                            alignItems: 'center',
                            backgroundColor: backgroundColor,
                        }, onClick: function () {
                            var _a;
                            setState(__assign(__assign({}, state), (_a = {}, _a[intent] = rgbToHex(backgroundColor), _a["".concat(intent, "Input")] = rgbToHex(backgroundColor), _a)));
                        }, children: _jsx(Typography, { variant: "caption", style: {
                                color: theme.palette.getContrastText(backgroundColor),
                            }, children: rgbToHex(backgroundColor) }) }) }, key));
            }) }));
    };
    var colorPicker = function (intent) {
        var intentInput = state["".concat(intent, "Input")];
        var intentShade = state["".concat(intent, "Shade")];
        var color = state["".concat(intent)];
        return (_jsxs(Grid, { item: true, xs: 12, sm: 6, md: 4, className: "min-w-104", children: [_jsx(Typography, { component: "label", gutterBottom: true, htmlFor: intent, variant: "h6", children: capitalize(intent) }), _jsx(Input, { id: intent, value: intentInput, onChange: handleChangeColor(intent), fullWidth: true }), _jsxs("div", { style: {
                        display: 'flex',
                        alignItems: 'center',
                        marginTop: theme.spacing(2),
                        marginBottom: theme.spacing(2),
                    }, children: [_jsx(Typography, { id: "".concat(intent, "ShadeSliderLabel"), children: "Shade:" }), _jsx(Slider, { sx: {
                                width: 'calc(100% - 80px)',
                                marginLeft: theme.spacing(3),
                                marginRight: theme.spacing(3),
                            }, value: intentShade, min: 0, max: 13, step: 1, onChange: handleChangeShade(intent), "aria-labelledby": "".concat(intent, "ShadeSliderLabel") }), _jsx(Typography, { children: shades[intentShade] })] }), _jsx("div", { style: { width: 192 }, children: hues.map(function (hue) {
                        var shade = intent === 'primary'
                            ? shades[state.primaryShade]
                            : shades[state.secondaryShade];
                        // @ts-expect-error ts-migrate(7015) FIXME: Element implicitly has an 'any' type because index... Remove this comment to see the full error message
                        var backgroundColor = colors[hue][shade];
                        return (_jsx(Tooltip, { placement: "right", title: hue, children: _jsx(Radio, { sx: { padding: 0 }, color: "default", checked: state[intent] === backgroundColor, onChange: handleChangeHue(intent), value: hue, name: intent, "aria-labelledby": "tooltip-".concat(intent, "-").concat(hue), icon: _jsx("div", { style: {
                                        backgroundColor: backgroundColor,
                                        width: 48,
                                        height: 48,
                                    } }), checkedIcon: _jsx("div", { style: {
                                        backgroundColor: backgroundColor,
                                        width: 48,
                                        height: 48,
                                        border: '1px solid white',
                                        color: theme.palette.common.white,
                                        display: 'flex',
                                        justifyContent: 'center',
                                        alignItems: 'center',
                                    }, children: _jsx(CheckIcon, { style: { fontSize: 30 } }) }) }) }, hue));
                    }) }), colorBar(color, intent)] }));
    };
    return (_jsxs(Grid, { container: true, spacing: 5, className: classes === null || classes === void 0 ? void 0 : classes.root, children: [colorPicker('primary'), colorPicker('secondary')] }));
}
export default ColorTool;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItdG9vbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3dlYmFwcC9yZWFjdC1jb21wb25lbnQvdGhlbWUtc2V0dGluZ3MvY29sb3ItdG9vbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7R0FFRztBQUNILE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBRTlCLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sc0JBQXNCLENBQUE7QUFDekQsT0FBTyxNQUFNLE1BQU0sZ0JBQWdCLENBQUE7QUFDbkMsT0FBTyxJQUFJLE1BQU0sb0JBQW9CLENBQUE7QUFDckMsT0FBTyxLQUFLLE1BQU0scUJBQXFCLENBQUE7QUFDdkMsT0FBTyxLQUFLLE1BQU0scUJBQXFCLENBQUE7QUFDdkMsT0FBTyxPQUFPLE1BQU0sdUJBQXVCLENBQUE7QUFDM0MsT0FBTyxVQUFVLE1BQU0sMEJBQTBCLENBQUE7QUFDakQsT0FBTyxNQUFNLE1BQU0sc0JBQXNCLENBQUE7QUFDekMsT0FBTyxDQUFDLE1BQU0sUUFBUSxDQUFBO0FBQ3RCLE9BQU8sU0FBUyxNQUFNLDJCQUEyQixDQUFBO0FBQ2pELE9BQU8sTUFBTSxNQUFNLHNCQUFzQixDQUFBO0FBQ3pDLE9BQU8sSUFBSSxNQUFNLDBDQUEwQyxDQUFBO0FBQzNELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQTtBQUVoRCxJQUFNLE1BQU0sR0FBRztJQUNiLEdBQUc7SUFDSCxHQUFHO0lBQ0gsR0FBRztJQUNILEdBQUc7SUFDSCxHQUFHO0lBQ0gsR0FBRztJQUNILEdBQUc7SUFDSCxHQUFHO0lBQ0gsR0FBRztJQUNILEVBQUU7SUFDRixNQUFNO0lBQ04sTUFBTTtJQUNOLE1BQU07SUFDTixNQUFNO0NBQ1AsQ0FBQTtBQUNELElBQU0sY0FBYyxHQUFHLFVBQ3JCLEtBQVUsRUFDVixNQUE4QjtJQUU5QixPQUFPLE1B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QUFFLE1BQU0sQ0FBQyxJQUNuQixDQUNSLENBQUE7SUFDSCxDQUFDLENBQUE7SUFFRCxPQUFPLENBQ0wsTUFBQyxJQUFJLElBQUMsU0FBUyxRQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLE9BQU8sYUFBUCxPQUFPLHVCQUFQLE9BQU8sQ0FBRSxJQUFJLGFBQ2pELFdBQVcsQ0FBQyxTQUFTLENBQUMsRUFDdEIsV0FBVyxDQUFDLFdBQVcsQ0FBQyxJQUNwQixDQUNSLENBQUE7QUFDSCxDQUFDO0FBRUQsZUFBZSxTQUFTLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFkYXB0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vbXVpLW9yZy9tYXRlcmlhbC11aS9ibG9iL21hc3Rlci9kb2NzL3NyYy9wYWdlcy9jdXN0b21pemF0aW9uL2NvbG9yL0NvbG9yVG9vbC5qc1xuICovXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCdcblxuaW1wb3J0IHsgcmdiVG9IZXgsIHVzZVRoZW1lIH0gZnJvbSAnQG11aS9tYXRlcmlhbC9zdHlsZXMnXG5pbXBvcnQgY29sb3JzIGZyb20gJy4vdHlwZWQtY29sb3JzJ1xuaW1wb3J0IEdyaWQgZnJvbSAnQG11aS9tYXRlcmlhbC9HcmlkJ1xuaW1wb3J0IElucHV0IGZyb20gJ0BtdWkvbWF0ZXJpYWwvSW5wdXQnXG5pbXBvcnQgUmFkaW8gZnJvbSAnQG11aS9tYXRlcmlhbC9SYWRpbydcbmltcG9ydCBUb29sdGlwIGZyb20gJ0BtdWkvbWF0ZXJpYWwvVG9vbHRpcCdcbmltcG9ydCBUeXBvZ3JhcGh5IGZyb20gJ0BtdWkvbWF0ZXJpYWwvVHlwb2dyYXBoeSdcbmltcG9ydCBCdXR0b24gZnJvbSAnQG11aS9tYXRlcmlhbC9CdXR0b24nXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnXG5pbXBvcnQgQ2hlY2tJY29uIGZyb20gJ0BtdWkvaWNvbnMtbWF0ZXJpYWwvQ2hlY2snXG5pbXBvcnQgU2xpZGVyIGZyb20gJ0BtdWkvbWF0ZXJpYWwvU2xpZGVyJ1xuaW1wb3J0IHVzZXIgZnJvbSAnLi4vLi4vY29tcG9uZW50L3NpbmdsZXRvbnMvdXNlci1pbnN0YW5jZSdcbmltcG9ydCB7IGNhcGl0YWxpemUgfSBmcm9tICdAbXVpL21hdGVyaWFsL3V0aWxzJ1xuXG5jb25zdCBzaGFkZXMgPSBbXG4gIDkwMCxcbiAgODAwLFxuICA3MDAsXG4gIDYwMCxcbiAgNTAwLFxuICA0MDAsXG4gIDMwMCxcbiAgMjAwLFxuICAxMDAsXG4gIDUwLFxuICAnQTcwMCcsXG4gICdBNDAwJyxcbiAgJ0EyMDAnLFxuICAnQTEwMCcsXG5dXG5jb25zdCBjb250YWluc1NoYWRlcyA9IChcbiAgY29sb3I6IGFueSxcbiAgc2hhZGVzOiBBcnJheTxzdHJpbmcgfCBudW1iZXI+XG4pOiBib29sZWFuID0+IHtcbiAgcmV0dXJuIHNoYWRlcy5ldmVyeSgoc2hhZGUpID0+IE9iamVjdC5rZXlzKGNvbG9yKS5pbmNsdWRlcyhzaGFkZS50b1N0cmluZygpKSlcbn1cbmNvbnN0IGdldEh1ZXMgPSAoKSA9PiB7XG4gIGNvbnN0IGh1ZXMgPSBPYmplY3Qua2V5cyhjb2xvcnMpLmZpbHRlcigoaHVlKSA9PlxuICAgIGNvbnRhaW5zU2hhZGVzKGNvbG9yc1todWVdLCBzaGFkZXMpXG4gIClcbiAgcmV0dXJuIGh1ZXMuc2xpY2UoMSwgMTcpXG59XG5cbmNvbnN0IGh1ZXMgPSBnZXRIdWVzKClcblxuLyoqXG4gKiBDb3N0bHkgdG8gdXBkYXRlLCBzbyBsZXQgdGhlbSBzZXR0bGUgb24gYSBjb2xvciBmaXJzdFxuICovXG5jb25zdCB1cGRhdGVUaGVtZSA9IF8uZGVib3VuY2UoKHN0YXRlOiBhbnkpID0+IHtcbiAgdXNlci5nZXQoJ3VzZXInKS5nZXQoJ3ByZWZlcmVuY2VzJykuZ2V0KCd0aGVtZScpLnNldCh7XG4gICAgcHJpbWFyeTogc3RhdGUucHJpbWFyeSxcbiAgICBzZWNvbmRhcnk6IHN0YXRlLnNlY29uZGFyeSxcbiAgfSlcbn0sIDApXG5cbmNvbnN0IGdldERlZmF1bHRzID0gKCkgPT4ge1xuICByZXR1cm4ge1xuICAgIHByaW1hcnk6ICcjMjE5NmYzJyxcbiAgICBzZWNvbmRhcnk6ICcjZjUwMDU3JyxcbiAgICAuLi51c2VyLmdldCgndXNlcicpLmdldCgncHJlZmVyZW5jZXMnKS5nZXQoJ3RoZW1lJykudG9KU09OKCksXG4gIH1cbn1cblxuZnVuY3Rpb24gQ29sb3JUb29sKHByb3BzOiBhbnkpIHtcbiAgY29uc3QgeyBjbGFzc2VzIH0gPSBwcm9wc1xuICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKClcbiAgY29uc3QgZGVmYXVsdHMgPSBnZXREZWZhdWx0cygpIGFzIHsgcHJpbWFyeTogc3RyaW5nOyBzZWNvbmRhcnk6IHN0cmluZyB9XG4gIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gUmVhY3QudXNlU3RhdGUoe1xuICAgIHByaW1hcnk6IGRlZmF1bHRzLnByaW1hcnksXG4gICAgc2Vjb25kYXJ5OiBkZWZhdWx0cy5zZWNvbmRhcnksXG4gICAgcHJpbWFyeUlucHV0OiBkZWZhdWx0cy5wcmltYXJ5LFxuICAgIHNlY29uZGFyeUlucHV0OiBkZWZhdWx0cy5zZWNvbmRhcnksXG4gICAgcHJpbWFyeUh1ZTogJ2JsdWUnLFxuICAgIHNlY29uZGFyeUh1ZTogJ3BpbmsnLFxuICAgIHByaW1hcnlTaGFkZTogNCxcbiAgICBzZWNvbmRhcnlTaGFkZTogMTEsXG4gIH0pXG5cbiAgY29uc3QgaGFuZGxlQ2hhbmdlQ29sb3IgPSAobmFtZTogc3RyaW5nKSA9PiAoZXZlbnQ6IGFueSkgPT4ge1xuICAgIGNvbnN0IGlzUmdiID0gKHN0cmluZzogc3RyaW5nKSA9PlxuICAgICAgL3JnYlxcKFswLTldezEsM31cXHMqLFxccypbMC05XXsxLDN9XFxzKixcXHMqWzAtOV17MSwzfVxcKS9pLnRlc3Qoc3RyaW5nKVxuXG4gICAgY29uc3QgaXNIZXggPSAoc3RyaW5nOiBzdHJpbmcpID0+XG4gICAgICAvXiM/KFswLTlhLWZdezN9KSR8XiM/KFswLTlhLWZdKXs2fSQvaS50ZXN0KHN0cmluZylcblxuICAgIGxldCB7XG4gICAgICB0YXJnZXQ6IHsgdmFsdWU6IGNvbG9yIH0sXG4gICAgfSA9IGV2ZW50XG5cbiAgICBzZXRTdGF0ZSgocHJldlN0YXRlKSA9PiAoe1xuICAgICAgLi4ucHJldlN0YXRlLFxuICAgICAgW2Ake25hbWV9SW5wdXRgXTogY29sb3IsXG4gICAgfSkpXG5cbiAgICBsZXQgaXNWYWxpZENvbG9yID0gZmFsc2VcblxuICAgIGlmIChpc1JnYihjb2xvcikpIHtcbiAgICAgIGlzVmFsaWRDb2xvciA9IHRydWVcbiAgICB9IGVsc2UgaWYgKGlzSGV4KGNvbG9yKSkge1xuICAgICAgaXNWYWxpZENvbG9yID0gdHJ1ZVxuICAgICAgaWYgKGNvbG9yLmluZGV4T2YoJyMnKSA9PT0gLTEpIHtcbiAgICAgICAgY29sb3IgPSBgIyR7Y29sb3J9YFxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc1ZhbGlkQ29sb3IpIHtcbiAgICAgIHNldFN0YXRlKChwcmV2U3RhdGUpID0+ICh7XG4gICAgICAgIC4uLnByZXZTdGF0ZSxcbiAgICAgICAgW25hbWVdOiBjb2xvcixcbiAgICAgIH0pKVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGhhbmRsZUNoYW5nZUh1ZSA9IChuYW1lOiBzdHJpbmcpID0+IChldmVudDogYW55KSA9PiB7XG4gICAgY29uc3QgaHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlXG4gICAgY29uc3Qgc2hhZGUgPSBzdGF0ZVtgJHtuYW1lfVNoYWRlYCBhcyAncHJpbWFyeVNoYWRlJ11cblxuICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdHMtbWlncmF0ZSg3MDE1KSBGSVhNRTogRWxlbWVudCBpbXBsaWNpdGx5IGhhcyBhbiAnYW55JyB0eXBlIGJlY2F1c2UgaW5kZXguLi4gUmVtb3ZlIHRoaXMgY29tbWVudCB0byBzZWUgdGhlIGZ1bGwgZXJyb3IgbWVzc2FnZVxuICAgIGNvbnN0IGNvbG9yID0gY29sb3JzW2h1ZV1bc2hhZGVzW3NoYWRlXV1cblxuICAgIGlmIChjb2xvcikge1xuICAgICAgc2V0U3RhdGUoe1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgW2Ake25hbWV9SHVlYF06IGh1ZSxcbiAgICAgICAgW25hbWVdOiBjb2xvcixcbiAgICAgICAgW2Ake25hbWV9SW5wdXRgXTogY29sb3IsXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGhhbmRsZUNoYW5nZVNoYWRlID1cbiAgICAobmFtZTogc3RyaW5nKSA9PiAoX2V2ZW50OiBhbnksIHNoYWRlOiBzdHJpbmcgfCBudW1iZXIpID0+IHtcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdHMtbWlncmF0ZSg3MDUzKSBGSVhNRTogRWxlbWVudCBpbXBsaWNpdGx5IGhhcyBhbiAnYW55JyB0eXBlIGJlY2F1c2UgZXhwcmUuLi4gUmVtb3ZlIHRoaXMgY29tbWVudCB0byBzZWUgdGhlIGZ1bGwgZXJyb3IgbWVzc2FnZVxuICAgICAgY29uc3QgY29sb3IgPSBjb2xvcnNbc3RhdGVbYCR7bmFtZX1IdWVgXV1bc2hhZGVzW3NoYWRlXV1cbiAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIFtgJHtuYW1lfVNoYWRlYF06IHNoYWRlLFxuICAgICAgICBbbmFtZV06IGNvbG9yLFxuICAgICAgICBbYCR7bmFtZX1JbnB1dGBdOiBjb2xvcixcbiAgICAgIH0pXG4gICAgfVxuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgdXBkYXRlVGhlbWUoc3RhdGUpXG4gIH0sIFtzdGF0ZV0pXG5cbiAgY29uc3QgY29sb3JCYXIgPSAoY29sb3I6IGFueSwgaW50ZW50OiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBiYWNrZ3JvdW5kID0gdGhlbWUucGFsZXR0ZS5hdWdtZW50Q29sb3Ioe1xuICAgICAgY29sb3I6IHtcbiAgICAgICAgbWFpbjogY29sb3IsXG4gICAgICB9LFxuICAgIH0pXG5cbiAgICByZXR1cm4gKFxuICAgICAgPEdyaWQgY29udGFpbmVyIHN4PXt7IG1hcmdpblRvcDogdGhlbWUuc3BhY2luZygyKSB9fT5cbiAgICAgICAge1snZGFyaycsICdtYWluJywgJ2xpZ2h0J10ubWFwKChrZXkpID0+IHtcbiAgICAgICAgICBjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBiYWNrZ3JvdW5kW2tleSBhcyAnbGlnaHQnXSBhcyBzdHJpbmdcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPFRvb2x0aXBcbiAgICAgICAgICAgICAgcGxhY2VtZW50PVwicmlnaHRcIlxuICAgICAgICAgICAgICB0aXRsZT17KCgpID0+IHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgICAgICAgY2FzZSAnZGFyayc6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnR28gZGFya2VyJ1xuICAgICAgICAgICAgICAgICAgY2FzZSAnbGlnaHQnOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ0dvIGxpZ2h0ZXInXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ0N1cnJlbnQgc2hhZGUnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KSgpfVxuICAgICAgICAgICAgICBrZXk9e2tleX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIHN4PXt7XG4gICAgICAgICAgICAgICAgICB3aWR0aDogNjQsXG4gICAgICAgICAgICAgICAgICBoZWlnaHQ6IDY0LFxuICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLFxuICAgICAgICAgICAgICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBzZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICAgICAgICBbaW50ZW50XTogcmdiVG9IZXgoYmFja2dyb3VuZENvbG9yKSxcbiAgICAgICAgICAgICAgICAgICAgW2Ake2ludGVudH1JbnB1dGBdOiByZ2JUb0hleChiYWNrZ3JvdW5kQ29sb3IpLFxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPFR5cG9ncmFwaHlcbiAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9XCJjYXB0aW9uXCJcbiAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVtZS5wYWxldHRlLmdldENvbnRyYXN0VGV4dChiYWNrZ3JvdW5kQ29sb3IpLFxuICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICB7cmdiVG9IZXgoYmFja2dyb3VuZENvbG9yKX1cbiAgICAgICAgICAgICAgICA8L1R5cG9ncmFwaHk+XG4gICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgPC9Ub29sdGlwPlxuICAgICAgICAgIClcbiAgICAgICAgfSl9XG4gICAgICA8L0dyaWQ+XG4gICAgKVxuICB9XG5cbiAgY29uc3QgY29sb3JQaWNrZXIgPSAoaW50ZW50OiAncHJpbWFyeScgfCAnc2Vjb25kYXJ5JykgPT4ge1xuICAgIGNvbnN0IGludGVudElucHV0ID0gc3RhdGVbYCR7aW50ZW50fUlucHV0YCBhcyAncHJpbWFyeUlucHV0J11cbiAgICBjb25zdCBpbnRlbnRTaGFkZSA9IHN0YXRlW2Ake2ludGVudH1TaGFkZWAgYXMgJ3ByaW1hcnlTaGFkZSddXG4gICAgY29uc3QgY29sb3IgPSBzdGF0ZVtgJHtpbnRlbnR9YCBhcyAncHJpbWFyeSddXG5cbiAgICByZXR1cm4gKFxuICAgICAgPEdyaWQgaXRlbSB4cz17MTJ9IHNtPXs2fSBtZD17NH0gY2xhc3NOYW1lPVwibWluLXctMTA0XCI+XG4gICAgICAgIDxUeXBvZ3JhcGh5XG4gICAgICAgICAgY29tcG9uZW50PVwibGFiZWxcIlxuICAgICAgICAgIGd1dHRlckJvdHRvbVxuICAgICAgICAgIGh0bWxGb3I9e2ludGVudH1cbiAgICAgICAgICB2YXJpYW50PVwiaDZcIlxuICAgICAgICA+XG4gICAgICAgICAge2NhcGl0YWxpemUoaW50ZW50KX1cbiAgICAgICAgPC9UeXBvZ3JhcGh5PlxuICAgICAgICA8SW5wdXRcbiAgICAgICAgICBpZD17aW50ZW50fVxuICAgICAgICAgIHZhbHVlPXtpbnRlbnRJbnB1dH1cbiAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlQ2hhbmdlQ29sb3IoaW50ZW50KX1cbiAgICAgICAgICBmdWxsV2lkdGhcbiAgICAgICAgLz5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICAgICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgICAgICAgIG1hcmdpblRvcDogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgICAgICB9fVxuICAgICAgICA+XG4gICAgICAgICAgPFR5cG9ncmFwaHkgaWQ9e2Ake2ludGVudH1TaGFkZVNsaWRlckxhYmVsYH0+U2hhZGU6PC9UeXBvZ3JhcGh5PlxuICAgICAgICAgIDxTbGlkZXJcbiAgICAgICAgICAgIHN4PXt7XG4gICAgICAgICAgICAgIHdpZHRoOiAnY2FsYygxMDAlIC0gODBweCknLFxuICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiB0aGVtZS5zcGFjaW5nKDMpLFxuICAgICAgICAgICAgICBtYXJnaW5SaWdodDogdGhlbWUuc3BhY2luZygzKSxcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICB2YWx1ZT17aW50ZW50U2hhZGV9XG4gICAgICAgICAgICBtaW49ezB9XG4gICAgICAgICAgICBtYXg9ezEzfVxuICAgICAgICAgICAgc3RlcD17MX1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVDaGFuZ2VTaGFkZShpbnRlbnQpIGFzIGFueX1cbiAgICAgICAgICAgIGFyaWEtbGFiZWxsZWRieT17YCR7aW50ZW50fVNoYWRlU2xpZGVyTGFiZWxgfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPFR5cG9ncmFwaHk+e3NoYWRlc1tpbnRlbnRTaGFkZV19PC9UeXBvZ3JhcGh5PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT17eyB3aWR0aDogMTkyIH19PlxuICAgICAgICAgIHtodWVzLm1hcCgoaHVlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzaGFkZSA9XG4gICAgICAgICAgICAgIGludGVudCA9PT0gJ3ByaW1hcnknXG4gICAgICAgICAgICAgICAgPyBzaGFkZXNbc3RhdGUucHJpbWFyeVNoYWRlXVxuICAgICAgICAgICAgICAgIDogc2hhZGVzW3N0YXRlLnNlY29uZGFyeVNoYWRlXVxuXG4gICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIHRzLW1pZ3JhdGUoNzAxNSkgRklYTUU6IEVsZW1lbnQgaW1wbGljaXRseSBoYXMgYW4gJ2FueScgdHlwZSBiZWNhdXNlIGluZGV4Li4uIFJlbW92ZSB0aGlzIGNvbW1lbnQgdG8gc2VlIHRoZSBmdWxsIGVycm9yIG1lc3NhZ2VcbiAgICAgICAgICAgIGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGNvbG9yc1todWVdW3NoYWRlXSBhcyBzdHJpbmdcblxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgPFRvb2x0aXAgcGxhY2VtZW50PVwicmlnaHRcIiB0aXRsZT17aHVlfSBrZXk9e2h1ZX0+XG4gICAgICAgICAgICAgICAgPFJhZGlvXG4gICAgICAgICAgICAgICAgICBzeD17eyBwYWRkaW5nOiAwIH19XG4gICAgICAgICAgICAgICAgICBjb2xvcj1cImRlZmF1bHRcIlxuICAgICAgICAgICAgICAgICAgY2hlY2tlZD17c3RhdGVbaW50ZW50XSA9PT0gYmFja2dyb3VuZENvbG9yfVxuICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZUh1ZShpbnRlbnQpfVxuICAgICAgICAgICAgICAgICAgdmFsdWU9e2h1ZX1cbiAgICAgICAgICAgICAgICAgIG5hbWU9e2ludGVudH1cbiAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWxsZWRieT17YHRvb2x0aXAtJHtpbnRlbnR9LSR7aHVlfWB9XG4gICAgICAgICAgICAgICAgICBpY29uPXtcbiAgICAgICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogNDgsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQ4LFxuICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBjaGVja2VkSWNvbj17XG4gICAgICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDQ4LFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0OCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCB3aGl0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgPENoZWNrSWNvbiBzdHlsZT17eyBmb250U2l6ZTogMzAgfX0gLz5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPC9Ub29sdGlwPlxuICAgICAgICAgICAgKVxuICAgICAgICAgIH0pfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAge2NvbG9yQmFyKGNvbG9yLCBpbnRlbnQpfVxuICAgICAgPC9HcmlkPlxuICAgIClcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPEdyaWQgY29udGFpbmVyIHNwYWNpbmc9ezV9IGNsYXNzTmFtZT17Y2xhc3Nlcz8ucm9vdH0+XG4gICAgICB7Y29sb3JQaWNrZXIoJ3ByaW1hcnknKX1cbiAgICAgIHtjb2xvclBpY2tlcignc2Vjb25kYXJ5Jyl9XG4gICAgPC9HcmlkPlxuICApXG59XG5cbmV4cG9ydCBkZWZhdWx0IENvbG9yVG9vbFxuIl19