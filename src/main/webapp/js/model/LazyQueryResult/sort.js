/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import { StartupDataStore } from '../Startup/startup';
function parseMultiValue(value) {
    if (value && Array.isArray(value)) {
        return value[0];
    }
    return value;
}
function isEmpty(value) {
    return value === undefined || value === null;
}
function parseValue(value, attribute) {
    var attributeDefinition = StartupDataStore.MetacardDefinitions.getAttributeMap()[attribute];
    if (!attributeDefinition) {
        return value.toString().toLowerCase();
    }
    switch (attributeDefinition.type) {
        case 'DATE':
        case 'BOOLEAN':
            return value;
        case 'STRING':
            return value.toString().toLowerCase();
        default:
            return parseFloat(value);
    }
}
function compareValues(aVal, bVal, sorting) {
    var sortOrder = sorting.direction === 'descending' ? -1 : 1;
    aVal = parseValue(aVal, sorting.attribute);
    bVal = parseValue(bVal, sorting.attribute);
    if (aVal < bVal) {
        return sortOrder * -1;
    }
    if (aVal > bVal) {
        return sortOrder;
    }
    return 0;
}
function checkSortValue(a, b, sorting) {
    var aVal = parseMultiValue(a.plain.metacard.properties[sorting.attribute]);
    var bVal = parseMultiValue(b.plain.metacard.properties[sorting.attribute]);
    if (isEmpty(aVal) && isEmpty(bVal)) {
        return 0;
    }
    if (isEmpty(aVal)) {
        return 1;
    }
    if (isEmpty(bVal)) {
        return -1;
    }
    return compareValues(aVal, bVal, sorting);
}
export var generateCompareFunction = function (sorting) {
    if (!sorting) {
        throw new Error("Sorting can't be undefined!");
    }
    return function (a, b) {
        var sortValue = 0;
        for (var i = 0; i <= sorting.length - 1; i++) {
            var sortField = sorting[i].attribute;
            var sortOrder = sorting[i].direction === 'descending' ? -1 : 1;
            switch (sortField) {
                case 'RELEVANCE':
                    sortValue = sortOrder * (a.plain.relevance - b.plain.relevance);
                    break;
                case 'DISTANCE':
                    // this says distance could be null, could be a bug we need to address
                    // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.
                    sortValue = sortOrder * (a.plain.distance - b.plain.distance);
                    break;
                default:
                    sortValue = checkSortValue(a, b, sorting[i]);
            }
            if (sortValue !== 0) {
                break;
            }
        }
        return sortValue;
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3dlYmFwcC9qcy9tb2RlbC9MYXp5UXVlcnlSZXN1bHQvc29ydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7SUFhSTtBQUVKLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBSXJELFNBQVMsZUFBZSxDQUFDLEtBQVU7SUFDakMsSUFBSSxLQUFLLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ2xDLE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ2pCLENBQUM7SUFDRCxPQUFPLEtBQUssQ0FBQTtBQUNkLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBQyxLQUFVO0lBQ3pCLE9BQU8sS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLEtBQUssSUFBSSxDQUFBO0FBQzlDLENBQUM7QUFFRCxTQUFTLFVBQVUsQ0FBQyxLQUFVLEVBQUUsU0FBaUI7SUFDL0MsSUFBTSxtQkFBbUIsR0FDdkIsZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsZUFBZSxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUE7SUFDbkUsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFDekIsT0FBTyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7SUFDdkMsQ0FBQztJQUNELFFBQVEsbUJBQW1CLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakMsS0FBSyxNQUFNLENBQUM7UUFDWixLQUFLLFNBQVM7WUFDWixPQUFPLEtBQUssQ0FBQTtRQUNkLEtBQUssUUFBUTtZQUNYLE9BQU8sS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFBO1FBQ3ZDO1lBQ0UsT0FBTyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDNUIsQ0FBQztBQUNILENBQUM7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RUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDaEQsQ0FBQztZQUNELElBQUksU0FBUyxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUNwQixNQUFLO1lBQ1AsQ0FBQztRQUNILENBQUM7UUFDRCxPQUFPLFNBQVMsQ0FBQTtJQUNsQixDQUFDLENBQUE7QUFDSCxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgQ29kaWNlIEZvdW5kYXRpb25cbiAqXG4gKiBUaGlzIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyXG4gKiBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZVxuICogTGljZW5zZSwgb3IgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dFxuICogZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VXG4gKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLiBBIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogaXMgZGlzdHJpYnV0ZWQgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0gYW5kIGNhbiBiZSBmb3VuZCBhdFxuICogPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3BsLmh0bWw+LlxuICpcbiAqKi9cblxuaW1wb3J0IHsgU3RhcnR1cERhdGFTdG9yZSB9IGZyb20gJy4uL1N0YXJ0dXAvc3RhcnR1cCdcbmltcG9ydCB7IExhenlRdWVyeVJlc3VsdCB9IGZyb20gJy4vTGF6eVF1ZXJ5UmVzdWx0J1xuaW1wb3J0IHsgUXVlcnlTb3J0VHlwZSB9IGZyb20gJy4vdHlwZXMnXG5cbmZ1bmN0aW9uIHBhcnNlTXVsdGlWYWx1ZSh2YWx1ZTogYW55KSB7XG4gIGlmICh2YWx1ZSAmJiBBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIHJldHVybiB2YWx1ZVswXVxuICB9XG4gIHJldHVybiB2YWx1ZVxufVxuXG5mdW5jdGlvbiBpc0VtcHR5KHZhbHVlOiBhbnkpIHtcbiAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGxcbn1cblxuZnVuY3Rpb24gcGFyc2VWYWx1ZSh2YWx1ZTogYW55LCBhdHRyaWJ1dGU6IHN0cmluZykge1xuICBjb25zdCBhdHRyaWJ1dGVEZWZpbml0aW9uID1cbiAgICBTdGFydHVwRGF0YVN0b3JlLk1ldGFjYXJkRGVmaW5pdGlvbnMuZ2V0QXR0cmlidXRlTWFwKClbYXR0cmlidXRlXVxuICBpZiAoIWF0dHJpYnV0ZURlZmluaXRpb24pIHtcbiAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpXG4gIH1cbiAgc3dpdGNoIChhdHRyaWJ1dGVEZWZpbml0aW9uLnR5cGUpIHtcbiAgICBjYXNlICdEQVRFJzpcbiAgICBjYXNlICdCT09MRUFOJzpcbiAgICAgIHJldHVybiB2YWx1ZVxuICAgIGNhc2UgJ1NUUklORyc6XG4gICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVWYWx1ZXMoYVZhbDogYW55LCBiVmFsOiBhbnksIHNvcnRpbmc6IFF1ZXJ5U29ydFR5cGUpIHtcbiAgY29uc3Qgc29ydE9yZGVyID0gc29ydGluZy5kaXJlY3Rpb24gPT09ICdkZXNjZW5kaW5nJyA/IC0xIDogMVxuICBhVmFsID0gcGFyc2VWYWx1ZShhVmFsLCBzb3J0aW5nLmF0dHJpYnV0ZSlcbiAgYlZhbCA9IHBhcnNlVmFsdWUoYlZhbCwgc29ydGluZy5hdHRyaWJ1dGUpXG4gIGlmIChhVmFsIDwgYlZhbCkge1xuICAgIHJldHVybiBzb3J0T3JkZXIgKiAtMVxuICB9XG4gIGlmIChhVmFsID4gYlZhbCkge1xuICAgIHJldHVybiBzb3J0T3JkZXJcbiAgfVxuICByZXR1cm4gMFxufVxuXG5mdW5jdGlvbiBjaGVja1NvcnRWYWx1ZShcbiAgYTogTGF6eVF1ZXJ5UmVzdWx0LFxuICBiOiBMYXp5UXVlcnlSZXN1bHQsXG4gIHNvcnRpbmc6IFF1ZXJ5U29ydFR5cGVcbikge1xuICBjb25zdCBhVmFsID0gcGFyc2VNdWx0aVZhbHVlKGEucGxhaW4ubWV0YWNhcmQucHJvcGVydGllc1tzb3J0aW5nLmF0dHJpYnV0ZV0pXG4gIGNvbnN0IGJWYWwgPSBwYXJzZU11bHRpVmFsdWUoYi5wbGFpbi5tZXRhY2FyZC5wcm9wZXJ0aWVzW3NvcnRpbmcuYXR0cmlidXRlXSlcbiAgaWYgKGlzRW1wdHkoYVZhbCkgJiYgaXNFbXB0eShiVmFsKSkge1xuICAgIHJldHVybiAwXG4gIH1cbiAgaWYgKGlzRW1wdHkoYVZhbCkpIHtcbiAgICByZXR1cm4gMVxuICB9XG4gIGlmIChpc0VtcHR5KGJWYWwpKSB7XG4gICAgcmV0dXJuIC0xXG4gIH1cbiAgcmV0dXJuIGNvbXBhcmVWYWx1ZXMoYVZhbCwgYlZhbCwgc29ydGluZylcbn1cblxuZXhwb3J0IGNvbnN0IGdlbmVyYXRlQ29tcGFyZUZ1bmN0aW9uID0gKHNvcnRpbmc6IFF1ZXJ5U29ydFR5cGVbXSkgPT4ge1xuICBpZiAoIXNvcnRpbmcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFNvcnRpbmcgY2FuJ3QgYmUgdW5kZWZpbmVkIWApXG4gIH1cbiAgcmV0dXJuIGZ1bmN0aW9uIChhOiBMYXp5UXVlcnlSZXN1bHQsIGI6IExhenlRdWVyeVJlc3VsdCkge1xuICAgIGxldCBzb3J0VmFsdWUgPSAwXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gc29ydGluZy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgIGNvbnN0IHNvcnRGaWVsZCA9IHNvcnRpbmdbaV0uYXR0cmlidXRlXG4gICAgICBjb25zdCBzb3J0T3JkZXIgPSBzb3J0aW5nW2ldLmRpcmVjdGlvbiA9PT0gJ2Rlc2NlbmRpbmcnID8gLTEgOiAxXG4gICAgICBzd2l0Y2ggKHNvcnRGaWVsZCkge1xuICAgICAgICBjYXNlICdSRUxFVkFOQ0UnOlxuICAgICAgICAgIHNvcnRWYWx1ZSA9IHNvcnRPcmRlciAqIChhLnBsYWluLnJlbGV2YW5jZSAtIGIucGxhaW4ucmVsZXZhbmNlKVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgJ0RJU1RBTkNFJzpcbiAgICAgICAgICAvLyB0aGlzIHNheXMgZGlzdGFuY2UgY291bGQgYmUgbnVsbCwgY291bGQgYmUgYSBidWcgd2UgbmVlZCB0byBhZGRyZXNzXG5cbiAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIHRzLW1pZ3JhdGUoMjUzMSkgRklYTUU6IE9iamVjdCBpcyBwb3NzaWJseSAnbnVsbCcuXG4gICAgICAgICAgc29ydFZhbHVlID0gc29ydE9yZGVyICogKGEucGxhaW4uZGlzdGFuY2UgLSBiLnBsYWluLmRpc3RhbmNlKVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgc29ydFZhbHVlID0gY2hlY2tTb3J0VmFsdWUoYSwgYiwgc29ydGluZ1tpXSlcbiAgICAgIH1cbiAgICAgIGlmIChzb3J0VmFsdWUgIT09IDApIHtcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNvcnRWYWx1ZVxuICB9XG59XG4iXX0=