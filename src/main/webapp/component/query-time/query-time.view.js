import { __assign } from "tslib";
import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import * as React from 'react';
import TextField from '@mui/material/TextField';
import MenuItem from '@mui/material/MenuItem';
import Autocomplete from '@mui/material/Autocomplete';
import Chip from '@mui/material/Chip';
import Grid from '@mui/material/Grid';
import Swath from '../swath/swath';
import FilterInput from '../../react-component/filter/filter-input';
import Checkbox from '@mui/material/Checkbox';
import FormControlLabel from '@mui/material/FormControlLabel';
import { StartupDataStore } from '../../js/model/Startup/startup';
var getPossibleProperties = function () {
    return StartupDataStore.MetacardDefinitions.getSortedAttributes()
        .filter(function (definition) { return !definition.hidden && definition.type === 'DATE'; })
        .map(function (definition) { return ({
        label: definition.alias || definition.id,
        value: definition.id,
    }); });
};
var getDefaultPropertiesToApplyTo = function () {
    return (StartupDataStore.Configuration.getBasicSearchTemporalSelectionDefault() ||
        []).map(function (property) {
        return {
            label: StartupDataStore.MetacardDefinitions.getAlias(property),
            value: property,
        };
    });
};
var determinePropertiesToApplyTo = function (_a) {
    var value = _a.value;
    if (value.property) {
        return value.property
            .filter(function (prop) { return prop !== 'anyDate'; })
            .map(function (property) {
            return {
                label: StartupDataStore.MetacardDefinitions.getAlias(property),
                value: property,
            };
        });
    }
    else {
        return getDefaultPropertiesToApplyTo();
    }
};
var QueryTime = function (_a) {
    var value = _a.value, onChange = _a.onChange;
    React.useEffect(function () {
        if (value && value.property === undefined) {
            onChange(__assign(__assign({}, value), { property: determinePropertiesToApplyTo({ value: value }).map(function (val) { return val.value; }) }));
        }
    }, [value]);
    if (value && value.property === undefined) {
        return null; // the use effect above should fire to take care of setting a default
    }
    return (_jsx(_Fragment, { children: _jsxs("div", { children: [_jsx(FormControlLabel, { labelPlacement: "end", control: _jsx(Checkbox, { color: "default", checked: value ? true : false, onChange: function (e) {
                            if (e.target.checked) {
                                onChange(__assign(__assign({}, value), { type: 'AFTER', property: getDefaultPropertiesToApplyTo().map(function (val) { return val.value; }) }));
                            }
                            else {
                                onChange(undefined);
                            }
                        } }), label: "Time" }), value ? (_jsxs(Grid, { container: true, alignItems: "stretch", direction: "column", wrap: "nowrap", className: "pt-2", children: [_jsx(Grid, { item: true, className: "w-full pb-2", children: _jsx(Autocomplete, { fullWidth: true, multiple: true, options: getPossibleProperties(), disableCloseOnSelect: true, getOptionLabel: function (option) { return option.label; }, isOptionEqualToValue: function (option, value) {
                                    return option.value === value.value;
                                }, onChange: function (_e, newValue) {
                                    onChange(__assign(__assign({}, value), { property: newValue.map(function (val) { return val.value; }) }));
                                }, size: "small", renderTags: function (tagValue, getTagProps) {
                                    return tagValue.map(function (option, index) { return (_jsx(Chip, __assign({ variant: "outlined", color: "default", label: option.label }, getTagProps({ index: index })))); });
                                }, value: determinePropertiesToApplyTo({ value: value }), renderInput: function (params) { return (_jsx(TextField, __assign({}, params, { variant: "outlined" }))); } }) }), _jsxs(Grid, { container: true, alignItems: "stretch", direction: "row", wrap: "nowrap", className: "pt-2", children: [_jsx(Grid, { item: true, children: _jsx(Swath, { className: "w-1 h-full" }) }), _jsxs(Grid, { container: true, direction: "column", children: [_jsx(Grid, { item: true, className: "w-full pl-2 pb-2", children: _jsxs(TextField, { fullWidth: true, variant: "outlined", size: "small", select: true, value: value.type, onChange: function (e) {
                                                    onChange(__assign(__assign({}, value), { type: e.target.value }));
                                                }, children: [_jsx(MenuItem, { value: "AFTER", children: "After" }), _jsx(MenuItem, { value: "BEFORE", children: "Before" }), _jsx(MenuItem, { value: "DURING", children: "Between" }), _jsx(MenuItem, { value: "RELATIVE", children: "Within the last" }), _jsx(MenuItem, { value: "AROUND", children: "Around" })] }) }), _jsx(Grid, { item: true, className: "w-full pl-2", children: _jsx(FilterInput, { filter: __assign(__assign({}, value), { property: value.property[0] }), setFilter: function (val) {
                                                    onChange(__assign(__assign({}, value), { value: val.value }));
                                                } }) })] })] })] })) : null] }) }));
};
export default QueryTime;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcnktdGltZS52aWV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL21haW4vd2ViYXBwL2NvbXBvbmVudC9xdWVyeS10aW1lL3F1ZXJ5LXRpbWUudmlldy50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7Ozs7Ozs7OztJQWFJO0FBQ0osT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDOUIsT0FBTyxTQUFTLE1BQU0seUJBQXlCLENBQUE7QUFDL0MsT0FBTyxRQUFRLE1BQU0sd0JBQXdCLENBQUE7QUFFN0MsT0FBTyxZQUFZLE1BQU0sNEJBQTRCLENBQUE7QUFDckQsT0FBTyxJQUFJLE1BQU0sb0JBQW9CLENBQUE7QUFDckMsT0FBTyxJQUFJLE1BQU0sb0JBQW9CLENBQUE7QUFDckMsT0FBTyxLQUFLLE1BQU0sZ0JBQWdCLENBQUE7QUFDbEMsT0FBTyxXQUFXLE1BQU0sMkNBQTJDLENBQUE7QUFDbkUsT0FBTyxRQUFRLE1BQU0sd0JBQXdCLENBQUE7QUFDN0MsT0FBTyxnQkFBZ0IsTUFBTSxnQ0FBZ0MsQ0FBQTtBQUM3RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQTtBQVFqRSxJQUFNLHFCQUFxQixHQUFHO0lBQzVCLE9BQU8sZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsbUJBQW1CLEVBQUU7U0FDOUQsTUFBTSxDQUNMLFVBQUMsVUFBZSxJQUFLLE9BQUEsQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLFVBQVUsQ0FBQyxJQUFJLEtBQUssTUFBTSxFQUFoRCxDQUFnRCxDQUN0RTtTQUNBLEdBQUcsQ0FBQyxVQUFDLFVBQWUsSUFBSyxPQUFBLENBQUM7UUFDekIsS0FBSyxFQUFFLFVBQVUsQ0FBQyxLQUFLLElBQUksVUFBVSxDQUFDLEVBQUU7UUFDeEMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxFQUFFO0tBQ3JCLENBQUMsRUFId0IsQ0FHeEIsQ0FLSCxDQUFB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Q0FBQyxDQUFDLENBQUMsSUFBSSxJQUNKLEdBQ0wsQ0FDSixDQUFBO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsZUFBZSxTQUFTLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgQ29kaWNlIEZvdW5kYXRpb25cbiAqXG4gKiBUaGlzIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyXG4gKiBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZVxuICogTGljZW5zZSwgb3IgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dFxuICogZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VXG4gKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLiBBIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogaXMgZGlzdHJpYnV0ZWQgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0gYW5kIGNhbiBiZSBmb3VuZCBhdFxuICogPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3BsLmh0bWw+LlxuICpcbiAqKi9cbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFRleHRGaWVsZCBmcm9tICdAbXVpL21hdGVyaWFsL1RleHRGaWVsZCdcbmltcG9ydCBNZW51SXRlbSBmcm9tICdAbXVpL21hdGVyaWFsL01lbnVJdGVtJ1xuXG5pbXBvcnQgQXV0b2NvbXBsZXRlIGZyb20gJ0BtdWkvbWF0ZXJpYWwvQXV0b2NvbXBsZXRlJ1xuaW1wb3J0IENoaXAgZnJvbSAnQG11aS9tYXRlcmlhbC9DaGlwJ1xuaW1wb3J0IEdyaWQgZnJvbSAnQG11aS9tYXRlcmlhbC9HcmlkJ1xuaW1wb3J0IFN3YXRoIGZyb20gJy4uL3N3YXRoL3N3YXRoJ1xuaW1wb3J0IEZpbHRlcklucHV0IGZyb20gJy4uLy4uL3JlYWN0LWNvbXBvbmVudC9maWx0ZXIvZmlsdGVyLWlucHV0J1xuaW1wb3J0IENoZWNrYm94IGZyb20gJ0BtdWkvbWF0ZXJpYWwvQ2hlY2tib3gnXG5pbXBvcnQgRm9ybUNvbnRyb2xMYWJlbCBmcm9tICdAbXVpL21hdGVyaWFsL0Zvcm1Db250cm9sTGFiZWwnXG5pbXBvcnQgeyBTdGFydHVwRGF0YVN0b3JlIH0gZnJvbSAnLi4vLi4vanMvbW9kZWwvU3RhcnR1cC9zdGFydHVwJ1xuaW1wb3J0IHsgQmFzaWNGaWx0ZXJDbGFzcyB9IGZyb20gJy4uL2ZpbHRlci1idWlsZGVyL2ZpbHRlci5zdHJ1Y3R1cmUnXG5cbnR5cGUgUXVlcnlUaW1lUHJvcHMgPSB7XG4gIHZhbHVlOiB1bmRlZmluZWQgfCBCYXNpY0ZpbHRlckNsYXNzXG4gIG9uQ2hhbmdlOiAoZTogYW55KSA9PiB2b2lkXG59XG5cbmNvbnN0IGdldFBvc3NpYmxlUHJvcGVydGllcyA9ICgpID0+IHtcbiAgcmV0dXJuIFN0YXJ0dXBEYXRhU3RvcmUuTWV0YWNhcmREZWZpbml0aW9ucy5nZXRTb3J0ZWRBdHRyaWJ1dGVzKClcbiAgICAuZmlsdGVyKFxuICAgICAgKGRlZmluaXRpb246IGFueSkgPT4gIWRlZmluaXRpb24uaGlkZGVuICYmIGRlZmluaXRpb24udHlwZSA9PT0gJ0RBVEUnXG4gICAgKVxuICAgIC5tYXAoKGRlZmluaXRpb246IGFueSkgPT4gKHtcbiAgICAgIGxhYmVsOiBkZWZpbml0aW9uLmFsaWFzIHx8IGRlZmluaXRpb24uaWQsXG4gICAgICB2YWx1ZTogZGVmaW5pdGlvbi5pZCxcbiAgICB9KSkgYXMgW1xuICAgIHtcbiAgICAgIGxhYmVsOiBzdHJpbmdcbiAgICAgIHZhbHVlOiBzdHJpbmdcbiAgICB9XG4gIF1cbn1cblxuY29uc3QgZ2V0RGVmYXVsdFByb3BlcnRpZXNUb0FwcGx5VG8gPSAoKToge1xuICBsYWJlbDogc3RyaW5nXG4gIHZhbHVlOiBzdHJpbmdcbn1bXSA9PiB7XG4gIHJldHVybiAoXG4gICAgU3RhcnR1cERhdGFTdG9yZS5Db25maWd1cmF0aW9uLmdldEJhc2ljU2VhcmNoVGVtcG9yYWxTZWxlY3Rpb25EZWZhdWx0KCkgfHxcbiAgICBbXVxuICApLm1hcCgocHJvcGVydHk6IHN0cmluZykgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBsYWJlbDogU3RhcnR1cERhdGFTdG9yZS5NZXRhY2FyZERlZmluaXRpb25zLmdldEFsaWFzKHByb3BlcnR5KSxcbiAgICAgIHZhbHVlOiBwcm9wZXJ0eSxcbiAgICB9XG4gIH0pXG59XG5cbmNvbnN0IGRldGVybWluZVByb3BlcnRpZXNUb0FwcGx5VG8gPSAoe1xuICB2YWx1ZSxcbn06IHtcbiAgdmFsdWU6IEJhc2ljRmlsdGVyQ2xhc3Ncbn0pOiBBcnJheTx7IGxhYmVsOiBzdHJpbmc7IHZhbHVlOiBzdHJpbmcgfT4gPT4ge1xuICBpZiAodmFsdWUucHJvcGVydHkpIHtcbiAgICByZXR1cm4gdmFsdWUucHJvcGVydHlcbiAgICAgIC5maWx0ZXIoKHByb3ApID0+IHByb3AgIT09ICdhbnlEYXRlJylcbiAgICAgIC5tYXAoKHByb3BlcnR5KSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbGFiZWw6IFN0YXJ0dXBEYXRhU3RvcmUuTWV0YWNhcmREZWZpbml0aW9ucy5nZXRBbGlhcyhwcm9wZXJ0eSksXG4gICAgICAgICAgdmFsdWU6IHByb3BlcnR5LFxuICAgICAgICB9XG4gICAgICB9KVxuICB9IGVsc2Uge1xuICAgIHJldHVybiBnZXREZWZhdWx0UHJvcGVydGllc1RvQXBwbHlUbygpXG4gIH1cbn1cblxuY29uc3QgUXVlcnlUaW1lID0gKHsgdmFsdWUsIG9uQ2hhbmdlIH06IFF1ZXJ5VGltZVByb3BzKSA9PiB7XG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHZhbHVlICYmIHZhbHVlLnByb3BlcnR5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgLi4udmFsdWUsXG4gICAgICAgIHByb3BlcnR5OiBkZXRlcm1pbmVQcm9wZXJ0aWVzVG9BcHBseVRvKHsgdmFsdWUgfSkubWFwKFxuICAgICAgICAgICh2YWwpID0+IHZhbC52YWx1ZVxuICAgICAgICApLFxuICAgICAgfSlcbiAgICB9XG4gIH0sIFt2YWx1ZV0pXG4gIGlmICh2YWx1ZSAmJiB2YWx1ZS5wcm9wZXJ0eSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIG51bGwgLy8gdGhlIHVzZSBlZmZlY3QgYWJvdmUgc2hvdWxkIGZpcmUgdG8gdGFrZSBjYXJlIG9mIHNldHRpbmcgYSBkZWZhdWx0XG4gIH1cbiAgcmV0dXJuIChcbiAgICA8PlxuICAgICAgPGRpdj5cbiAgICAgICAgPEZvcm1Db250cm9sTGFiZWxcbiAgICAgICAgICBsYWJlbFBsYWNlbWVudD1cImVuZFwiXG4gICAgICAgICAgY29udHJvbD17XG4gICAgICAgICAgICA8Q2hlY2tib3hcbiAgICAgICAgICAgICAgY29sb3I9XCJkZWZhdWx0XCJcbiAgICAgICAgICAgICAgY2hlY2tlZD17dmFsdWUgPyB0cnVlIDogZmFsc2V9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgICBvbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQUZURVInLFxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogZ2V0RGVmYXVsdFByb3BlcnRpZXNUb0FwcGx5VG8oKS5tYXAoXG4gICAgICAgICAgICAgICAgICAgICAgKHZhbCkgPT4gdmFsLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBvbkNoYW5nZSh1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICB9XG4gICAgICAgICAgbGFiZWw9XCJUaW1lXCJcbiAgICAgICAgLz5cbiAgICAgICAge3ZhbHVlID8gKFxuICAgICAgICAgIDxHcmlkXG4gICAgICAgICAgICBjb250YWluZXJcbiAgICAgICAgICAgIGFsaWduSXRlbXM9XCJzdHJldGNoXCJcbiAgICAgICAgICAgIGRpcmVjdGlvbj1cImNvbHVtblwiXG4gICAgICAgICAgICB3cmFwPVwibm93cmFwXCJcbiAgICAgICAgICAgIGNsYXNzTmFtZT1cInB0LTJcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxHcmlkIGl0ZW0gY2xhc3NOYW1lPVwidy1mdWxsIHBiLTJcIj5cbiAgICAgICAgICAgICAgPEF1dG9jb21wbGV0ZVxuICAgICAgICAgICAgICAgIGZ1bGxXaWR0aFxuICAgICAgICAgICAgICAgIG11bHRpcGxlXG4gICAgICAgICAgICAgICAgb3B0aW9ucz17Z2V0UG9zc2libGVQcm9wZXJ0aWVzKCl9XG4gICAgICAgICAgICAgICAgZGlzYWJsZUNsb3NlT25TZWxlY3RcbiAgICAgICAgICAgICAgICBnZXRPcHRpb25MYWJlbD17KG9wdGlvbikgPT4gb3B0aW9uLmxhYmVsfVxuICAgICAgICAgICAgICAgIGlzT3B0aW9uRXF1YWxUb1ZhbHVlPXsob3B0aW9uLCB2YWx1ZSkgPT5cbiAgICAgICAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9PT0gdmFsdWUudmFsdWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhfZSwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgLi4udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBuZXdWYWx1ZS5tYXAoKHZhbCkgPT4gdmFsLnZhbHVlKSxcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICBzaXplPVwic21hbGxcIlxuICAgICAgICAgICAgICAgIHJlbmRlclRhZ3M9eyh0YWdWYWx1ZSwgZ2V0VGFnUHJvcHMpID0+XG4gICAgICAgICAgICAgICAgICB0YWdWYWx1ZS5tYXAoKG9wdGlvbiwgaW5kZXgpID0+IChcbiAgICAgICAgICAgICAgICAgICAgPENoaXBcbiAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50PVwib3V0bGluZWRcIlxuICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPVwiZGVmYXVsdFwiXG4gICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e29wdGlvbi5sYWJlbH1cbiAgICAgICAgICAgICAgICAgICAgICB7Li4uZ2V0VGFnUHJvcHMoeyBpbmRleCB9KX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhbHVlPXtkZXRlcm1pbmVQcm9wZXJ0aWVzVG9BcHBseVRvKHsgdmFsdWUgfSl9XG4gICAgICAgICAgICAgICAgcmVuZGVySW5wdXQ9eyhwYXJhbXMpID0+IChcbiAgICAgICAgICAgICAgICAgIDxUZXh0RmllbGQgey4uLnBhcmFtc30gdmFyaWFudD1cIm91dGxpbmVkXCIgLz5cbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9HcmlkPlxuICAgICAgICAgICAgPEdyaWRcbiAgICAgICAgICAgICAgY29udGFpbmVyXG4gICAgICAgICAgICAgIGFsaWduSXRlbXM9XCJzdHJldGNoXCJcbiAgICAgICAgICAgICAgZGlyZWN0aW9uPVwicm93XCJcbiAgICAgICAgICAgICAgd3JhcD1cIm5vd3JhcFwiXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cInB0LTJcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8R3JpZCBpdGVtPlxuICAgICAgICAgICAgICAgIDxTd2F0aCBjbGFzc05hbWU9XCJ3LTEgaC1mdWxsXCIgLz5cbiAgICAgICAgICAgICAgPC9HcmlkPlxuICAgICAgICAgICAgICA8R3JpZCBjb250YWluZXIgZGlyZWN0aW9uPVwiY29sdW1uXCI+XG4gICAgICAgICAgICAgICAgPEdyaWQgaXRlbSBjbGFzc05hbWU9XCJ3LWZ1bGwgcGwtMiBwYi0yXCI+XG4gICAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICAgIGZ1bGxXaWR0aFxuICAgICAgICAgICAgICAgICAgICB2YXJpYW50PVwib3V0bGluZWRcIlxuICAgICAgICAgICAgICAgICAgICBzaXplPVwic21hbGxcIlxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3ZhbHVlLnR5cGV9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogZS50YXJnZXQudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPE1lbnVJdGVtIHZhbHVlPVwiQUZURVJcIj5BZnRlcjwvTWVudUl0ZW0+XG4gICAgICAgICAgICAgICAgICAgIDxNZW51SXRlbSB2YWx1ZT1cIkJFRk9SRVwiPkJlZm9yZTwvTWVudUl0ZW0+XG4gICAgICAgICAgICAgICAgICAgIDxNZW51SXRlbSB2YWx1ZT1cIkRVUklOR1wiPkJldHdlZW48L01lbnVJdGVtPlxuICAgICAgICAgICAgICAgICAgICA8TWVudUl0ZW0gdmFsdWU9XCJSRUxBVElWRVwiPldpdGhpbiB0aGUgbGFzdDwvTWVudUl0ZW0+XG4gICAgICAgICAgICAgICAgICAgIDxNZW51SXRlbSB2YWx1ZT1cIkFST1VORFwiPkFyb3VuZDwvTWVudUl0ZW0+XG4gICAgICAgICAgICAgICAgICA8L1RleHRGaWVsZD5cbiAgICAgICAgICAgICAgICA8L0dyaWQ+XG4gICAgICAgICAgICAgICAgPEdyaWQgaXRlbSBjbGFzc05hbWU9XCJ3LWZ1bGwgcGwtMlwiPlxuICAgICAgICAgICAgICAgICAgPEZpbHRlcklucHV0XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcj17eyAuLi52YWx1ZSwgcHJvcGVydHk6IHZhbHVlLnByb3BlcnR5WzBdIH19XG4gICAgICAgICAgICAgICAgICAgIHNldEZpbHRlcj17KHZhbDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvR3JpZD5cbiAgICAgICAgICAgICAgPC9HcmlkPlxuICAgICAgICAgICAgPC9HcmlkPlxuICAgICAgICAgIDwvR3JpZD5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8L2Rpdj5cbiAgICA8Lz5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBRdWVyeVRpbWVcbiJdfQ==