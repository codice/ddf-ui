import { __assign, __read } from "tslib";
import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import Button from '@mui/material/Button';
import * as React from 'react';
import { useLazyResultsSelectedResultsFromSelectionInterface } from '../../selection-interface/hooks';
import KeyboardArrowLeftIcon from '@mui/icons-material/KeyboardArrowLeft';
import KeyboardArrowRightIcon from '@mui/icons-material/KeyboardArrowRight';
import { getIconClassName } from '../results-visual/result-item';
import LazyMetacardInteractions from '../results-visual/lazy-metacard-interactions';
import MoreVertIcon from '@mui/icons-material/MoreVert';
import { useMenuState } from '../../menu-state/menu-state';
import Popover from '@mui/material/Popover';
import Paper from '@mui/material/Paper';
import { Elevations } from '../../theme/theme';
import OverflowTooltip from '../../overflow-tooltip/overflow-tooltip';
import Tabs from '@mui/material/Tabs';
import MaterialTab from '@mui/material/Tab';
import MetacardTabs, { TabNames } from '../../tabs/metacard/tabs-metacard';
import { useRerenderOnBackboneSync } from '../../../js/model/LazyQueryResult/hooks';
import Extensions from '../../../extension-points';
import { LinkButton } from '../../button/link-button';
import { DownloadButton } from '../../button/download-button';
var useSelectedResultsArrayFromSelectionInterface = function (_a) {
    var selectionInterface = _a.selectionInterface;
    var _b = __read(React.useState([]), 2), selectedResultsArray = _b[0], setSelectedResultsArray = _b[1];
    var selectedResults = useLazyResultsSelectedResultsFromSelectionInterface({
        selectionInterface: selectionInterface,
    });
    React.useEffect(function () {
        setSelectedResultsArray(Object.values(selectedResults));
    }, [selectedResults]);
    return selectedResultsArray;
};
export var TitleView = function (_a) {
    var lazyResult = _a.lazyResult;
    var menuState = useMenuState();
    useRerenderOnBackboneSync({ lazyResult: lazyResult });
    return (_jsxs("div", { className: "flex flex-row items-center justify-center flex-nowrap p-2", children: [_jsx("span", { className: "".concat(getIconClassName({ lazyResult: lazyResult }), " font-awesome-span") }), _jsx(Extensions.resultTitleIconAddOn, { lazyResult: lazyResult }), _jsx(OverflowTooltip, { className: 'truncate', children: lazyResult.plain.metacard.properties.title }), _jsx(LinkButton, { lazyResult: lazyResult }), _jsx(DownloadButton, { lazyResult: lazyResult }), _jsx(Button, __assign({}, menuState.MuiButtonProps, { children: _jsx(MoreVertIcon, {}) })), _jsx(Popover, __assign({}, menuState.MuiPopoverProps, { keepMounted: true, children: _jsx(Paper, { elevation: Elevations.overlays, children: _jsx(LazyMetacardInteractions, { lazyResults: [lazyResult], onClose: menuState.handleClose }) }) }))] }));
};
var defaultActiveTab = 'Details';
var useLastAsDefaultActiveTab = function (tabIndex) {
    React.useEffect(function () {
        defaultActiveTab = tabIndex;
    }, [tabIndex]);
};
var useIndexForSelectedResults = function (selectedResults) {
    var _a = __read(React.useState(0), 2), index = _a[0], setIndex = _a[1];
    React.useEffect(function () {
        setIndex(0);
    }, [selectedResults]);
    return [index, setIndex];
};
var usePossibleMetacardTabs = function (_a) {
    var result = _a.result;
    var _b = __read(React.useState(MetacardTabs), 2), possibleMetacardTabs = _b[0], setPossibleMetacardTabs = _b[1];
    React.useEffect(function () {
        if (result) {
            var copyOfMetacardTabs = __assign({}, MetacardTabs);
            if (result.isRevision()) {
                delete copyOfMetacardTabs[TabNames.History];
                delete copyOfMetacardTabs[TabNames.Actions];
            }
            if (result.isDeleted()) {
                delete copyOfMetacardTabs[TabNames.History];
                delete copyOfMetacardTabs[TabNames.Actions];
            }
            if (result.isRemote()) {
                delete copyOfMetacardTabs[TabNames.History];
                delete copyOfMetacardTabs[TabNames.Quality];
            }
            if (!result.hasPreview()) {
                delete copyOfMetacardTabs[TabNames.Preview];
            }
            setPossibleMetacardTabs(copyOfMetacardTabs);
        }
        else {
            setPossibleMetacardTabs({});
        }
    }, [result]);
    return possibleMetacardTabs;
};
var useMetacardTabs = function (_a) {
    var _b;
    var result = _a.result;
    var possibleMetacardTabs = usePossibleMetacardTabs({ result: result });
    var _c = __read(React.useState(defaultActiveTab), 2), activeTab = _c[0], setActiveTab = _c[1];
    useLastAsDefaultActiveTab(activeTab);
    React.useEffect(function () {
        if (Object.keys(possibleMetacardTabs).length > 0 &&
            !possibleMetacardTabs[activeTab]) {
            setActiveTab(TabNames.Details);
        }
    }, [possibleMetacardTabs]);
    return {
        possibleMetacardTabs: possibleMetacardTabs,
        activeTab: activeTab,
        setActiveTab: setActiveTab,
        TabContent: ((_b = possibleMetacardTabs[activeTab]) === null || _b === void 0 ? void 0 : _b.content) || (function () { return null; }),
    };
};
var Inspector = function (_a) {
    var selectionInterface = _a.selectionInterface;
    var selectedResults = useSelectedResultsArrayFromSelectionInterface({
        selectionInterface: selectionInterface,
    });
    var _b = __read(useIndexForSelectedResults(selectedResults), 2), index = _b[0], setIndex = _b[1];
    var amountSelected = selectedResults.length;
    var currentResult = selectedResults[index];
    var _c = useMetacardTabs({ result: currentResult }), possibleMetacardTabs = _c.possibleMetacardTabs, activeTab = _c.activeTab, setActiveTab = _c.setActiveTab, TabContent = _c.TabContent;
    return (_jsx(_Fragment, { children: _jsxs("div", { className: "flex flex-col flex-nowrap h-full overflow-hidden", children: [amountSelected > 1 ? (_jsxs("div", { className: "flex flex-row items-center justify-center flex-nowrap shrink-0 grow-0", children: [_jsxs(Button, { onClick: function () {
                                setIndex(index - 1);
                            }, disabled: index === 0, children: [_jsx(KeyboardArrowLeftIcon, { color: "inherit", className: "Mui-text-text-primary Mui-icon-size-small" }), _jsx(KeyboardArrowLeftIcon, { color: "inherit", className: "-ml-3 Mui-text-text-primary Mui-icon-size-small" })] }), "Item ", index + 1, " / ", amountSelected, _jsxs(Button, { onClick: function () {
                                setIndex(index + 1);
                            }, disabled: index === amountSelected - 1, children: [_jsx(KeyboardArrowRightIcon, { color: "inherit", className: "Mui-text-text-primary" }), _jsx(KeyboardArrowRightIcon, { color: "inherit", className: "-ml-5 Mui-text-text-primary" })] })] })) : null, currentResult ? (_jsxs(_Fragment, { children: [_jsx(TitleView, { lazyResult: currentResult }), _jsxs("div", { className: "flex flex-col flex-nowrap shrink overflow-hidden h-full", children: [_jsx(Tabs, { value: activeTab, onChange: function (_e, newValue) {
                                        setActiveTab(newValue);
                                    }, className: "shrink-0 w-full", scrollButtons: "auto", variant: "scrollable", children: Object.entries(possibleMetacardTabs).map(function (_a) {
                                        var _b;
                                        var _c = __read(_a, 2), tabName = _c[0], tabDefinition = _c[1];
                                        return (_jsx(MaterialTab, { value: tabName, label: ((_b = tabDefinition.header) === null || _b === void 0 ? void 0 : _b.call(tabDefinition, { result: currentResult })) ||
                                                tabName }, tabName));
                                    }) }), _jsx("div", { className: "h-full w-full shrink overflow-hidden", children: _jsx(TabContent, { result: currentResult, selectionInterface: selectionInterface }, currentResult.plain.id) })] })] })) : (_jsx("div", { className: "p-2 text-center", children: "Please select result(s) to display in the inspector." }))] }) }));
};
export default Inspector;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5zcGVjdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL21haW4vd2ViYXBwL2NvbXBvbmVudC92aXN1YWxpemF0aW9uL2luc3BlY3Rvci9pbnNwZWN0b3IudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7Ozs7Ozs7SUFhSTtBQUVKLE9BQU8sTUFBTSxNQUFNLHNCQUFzQixDQUFBO0FBQ3pDLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBRzlCLE9BQU8sRUFBRSxtREFBbUQsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBQ3JHLE9BQU8scUJBQXFCLE1BQU0sdUNBQXVDLENBQUE7QUFDekUsT0FBTyxzQkFBc0IsTUFBTSx3Q0FBd0MsQ0FBQTtBQUMzRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQTtBQUNoRSxPQUFPLHdCQUF3QixNQUFNLDhDQUE4QyxDQUFBO0FBQ25GLE9BQU8sWUFBWSxNQUFNLDhCQUE4QixDQUFBO0FBQ3ZELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUMxRCxPQUFPLE9BQU8sTUFBTSx1QkFBdUIsQ0FBQTtBQUMzQyxPQUFPLEtBQUssTUFBTSxxQkFBcUIsQ0FBQTtBQUN2QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sbUJBQW1CLENBQUE7QUFDOUMsT0FBTyxlQUFlLE1BQU0seUNBQXlDLENBQUE7QUFDckUsT0FBTyxJQUFJLE1BQU0sb0JBQW9CLENBQUE7QUFDckMsT0FBTyxXQUFXLE1BQU0sbUJBQW1CLENBQUE7QUFDM0MsT0FBTyxZQUFZLEVBQUUsRUFBRSxRQUFRLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQTtBQUMxRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQTtBQUNuRixPQUFPLFVBQVUsTUFBTSwyQkFBMkIsQ0FBQTtBQUNsRCxPQUFPLEVBQUUsVUFBVSxFQUFF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SUFDSCxLQUFLLEVBQUUsU0FBUyxFQUNoQixRQUFRLEVBQUUsVUFBQyxFQUFFLEVBQUUsUUFBUTt3Q0FDckIsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFBO29DQUN4QixDQUFDLEVBQ0QsU0FBUyxFQUFDLGlCQUFpQixFQUMzQixhQUFhLEVBQUMsTUFBTSxFQUNwQixPQUFPLEVBQUMsWUFBWSxZQUVuQixNQUFNLENBQUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUMsR0FBRyxDQUN2QyxVQUFDLEVBQXdCOzs0Q0FBeEIsS0FBQSxhQUF3QixFQUF2QixPQUFPLFFBQUEsRUFBRSxhQUFhLFFBQUE7d0NBQ3RCLE9BQU8sQ0FDTCxLQUFDLFdBQVcsSUFFVixLQUFLLEVBQUUsT0FBTyxFQUNkLEtBQUssRUFDSCxDQUFBLE1BQUEsYUFBYSxDQUFDLE1BQU0sOERBQUcsRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLENBQUM7Z0RBQ2pELE9BQU8sSUFKSixPQUFPLENBTVosQ0FDSCxDQUFBO29DQUNILENBQUMsQ0FDRixHQUNJLEVBRVAsY0FBSyxTQUFTLEVBQUMsc0NBQXNDLFlBQ25ELEtBQUMsVUFBVSxJQUNULE1BQU0sRUFBRSxhQUFhLEVBQ3JCLGtCQUFrQixFQUFFLGtCQUFrQixJQUNqQyxhQUFhLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FDM0IsR0FDRSxJQUNGLElBQ0wsQ0FDSixDQUFDLENBQUMsQ0FBQyxDQUNGLGNBQUssU0FBUyxFQUFDLGlCQUFpQixxRUFFMUIsQ0FDUCxJQUNHLEdBQ0wsQ0FDSixDQUFBO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsZUFBZSxTQUFTLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgQ29kaWNlIEZvdW5kYXRpb25cbiAqXG4gKiBUaGlzIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyXG4gKiBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZVxuICogTGljZW5zZSwgb3IgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dFxuICogZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VXG4gKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLiBBIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogaXMgZGlzdHJpYnV0ZWQgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0gYW5kIGNhbiBiZSBmb3VuZCBhdFxuICogPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3BsLmh0bWw+LlxuICpcbiAqKi9cblxuaW1wb3J0IEJ1dHRvbiBmcm9tICdAbXVpL21hdGVyaWFsL0J1dHRvbidcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0J1xuXG5pbXBvcnQgeyBMYXp5UXVlcnlSZXN1bHQgfSBmcm9tICcuLi8uLi8uLi9qcy9tb2RlbC9MYXp5UXVlcnlSZXN1bHQvTGF6eVF1ZXJ5UmVzdWx0J1xuaW1wb3J0IHsgdXNlTGF6eVJlc3VsdHNTZWxlY3RlZFJlc3VsdHNGcm9tU2VsZWN0aW9uSW50ZXJmYWNlIH0gZnJvbSAnLi4vLi4vc2VsZWN0aW9uLWludGVyZmFjZS9ob29rcydcbmltcG9ydCBLZXlib2FyZEFycm93TGVmdEljb24gZnJvbSAnQG11aS9pY29ucy1tYXRlcmlhbC9LZXlib2FyZEFycm93TGVmdCdcbmltcG9ydCBLZXlib2FyZEFycm93UmlnaHRJY29uIGZyb20gJ0BtdWkvaWNvbnMtbWF0ZXJpYWwvS2V5Ym9hcmRBcnJvd1JpZ2h0J1xuaW1wb3J0IHsgZ2V0SWNvbkNsYXNzTmFtZSB9IGZyb20gJy4uL3Jlc3VsdHMtdmlzdWFsL3Jlc3VsdC1pdGVtJ1xuaW1wb3J0IExhenlNZXRhY2FyZEludGVyYWN0aW9ucyBmcm9tICcuLi9yZXN1bHRzLXZpc3VhbC9sYXp5LW1ldGFjYXJkLWludGVyYWN0aW9ucydcbmltcG9ydCBNb3JlVmVydEljb24gZnJvbSAnQG11aS9pY29ucy1tYXRlcmlhbC9Nb3JlVmVydCdcbmltcG9ydCB7IHVzZU1lbnVTdGF0ZSB9IGZyb20gJy4uLy4uL21lbnUtc3RhdGUvbWVudS1zdGF0ZSdcbmltcG9ydCBQb3BvdmVyIGZyb20gJ0BtdWkvbWF0ZXJpYWwvUG9wb3ZlcidcbmltcG9ydCBQYXBlciBmcm9tICdAbXVpL21hdGVyaWFsL1BhcGVyJ1xuaW1wb3J0IHsgRWxldmF0aW9ucyB9IGZyb20gJy4uLy4uL3RoZW1lL3RoZW1lJ1xuaW1wb3J0IE92ZXJmbG93VG9vbHRpcCBmcm9tICcuLi8uLi9vdmVyZmxvdy10b29sdGlwL292ZXJmbG93LXRvb2x0aXAnXG5pbXBvcnQgVGFicyBmcm9tICdAbXVpL21hdGVyaWFsL1RhYnMnXG5pbXBvcnQgTWF0ZXJpYWxUYWIgZnJvbSAnQG11aS9tYXRlcmlhbC9UYWInXG5pbXBvcnQgTWV0YWNhcmRUYWJzLCB7IFRhYk5hbWVzIH0gZnJvbSAnLi4vLi4vdGFicy9tZXRhY2FyZC90YWJzLW1ldGFjYXJkJ1xuaW1wb3J0IHsgdXNlUmVyZW5kZXJPbkJhY2tib25lU3luYyB9IGZyb20gJy4uLy4uLy4uL2pzL21vZGVsL0xhenlRdWVyeVJlc3VsdC9ob29rcydcbmltcG9ydCBFeHRlbnNpb25zIGZyb20gJy4uLy4uLy4uL2V4dGVuc2lvbi1wb2ludHMnXG5pbXBvcnQgeyBMaW5rQnV0dG9uIH0gZnJvbSAnLi4vLi4vYnV0dG9uL2xpbmstYnV0dG9uJ1xuaW1wb3J0IHsgRG93bmxvYWRCdXR0b24gfSBmcm9tICcuLi8uLi9idXR0b24vZG93bmxvYWQtYnV0dG9uJ1xuXG50eXBlIEluc3BlY3RvclR5cGUgPSB7XG4gIHNlbGVjdGlvbkludGVyZmFjZTogYW55XG59XG5cbmNvbnN0IHVzZVNlbGVjdGVkUmVzdWx0c0FycmF5RnJvbVNlbGVjdGlvbkludGVyZmFjZSA9ICh7XG4gIHNlbGVjdGlvbkludGVyZmFjZSxcbn06IEluc3BlY3RvclR5cGUpID0+IHtcbiAgY29uc3QgW3NlbGVjdGVkUmVzdWx0c0FycmF5LCBzZXRTZWxlY3RlZFJlc3VsdHNBcnJheV0gPSBSZWFjdC51c2VTdGF0ZShcbiAgICBbXSBhcyBMYXp5UXVlcnlSZXN1bHRbXVxuICApXG4gIGNvbnN0IHNlbGVjdGVkUmVzdWx0cyA9IHVzZUxhenlSZXN1bHRzU2VsZWN0ZWRSZXN1bHRzRnJvbVNlbGVjdGlvbkludGVyZmFjZSh7XG4gICAgc2VsZWN0aW9uSW50ZXJmYWNlLFxuICB9KVxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHNldFNlbGVjdGVkUmVzdWx0c0FycmF5KE9iamVjdC52YWx1ZXMoc2VsZWN0ZWRSZXN1bHRzKSlcbiAgfSwgW3NlbGVjdGVkUmVzdWx0c10pXG4gIHJldHVybiBzZWxlY3RlZFJlc3VsdHNBcnJheVxufVxuXG50eXBlIFRpdGxlVmlld1R5cGUgPSB7XG4gIGxhenlSZXN1bHQ6IExhenlRdWVyeVJlc3VsdFxufVxuXG5leHBvcnQgY29uc3QgVGl0bGVWaWV3ID0gKHsgbGF6eVJlc3VsdCB9OiBUaXRsZVZpZXdUeXBlKSA9PiB7XG4gIGNvbnN0IG1lbnVTdGF0ZSA9IHVzZU1lbnVTdGF0ZSgpXG4gIHVzZVJlcmVuZGVyT25CYWNrYm9uZVN5bmMoeyBsYXp5UmVzdWx0IH0pXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtcm93IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBmbGV4LW5vd3JhcCBwLTJcIj5cbiAgICAgIDxzcGFuXG4gICAgICAgIGNsYXNzTmFtZT17YCR7Z2V0SWNvbkNsYXNzTmFtZSh7IGxhenlSZXN1bHQgfSl9IGZvbnQtYXdlc29tZS1zcGFuYH1cbiAgICAgID48L3NwYW4+XG4gICAgICA8RXh0ZW5zaW9ucy5yZXN1bHRUaXRsZUljb25BZGRPbiBsYXp5UmVzdWx0PXtsYXp5UmVzdWx0fSAvPlxuICAgICAgPE92ZXJmbG93VG9vbHRpcCBjbGFzc05hbWU9eyd0cnVuY2F0ZSd9PlxuICAgICAgICB7bGF6eVJlc3VsdC5wbGFpbi5tZXRhY2FyZC5wcm9wZXJ0aWVzLnRpdGxlfVxuICAgICAgPC9PdmVyZmxvd1Rvb2x0aXA+XG4gICAgICA8TGlua0J1dHRvbiBsYXp5UmVzdWx0PXtsYXp5UmVzdWx0fSAvPlxuICAgICAgPERvd25sb2FkQnV0dG9uIGxhenlSZXN1bHQ9e2xhenlSZXN1bHR9IC8+XG4gICAgICA8QnV0dG9uIHsuLi5tZW51U3RhdGUuTXVpQnV0dG9uUHJvcHN9PlxuICAgICAgICA8TW9yZVZlcnRJY29uIC8+XG4gICAgICA8L0J1dHRvbj5cbiAgICAgIDxQb3BvdmVyIHsuLi5tZW51U3RhdGUuTXVpUG9wb3ZlclByb3BzfSBrZWVwTW91bnRlZD17dHJ1ZX0+XG4gICAgICAgIDxQYXBlciBlbGV2YXRpb249e0VsZXZhdGlvbnMub3ZlcmxheXN9PlxuICAgICAgICAgIDxMYXp5TWV0YWNhcmRJbnRlcmFjdGlvbnNcbiAgICAgICAgICAgIGxhenlSZXN1bHRzPXtbbGF6eVJlc3VsdF19XG4gICAgICAgICAgICBvbkNsb3NlPXttZW51U3RhdGUuaGFuZGxlQ2xvc2V9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9QYXBlcj5cbiAgICAgIDwvUG9wb3Zlcj5cbiAgICA8L2Rpdj5cbiAgKVxufVxuXG5sZXQgZGVmYXVsdEFjdGl2ZVRhYiA9ICdEZXRhaWxzJ1xuXG5jb25zdCB1c2VMYXN0QXNEZWZhdWx0QWN0aXZlVGFiID0gKHRhYkluZGV4OiBzdHJpbmcpID0+IHtcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBkZWZhdWx0QWN0aXZlVGFiID0gdGFiSW5kZXhcbiAgfSwgW3RhYkluZGV4XSlcbn1cblxuY29uc3QgdXNlSW5kZXhGb3JTZWxlY3RlZFJlc3VsdHMgPSAoXG4gIHNlbGVjdGVkUmVzdWx0czogTGF6eVF1ZXJ5UmVzdWx0W11cbik6IFtudW1iZXIsIChpbmRleDogbnVtYmVyKSA9PiB2b2lkXSA9PiB7XG4gIGNvbnN0IFtpbmRleCwgc2V0SW5kZXhdID0gUmVhY3QudXNlU3RhdGUoMClcblxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHNldEluZGV4KDApXG4gIH0sIFtzZWxlY3RlZFJlc3VsdHNdKVxuICByZXR1cm4gW2luZGV4LCBzZXRJbmRleF1cbn1cblxuY29uc3QgdXNlUG9zc2libGVNZXRhY2FyZFRhYnMgPSAoeyByZXN1bHQgfTogeyByZXN1bHQ6IExhenlRdWVyeVJlc3VsdCB9KSA9PiB7XG4gIGNvbnN0IFtwb3NzaWJsZU1ldGFjYXJkVGFicywgc2V0UG9zc2libGVNZXRhY2FyZFRhYnNdID1cbiAgICBSZWFjdC51c2VTdGF0ZShNZXRhY2FyZFRhYnMpXG5cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICBsZXQgY29weU9mTWV0YWNhcmRUYWJzID0geyAuLi5NZXRhY2FyZFRhYnMgfVxuICAgICAgaWYgKHJlc3VsdC5pc1JldmlzaW9uKCkpIHtcbiAgICAgICAgZGVsZXRlIGNvcHlPZk1ldGFjYXJkVGFic1tUYWJOYW1lcy5IaXN0b3J5XVxuICAgICAgICBkZWxldGUgY29weU9mTWV0YWNhcmRUYWJzW1RhYk5hbWVzLkFjdGlvbnNdXG4gICAgICB9XG4gICAgICBpZiAocmVzdWx0LmlzRGVsZXRlZCgpKSB7XG4gICAgICAgIGRlbGV0ZSBjb3B5T2ZNZXRhY2FyZFRhYnNbVGFiTmFtZXMuSGlzdG9yeV1cbiAgICAgICAgZGVsZXRlIGNvcHlPZk1ldGFjYXJkVGFic1tUYWJOYW1lcy5BY3Rpb25zXVxuICAgICAgfVxuICAgICAgaWYgKHJlc3VsdC5pc1JlbW90ZSgpKSB7XG4gICAgICAgIGRlbGV0ZSBjb3B5T2ZNZXRhY2FyZFRhYnNbVGFiTmFtZXMuSGlzdG9yeV1cbiAgICAgICAgZGVsZXRlIGNvcHlPZk1ldGFjYXJkVGFic1tUYWJOYW1lcy5RdWFsaXR5XVxuICAgICAgfVxuICAgICAgaWYgKCFyZXN1bHQuaGFzUHJldmlldygpKSB7XG4gICAgICAgIGRlbGV0ZSBjb3B5T2ZNZXRhY2FyZFRhYnNbVGFiTmFtZXMuUHJldmlld11cbiAgICAgIH1cbiAgICAgIHNldFBvc3NpYmxlTWV0YWNhcmRUYWJzKGNvcHlPZk1ldGFjYXJkVGFicylcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0UG9zc2libGVNZXRhY2FyZFRhYnMoe30pXG4gICAgfVxuICB9LCBbcmVzdWx0XSlcblxuICByZXR1cm4gcG9zc2libGVNZXRhY2FyZFRhYnNcbn1cblxuY29uc3QgdXNlTWV0YWNhcmRUYWJzID0gKHsgcmVzdWx0IH06IHsgcmVzdWx0OiBMYXp5UXVlcnlSZXN1bHQgfSkgPT4ge1xuICBjb25zdCBwb3NzaWJsZU1ldGFjYXJkVGFicyA9IHVzZVBvc3NpYmxlTWV0YWNhcmRUYWJzKHsgcmVzdWx0IH0pXG4gIGNvbnN0IFthY3RpdmVUYWIsIHNldEFjdGl2ZVRhYl0gPSBSZWFjdC51c2VTdGF0ZShkZWZhdWx0QWN0aXZlVGFiKVxuICB1c2VMYXN0QXNEZWZhdWx0QWN0aXZlVGFiKGFjdGl2ZVRhYilcblxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChcbiAgICAgIE9iamVjdC5rZXlzKHBvc3NpYmxlTWV0YWNhcmRUYWJzKS5sZW5ndGggPiAwICYmXG4gICAgICAhcG9zc2libGVNZXRhY2FyZFRhYnNbYWN0aXZlVGFiXVxuICAgICkge1xuICAgICAgc2V0QWN0aXZlVGFiKFRhYk5hbWVzLkRldGFpbHMpXG4gICAgfVxuICB9LCBbcG9zc2libGVNZXRhY2FyZFRhYnNdKVxuICByZXR1cm4ge1xuICAgIHBvc3NpYmxlTWV0YWNhcmRUYWJzLFxuICAgIGFjdGl2ZVRhYixcbiAgICBzZXRBY3RpdmVUYWIsXG4gICAgVGFiQ29udGVudDogcG9zc2libGVNZXRhY2FyZFRhYnNbYWN0aXZlVGFiXT8uY29udGVudCB8fCAoKCkgPT4gbnVsbCksXG4gIH1cbn1cblxuY29uc3QgSW5zcGVjdG9yID0gKHsgc2VsZWN0aW9uSW50ZXJmYWNlIH06IEluc3BlY3RvclR5cGUpID0+IHtcbiAgY29uc3Qgc2VsZWN0ZWRSZXN1bHRzID0gdXNlU2VsZWN0ZWRSZXN1bHRzQXJyYXlGcm9tU2VsZWN0aW9uSW50ZXJmYWNlKHtcbiAgICBzZWxlY3Rpb25JbnRlcmZhY2UsXG4gIH0pXG4gIGNvbnN0IFtpbmRleCwgc2V0SW5kZXhdID0gdXNlSW5kZXhGb3JTZWxlY3RlZFJlc3VsdHMoc2VsZWN0ZWRSZXN1bHRzKVxuXG4gIGNvbnN0IGFtb3VudFNlbGVjdGVkID0gc2VsZWN0ZWRSZXN1bHRzLmxlbmd0aFxuXG4gIGNvbnN0IGN1cnJlbnRSZXN1bHQgPSBzZWxlY3RlZFJlc3VsdHNbaW5kZXhdXG4gIGNvbnN0IHsgcG9zc2libGVNZXRhY2FyZFRhYnMsIGFjdGl2ZVRhYiwgc2V0QWN0aXZlVGFiLCBUYWJDb250ZW50IH0gPVxuICAgIHVzZU1ldGFjYXJkVGFicyh7IHJlc3VsdDogY3VycmVudFJlc3VsdCB9KVxuXG4gIHJldHVybiAoXG4gICAgPD5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LWNvbCBmbGV4LW5vd3JhcCBoLWZ1bGwgb3ZlcmZsb3ctaGlkZGVuXCI+XG4gICAgICAgIHthbW91bnRTZWxlY3RlZCA+IDEgPyAoXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtcm93IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBmbGV4LW5vd3JhcCBzaHJpbmstMCBncm93LTBcIj5cbiAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldEluZGV4KGluZGV4IC0gMSlcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgZGlzYWJsZWQ9e2luZGV4ID09PSAwfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8S2V5Ym9hcmRBcnJvd0xlZnRJY29uXG4gICAgICAgICAgICAgICAgY29sb3I9XCJpbmhlcml0XCJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJNdWktdGV4dC10ZXh0LXByaW1hcnkgTXVpLWljb24tc2l6ZS1zbWFsbFwiXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxLZXlib2FyZEFycm93TGVmdEljb25cbiAgICAgICAgICAgICAgICBjb2xvcj1cImluaGVyaXRcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIi1tbC0zIE11aS10ZXh0LXRleHQtcHJpbWFyeSBNdWktaWNvbi1zaXplLXNtYWxsXCJcbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgSXRlbSB7aW5kZXggKyAxfSAvIHthbW91bnRTZWxlY3RlZH1cbiAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldEluZGV4KGluZGV4ICsgMSlcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgZGlzYWJsZWQ9e2luZGV4ID09PSBhbW91bnRTZWxlY3RlZCAtIDF9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxLZXlib2FyZEFycm93UmlnaHRJY29uXG4gICAgICAgICAgICAgICAgY29sb3I9XCJpbmhlcml0XCJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJNdWktdGV4dC10ZXh0LXByaW1hcnlcIlxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8S2V5Ym9hcmRBcnJvd1JpZ2h0SWNvblxuICAgICAgICAgICAgICAgIGNvbG9yPVwiaW5oZXJpdFwiXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiLW1sLTUgTXVpLXRleHQtdGV4dC1wcmltYXJ5XCJcbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApIDogbnVsbH1cbiAgICAgICAge2N1cnJlbnRSZXN1bHQgPyAoXG4gICAgICAgICAgPD5cbiAgICAgICAgICAgIDxUaXRsZVZpZXcgbGF6eVJlc3VsdD17Y3VycmVudFJlc3VsdH0gLz5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LWNvbCBmbGV4LW5vd3JhcCBzaHJpbmsgb3ZlcmZsb3ctaGlkZGVuIGgtZnVsbFwiPlxuICAgICAgICAgICAgICA8VGFic1xuICAgICAgICAgICAgICAgIHZhbHVlPXthY3RpdmVUYWJ9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhfZSwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgIHNldEFjdGl2ZVRhYihuZXdWYWx1ZSlcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cInNocmluay0wIHctZnVsbFwiXG4gICAgICAgICAgICAgICAgc2Nyb2xsQnV0dG9ucz1cImF1dG9cIlxuICAgICAgICAgICAgICAgIHZhcmlhbnQ9XCJzY3JvbGxhYmxlXCJcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHtPYmplY3QuZW50cmllcyhwb3NzaWJsZU1ldGFjYXJkVGFicykubWFwKFxuICAgICAgICAgICAgICAgICAgKFt0YWJOYW1lLCB0YWJEZWZpbml0aW9uXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICAgIDxNYXRlcmlhbFRhYlxuICAgICAgICAgICAgICAgICAgICAgICAga2V5PXt0YWJOYW1lfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RhYk5hbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD17XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRhYkRlZmluaXRpb24uaGVhZGVyPy4oeyByZXN1bHQ6IGN1cnJlbnRSZXN1bHQgfSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiTmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICA8L1RhYnM+XG5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJoLWZ1bGwgdy1mdWxsIHNocmluayBvdmVyZmxvdy1oaWRkZW5cIj5cbiAgICAgICAgICAgICAgICA8VGFiQ29udGVudFxuICAgICAgICAgICAgICAgICAgcmVzdWx0PXtjdXJyZW50UmVzdWx0fVxuICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uSW50ZXJmYWNlPXtzZWxlY3Rpb25JbnRlcmZhY2V9XG4gICAgICAgICAgICAgICAgICBrZXk9e2N1cnJlbnRSZXN1bHQucGxhaW4uaWR9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8Lz5cbiAgICAgICAgKSA6IChcbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInAtMiB0ZXh0LWNlbnRlclwiPlxuICAgICAgICAgICAgUGxlYXNlIHNlbGVjdCByZXN1bHQocykgdG8gZGlzcGxheSBpbiB0aGUgaW5zcGVjdG9yLlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgPC8+XG4gIClcbn1cblxuZXhwb3J0IGRlZmF1bHQgSW5zcGVjdG9yXG4iXX0=