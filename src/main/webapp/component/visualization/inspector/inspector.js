import { __assign, __read } from "tslib";
import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import Button from '@mui/material/Button';
import * as React from 'react';
import { useLazyResultsSelectedResultsFromSelectionInterface } from '../../selection-interface/hooks';
import KeyboardArrowLeftIcon from '@mui/icons-material/KeyboardArrowLeft';
import KeyboardArrowRightIcon from '@mui/icons-material/KeyboardArrowRight';
import { getIconClassName } from '../results-visual/result-item';
import LazyMetacardInteractions from '../results-visual/lazy-metacard-interactions';
import MoreVertIcon from '@mui/icons-material/MoreVert';
import { useMenuState } from '../../menu-state/menu-state';
import Popover from '@mui/material/Popover';
import Paper from '@mui/material/Paper';
import { Elevations } from '../../theme/theme';
import OverflowTooltip from '../../overflow-tooltip/overflow-tooltip';
import Tabs from '@mui/material/Tabs';
import MaterialTab from '@mui/material/Tab';
import MetacardTabs, { TabNames } from '../../tabs/metacard/tabs-metacard';
import { useRerenderOnBackboneSync } from '../../../js/model/LazyQueryResult/hooks';
import Extensions from '../../../extension-points';
var useSelectedResultsArrayFromSelectionInterface = function (_a) {
    var selectionInterface = _a.selectionInterface;
    var _b = __read(React.useState([]), 2), selectedResultsArray = _b[0], setSelectedResultsArray = _b[1];
    var selectedResults = useLazyResultsSelectedResultsFromSelectionInterface({
        selectionInterface: selectionInterface,
    });
    React.useEffect(function () {
        setSelectedResultsArray(Object.values(selectedResults));
    }, [selectedResults]);
    return selectedResultsArray;
};
export var TitleView = function (_a) {
    var lazyResult = _a.lazyResult;
    var menuState = useMenuState();
    useRerenderOnBackboneSync({ lazyResult: lazyResult });
    return (_jsxs("div", { className: "flex flex-row items-center justify-center flex-nowrap p-2", children: [_jsx("span", { className: "".concat(getIconClassName({ lazyResult: lazyResult }), " font-awesome-span") }), _jsx(Extensions.resultTitleIconAddOn, { lazyResult: lazyResult }), _jsx(OverflowTooltip, { className: 'truncate', children: lazyResult.plain.metacard.properties.title }), _jsx(Button, __assign({}, menuState.MuiButtonProps, { children: _jsx(MoreVertIcon, {}) })), _jsx(Popover, __assign({}, menuState.MuiPopoverProps, { keepMounted: true, children: _jsx(Paper, { elevation: Elevations.overlays, children: _jsx(LazyMetacardInteractions, { lazyResults: [lazyResult], onClose: menuState.handleClose }) }) }))] }));
};
var defaultActiveTab = 'Details';
var useLastAsDefaultActiveTab = function (tabIndex) {
    React.useEffect(function () {
        defaultActiveTab = tabIndex;
    }, [tabIndex]);
};
var useIndexForSelectedResults = function (selectedResults) {
    var _a = __read(React.useState(0), 2), index = _a[0], setIndex = _a[1];
    React.useEffect(function () {
        setIndex(0);
    }, [selectedResults]);
    return [index, setIndex];
};
var usePossibleMetacardTabs = function (_a) {
    var result = _a.result;
    var _b = __read(React.useState(MetacardTabs), 2), possibleMetacardTabs = _b[0], setPossibleMetacardTabs = _b[1];
    React.useEffect(function () {
        if (result) {
            var copyOfMetacardTabs = __assign({}, MetacardTabs);
            if (result.isRevision()) {
                delete copyOfMetacardTabs[TabNames.History];
                delete copyOfMetacardTabs[TabNames.Actions];
            }
            if (result.isDeleted()) {
                delete copyOfMetacardTabs[TabNames.History];
                delete copyOfMetacardTabs[TabNames.Actions];
            }
            if (result.isRemote()) {
                delete copyOfMetacardTabs[TabNames.History];
                delete copyOfMetacardTabs[TabNames.Quality];
            }
            if (!result.hasPreview()) {
                delete copyOfMetacardTabs[TabNames.Preview];
            }
            setPossibleMetacardTabs(copyOfMetacardTabs);
        }
        else {
            setPossibleMetacardTabs({});
        }
    }, [result]);
    return possibleMetacardTabs;
};
var useMetacardTabs = function (_a) {
    var _b;
    var result = _a.result;
    var possibleMetacardTabs = usePossibleMetacardTabs({ result: result });
    var _c = __read(React.useState(defaultActiveTab), 2), activeTab = _c[0], setActiveTab = _c[1];
    useLastAsDefaultActiveTab(activeTab);
    React.useEffect(function () {
        if (Object.keys(possibleMetacardTabs).length > 0 &&
            !possibleMetacardTabs[activeTab]) {
            setActiveTab(TabNames.Details);
        }
    }, [possibleMetacardTabs]);
    return {
        possibleMetacardTabs: possibleMetacardTabs,
        activeTab: activeTab,
        setActiveTab: setActiveTab,
        TabContent: ((_b = possibleMetacardTabs[activeTab]) === null || _b === void 0 ? void 0 : _b.content) || (function () { return null; }),
    };
};
var Inspector = function (_a) {
    var selectionInterface = _a.selectionInterface;
    var selectedResults = useSelectedResultsArrayFromSelectionInterface({
        selectionInterface: selectionInterface,
    });
    var _b = __read(useIndexForSelectedResults(selectedResults), 2), index = _b[0], setIndex = _b[1];
    var amountSelected = selectedResults.length;
    var currentResult = selectedResults[index];
    var _c = useMetacardTabs({ result: currentResult }), possibleMetacardTabs = _c.possibleMetacardTabs, activeTab = _c.activeTab, setActiveTab = _c.setActiveTab, TabContent = _c.TabContent;
    return (_jsx(_Fragment, { children: _jsxs("div", { className: "flex flex-col flex-nowrap h-full overflow-hidden", children: [amountSelected > 1 ? (_jsxs("div", { className: "flex flex-row items-center justify-center flex-nowrap shrink-0 grow-0", children: [_jsxs(Button, { onClick: function () {
                                setIndex(index - 1);
                            }, disabled: index === 0, children: [_jsx(KeyboardArrowLeftIcon, { color: "inherit", className: "Mui-text-text-primary Mui-icon-size-small" }), _jsx(KeyboardArrowLeftIcon, { color: "inherit", className: "-ml-3 Mui-text-text-primary Mui-icon-size-small" })] }), "Item ", index + 1, " / ", amountSelected, _jsxs(Button, { onClick: function () {
                                setIndex(index + 1);
                            }, disabled: index === amountSelected - 1, children: [_jsx(KeyboardArrowRightIcon, { color: "inherit", className: "Mui-text-text-primary" }), _jsx(KeyboardArrowRightIcon, { color: "inherit", className: "-ml-5 Mui-text-text-primary" })] })] })) : null, currentResult ? (_jsxs(_Fragment, { children: [_jsx(TitleView, { lazyResult: currentResult }), _jsxs("div", { className: "flex flex-col flex-nowrap shrink overflow-hidden h-full", children: [_jsx(Tabs, { value: activeTab, onChange: function (_e, newValue) {
                                        setActiveTab(newValue);
                                    }, className: "shrink-0 w-full", scrollButtons: "auto", variant: "scrollable", children: Object.entries(possibleMetacardTabs).map(function (_a) {
                                        var _b;
                                        var _c = __read(_a, 2), tabName = _c[0], tabDefinition = _c[1];
                                        return (_jsx(MaterialTab, { value: tabName, label: ((_b = tabDefinition.header) === null || _b === void 0 ? void 0 : _b.call(tabDefinition, { result: currentResult })) ||
                                                tabName }, tabName));
                                    }) }), _jsx("div", { className: "h-full w-full shrink overflow-hidden", children: _jsx(TabContent, { result: currentResult, selectionInterface: selectionInterface }, currentResult.plain.id) })] })] })) : (_jsx("div", { className: "p-2 text-center", children: "Please select result(s) to display in the inspector." }))] }) }));
};
export default Inspector;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5zcGVjdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL21haW4vd2ViYXBwL2NvbXBvbmVudC92aXN1YWxpemF0aW9uL2luc3BlY3Rvci9pbnNwZWN0b3IudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7Ozs7Ozs7SUFhSTtBQUVKLE9BQU8sTUFBTSxNQUFNLHNCQUFzQixDQUFBO0FBQ3pDLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBRzlCLE9BQU8sRUFBRSxtREFBbUQsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBQ3JHLE9BQU8scUJBQXFCLE1BQU0sdUNBQXVDLENBQUE7QUFDekUsT0FBTyxzQkFBc0IsTUFBTSx3Q0FBd0MsQ0FBQTtBQUMzRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQTtBQUNoRSxPQUFPLHdCQUF3QixNQUFNLDhDQUE4QyxDQUFBO0FBQ25GLE9BQU8sWUFBWSxNQUFNLDhCQUE4QixDQUFBO0FBQ3ZELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUMxRCxPQUFPLE9BQU8sTUFBTSx1QkFBdUIsQ0FBQTtBQUMzQyxPQUFPLEtBQUssTUFBTSxxQkFBcUIsQ0FBQTtBQUN2QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sbUJBQW1CLENBQUE7QUFDOUMsT0FBTyxlQUFlLE1BQU0seUNBQXlDLENBQUE7QUFDckUsT0FBTyxJQUFJLE1BQU0sb0JBQW9CLENBQUE7QUFDckMsT0FBTyxXQUFXLE1BQU0sbUJBQW1CLENBQUE7QUFDM0MsT0FBTyxZQUFZLEVBQUUsRUFBRSxRQUFRLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQTtBQUMxRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQTtBQUNuRixPQUFPLFVBQVUsTUFBTSwyQkFBMkIsQ0FBQTtBQU1sRCxJQUFNLDZDQUE2QyxHQUFHLFVB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QixNQUFNLENBQUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUMsR0FBRyxDQUN2QyxVQUFDLEVBQXdCOzs0Q0FBeEIsS0FBQSxhQUF3QixFQUF2QixPQUFPLFFBQUEsRUFBRSxhQUFhLFFBQUE7d0NBQ3RCLE9BQU8sQ0FDTCxLQUFDLFdBQVcsSUFFVixLQUFLLEVBQUUsT0FBTyxFQUNkLEtBQUssRUFDSCxDQUFBLE1BQUEsYUFBYSxDQUFDLE1BQU0sOERBQUcsRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLENBQUM7Z0RBQ2pELE9BQU8sSUFKSixPQUFPLENBTVosQ0FDSCxDQUFBO29DQUNILENBQUMsQ0FDRixHQUNJLEVBRVAsY0FBSyxTQUFTLEVBQUMsc0NBQXNDLFlBQ25ELEtBQUMsVUFBVSxJQUNULE1BQU0sRUFBRSxhQUFhLEVBQ3JCLGtCQUFrQixFQUFFLGtCQUFrQixJQUNqQyxhQUFhLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FDM0IsR0FDRSxJQUNGLElBQ0wsQ0FDSixDQUFDLENBQUMsQ0FBQyxDQUNGLGNBQUssU0FBUyxFQUFDLGlCQUFpQixxRUFFMUIsQ0FDUCxJQUNHLEdBQ0wsQ0FDSixDQUFBO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsZUFBZSxTQUFTLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgQ29kaWNlIEZvdW5kYXRpb25cbiAqXG4gKiBUaGlzIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyXG4gKiBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZVxuICogTGljZW5zZSwgb3IgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dFxuICogZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VXG4gKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLiBBIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogaXMgZGlzdHJpYnV0ZWQgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0gYW5kIGNhbiBiZSBmb3VuZCBhdFxuICogPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3BsLmh0bWw+LlxuICpcbiAqKi9cblxuaW1wb3J0IEJ1dHRvbiBmcm9tICdAbXVpL21hdGVyaWFsL0J1dHRvbidcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0J1xuXG5pbXBvcnQgeyBMYXp5UXVlcnlSZXN1bHQgfSBmcm9tICcuLi8uLi8uLi9qcy9tb2RlbC9MYXp5UXVlcnlSZXN1bHQvTGF6eVF1ZXJ5UmVzdWx0J1xuaW1wb3J0IHsgdXNlTGF6eVJlc3VsdHNTZWxlY3RlZFJlc3VsdHNGcm9tU2VsZWN0aW9uSW50ZXJmYWNlIH0gZnJvbSAnLi4vLi4vc2VsZWN0aW9uLWludGVyZmFjZS9ob29rcydcbmltcG9ydCBLZXlib2FyZEFycm93TGVmdEljb24gZnJvbSAnQG11aS9pY29ucy1tYXRlcmlhbC9LZXlib2FyZEFycm93TGVmdCdcbmltcG9ydCBLZXlib2FyZEFycm93UmlnaHRJY29uIGZyb20gJ0BtdWkvaWNvbnMtbWF0ZXJpYWwvS2V5Ym9hcmRBcnJvd1JpZ2h0J1xuaW1wb3J0IHsgZ2V0SWNvbkNsYXNzTmFtZSB9IGZyb20gJy4uL3Jlc3VsdHMtdmlzdWFsL3Jlc3VsdC1pdGVtJ1xuaW1wb3J0IExhenlNZXRhY2FyZEludGVyYWN0aW9ucyBmcm9tICcuLi9yZXN1bHRzLXZpc3VhbC9sYXp5LW1ldGFjYXJkLWludGVyYWN0aW9ucydcbmltcG9ydCBNb3JlVmVydEljb24gZnJvbSAnQG11aS9pY29ucy1tYXRlcmlhbC9Nb3JlVmVydCdcbmltcG9ydCB7IHVzZU1lbnVTdGF0ZSB9IGZyb20gJy4uLy4uL21lbnUtc3RhdGUvbWVudS1zdGF0ZSdcbmltcG9ydCBQb3BvdmVyIGZyb20gJ0BtdWkvbWF0ZXJpYWwvUG9wb3ZlcidcbmltcG9ydCBQYXBlciBmcm9tICdAbXVpL21hdGVyaWFsL1BhcGVyJ1xuaW1wb3J0IHsgRWxldmF0aW9ucyB9IGZyb20gJy4uLy4uL3RoZW1lL3RoZW1lJ1xuaW1wb3J0IE92ZXJmbG93VG9vbHRpcCBmcm9tICcuLi8uLi9vdmVyZmxvdy10b29sdGlwL292ZXJmbG93LXRvb2x0aXAnXG5pbXBvcnQgVGFicyBmcm9tICdAbXVpL21hdGVyaWFsL1RhYnMnXG5pbXBvcnQgTWF0ZXJpYWxUYWIgZnJvbSAnQG11aS9tYXRlcmlhbC9UYWInXG5pbXBvcnQgTWV0YWNhcmRUYWJzLCB7IFRhYk5hbWVzIH0gZnJvbSAnLi4vLi4vdGFicy9tZXRhY2FyZC90YWJzLW1ldGFjYXJkJ1xuaW1wb3J0IHsgdXNlUmVyZW5kZXJPbkJhY2tib25lU3luYyB9IGZyb20gJy4uLy4uLy4uL2pzL21vZGVsL0xhenlRdWVyeVJlc3VsdC9ob29rcydcbmltcG9ydCBFeHRlbnNpb25zIGZyb20gJy4uLy4uLy4uL2V4dGVuc2lvbi1wb2ludHMnXG5cbnR5cGUgSW5zcGVjdG9yVHlwZSA9IHtcbiAgc2VsZWN0aW9uSW50ZXJmYWNlOiBhbnlcbn1cblxuY29uc3QgdXNlU2VsZWN0ZWRSZXN1bHRzQXJyYXlGcm9tU2VsZWN0aW9uSW50ZXJmYWNlID0gKHtcbiAgc2VsZWN0aW9uSW50ZXJmYWNlLFxufTogSW5zcGVjdG9yVHlwZSkgPT4ge1xuICBjb25zdCBbc2VsZWN0ZWRSZXN1bHRzQXJyYXksIHNldFNlbGVjdGVkUmVzdWx0c0FycmF5XSA9IFJlYWN0LnVzZVN0YXRlKFxuICAgIFtdIGFzIExhenlRdWVyeVJlc3VsdFtdXG4gIClcbiAgY29uc3Qgc2VsZWN0ZWRSZXN1bHRzID0gdXNlTGF6eVJlc3VsdHNTZWxlY3RlZFJlc3VsdHNGcm9tU2VsZWN0aW9uSW50ZXJmYWNlKHtcbiAgICBzZWxlY3Rpb25JbnRlcmZhY2UsXG4gIH0pXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgc2V0U2VsZWN0ZWRSZXN1bHRzQXJyYXkoT2JqZWN0LnZhbHVlcyhzZWxlY3RlZFJlc3VsdHMpKVxuICB9LCBbc2VsZWN0ZWRSZXN1bHRzXSlcbiAgcmV0dXJuIHNlbGVjdGVkUmVzdWx0c0FycmF5XG59XG5cbnR5cGUgVGl0bGVWaWV3VHlwZSA9IHtcbiAgbGF6eVJlc3VsdDogTGF6eVF1ZXJ5UmVzdWx0XG59XG5cbmV4cG9ydCBjb25zdCBUaXRsZVZpZXcgPSAoeyBsYXp5UmVzdWx0IH06IFRpdGxlVmlld1R5cGUpID0+IHtcbiAgY29uc3QgbWVudVN0YXRlID0gdXNlTWVudVN0YXRlKClcbiAgdXNlUmVyZW5kZXJPbkJhY2tib25lU3luYyh7IGxhenlSZXN1bHQgfSlcbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1yb3cgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGZsZXgtbm93cmFwIHAtMlwiPlxuICAgICAgPHNwYW5cbiAgICAgICAgY2xhc3NOYW1lPXtgJHtnZXRJY29uQ2xhc3NOYW1lKHsgbGF6eVJlc3VsdCB9KX0gZm9udC1hd2Vzb21lLXNwYW5gfVxuICAgICAgPjwvc3Bhbj5cbiAgICAgIDxFeHRlbnNpb25zLnJlc3VsdFRpdGxlSWNvbkFkZE9uIGxhenlSZXN1bHQ9e2xhenlSZXN1bHR9IC8+XG4gICAgICA8T3ZlcmZsb3dUb29sdGlwIGNsYXNzTmFtZT17J3RydW5jYXRlJ30+XG4gICAgICAgIHtsYXp5UmVzdWx0LnBsYWluLm1ldGFjYXJkLnByb3BlcnRpZXMudGl0bGV9XG4gICAgICA8L092ZXJmbG93VG9vbHRpcD5cbiAgICAgIDxCdXR0b24gey4uLm1lbnVTdGF0ZS5NdWlCdXR0b25Qcm9wc30+XG4gICAgICAgIDxNb3JlVmVydEljb24gLz5cbiAgICAgIDwvQnV0dG9uPlxuICAgICAgPFBvcG92ZXIgey4uLm1lbnVTdGF0ZS5NdWlQb3BvdmVyUHJvcHN9IGtlZXBNb3VudGVkPXt0cnVlfT5cbiAgICAgICAgPFBhcGVyIGVsZXZhdGlvbj17RWxldmF0aW9ucy5vdmVybGF5c30+XG4gICAgICAgICAgPExhenlNZXRhY2FyZEludGVyYWN0aW9uc1xuICAgICAgICAgICAgbGF6eVJlc3VsdHM9e1tsYXp5UmVzdWx0XX1cbiAgICAgICAgICAgIG9uQ2xvc2U9e21lbnVTdGF0ZS5oYW5kbGVDbG9zZX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L1BhcGVyPlxuICAgICAgPC9Qb3BvdmVyPlxuICAgIDwvZGl2PlxuICApXG59XG5cbmxldCBkZWZhdWx0QWN0aXZlVGFiID0gJ0RldGFpbHMnXG5cbmNvbnN0IHVzZUxhc3RBc0RlZmF1bHRBY3RpdmVUYWIgPSAodGFiSW5kZXg6IHN0cmluZykgPT4ge1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGRlZmF1bHRBY3RpdmVUYWIgPSB0YWJJbmRleFxuICB9LCBbdGFiSW5kZXhdKVxufVxuXG5jb25zdCB1c2VJbmRleEZvclNlbGVjdGVkUmVzdWx0cyA9IChcbiAgc2VsZWN0ZWRSZXN1bHRzOiBMYXp5UXVlcnlSZXN1bHRbXVxuKTogW251bWJlciwgKGluZGV4OiBudW1iZXIpID0+IHZvaWRdID0+IHtcbiAgY29uc3QgW2luZGV4LCBzZXRJbmRleF0gPSBSZWFjdC51c2VTdGF0ZSgwKVxuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgc2V0SW5kZXgoMClcbiAgfSwgW3NlbGVjdGVkUmVzdWx0c10pXG4gIHJldHVybiBbaW5kZXgsIHNldEluZGV4XVxufVxuXG5jb25zdCB1c2VQb3NzaWJsZU1ldGFjYXJkVGFicyA9ICh7IHJlc3VsdCB9OiB7IHJlc3VsdDogTGF6eVF1ZXJ5UmVzdWx0IH0pID0+IHtcbiAgY29uc3QgW3Bvc3NpYmxlTWV0YWNhcmRUYWJzLCBzZXRQb3NzaWJsZU1ldGFjYXJkVGFic10gPVxuICAgIFJlYWN0LnVzZVN0YXRlKE1ldGFjYXJkVGFicylcblxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChyZXN1bHQpIHtcbiAgICAgIGxldCBjb3B5T2ZNZXRhY2FyZFRhYnMgPSB7IC4uLk1ldGFjYXJkVGFicyB9XG4gICAgICBpZiAocmVzdWx0LmlzUmV2aXNpb24oKSkge1xuICAgICAgICBkZWxldGUgY29weU9mTWV0YWNhcmRUYWJzW1RhYk5hbWVzLkhpc3RvcnldXG4gICAgICAgIGRlbGV0ZSBjb3B5T2ZNZXRhY2FyZFRhYnNbVGFiTmFtZXMuQWN0aW9uc11cbiAgICAgIH1cbiAgICAgIGlmIChyZXN1bHQuaXNEZWxldGVkKCkpIHtcbiAgICAgICAgZGVsZXRlIGNvcHlPZk1ldGFjYXJkVGFic1tUYWJOYW1lcy5IaXN0b3J5XVxuICAgICAgICBkZWxldGUgY29weU9mTWV0YWNhcmRUYWJzW1RhYk5hbWVzLkFjdGlvbnNdXG4gICAgICB9XG4gICAgICBpZiAocmVzdWx0LmlzUmVtb3RlKCkpIHtcbiAgICAgICAgZGVsZXRlIGNvcHlPZk1ldGFjYXJkVGFic1tUYWJOYW1lcy5IaXN0b3J5XVxuICAgICAgICBkZWxldGUgY29weU9mTWV0YWNhcmRUYWJzW1RhYk5hbWVzLlF1YWxpdHldXG4gICAgICB9XG4gICAgICBpZiAoIXJlc3VsdC5oYXNQcmV2aWV3KCkpIHtcbiAgICAgICAgZGVsZXRlIGNvcHlPZk1ldGFjYXJkVGFic1tUYWJOYW1lcy5QcmV2aWV3XVxuICAgICAgfVxuICAgICAgc2V0UG9zc2libGVNZXRhY2FyZFRhYnMoY29weU9mTWV0YWNhcmRUYWJzKVxuICAgIH0gZWxzZSB7XG4gICAgICBzZXRQb3NzaWJsZU1ldGFjYXJkVGFicyh7fSlcbiAgICB9XG4gIH0sIFtyZXN1bHRdKVxuXG4gIHJldHVybiBwb3NzaWJsZU1ldGFjYXJkVGFic1xufVxuXG5jb25zdCB1c2VNZXRhY2FyZFRhYnMgPSAoeyByZXN1bHQgfTogeyByZXN1bHQ6IExhenlRdWVyeVJlc3VsdCB9KSA9PiB7XG4gIGNvbnN0IHBvc3NpYmxlTWV0YWNhcmRUYWJzID0gdXNlUG9zc2libGVNZXRhY2FyZFRhYnMoeyByZXN1bHQgfSlcbiAgY29uc3QgW2FjdGl2ZVRhYiwgc2V0QWN0aXZlVGFiXSA9IFJlYWN0LnVzZVN0YXRlKGRlZmF1bHRBY3RpdmVUYWIpXG4gIHVzZUxhc3RBc0RlZmF1bHRBY3RpdmVUYWIoYWN0aXZlVGFiKVxuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKFxuICAgICAgT2JqZWN0LmtleXMocG9zc2libGVNZXRhY2FyZFRhYnMpLmxlbmd0aCA+IDAgJiZcbiAgICAgICFwb3NzaWJsZU1ldGFjYXJkVGFic1thY3RpdmVUYWJdXG4gICAgKSB7XG4gICAgICBzZXRBY3RpdmVUYWIoVGFiTmFtZXMuRGV0YWlscylcbiAgICB9XG4gIH0sIFtwb3NzaWJsZU1ldGFjYXJkVGFic10pXG4gIHJldHVybiB7XG4gICAgcG9zc2libGVNZXRhY2FyZFRhYnMsXG4gICAgYWN0aXZlVGFiLFxuICAgIHNldEFjdGl2ZVRhYixcbiAgICBUYWJDb250ZW50OiBwb3NzaWJsZU1ldGFjYXJkVGFic1thY3RpdmVUYWJdPy5jb250ZW50IHx8ICgoKSA9PiBudWxsKSxcbiAgfVxufVxuXG5jb25zdCBJbnNwZWN0b3IgPSAoeyBzZWxlY3Rpb25JbnRlcmZhY2UgfTogSW5zcGVjdG9yVHlwZSkgPT4ge1xuICBjb25zdCBzZWxlY3RlZFJlc3VsdHMgPSB1c2VTZWxlY3RlZFJlc3VsdHNBcnJheUZyb21TZWxlY3Rpb25JbnRlcmZhY2Uoe1xuICAgIHNlbGVjdGlvbkludGVyZmFjZSxcbiAgfSlcbiAgY29uc3QgW2luZGV4LCBzZXRJbmRleF0gPSB1c2VJbmRleEZvclNlbGVjdGVkUmVzdWx0cyhzZWxlY3RlZFJlc3VsdHMpXG5cbiAgY29uc3QgYW1vdW50U2VsZWN0ZWQgPSBzZWxlY3RlZFJlc3VsdHMubGVuZ3RoXG5cbiAgY29uc3QgY3VycmVudFJlc3VsdCA9IHNlbGVjdGVkUmVzdWx0c1tpbmRleF1cbiAgY29uc3QgeyBwb3NzaWJsZU1ldGFjYXJkVGFicywgYWN0aXZlVGFiLCBzZXRBY3RpdmVUYWIsIFRhYkNvbnRlbnQgfSA9XG4gICAgdXNlTWV0YWNhcmRUYWJzKHsgcmVzdWx0OiBjdXJyZW50UmVzdWx0IH0pXG5cbiAgcmV0dXJuIChcbiAgICA8PlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGZsZXgtbm93cmFwIGgtZnVsbCBvdmVyZmxvdy1oaWRkZW5cIj5cbiAgICAgICAge2Ftb3VudFNlbGVjdGVkID4gMSA/IChcbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1yb3cgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGZsZXgtbm93cmFwIHNocmluay0wIGdyb3ctMFwiPlxuICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0SW5kZXgoaW5kZXggLSAxKVxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICBkaXNhYmxlZD17aW5kZXggPT09IDB9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxLZXlib2FyZEFycm93TGVmdEljb25cbiAgICAgICAgICAgICAgICBjb2xvcj1cImluaGVyaXRcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIk11aS10ZXh0LXRleHQtcHJpbWFyeSBNdWktaWNvbi1zaXplLXNtYWxsXCJcbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPEtleWJvYXJkQXJyb3dMZWZ0SWNvblxuICAgICAgICAgICAgICAgIGNvbG9yPVwiaW5oZXJpdFwiXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiLW1sLTMgTXVpLXRleHQtdGV4dC1wcmltYXJ5IE11aS1pY29uLXNpemUtc21hbGxcIlxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICBJdGVtIHtpbmRleCArIDF9IC8ge2Ftb3VudFNlbGVjdGVkfVxuICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0SW5kZXgoaW5kZXggKyAxKVxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICBkaXNhYmxlZD17aW5kZXggPT09IGFtb3VudFNlbGVjdGVkIC0gMX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPEtleWJvYXJkQXJyb3dSaWdodEljb25cbiAgICAgICAgICAgICAgICBjb2xvcj1cImluaGVyaXRcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIk11aS10ZXh0LXRleHQtcHJpbWFyeVwiXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxLZXlib2FyZEFycm93UmlnaHRJY29uXG4gICAgICAgICAgICAgICAgY29sb3I9XCJpbmhlcml0XCJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCItbWwtNSBNdWktdGV4dC10ZXh0LXByaW1hcnlcIlxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICkgOiBudWxsfVxuICAgICAgICB7Y3VycmVudFJlc3VsdCA/IChcbiAgICAgICAgICA8PlxuICAgICAgICAgICAgPFRpdGxlVmlldyBsYXp5UmVzdWx0PXtjdXJyZW50UmVzdWx0fSAvPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGZsZXgtbm93cmFwIHNocmluayBvdmVyZmxvdy1oaWRkZW4gaC1mdWxsXCI+XG4gICAgICAgICAgICAgIDxUYWJzXG4gICAgICAgICAgICAgICAgdmFsdWU9e2FjdGl2ZVRhYn1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KF9lLCBuZXdWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgc2V0QWN0aXZlVGFiKG5ld1ZhbHVlKVxuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwic2hyaW5rLTAgdy1mdWxsXCJcbiAgICAgICAgICAgICAgICBzY3JvbGxCdXR0b25zPVwiYXV0b1wiXG4gICAgICAgICAgICAgICAgdmFyaWFudD1cInNjcm9sbGFibGVcIlxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge09iamVjdC5lbnRyaWVzKHBvc3NpYmxlTWV0YWNhcmRUYWJzKS5tYXAoXG4gICAgICAgICAgICAgICAgICAoW3RhYk5hbWUsIHRhYkRlZmluaXRpb25dKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgPE1hdGVyaWFsVGFiXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk9e3RhYk5hbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGFiTmFtZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiRGVmaW5pdGlvbi5oZWFkZXI/Lih7IHJlc3VsdDogY3VycmVudFJlc3VsdCB9KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIDwvVGFicz5cblxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImgtZnVsbCB3LWZ1bGwgc2hyaW5rIG92ZXJmbG93LWhpZGRlblwiPlxuICAgICAgICAgICAgICAgIDxUYWJDb250ZW50XG4gICAgICAgICAgICAgICAgICByZXN1bHQ9e2N1cnJlbnRSZXN1bHR9XG4gICAgICAgICAgICAgICAgICBzZWxlY3Rpb25JbnRlcmZhY2U9e3NlbGVjdGlvbkludGVyZmFjZX1cbiAgICAgICAgICAgICAgICAgIGtleT17Y3VycmVudFJlc3VsdC5wbGFpbi5pZH1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvPlxuICAgICAgICApIDogKFxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicC0yIHRleHQtY2VudGVyXCI+XG4gICAgICAgICAgICBQbGVhc2Ugc2VsZWN0IHJlc3VsdChzKSB0byBkaXNwbGF5IGluIHRoZSBpbnNwZWN0b3IuXG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICl9XG4gICAgICA8L2Rpdj5cbiAgICA8Lz5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBJbnNwZWN0b3JcbiJdfQ==