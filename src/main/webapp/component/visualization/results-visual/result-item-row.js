import { __read } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import Button from '@mui/material/Button';
import Grid from '@mui/material/Grid';
import * as React from 'react';
import { CellComponent } from './table-header';
import { useRerenderOnBackboneSync, useSelectionOfLazyResult, } from '../../../js/model/LazyQueryResult/hooks';
import user from '../../singletons/user-instance';
import CheckBoxOutlineBlankIcon from '@mui/icons-material/CheckBoxOutlineBlank';
import CheckBoxIcon from '@mui/icons-material/CheckBox';
import { SelectionBackground } from './result-item';
import { useBackbone } from '../../selection-checkbox/useBackbone.hook';
import { TypedUserInstance } from '../../singletons/TypedUser';
import useCoordinateFormat from '../../tabs/metacard/useCoordinateFormat';
import Common from '../../../js/Common';
import Extensions from '../../../extension-points';
import { useMetacardDefinitions } from '../../../js/model/Startup/metacard-definitions.hooks';
import wreqr from '../../../js/wreqr';
import { LayoutContext } from '../../golden-layout/visual-settings.provider';
import { RESULTS_ATTRIBUTES_TABLE, getDefaultResultsShownTable, } from '../settings-helpers';
export function clearSelection() {
    if (window.getSelection) {
        // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.
        window.getSelection().removeAllRanges();
    }
    else if (document.selection) {
        ;
        document.selection.empty();
    }
}
export function hasSelection() {
    if (window.getSelection) {
        // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.
        return window.getSelection().toString() !== '';
    }
    else if (document.selection) {
        return document.selection.toString() !== '';
    }
    else {
        return false;
    }
}
var CheckboxCell = function (_a) {
    var lazyResult = _a.lazyResult;
    var isSelected = useSelectionOfLazyResult({ lazyResult: lazyResult });
    return (_jsx(CellComponent, { className: "h-full", style: { width: 'auto', padding: '0px' }, children: _jsx(Button, { "data-id": "select-checkbox", onClick: function (event) {
                event.stopPropagation();
                if (event.shiftKey) {
                    lazyResult.shiftSelect();
                }
                else {
                    lazyResult.controlSelect();
                }
            }, className: "h-full", children: isSelected ? _jsx(CheckBoxIcon, {}) : _jsx(CheckBoxOutlineBlankIcon, {}) }) }));
};
var RowComponent = function (_a) {
    var lazyResult = _a.lazyResult, originalMeasure = _a.measure, index = _a.index, results = _a.results, selectionInterface = _a.selectionInterface, headerColWidth = _a.headerColWidth, actionWidth = _a.actionWidth, setMaxActionWidth = _a.setMaxActionWidth, addOnWidth = _a.addOnWidth, setMaxAddOnWidth = _a.setMaxAddOnWidth;
    var _b = React.useContext(LayoutContext), getValue = _b.getValue, onStateChanged = _b.onStateChanged;
    var MetacardDefinitions = useMetacardDefinitions();
    var thumbnail = lazyResult.plain.metacard.properties.thumbnail;
    var _c = __read(React.useState(TypedUserInstance.getDecimalPrecision()), 2), decimalPrecision = _c[0], setDecimalPrecision = _c[1];
    var _d = __read(React.useState(getValue(RESULTS_ATTRIBUTES_TABLE, getDefaultResultsShownTable())), 2), shownAttributes = _d[0], setShownAttributes = _d[1];
    var isLast = index === results.length - 1;
    var listenTo = useBackbone().listenTo;
    var convertToFormat = useCoordinateFormat();
    var convertToPrecision = function (value) {
        return value && decimalPrecision
            ? Number(value).toFixed(decimalPrecision)
            : value;
    };
    useRerenderOnBackboneSync({ lazyResult: lazyResult });
    var actionRef = React.useRef(null);
    var addOnRef = React.useRef(null);
    React.useEffect(function () {
        var _a, _b;
        var actionWidth = ((_a = actionRef.current) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect().width) || 0;
        setMaxActionWidth(actionWidth);
        var addOnWidth = ((_b = addOnRef.current) === null || _b === void 0 ? void 0 : _b.getBoundingClientRect().width) || 0;
        setMaxAddOnWidth(addOnWidth);
    });
    React.useEffect(function () {
        listenTo(user.get('user').get('preferences'), 'change:decimalPrecision', function () {
            setDecimalPrecision(TypedUserInstance.getDecimalPrecision());
        });
        onStateChanged(function () {
            var shownList = getValue(RESULTS_ATTRIBUTES_TABLE, getDefaultResultsShownTable());
            setShownAttributes(shownList);
        });
    }, []);
    var imgsrc = Common.getImageSrc(thumbnail);
    var measure = function () {
        var _a, _b;
        if (((_a = containerRef.current) === null || _a === void 0 ? void 0 : _a.clientHeight) &&
            ((_b = containerRef.current) === null || _b === void 0 ? void 0 : _b.clientHeight) > 0) {
            originalMeasure();
        }
    };
    React.useEffect(function () {
        measure();
    }, [shownAttributes, convertToFormat]);
    var getDisplayValue = function (value, property) {
        if (value && MetacardDefinitions.getAttributeMap()[property]) {
            switch (MetacardDefinitions.getAttributeMap()[property].type) {
                case 'GEOMETRY':
                    return convertToFormat(value);
                case 'LONG':
                case 'DOUBLE':
                case 'FLOAT':
                    return convertToPrecision(value);
            }
        }
        return value;
    };
    listenTo(wreqr.vent, 'activeContentItemChanged', function () {
        measure();
    });
    var containerRef = React.useRef(null);
    var ResultItemActionInstance = Extensions.resultItemAction({
        lazyResult: lazyResult,
        selectionInterface: selectionInterface,
        itemContentRef: containerRef,
    });
    var ResultItemAddOnInstance = Extensions.resultItemRowAddOn({
        lazyResult: lazyResult,
        isTableView: true,
    });
    return (_jsx("div", { ref: containerRef, children: _jsxs("div", { className: "bg-inherit flex items-strech flex-nowrap", style: {
                width: actionWidth + addOnWidth + shownAttributes.length * 200 + 'px',
            }, children: [_jsx("div", { className: "bg-inherit Mui-border-divider border ".concat(isLast ? '' : 'border-b-0', " border-l-0 ").concat(index === 0 ? 'border-t-0' : ''), children: ResultItemActionInstance ? (_jsx(CellComponent, { className: "h-full", style: {
                            width: 'auto',
                            padding: 0,
                        }, ref: actionRef, children: _jsx(ResultItemActionInstance, {}) }, "resultItemAction")) : (_jsx("div", { style: { width: actionWidth } })) }, "resultItemAction"), _jsxs("div", { className: "sticky left-0 w-auto z-10 bg-inherit Mui-border-divider border ".concat(isLast ? '' : 'border-b-0', " border-l-0 ").concat(index === 0 ? 'border-t-0' : ''), children: [_jsx(SelectionBackground, { lazyResult: lazyResult }), _jsx(CheckboxCell, { lazyResult: lazyResult })] }), _jsxs("div", { className: "relative Mui-border-divider border border-b-0 border-r-0 border-l-0 ".concat(index === 0 ? 'border-t-0' : ''), children: [_jsx(SelectionBackground, { lazyResult: lazyResult, style: { width: addOnWidth + shownAttributes.length * 200 + 'px' } }), _jsx(Button, { "data-id": "result-item-row-container-button", onMouseDown: function (event) {
                                /**
                                 * Shift key can cause selections since we set the class to allow text selection,
                                 * so the only scenario we want to prevent that in is when shift clicking
                                 */
                                if (event.shiftKey) {
                                    clearSelection();
                                }
                            }, onClick: function (event) {
                                if (hasSelection()) {
                                    return;
                                }
                                if (event.shiftKey) {
                                    lazyResult.shiftSelect();
                                }
                                else if (event.ctrlKey || event.metaKey) {
                                    lazyResult.controlSelect();
                                }
                                else {
                                    lazyResult.select();
                                }
                            }, disableFocusRipple: true, disableRipple: true, disableTouchRipple: true, className: "outline-none rounded-none select-text p-0 text-left break-words h-full", children: _jsx("div", { className: "w-full h-full", children: _jsxs(Grid, { container: true, direction: "row", className: "h-full", wrap: "nowrap", children: [_jsx("div", { className: "Mui-border-divider border border-t-0 border-l-0 ".concat(isLast ? '' : 'border-b-0', " h-full"), children: _jsx("div", { style: { width: addOnWidth }, children: ResultItemAddOnInstance && (_jsx(CellComponent, { style: {
                                                        width: 'auto',
                                                    }, className: "pt-3", ref: addOnRef, children: ResultItemAddOnInstance }, "resultItemAddOn")) }) }, "resultItemAddOn"), shownAttributes.map(function (property) {
                                            var value = lazyResult.plain.metacard.properties[property];
                                            if (value === undefined) {
                                                value = '';
                                            }
                                            if (!Array.isArray(value)) {
                                                value = [value];
                                            }
                                            if (value &&
                                                MetacardDefinitions.getAttributeMap()[property]) {
                                                switch (MetacardDefinitions.getAttributeMap()[property].type) {
                                                    case 'DATE':
                                                        value = value.map(function (val) {
                                                            return val !== undefined && val !== ''
                                                                ? user.getUserReadableDateTime(val)
                                                                : '';
                                                        });
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            return (_jsx("div", { children: _jsx(CellComponent, { "data-property": "".concat(property), className: "Mui-border-divider border border-t-0 border-l-0 ".concat(isLast ? '' : 'border-b-0', " h-full"), "data-value": "".concat(value), style: {
                                                        width: "".concat(headerColWidth.get(property)),
                                                        minWidth: '200px',
                                                    }, children: property === 'thumbnail' && thumbnail ? (_jsx("img", { "data-id": "thumbnail-value", src: imgsrc, style: {
                                                            maxWidth: '100%',
                                                            maxHeight: '100%',
                                                        }, onLoad: function () {
                                                            measure();
                                                        }, onError: function () {
                                                            measure();
                                                        } })) : (_jsx(React.Fragment, { children: _jsx("div", { "data-id": "".concat(property, "-value"), style: { wordBreak: 'break-word' }, children: value.map(function (curValue, index) {
                                                                return (_jsx("span", { "data-value": "".concat(curValue), children: curValue.toString().startsWith('http') ? (_jsx("a", { href: "".concat(curValue), target: "_blank", rel: "noopener noreferrer", children: MetacardDefinitions.getAlias(property) })) : ("".concat(value.length > 1 &&
                                                                        index < value.length - 1
                                                                        ? getDisplayValue(curValue, property) + ', '
                                                                        : getDisplayValue(curValue, property))) }, index));
                                                            }) }) })) }, property) }, property));
                                        })] }) }) })] })] }) }));
};
export default RowComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdWx0LWl0ZW0tcm93LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL21haW4vd2ViYXBwL2NvbXBvbmVudC92aXN1YWxpemF0aW9uL3Jlc3VsdHMtdmlzdWFsL3Jlc3VsdC1pdGVtLXJvdy50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7Ozs7Ozs7OztJQWFJO0FBQ0osT0FBTyxNQUFNLE1BQU0sc0JBQXNCLENBQUE7QUFDekMsT0FBTyxJQUFJLE1BQU0sb0JBQW9CLENBQUE7QUFDckMsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUE7QUFFOUIsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBRTlDLE9BQU8sRUFDTCx5QkFBeUIsRUFDekIsd0JBQXdCLEdBQ3pCLE1BQU0seUNBQXlDLENBQUE7QUFDaEQsT0FBTyxJQUFJLE1BQU0sZ0NBQWdDLENBQUE7QUFDakQsT0FBTyx3QkFBd0IsTUFBTSwwQ0FBMEMsQ0FBQTtBQUMvRSxPQUFPLFlBQVksTUFBTSw4QkFBOEIsQ0FBQTtBQUN2RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFDbkQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDJDQUEyQyxDQUFBO0FBQ3ZFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDRCQUE0QixDQUFBO0FBQzlELE9BQU8sbUJBQW1CLE1BQU0seUNBQXlDLENBQUE7QUFDekUsT0FBTyxNQUFNLE1BQU0sb0JBQW9CLENBQUE7QUFDdkMsT0FBTyxVQUFVLE1BQU0sMkJBQTJCLENBQUE7QUFDbEQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sc0RBQXNELENBQUE7QUFDN0YsT0FBTyxLQUFLLE1BQU0sbUJBQW1CLENBQUE7QUFDckMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDhDQUE4QyxDQUFBO0FBQzVFLE9BQU8sRUFDTCx3QkFBd0IsRUFDeEIs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akMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFDLFFBQWEsRUFBRSxLQUFhO2dFQUN0QyxPQUFPLENBQ0wsNkJBQThCLFVBQUcsUUFBUSxDQUFFLFlBQ3hDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3hDLFlBQ0UsSUFBSSxFQUFFLFVBQUcsUUFBUSxDQUFFLEVBQ25CLE1BQU0sRUFBQyxRQUFRLEVBQ2YsR0FBRyxFQUFDLHFCQUFxQixZQUV4QixtQkFBbUIsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEdBQ3JDLENBQ0wsQ0FBQyxDQUFDLENBQUMsQ0FDRixVQUNFLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQzt3RUFDaEIsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQzt3RUFDdEIsQ0FBQyxDQUFDLGVBQWUsQ0FDYixRQUFRLEVBQ1IsUUFBUSxDQUNULEdBQUcsSUFBSTt3RUFDVixDQUFDLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FDdkMsQ0FDSCxJQW5CUSxLQUFLLENBb0JULENBQ1IsQ0FBQTs0REFDSCxDQUFDLENBQUMsR0FDRSxHQUNTLENBQ2xCLElBM0RJLFFBQVEsQ0E0REMsSUE5RFIsUUFBUSxDQStEWixDQUNQLENBQUE7d0NBQ0gsQ0FBQyxDQUFDLElBQ0csR0FDSCxHQUNDLElBQ0wsSUFDRixHQUNGLENBQ1AsQ0FBQTtBQUNILENBQUMsQ0FBQTtBQUNELGVBQWUsWUFBWSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIENvZGljZSBGb3VuZGF0aW9uXG4gKlxuICogVGhpcyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlclxuICogR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGVcbiAqIExpY2Vuc2UsIG9yIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXRcbiAqIGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVVxuICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4gQSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGlzIGRpc3RyaWJ1dGVkIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtIGFuZCBjYW4gYmUgZm91bmQgYXRcbiAqIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvbGdwbC5odG1sPi5cbiAqXG4gKiovXG5pbXBvcnQgQnV0dG9uIGZyb20gJ0BtdWkvbWF0ZXJpYWwvQnV0dG9uJ1xuaW1wb3J0IEdyaWQgZnJvbSAnQG11aS9tYXRlcmlhbC9HcmlkJ1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnXG5cbmltcG9ydCB7IENlbGxDb21wb25lbnQgfSBmcm9tICcuL3RhYmxlLWhlYWRlcidcbmltcG9ydCB7IExhenlRdWVyeVJlc3VsdCB9IGZyb20gJy4uLy4uLy4uL2pzL21vZGVsL0xhenlRdWVyeVJlc3VsdC9MYXp5UXVlcnlSZXN1bHQnXG5pbXBvcnQge1xuICB1c2VSZXJlbmRlck9uQmFja2JvbmVTeW5jLFxuICB1c2VTZWxlY3Rpb25PZkxhenlSZXN1bHQsXG59IGZyb20gJy4uLy4uLy4uL2pzL21vZGVsL0xhenlRdWVyeVJlc3VsdC9ob29rcydcbmltcG9ydCB1c2VyIGZyb20gJy4uLy4uL3NpbmdsZXRvbnMvdXNlci1pbnN0YW5jZSdcbmltcG9ydCBDaGVja0JveE91dGxpbmVCbGFua0ljb24gZnJvbSAnQG11aS9pY29ucy1tYXRlcmlhbC9DaGVja0JveE91dGxpbmVCbGFuaydcbmltcG9ydCBDaGVja0JveEljb24gZnJvbSAnQG11aS9pY29ucy1tYXRlcmlhbC9DaGVja0JveCdcbmltcG9ydCB7IFNlbGVjdGlvbkJhY2tncm91bmQgfSBmcm9tICcuL3Jlc3VsdC1pdGVtJ1xuaW1wb3J0IHsgdXNlQmFja2JvbmUgfSBmcm9tICcuLi8uLi9zZWxlY3Rpb24tY2hlY2tib3gvdXNlQmFja2JvbmUuaG9vaydcbmltcG9ydCB7IFR5cGVkVXNlckluc3RhbmNlIH0gZnJvbSAnLi4vLi4vc2luZ2xldG9ucy9UeXBlZFVzZXInXG5pbXBvcnQgdXNlQ29vcmRpbmF0ZUZvcm1hdCBmcm9tICcuLi8uLi90YWJzL21ldGFjYXJkL3VzZUNvb3JkaW5hdGVGb3JtYXQnXG5pbXBvcnQgQ29tbW9uIGZyb20gJy4uLy4uLy4uL2pzL0NvbW1vbidcbmltcG9ydCBFeHRlbnNpb25zIGZyb20gJy4uLy4uLy4uL2V4dGVuc2lvbi1wb2ludHMnXG5pbXBvcnQgeyB1c2VNZXRhY2FyZERlZmluaXRpb25zIH0gZnJvbSAnLi4vLi4vLi4vanMvbW9kZWwvU3RhcnR1cC9tZXRhY2FyZC1kZWZpbml0aW9ucy5ob29rcydcbmltcG9ydCB3cmVxciBmcm9tICcuLi8uLi8uLi9qcy93cmVxcidcbmltcG9ydCB7IExheW91dENvbnRleHQgfSBmcm9tICcuLi8uLi9nb2xkZW4tbGF5b3V0L3Zpc3VhbC1zZXR0aW5ncy5wcm92aWRlcidcbmltcG9ydCB7XG4gIFJFU1VMVFNfQVRUUklCVVRFU19UQUJMRSxcbiAgZ2V0RGVmYXVsdFJlc3VsdHNTaG93blRhYmxlLFxufSBmcm9tICcuLi9zZXR0aW5ncy1oZWxwZXJzJ1xudHlwZSBSZXN1bHRJdGVtRnVsbFByb3BzID0ge1xuICBsYXp5UmVzdWx0OiBMYXp5UXVlcnlSZXN1bHRcbiAgbWVhc3VyZTogKCkgPT4gdm9pZFxuICBpbmRleDogbnVtYmVyXG4gIHJlc3VsdHM6IExhenlRdWVyeVJlc3VsdFtdXG4gIHNlbGVjdGlvbkludGVyZmFjZTogYW55XG4gIGhlYWRlckNvbFdpZHRoOiBNYXA8c3RyaW5nLCBzdHJpbmc+XG4gIGFjdGlvbldpZHRoOiBudW1iZXJcbiAgc2V0TWF4QWN0aW9uV2lkdGg6ICh3aWR0aDogbnVtYmVyKSA9PiB2b2lkXG4gIGFkZE9uV2lkdGg6IG51bWJlclxuICBzZXRNYXhBZGRPbldpZHRoOiAod2lkdGg6IG51bWJlcikgPT4gdm9pZFxufVxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyU2VsZWN0aW9uKCkge1xuICBpZiAod2luZG93LmdldFNlbGVjdGlvbikge1xuICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdHMtbWlncmF0ZSgyNTMxKSBGSVhNRTogT2JqZWN0IGlzIHBvc3NpYmx5ICdudWxsJy5cbiAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKClcbiAgfSBlbHNlIGlmICgoZG9jdW1lbnQgYXMgYW55KS5zZWxlY3Rpb24pIHtcbiAgICA7KGRvY3VtZW50IGFzIGFueSkuc2VsZWN0aW9uLmVtcHR5KClcbiAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGhhc1NlbGVjdGlvbigpOiBib29sZWFuIHtcbiAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHtcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIHRzLW1pZ3JhdGUoMjUzMSkgRklYTUU6IE9iamVjdCBpcyBwb3NzaWJseSAnbnVsbCcuXG4gICAgcmV0dXJuIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpICE9PSAnJ1xuICB9IGVsc2UgaWYgKChkb2N1bWVudCBhcyBhbnkpLnNlbGVjdGlvbikge1xuICAgIHJldHVybiAoZG9jdW1lbnQgYXMgYW55KS5zZWxlY3Rpb24udG9TdHJpbmcoKSAhPT0gJydcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuY29uc3QgQ2hlY2tib3hDZWxsID0gKHsgbGF6eVJlc3VsdCB9OiB7IGxhenlSZXN1bHQ6IExhenlRdWVyeVJlc3VsdCB9KSA9PiB7XG4gIGNvbnN0IGlzU2VsZWN0ZWQgPSB1c2VTZWxlY3Rpb25PZkxhenlSZXN1bHQoeyBsYXp5UmVzdWx0IH0pXG4gIHJldHVybiAoXG4gICAgPENlbGxDb21wb25lbnQgY2xhc3NOYW1lPVwiaC1mdWxsXCIgc3R5bGU9e3sgd2lkdGg6ICdhdXRvJywgcGFkZGluZzogJzBweCcgfX0+XG4gICAgICA8QnV0dG9uXG4gICAgICAgIGRhdGEtaWQ9XCJzZWxlY3QtY2hlY2tib3hcIlxuICAgICAgICBvbkNsaWNrPXsoZXZlbnQpID0+IHtcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgIGlmIChldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgbGF6eVJlc3VsdC5zaGlmdFNlbGVjdCgpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxhenlSZXN1bHQuY29udHJvbFNlbGVjdCgpXG4gICAgICAgICAgfVxuICAgICAgICB9fVxuICAgICAgICBjbGFzc05hbWU9XCJoLWZ1bGxcIlxuICAgICAgPlxuICAgICAgICB7aXNTZWxlY3RlZCA/IDxDaGVja0JveEljb24gLz4gOiA8Q2hlY2tCb3hPdXRsaW5lQmxhbmtJY29uIC8+fVxuICAgICAgPC9CdXR0b24+XG4gICAgPC9DZWxsQ29tcG9uZW50PlxuICApXG59XG5jb25zdCBSb3dDb21wb25lbnQgPSAoe1xuICBsYXp5UmVzdWx0LFxuICBtZWFzdXJlOiBvcmlnaW5hbE1lYXN1cmUsXG4gIGluZGV4LFxuICByZXN1bHRzLFxuICBzZWxlY3Rpb25JbnRlcmZhY2UsXG4gIGhlYWRlckNvbFdpZHRoLFxuICBhY3Rpb25XaWR0aCxcbiAgc2V0TWF4QWN0aW9uV2lkdGgsXG4gIGFkZE9uV2lkdGgsXG4gIHNldE1heEFkZE9uV2lkdGgsXG59OiBSZXN1bHRJdGVtRnVsbFByb3BzKSA9PiB7XG4gIGNvbnN0IHsgZ2V0VmFsdWUsIG9uU3RhdGVDaGFuZ2VkIH0gPSBSZWFjdC51c2VDb250ZXh0KExheW91dENvbnRleHQpXG4gIGNvbnN0IE1ldGFjYXJkRGVmaW5pdGlvbnMgPSB1c2VNZXRhY2FyZERlZmluaXRpb25zKClcbiAgY29uc3QgdGh1bWJuYWlsID0gbGF6eVJlc3VsdC5wbGFpbi5tZXRhY2FyZC5wcm9wZXJ0aWVzLnRodW1ibmFpbFxuICBjb25zdCBbZGVjaW1hbFByZWNpc2lvbiwgc2V0RGVjaW1hbFByZWNpc2lvbl0gPSBSZWFjdC51c2VTdGF0ZShcbiAgICBUeXBlZFVzZXJJbnN0YW5jZS5nZXREZWNpbWFsUHJlY2lzaW9uKClcbiAgKVxuICBjb25zdCBbc2hvd25BdHRyaWJ1dGVzLCBzZXRTaG93bkF0dHJpYnV0ZXNdID0gUmVhY3QudXNlU3RhdGUoXG4gICAgZ2V0VmFsdWUoXG4gICAgICBSRVNVTFRTX0FUVFJJQlVURVNfVEFCTEUsXG4gICAgICBnZXREZWZhdWx0UmVzdWx0c1Nob3duVGFibGUoKVxuICAgICkgYXMgc3RyaW5nW11cbiAgKVxuICBjb25zdCBpc0xhc3QgPSBpbmRleCA9PT0gcmVzdWx0cy5sZW5ndGggLSAxXG4gIGNvbnN0IHsgbGlzdGVuVG8gfSA9IHVzZUJhY2tib25lKClcbiAgY29uc3QgY29udmVydFRvRm9ybWF0ID0gdXNlQ29vcmRpbmF0ZUZvcm1hdCgpXG4gIGNvbnN0IGNvbnZlcnRUb1ByZWNpc2lvbiA9ICh2YWx1ZTogYW55KSA9PiB7XG4gICAgcmV0dXJuIHZhbHVlICYmIGRlY2ltYWxQcmVjaXNpb25cbiAgICAgID8gTnVtYmVyKHZhbHVlKS50b0ZpeGVkKGRlY2ltYWxQcmVjaXNpb24pXG4gICAgICA6IHZhbHVlXG4gIH1cbiAgdXNlUmVyZW5kZXJPbkJhY2tib25lU3luYyh7IGxhenlSZXN1bHQgfSlcblxuICBjb25zdCBhY3Rpb25SZWYgPSBSZWFjdC51c2VSZWY8SFRNTERpdkVsZW1lbnQ+KG51bGwpXG4gIGNvbnN0IGFkZE9uUmVmID0gUmVhY3QudXNlUmVmPEhUTUxEaXZFbGVtZW50PihudWxsKVxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGFjdGlvbldpZHRoID0gYWN0aW9uUmVmLmN1cnJlbnQ/LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIHx8IDBcbiAgICBzZXRNYXhBY3Rpb25XaWR0aChhY3Rpb25XaWR0aClcbiAgICBjb25zdCBhZGRPbldpZHRoID0gYWRkT25SZWYuY3VycmVudD8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggfHwgMFxuICAgIHNldE1heEFkZE9uV2lkdGgoYWRkT25XaWR0aClcbiAgfSlcblxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGxpc3RlblRvKFxuICAgICAgdXNlci5nZXQoJ3VzZXInKS5nZXQoJ3ByZWZlcmVuY2VzJyksXG4gICAgICAnY2hhbmdlOmRlY2ltYWxQcmVjaXNpb24nLFxuICAgICAgKCkgPT4ge1xuICAgICAgICBzZXREZWNpbWFsUHJlY2lzaW9uKFR5cGVkVXNlckluc3RhbmNlLmdldERlY2ltYWxQcmVjaXNpb24oKSlcbiAgICAgIH1cbiAgICApXG4gICAgb25TdGF0ZUNoYW5nZWQoKCkgPT4ge1xuICAgICAgY29uc3Qgc2hvd25MaXN0ID0gZ2V0VmFsdWUoXG4gICAgICAgIFJFU1VMVFNfQVRUUklCVVRFU19UQUJMRSxcbiAgICAgICAgZ2V0RGVmYXVsdFJlc3VsdHNTaG93blRhYmxlKClcbiAgICAgIClcbiAgICAgIHNldFNob3duQXR0cmlidXRlcyhzaG93bkxpc3QpXG4gICAgfSlcbiAgfSwgW10pXG4gIGNvbnN0IGltZ3NyYyA9IENvbW1vbi5nZXRJbWFnZVNyYyh0aHVtYm5haWwpXG4gIGNvbnN0IG1lYXN1cmUgPSAoKSA9PiB7XG4gICAgaWYgKFxuICAgICAgY29udGFpbmVyUmVmLmN1cnJlbnQ/LmNsaWVudEhlaWdodCAmJlxuICAgICAgY29udGFpbmVyUmVmLmN1cnJlbnQ/LmNsaWVudEhlaWdodCA+IDBcbiAgICApIHtcbiAgICAgIG9yaWdpbmFsTWVhc3VyZSgpXG4gICAgfVxuICB9XG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgbWVhc3VyZSgpXG4gIH0sIFtzaG93bkF0dHJpYnV0ZXMsIGNvbnZlcnRUb0Zvcm1hdF0pXG4gIGNvbnN0IGdldERpc3BsYXlWYWx1ZSA9ICh2YWx1ZTogYW55LCBwcm9wZXJ0eTogc3RyaW5nKSA9PiB7XG4gICAgaWYgKHZhbHVlICYmIE1ldGFjYXJkRGVmaW5pdGlvbnMuZ2V0QXR0cmlidXRlTWFwKClbcHJvcGVydHldKSB7XG4gICAgICBzd2l0Y2ggKE1ldGFjYXJkRGVmaW5pdGlvbnMuZ2V0QXR0cmlidXRlTWFwKClbcHJvcGVydHldLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnR0VPTUVUUlknOlxuICAgICAgICAgIHJldHVybiBjb252ZXJ0VG9Gb3JtYXQodmFsdWUpXG4gICAgICAgIGNhc2UgJ0xPTkcnOlxuICAgICAgICBjYXNlICdET1VCTEUnOlxuICAgICAgICBjYXNlICdGTE9BVCc6XG4gICAgICAgICAgcmV0dXJuIGNvbnZlcnRUb1ByZWNpc2lvbih2YWx1ZSlcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlXG4gIH1cbiAgbGlzdGVuVG8od3JlcXIudmVudCwgJ2FjdGl2ZUNvbnRlbnRJdGVtQ2hhbmdlZCcsICgpID0+IHtcbiAgICBtZWFzdXJlKClcbiAgfSlcbiAgY29uc3QgY29udGFpbmVyUmVmID0gUmVhY3QudXNlUmVmPEhUTUxEaXZFbGVtZW50PihudWxsKVxuICBjb25zdCBSZXN1bHRJdGVtQWN0aW9uSW5zdGFuY2UgPSBFeHRlbnNpb25zLnJlc3VsdEl0ZW1BY3Rpb24oe1xuICAgIGxhenlSZXN1bHQsXG4gICAgc2VsZWN0aW9uSW50ZXJmYWNlLFxuICAgIGl0ZW1Db250ZW50UmVmOiBjb250YWluZXJSZWYsXG4gIH0pXG5cbiAgY29uc3QgUmVzdWx0SXRlbUFkZE9uSW5zdGFuY2UgPSBFeHRlbnNpb25zLnJlc3VsdEl0ZW1Sb3dBZGRPbih7XG4gICAgbGF6eVJlc3VsdCxcbiAgICBpc1RhYmxlVmlldzogdHJ1ZSxcbiAgfSlcblxuICByZXR1cm4gKFxuICAgIDxkaXYgcmVmPXtjb250YWluZXJSZWZ9PlxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9XCJiZy1pbmhlcml0IGZsZXggaXRlbXMtc3RyZWNoIGZsZXgtbm93cmFwXCJcbiAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICB3aWR0aDogYWN0aW9uV2lkdGggKyBhZGRPbldpZHRoICsgc2hvd25BdHRyaWJ1dGVzLmxlbmd0aCAqIDIwMCArICdweCcsXG4gICAgICAgIH19XG4gICAgICA+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBrZXk9XCJyZXN1bHRJdGVtQWN0aW9uXCJcbiAgICAgICAgICBjbGFzc05hbWU9e2BiZy1pbmhlcml0IE11aS1ib3JkZXItZGl2aWRlciBib3JkZXIgJHtcbiAgICAgICAgICAgIGlzTGFzdCA/ICcnIDogJ2JvcmRlci1iLTAnXG4gICAgICAgICAgfSBib3JkZXItbC0wICR7aW5kZXggPT09IDAgPyAnYm9yZGVyLXQtMCcgOiAnJ31gfVxuICAgICAgICA+XG4gICAgICAgICAge1Jlc3VsdEl0ZW1BY3Rpb25JbnN0YW5jZSA/IChcbiAgICAgICAgICAgIDxDZWxsQ29tcG9uZW50XG4gICAgICAgICAgICAgIGtleT1cInJlc3VsdEl0ZW1BY3Rpb25cIlxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJoLWZ1bGxcIlxuICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgcGFkZGluZzogMCxcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgcmVmPXthY3Rpb25SZWZ9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxSZXN1bHRJdGVtQWN0aW9uSW5zdGFuY2UgLz5cbiAgICAgICAgICAgIDwvQ2VsbENvbXBvbmVudD5cbiAgICAgICAgICApIDogKFxuICAgICAgICAgICAgPGRpdiBzdHlsZT17eyB3aWR0aDogYWN0aW9uV2lkdGggfX0gLz5cbiAgICAgICAgICApfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzTmFtZT17YHN0aWNreSBsZWZ0LTAgdy1hdXRvIHotMTAgYmctaW5oZXJpdCBNdWktYm9yZGVyLWRpdmlkZXIgYm9yZGVyICR7XG4gICAgICAgICAgICBpc0xhc3QgPyAnJyA6ICdib3JkZXItYi0wJ1xuICAgICAgICAgIH0gYm9yZGVyLWwtMCAke2luZGV4ID09PSAwID8gJ2JvcmRlci10LTAnIDogJyd9YH1cbiAgICAgICAgPlxuICAgICAgICAgIDxTZWxlY3Rpb25CYWNrZ3JvdW5kIGxhenlSZXN1bHQ9e2xhenlSZXN1bHR9IC8+XG4gICAgICAgICAgPENoZWNrYm94Q2VsbCBsYXp5UmVzdWx0PXtsYXp5UmVzdWx0fSAvPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzTmFtZT17YHJlbGF0aXZlIE11aS1ib3JkZXItZGl2aWRlciBib3JkZXIgYm9yZGVyLWItMCBib3JkZXItci0wIGJvcmRlci1sLTAgJHtcbiAgICAgICAgICAgIGluZGV4ID09PSAwID8gJ2JvcmRlci10LTAnIDogJydcbiAgICAgICAgICB9YH1cbiAgICAgICAgPlxuICAgICAgICAgIDxTZWxlY3Rpb25CYWNrZ3JvdW5kXG4gICAgICAgICAgICBsYXp5UmVzdWx0PXtsYXp5UmVzdWx0fVxuICAgICAgICAgICAgc3R5bGU9e3sgd2lkdGg6IGFkZE9uV2lkdGggKyBzaG93bkF0dHJpYnV0ZXMubGVuZ3RoICogMjAwICsgJ3B4JyB9fVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgZGF0YS1pZD1cInJlc3VsdC1pdGVtLXJvdy1jb250YWluZXItYnV0dG9uXCJcbiAgICAgICAgICAgIG9uTW91c2VEb3duPXsoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAqIFNoaWZ0IGtleSBjYW4gY2F1c2Ugc2VsZWN0aW9ucyBzaW5jZSB3ZSBzZXQgdGhlIGNsYXNzIHRvIGFsbG93IHRleHQgc2VsZWN0aW9uLFxuICAgICAgICAgICAgICAgKiBzbyB0aGUgb25seSBzY2VuYXJpbyB3ZSB3YW50IHRvIHByZXZlbnQgdGhhdCBpbiBpcyB3aGVuIHNoaWZ0IGNsaWNraW5nXG4gICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICBjbGVhclNlbGVjdGlvbigpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICBvbkNsaWNrPXsoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGhhc1NlbGVjdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgbGF6eVJlc3VsdC5zaGlmdFNlbGVjdCgpXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSB7XG4gICAgICAgICAgICAgICAgbGF6eVJlc3VsdC5jb250cm9sU2VsZWN0KClcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsYXp5UmVzdWx0LnNlbGVjdCgpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICBkaXNhYmxlRm9jdXNSaXBwbGVcbiAgICAgICAgICAgIGRpc2FibGVSaXBwbGVcbiAgICAgICAgICAgIGRpc2FibGVUb3VjaFJpcHBsZVxuICAgICAgICAgICAgY2xhc3NOYW1lPVwib3V0bGluZS1ub25lIHJvdW5kZWQtbm9uZSBzZWxlY3QtdGV4dCBwLTAgdGV4dC1sZWZ0IGJyZWFrLXdvcmRzIGgtZnVsbFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3LWZ1bGwgaC1mdWxsXCI+XG4gICAgICAgICAgICAgIDxHcmlkIGNvbnRhaW5lciBkaXJlY3Rpb249XCJyb3dcIiBjbGFzc05hbWU9XCJoLWZ1bGxcIiB3cmFwPVwibm93cmFwXCI+XG4gICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAga2V5PVwicmVzdWx0SXRlbUFkZE9uXCJcbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YE11aS1ib3JkZXItZGl2aWRlciBib3JkZXIgYm9yZGVyLXQtMCBib3JkZXItbC0wICR7XG4gICAgICAgICAgICAgICAgICAgIGlzTGFzdCA/ICcnIDogJ2JvcmRlci1iLTAnXG4gICAgICAgICAgICAgICAgICB9IGgtZnVsbGB9XG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyB3aWR0aDogYWRkT25XaWR0aCB9fT5cbiAgICAgICAgICAgICAgICAgICAge1Jlc3VsdEl0ZW1BZGRPbkluc3RhbmNlICYmIChcbiAgICAgICAgICAgICAgICAgICAgICA8Q2VsbENvbXBvbmVudFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5PVwicmVzdWx0SXRlbUFkZE9uXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwicHQtM1wiXG4gICAgICAgICAgICAgICAgICAgICAgICByZWY9e2FkZE9uUmVmfVxuICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtSZXN1bHRJdGVtQWRkT25JbnN0YW5jZX1cbiAgICAgICAgICAgICAgICAgICAgICA8L0NlbGxDb21wb25lbnQ+XG4gICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICB7c2hvd25BdHRyaWJ1dGVzLm1hcCgocHJvcGVydHkpID0+IHtcbiAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IGxhenlSZXN1bHQucGxhaW4ubWV0YWNhcmQucHJvcGVydGllc1tcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlcbiAgICAgICAgICAgICAgICAgIF0gYXMgYW55XG4gICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICcnXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gW3ZhbHVlXVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSAmJlxuICAgICAgICAgICAgICAgICAgICBNZXRhY2FyZERlZmluaXRpb25zLmdldEF0dHJpYnV0ZU1hcCgpW3Byb3BlcnR5XVxuICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoXG4gICAgICAgICAgICAgICAgICAgICAgTWV0YWNhcmREZWZpbml0aW9ucy5nZXRBdHRyaWJ1dGVNYXAoKVtwcm9wZXJ0eV0udHlwZVxuICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICBjYXNlICdEQVRFJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUubWFwKCh2YWw6IGFueSkgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsICE9PSB1bmRlZmluZWQgJiYgdmFsICE9PSAnJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gdXNlci5nZXRVc2VyUmVhZGFibGVEYXRlVGltZSh2YWwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAnJ1xuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBrZXk9e3Byb3BlcnR5fT5cbiAgICAgICAgICAgICAgICAgICAgICA8Q2VsbENvbXBvbmVudFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtwcm9wZXJ0eX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtcHJvcGVydHk9e2Ake3Byb3BlcnR5fWB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2BNdWktYm9yZGVyLWRpdmlkZXIgYm9yZGVyIGJvcmRlci10LTAgYm9yZGVyLWwtMCAke1xuICAgICAgICAgICAgICAgICAgICAgICAgICBpc0xhc3QgPyAnJyA6ICdib3JkZXItYi0wJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBoLWZ1bGxgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS12YWx1ZT17YCR7dmFsdWV9YH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBgJHtoZWFkZXJDb2xXaWR0aC5nZXQocHJvcGVydHkpfWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG1pbldpZHRoOiAnMjAwcHgnLFxuICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7cHJvcGVydHkgPT09ICd0aHVtYm5haWwnICYmIHRodW1ibmFpbCA/IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGltZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtaWQ9XCJ0aHVtYm5haWwtdmFsdWVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYz17aW1nc3JjfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aDogJzEwMCUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiAnMTAwJScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkxvYWQ9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lYXN1cmUoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25FcnJvcj17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVhc3VyZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxSZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLWlkPXtgJHtwcm9wZXJ0eX0tdmFsdWVgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgd29yZEJyZWFrOiAnYnJlYWstd29yZCcgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dmFsdWUubWFwKChjdXJWYWx1ZTogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4ga2V5PXtpbmRleH0gZGF0YS12YWx1ZT17YCR7Y3VyVmFsdWV9YH0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Y3VyVmFsdWUudG9TdHJpbmcoKS5zdGFydHNXaXRoKCdodHRwJykgPyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHJlZj17YCR7Y3VyVmFsdWV9YH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ9XCJfYmxhbmtcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbD1cIm5vb3BlbmVyIG5vcmVmZXJyZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge01ldGFjYXJkRGVmaW5pdGlvbnMuZ2V0QWxpYXMocHJvcGVydHkpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgJHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5sZW5ndGggPiAxICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPCB2YWx1ZS5sZW5ndGggLSAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGdldERpc3BsYXlWYWx1ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApICsgJywgJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBnZXREaXNwbGF5VmFsdWUoY3VyVmFsdWUsIHByb3BlcnR5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9YFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L1JlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAgICA8L0NlbGxDb21wb25lbnQ+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICA8L0dyaWQ+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKVxufVxuZXhwb3J0IGRlZmF1bHQgUm93Q29tcG9uZW50XG4iXX0=