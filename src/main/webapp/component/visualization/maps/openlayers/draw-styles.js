import { __assign } from "tslib";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import Style from 'ol/style/Style';
import { Stroke, Fill, Circle } from 'ol/style';
import { MultiPoint } from 'ol/geom';
import { transparentize } from 'polished';
import { geometry } from 'geospatialdraw';
import { contrastingColor } from '../../../../react-component/location/location-color-selector';
var CIRCLE_BUFFER_PROPERTY_VALUE = geometry.CIRCLE_BUFFER_PROPERTY_VALUE, POLYGON_LINE_BUFFER_PROPERTY_VALUE = geometry.POLYGON_LINE_BUFFER_PROPERTY_VALUE, BUFFER_SHAPE_PROPERTY = geometry.BUFFER_SHAPE_PROPERTY;
var LINE_WIDTH = 2.5;
var POINT_SIZE = 4.5;
var SCALE_FACTOR = 1.5;
var RENDERER_STYLE = function (feature) {
    return new Style(__assign({ stroke: new Stroke({
            color: feature.get('color'),
            width: LINE_WIDTH,
        }), fill: new Fill({
            color: 'rgba(0, 0, 0, 0)',
        }) }, (feature.get(BUFFER_SHAPE_PROPERTY) === CIRCLE_BUFFER_PROPERTY_VALUE
        ? {}
        : {
            image: new Circle({
                radius: POINT_SIZE,
                fill: new Fill({
                    color: feature.get('color'),
                }),
            }),
        })));
};
var CIRCLE_DRAWING_STYLE = function (feature) {
    return new Style({
        stroke: new Stroke({
            color: 'rgba(0, 0, 0, 0)',
        }),
        fill: new Fill({
            color: 'rgba(0, 0, 0, 0)',
        }),
        image: new Circle({
            radius: POINT_SIZE,
            fill: new Fill({
                color: feature.get('color'),
            }),
        }),
    });
};
var CIRCLE_BUFFER_PROPERTY_VALUE_DRAWING_STYLE = function (feature) {
    return new Style({
        stroke: new Stroke({
            color: feature.get('color'),
            width: LINE_WIDTH * SCALE_FACTOR,
        }),
        fill: new Fill({
            color: transparentize(0.95, feature.get('color') || contrastingColor),
        }),
    });
};
var GENERIC_DRAWING_STYLE = function (feature) {
    var _a;
    return [
        new Style(__assign({ stroke: new Stroke({
                color: feature.get('color'),
                width: LINE_WIDTH * SCALE_FACTOR,
            }), fill: new Fill({
                color: transparentize(0.95, feature.get('color') || contrastingColor),
            }) }, (((_a = feature.getGeometry()) === null || _a === void 0 ? void 0 : _a.getType()) === 'Point' &&
            feature.get('buffer') > 0
            ? {}
            : {
                image: new Circle({
                    radius: POINT_SIZE * SCALE_FACTOR,
                    fill: new Fill({
                        color: feature.get('color'),
                    }),
                }),
            }))),
        new Style({
            image: new Circle({
                radius: POINT_SIZE,
                fill: new Fill({
                    color: feature.get('color'),
                }),
            }),
            geometry: function (feature) {
                var geometry = feature.getGeometry();
                if (!geometry)
                    return undefined;
                var coordinates = [];
                if (geometry.getType() === 'Polygon') {
                    coordinates = geometry.getCoordinates()[0];
                }
                else if (geometry.getType() === 'LineString') {
                    coordinates = geometry.getCoordinates();
                }
                return new MultiPoint(coordinates);
            },
        }),
    ];
};
var DRAWING_STYLE = function (feature) {
    var _a;
    if (((_a = feature.getGeometry()) === null || _a === void 0 ? void 0 : _a.getType()) === 'Circle') {
        return CIRCLE_DRAWING_STYLE(feature);
    }
    else {
        var bufferShape = feature.get(BUFFER_SHAPE_PROPERTY);
        switch (bufferShape) {
            case POLYGON_LINE_BUFFER_PROPERTY_VALUE:
                return RENDERER_STYLE(feature);
            case CIRCLE_BUFFER_PROPERTY_VALUE:
                return CIRCLE_BUFFER_PROPERTY_VALUE_DRAWING_STYLE(feature);
            default:
                return GENERIC_DRAWING_STYLE(feature);
        }
    }
};
export { RENDERER_STYLE, DRAWING_STYLE };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhdy1zdHlsZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbWFpbi93ZWJhcHAvY29tcG9uZW50L3Zpc3VhbGl6YXRpb24vbWFwcy9vcGVubGF5ZXJzL2RyYXctc3R5bGVzLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7SUFhSTtBQUNKLE9BQU8sS0FBSyxNQUFNLGdCQUFnQixDQUFBO0FBQ2xDLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUUvQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sU0FBUyxDQUFBO0FBS3BDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDekMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQ3pDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDhEQUE4RCxDQUFBO0FBRzdGLElBQUEsNEJBQTRCLEdBRzFCLFFBQVEsNkJBSGtCLEVBQzVCLGtDQUFrQyxHQUVoQyxRQUFRLG1DQUZ3QixFQUNsQyxxQkFBcUIsR0FDbkIsUUFBUSxzQkFEVyxDQUNYO0FBRVosSUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFBO0FBQ3RCLElBQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQTtBQUN0QixJQUFNLFlBQVksR0FBRyxHQUFHLENBQUE7QUFFeEIsSUFBTSxjQUFjLEdBQUcsVUFBQyxPQUFnQjtJQUN0QyxPQUFBLElBQUksS0FBSyxZQUNQLE1BQU0sRUFBRSxJQUFJLE1BQU0sQ0FBQztZQUNqQixLQUFLLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUM7WUFDM0IsS0FBSyxFQUFFLFVBQVU7U0FDbEIsQ0FBQyxFQUNGLElBQUksRUFBRSxJQUFJLElBQUksQ0FBQztZQUNiLEtBQUssRUFBRSxrQkFBa0I7U0FDMUIsQ0FBQyxJQUNDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLDRCQUE0QjtRQUNyRSxDQUFDLENBQUMsRUFBRTtRQUNKLENBQUMsQ0FBQztZQUNFLEtBQUssRUFBRSxJQUFJLE1BQU0sQ0FBQztnQkFDaEIsTUFBTSxFQUFFLFVBQVU7Z0JBQ2xCLElBQUksRUFBRSxJQUFJLElBQUksQ0FBQztvQkFDYixLQUFLLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUM7aUJBQzVCLENBQUM7YUFDSCxDQUFDO1NBQ0gsQ0FBQyxFQUNOO0FBbEJGLENBa0JFLENBQUE7QUFFSixJQUFNLG9CQUFvQixHQUFHLFVBQUMsT0FBZ0I7SUFDNUMsT0FBQSxJQUFJLEtBQUssQ0FBQztRQUNSLE1BQU0sRUFBRSxJQUFJLE1BQU0sQ0FBQztZQUNqQixLQUFLLEVBQUUsa0JBQWtCO1NBQzFCLENBQUM7UUFDRixJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUM7WUFDYixLQUFLLEVBQUUsa0JBQWtCO1NBQzFCLENBQUM7UUFDRixLQUFLLEVBQUUsSUFBSSxNQUFNLENBQUM7WUFDaEIsTUFBTSxFQUFFLFVBQVU7WUFDbEIsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDO2dCQUNiLEtBQUssRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQzthQUM1QixDQUFDO1NBQ0gsQ0FBQztLQUNILENBQUM7QUFiRixDQWFFLENBQUE7QUFFSixJQUFNLDBDQUEwQyxHQUFHLFVBQUMsT0FBZ0I7SUFDbEUsT0FBQSxJQUFJLEtBQUssQ0FBQztRQUNSLE1BQU0sRUFBRSxJQUFJLE1BQU0sQ0FBQztZQUNqQixLQUFLLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUM7WUFDM0IsS0FBSyxFQUFFLFVBQVUsR0FBRyxZQUFZO1NBQ2pDLENBQUM7UUFDRixJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUM7WUFDYixLQUFLLEVBQUUsY0FBYyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLGdCQUFnQixDQUFDO1NBQ3RFLENBQUM7S0FDSCxDQUFDO0FBUkYsQ0FRRSxDQUFBO0FBRUosSUFBTSxxQkFBcUIsR0FBRyxVQUFDLE9BQWdCOztJQUFjLE9BQUE7UUFDM0QsSUFBSSxLQUFLLFlBQ1AsTUFBTSxFQUFFLElBQUksTUFBTSxDQUFDO2dCQUNqQixLQUFLLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUM7Z0JBQzNCLEtBQUssRUFBRSxVQUFVLEdBQUcsWUFBWTthQUNqQyxDQUFDLEVBQ0YsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDO2dCQUNiLEtBQUssRUFBRSxjQUFjLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksZ0JBQWdCLENBQUM7YUFDdEUsQ0FBQyxJQUNDLENBQUMsQ0FBQSxNQUFBLE9BQU8sQ0FBQyxXQUFXLEVBQUUsMENBQUUsT0FBTyxFQUFFLE1BQUssT0FBTztZQUNoRCxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUM7WUFDdkIsQ0FBQyxDQUFDLEVBQUU7WUFDSixDQUFDLENBQUM7Z0JBQ0UsS0FBSyxFQUFFLElBQUksTUFBTSxDQUFDO29CQUNoQixNQUFNLEVBQUUsVUFBVSxHQUFHLFlBQVk7b0JBQ2pDLElBQUksRUFBRSxJQUFJLElBQUksQ0FBQzt3QkFDYixLQUFLLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUM7cUJBQzVCLENBQUM7aUJBQ0gsQ0FBQzthQUNILENBQUMsRUFDTjtRQUNGLElBQUksS0FBSyxDQUFDO1lBQ1IsS0FBSyxFQUFFLElBQUksTUFBTSxDQUFDO2dCQUNoQixNQUFNLEVBQUUsVUFBVTtnQkFDbEIsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDO29CQUNiLEtBQUssRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztpQkFDNUIsQ0FBQzthQUNILENBQUM7WUFDRixRQUFRLEVBQUUsVUFBQyxPQUFPO2dCQUNoQixJQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsV0FBVyxFQUFFLENBQUE7Z0JBQ3RDLElBQUksQ0FBQyxRQUFRO29CQUFFLE9BQU8sU0FBUyxDQUFBO2dCQUMvQixJQUFJLFdBQVcsR0FBaUIsRUFBRSxDQUFBO2dCQUNsQyxJQUFJLFFBQVEsQ0FBQyxPQUFPLEVBQUUsS0FBSyxTQUFTLEVBQUUsQ0FBQztvQkFDckMsV0FBVyxHQUFJLFFBQW9CLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQ3pELENBQUM7cUJBQU0sSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFFLEtBQUssWUFBWSxFQUFFLENBQUM7b0JBQy9DLFdBQVcsR0FBSSxRQUF1QixDQUFDLGNBQWMsRUFBRSxDQUFBO2dCQUN6RCxDQUFDO2dCQUNELE9BQU8sSUFBSSxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUE7WUFDcEMsQ0FBQztTQUNGLENBQUM7S0FDSCxDQUFBO0NBQUEsQ0FBQTtBQUVELElBQU0sYUFBYSxHQUFHLFVBQUMsT0FBZ0I7O0lBQ3JDLElBQUksQ0FBQSxNQUFBLE9BQU8sQ0FBQyxXQUFXLEVBQUUsMENBQUUsT0FBTyxFQUFFLE1BQUssUUFBUSxFQUFFLENBQUM7UUFDbEQsT0FBTyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUN0QyxDQUFDO1NBQU0sQ0FBQztRQUNOLElBQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQTtRQUN0RCxRQUFRLFdBQVcsRUFBRSxDQUFDO1lBQ3BCLEtBQUssa0NBQWtDO2dCQUNyQyxPQUFPLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUNoQyxLQUFLLDRCQUE0QjtnQkFDL0IsT0FBTywwQ0FBMEMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUM1RDtnQkFDRSxPQUFPLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQ3pDLENBQUM7SUFDSCxDQUFDO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxhQUFhLEVBQUUsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBDb2RpY2UgRm91bmRhdGlvblxuICpcbiAqIFRoaXMgaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXJcbiAqIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlXG4gKiBMaWNlbnNlLCBvciBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0XG4gKiBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlVcbiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuIEEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBpcyBkaXN0cmlidXRlZCBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbSBhbmQgY2FuIGJlIGZvdW5kIGF0XG4gKiA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2xncGwuaHRtbD4uXG4gKlxuICoqL1xuaW1wb3J0IFN0eWxlIGZyb20gJ29sL3N0eWxlL1N0eWxlJ1xuaW1wb3J0IHsgU3Ryb2tlLCBGaWxsLCBDaXJjbGUgfSBmcm9tICdvbC9zdHlsZSdcbmltcG9ydCBHZW9tZXRyeSBmcm9tICdvbC9nZW9tL0dlb21ldHJ5J1xuaW1wb3J0IHsgTXVsdGlQb2ludCB9IGZyb20gJ29sL2dlb20nXG5pbXBvcnQgUG9seWdvbiBmcm9tICdvbC9nZW9tL1BvbHlnb24nXG5pbXBvcnQgTGluZVN0cmluZyBmcm9tICdvbC9nZW9tL0xpbmVTdHJpbmcnXG5pbXBvcnQgRmVhdHVyZSBmcm9tICdvbC9GZWF0dXJlJ1xuaW1wb3J0IHsgQ29vcmRpbmF0ZSB9IGZyb20gJ29sL2Nvb3JkaW5hdGUnXG5pbXBvcnQgeyB0cmFuc3BhcmVudGl6ZSB9IGZyb20gJ3BvbGlzaGVkJ1xuaW1wb3J0IHsgZ2VvbWV0cnkgfSBmcm9tICdnZW9zcGF0aWFsZHJhdydcbmltcG9ydCB7IGNvbnRyYXN0aW5nQ29sb3IgfSBmcm9tICcuLi8uLi8uLi8uLi9yZWFjdC1jb21wb25lbnQvbG9jYXRpb24vbG9jYXRpb24tY29sb3Itc2VsZWN0b3InXG5cbmNvbnN0IHtcbiAgQ0lSQ0xFX0JVRkZFUl9QUk9QRVJUWV9WQUxVRSxcbiAgUE9MWUdPTl9MSU5FX0JVRkZFUl9QUk9QRVJUWV9WQUxVRSxcbiAgQlVGRkVSX1NIQVBFX1BST1BFUlRZLFxufSA9IGdlb21ldHJ5XG5cbmNvbnN0IExJTkVfV0lEVEggPSAyLjVcbmNvbnN0IFBPSU5UX1NJWkUgPSA0LjVcbmNvbnN0IFNDQUxFX0ZBQ1RPUiA9IDEuNVxuXG5jb25zdCBSRU5ERVJFUl9TVFlMRSA9IChmZWF0dXJlOiBGZWF0dXJlKTogU3R5bGUgPT5cbiAgbmV3IFN0eWxlKHtcbiAgICBzdHJva2U6IG5ldyBTdHJva2Uoe1xuICAgICAgY29sb3I6IGZlYXR1cmUuZ2V0KCdjb2xvcicpLFxuICAgICAgd2lkdGg6IExJTkVfV0lEVEgsXG4gICAgfSksXG4gICAgZmlsbDogbmV3IEZpbGwoe1xuICAgICAgY29sb3I6ICdyZ2JhKDAsIDAsIDAsIDApJyxcbiAgICB9KSxcbiAgICAuLi4oZmVhdHVyZS5nZXQoQlVGRkVSX1NIQVBFX1BST1BFUlRZKSA9PT0gQ0lSQ0xFX0JVRkZFUl9QUk9QRVJUWV9WQUxVRVxuICAgICAgPyB7fVxuICAgICAgOiB7XG4gICAgICAgICAgaW1hZ2U6IG5ldyBDaXJjbGUoe1xuICAgICAgICAgICAgcmFkaXVzOiBQT0lOVF9TSVpFLFxuICAgICAgICAgICAgZmlsbDogbmV3IEZpbGwoe1xuICAgICAgICAgICAgICBjb2xvcjogZmVhdHVyZS5nZXQoJ2NvbG9yJyksXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gIH0pXG5cbmNvbnN0IENJUkNMRV9EUkFXSU5HX1NUWUxFID0gKGZlYXR1cmU6IEZlYXR1cmUpOiBTdHlsZSA9PlxuICBuZXcgU3R5bGUoe1xuICAgIHN0cm9rZTogbmV3IFN0cm9rZSh7XG4gICAgICBjb2xvcjogJ3JnYmEoMCwgMCwgMCwgMCknLFxuICAgIH0pLFxuICAgIGZpbGw6IG5ldyBGaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgwLCAwLCAwLCAwKScsXG4gICAgfSksXG4gICAgaW1hZ2U6IG5ldyBDaXJjbGUoe1xuICAgICAgcmFkaXVzOiBQT0lOVF9TSVpFLFxuICAgICAgZmlsbDogbmV3IEZpbGwoe1xuICAgICAgICBjb2xvcjogZmVhdHVyZS5nZXQoJ2NvbG9yJyksXG4gICAgICB9KSxcbiAgICB9KSxcbiAgfSlcblxuY29uc3QgQ0lSQ0xFX0JVRkZFUl9QUk9QRVJUWV9WQUxVRV9EUkFXSU5HX1NUWUxFID0gKGZlYXR1cmU6IEZlYXR1cmUpOiBTdHlsZSA9PlxuICBuZXcgU3R5bGUoe1xuICAgIHN0cm9rZTogbmV3IFN0cm9rZSh7XG4gICAgICBjb2xvcjogZmVhdHVyZS5nZXQoJ2NvbG9yJyksXG4gICAgICB3aWR0aDogTElORV9XSURUSCAqIFNDQUxFX0ZBQ1RPUixcbiAgICB9KSxcbiAgICBmaWxsOiBuZXcgRmlsbCh7XG4gICAgICBjb2xvcjogdHJhbnNwYXJlbnRpemUoMC45NSwgZmVhdHVyZS5nZXQoJ2NvbG9yJykgfHwgY29udHJhc3RpbmdDb2xvciksXG4gICAgfSksXG4gIH0pXG5cbmNvbnN0IEdFTkVSSUNfRFJBV0lOR19TVFlMRSA9IChmZWF0dXJlOiBGZWF0dXJlKTogU3R5bGVbXSA9PiBbXG4gIG5ldyBTdHlsZSh7XG4gICAgc3Ryb2tlOiBuZXcgU3Ryb2tlKHtcbiAgICAgIGNvbG9yOiBmZWF0dXJlLmdldCgnY29sb3InKSxcbiAgICAgIHdpZHRoOiBMSU5FX1dJRFRIICogU0NBTEVfRkFDVE9SLFxuICAgIH0pLFxuICAgIGZpbGw6IG5ldyBGaWxsKHtcbiAgICAgIGNvbG9yOiB0cmFuc3BhcmVudGl6ZSgwLjk1LCBmZWF0dXJlLmdldCgnY29sb3InKSB8fCBjb250cmFzdGluZ0NvbG9yKSxcbiAgICB9KSxcbiAgICAuLi4oZmVhdHVyZS5nZXRHZW9tZXRyeSgpPy5nZXRUeXBlKCkgPT09ICdQb2ludCcgJiZcbiAgICBmZWF0dXJlLmdldCgnYnVmZmVyJykgPiAwXG4gICAgICA/IHt9XG4gICAgICA6IHtcbiAgICAgICAgICBpbWFnZTogbmV3IENpcmNsZSh7XG4gICAgICAgICAgICByYWRpdXM6IFBPSU5UX1NJWkUgKiBTQ0FMRV9GQUNUT1IsXG4gICAgICAgICAgICBmaWxsOiBuZXcgRmlsbCh7XG4gICAgICAgICAgICAgIGNvbG9yOiBmZWF0dXJlLmdldCgnY29sb3InKSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KSxcbiAgfSksXG4gIG5ldyBTdHlsZSh7XG4gICAgaW1hZ2U6IG5ldyBDaXJjbGUoe1xuICAgICAgcmFkaXVzOiBQT0lOVF9TSVpFLFxuICAgICAgZmlsbDogbmV3IEZpbGwoe1xuICAgICAgICBjb2xvcjogZmVhdHVyZS5nZXQoJ2NvbG9yJyksXG4gICAgICB9KSxcbiAgICB9KSxcbiAgICBnZW9tZXRyeTogKGZlYXR1cmUpOiBHZW9tZXRyeSB8IHVuZGVmaW5lZCA9PiB7XG4gICAgICBjb25zdCBnZW9tZXRyeSA9IGZlYXR1cmUuZ2V0R2VvbWV0cnkoKVxuICAgICAgaWYgKCFnZW9tZXRyeSkgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgbGV0IGNvb3JkaW5hdGVzOiBDb29yZGluYXRlW10gPSBbXVxuICAgICAgaWYgKGdlb21ldHJ5LmdldFR5cGUoKSA9PT0gJ1BvbHlnb24nKSB7XG4gICAgICAgIGNvb3JkaW5hdGVzID0gKGdlb21ldHJ5IGFzIFBvbHlnb24pLmdldENvb3JkaW5hdGVzKClbMF1cbiAgICAgIH0gZWxzZSBpZiAoZ2VvbWV0cnkuZ2V0VHlwZSgpID09PSAnTGluZVN0cmluZycpIHtcbiAgICAgICAgY29vcmRpbmF0ZXMgPSAoZ2VvbWV0cnkgYXMgTGluZVN0cmluZykuZ2V0Q29vcmRpbmF0ZXMoKVxuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBNdWx0aVBvaW50KGNvb3JkaW5hdGVzKVxuICAgIH0sXG4gIH0pLFxuXVxuXG5jb25zdCBEUkFXSU5HX1NUWUxFID0gKGZlYXR1cmU6IEZlYXR1cmUpOiBTdHlsZVtdIHwgU3R5bGUgPT4ge1xuICBpZiAoZmVhdHVyZS5nZXRHZW9tZXRyeSgpPy5nZXRUeXBlKCkgPT09ICdDaXJjbGUnKSB7XG4gICAgcmV0dXJuIENJUkNMRV9EUkFXSU5HX1NUWUxFKGZlYXR1cmUpXG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYnVmZmVyU2hhcGUgPSBmZWF0dXJlLmdldChCVUZGRVJfU0hBUEVfUFJPUEVSVFkpXG4gICAgc3dpdGNoIChidWZmZXJTaGFwZSkge1xuICAgICAgY2FzZSBQT0xZR09OX0xJTkVfQlVGRkVSX1BST1BFUlRZX1ZBTFVFOlxuICAgICAgICByZXR1cm4gUkVOREVSRVJfU1RZTEUoZmVhdHVyZSlcbiAgICAgIGNhc2UgQ0lSQ0xFX0JVRkZFUl9QUk9QRVJUWV9WQUxVRTpcbiAgICAgICAgcmV0dXJuIENJUkNMRV9CVUZGRVJfUFJPUEVSVFlfVkFMVUVfRFJBV0lOR19TVFlMRShmZWF0dXJlKVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIEdFTkVSSUNfRFJBV0lOR19TVFlMRShmZWF0dXJlKVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgeyBSRU5ERVJFUl9TVFlMRSwgRFJBV0lOR19TVFlMRSB9XG4iXX0=