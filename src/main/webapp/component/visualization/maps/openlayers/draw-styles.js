import { __assign } from "tslib";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import * as ol from 'openlayers';
import { transparentize } from 'polished';
import { geometry } from 'geospatialdraw';
import { contrastingColor } from '../../../../react-component/location/location-color-selector';
var CIRCLE_BUFFER_PROPERTY_VALUE = geometry.CIRCLE_BUFFER_PROPERTY_VALUE, POLYGON_LINE_BUFFER_PROPERTY_VALUE = geometry.POLYGON_LINE_BUFFER_PROPERTY_VALUE, BUFFER_SHAPE_PROPERTY = geometry.BUFFER_SHAPE_PROPERTY;
var LINE_WIDTH = 2.5;
var POINT_SIZE = 4.5;
var SCALE_FACTOR = 1.5;
var RENDERER_STYLE = function (feature) {
    return new ol.style.Style(__assign({ stroke: new ol.style.Stroke({
            color: feature.get('color'),
            width: LINE_WIDTH,
        }), fill: new ol.style.Fill({
            color: 'rgba(0, 0, 0, 0)',
        }) }, (feature.get(BUFFER_SHAPE_PROPERTY) === CIRCLE_BUFFER_PROPERTY_VALUE
        ? {}
        : {
            image: new ol.style.Circle({
                radius: POINT_SIZE,
                fill: new ol.style.Fill({
                    color: feature.get('color'),
                }),
            }),
        })));
};
var CIRCLE_DRAWING_STYLE = function (feature) {
    return new ol.style.Style({
        stroke: new ol.style.Stroke({
            color: 'rgba(0, 0, 0, 0)',
        }),
        fill: new ol.style.Fill({
            color: 'rgba(0, 0, 0, 0)',
        }),
        image: new ol.style.Circle({
            radius: POINT_SIZE,
            fill: new ol.style.Fill({
                color: feature.get('color'),
            }),
        }),
    });
};
var CIRCLE_BUFFER_PROPERTY_VALUE_DRAWING_STYLE = function (feature) {
    return new ol.style.Style({
        stroke: new ol.style.Stroke({
            color: feature.get('color'),
            width: LINE_WIDTH * SCALE_FACTOR,
        }),
        fill: new ol.style.Fill({
            color: transparentize(0.95, feature.get('color') || contrastingColor),
        }),
    });
};
var GENERIC_DRAWING_STYLE = function (feature) { return [
    new ol.style.Style(__assign({ stroke: new ol.style.Stroke({
            color: feature.get('color'),
            width: LINE_WIDTH * SCALE_FACTOR,
        }), fill: new ol.style.Fill({
            color: transparentize(0.95, feature.get('color') || contrastingColor),
        }) }, (feature.getGeometry().getType() === 'Point' && feature.get('buffer') > 0
        ? {}
        : {
            image: new ol.style.Circle({
                radius: POINT_SIZE * SCALE_FACTOR,
                fill: new ol.style.Fill({
                    color: feature.get('color'),
                }),
            }),
        }))),
    new ol.style.Style({
        image: new ol.style.Circle({
            radius: POINT_SIZE,
            fill: new ol.style.Fill({
                color: feature.get('color'),
            }),
        }),
        geometry: function (feature) {
            var geometry = feature.getGeometry();
            var coordinates = [];
            if (geometry.getType() === 'Polygon') {
                coordinates = geometry.getCoordinates()[0];
            }
            else if (geometry.getType() === 'LineString') {
                coordinates = geometry.getCoordinates();
            }
            return new ol.geom.MultiPoint(coordinates);
        },
    }),
]; };
var DRAWING_STYLE = function (feature) {
    if (feature.getGeometry().getType() === 'Circle') {
        return CIRCLE_DRAWING_STYLE(feature);
    }
    else {
        var bufferShape = feature.get(BUFFER_SHAPE_PROPERTY);
        switch (bufferShape) {
            case POLYGON_LINE_BUFFER_PROPERTY_VALUE:
                return RENDERER_STYLE(feature);
            case CIRCLE_BUFFER_PROPERTY_VALUE:
                return CIRCLE_BUFFER_PROPERTY_VALUE_DRAWING_STYLE(feature);
            default:
                return GENERIC_DRAWING_STYLE(feature);
        }
    }
};
export { RENDERER_STYLE, DRAWING_STYLE };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhdy1zdHlsZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbWFpbi93ZWJhcHAvY29tcG9uZW50L3Zpc3VhbGl6YXRpb24vbWFwcy9vcGVubGF5ZXJzL2RyYXctc3R5bGVzLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7SUFhSTtBQUNKLE9BQU8sS0FBSyxFQUFFLE1BQU0sWUFBWSxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDekMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQ3pDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDhEQUE4RCxDQUFBO0FBRzdGLElBQUEsNEJBQTRCLEdBRzFCLFFBQVEsNkJBSGtCLEVBQzVCLGtDQUFrQyxHQUVoQyxRQUFRLG1DQUZ3QixFQUNsQyxxQkFBcUIsR0FDbkIsUUFBUSxzQkFEVyxDQUNYO0FBRVosSUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFBO0FBQ3RCLElBQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQTtBQUN0QixJQUFNLFlBQVksR0FBRyxHQUFHLENBQUE7QUFFeEIsSUFBTSxjQUFjLEdBQUcsVUFBQyxPQUFtQjtJQUN6QyxPQUFBLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLFlBQ2hCLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO1lBQzFCLEtBQUssRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztZQUMzQixLQUFLLEVBQUUsVUFBVTtTQUNsQixDQUFDLEVBQ0YsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7WUFDdEIsS0FBSyxFQUFFLGtCQUFrQjtTQUMxQixDQUFDLElBQ0MsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLEtBQUss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O1lBQ25CLEtBQUssa0NBQWtDO2dCQUNyQyxPQUFPLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUNoQyxLQUFLLDRCQUE0QjtnQkFDL0IsT0FBTywwQ0FBMEMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUM1RDtnQkFDRSxPQUFPLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFBO1NBQ3hDO0tBQ0Y7QUFDSCxDQUFDLENBQUE7QUFFRCxPQUFPLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIENvZGljZSBGb3VuZGF0aW9uXG4gKlxuICogVGhpcyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlclxuICogR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGVcbiAqIExpY2Vuc2UsIG9yIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXRcbiAqIGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVVxuICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4gQSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGlzIGRpc3RyaWJ1dGVkIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtIGFuZCBjYW4gYmUgZm91bmQgYXRcbiAqIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvbGdwbC5odG1sPi5cbiAqXG4gKiovXG5pbXBvcnQgKiBhcyBvbCBmcm9tICdvcGVubGF5ZXJzJ1xuaW1wb3J0IHsgdHJhbnNwYXJlbnRpemUgfSBmcm9tICdwb2xpc2hlZCdcbmltcG9ydCB7IGdlb21ldHJ5IH0gZnJvbSAnZ2Vvc3BhdGlhbGRyYXcnXG5pbXBvcnQgeyBjb250cmFzdGluZ0NvbG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vcmVhY3QtY29tcG9uZW50L2xvY2F0aW9uL2xvY2F0aW9uLWNvbG9yLXNlbGVjdG9yJ1xuXG5jb25zdCB7XG4gIENJUkNMRV9CVUZGRVJfUFJPUEVSVFlfVkFMVUUsXG4gIFBPTFlHT05fTElORV9CVUZGRVJfUFJPUEVSVFlfVkFMVUUsXG4gIEJVRkZFUl9TSEFQRV9QUk9QRVJUWSxcbn0gPSBnZW9tZXRyeVxuXG5jb25zdCBMSU5FX1dJRFRIID0gMi41XG5jb25zdCBQT0lOVF9TSVpFID0gNC41XG5jb25zdCBTQ0FMRV9GQUNUT1IgPSAxLjVcblxuY29uc3QgUkVOREVSRVJfU1RZTEUgPSAoZmVhdHVyZTogb2wuRmVhdHVyZSk6IG9sLnN0eWxlLlN0eWxlID0+XG4gIG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgIGNvbG9yOiBmZWF0dXJlLmdldCgnY29sb3InKSxcbiAgICAgIHdpZHRoOiBMSU5FX1dJRFRILFxuICAgIH0pLFxuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiAncmdiYSgwLCAwLCAwLCAwKScsXG4gICAgfSksXG4gICAgLi4uKGZlYXR1cmUuZ2V0KEJVRkZFUl9TSEFQRV9QUk9QRVJUWSkgPT09IENJUkNMRV9CVUZGRVJfUFJPUEVSVFlfVkFMVUVcbiAgICAgID8ge31cbiAgICAgIDoge1xuICAgICAgICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgICAgICAgIHJhZGl1czogUE9JTlRfU0laRSxcbiAgICAgICAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgICAgICAgICAgY29sb3I6IGZlYXR1cmUuZ2V0KCdjb2xvcicpLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICB9KVxuXG5jb25zdCBDSVJDTEVfRFJBV0lOR19TVFlMRSA9IChmZWF0dXJlOiBvbC5GZWF0dXJlKTogb2wuc3R5bGUuU3R5bGUgPT5cbiAgbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xuICAgICAgY29sb3I6ICdyZ2JhKDAsIDAsIDAsIDApJyxcbiAgICB9KSxcbiAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICBjb2xvcjogJ3JnYmEoMCwgMCwgMCwgMCknLFxuICAgIH0pLFxuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgIHJhZGl1czogUE9JTlRfU0laRSxcbiAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgICAgY29sb3I6IGZlYXR1cmUuZ2V0KCdjb2xvcicpLFxuICAgICAgfSksXG4gICAgfSksXG4gIH0pXG5cbmNvbnN0IENJUkNMRV9CVUZGRVJfUFJPUEVSVFlfVkFMVUVfRFJBV0lOR19TVFlMRSA9IChcbiAgZmVhdHVyZTogb2wuRmVhdHVyZVxuKTogb2wuc3R5bGUuU3R5bGUgPT5cbiAgbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xuICAgICAgY29sb3I6IGZlYXR1cmUuZ2V0KCdjb2xvcicpLFxuICAgICAgd2lkdGg6IExJTkVfV0lEVEggKiBTQ0FMRV9GQUNUT1IsXG4gICAgfSksXG4gICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xuICAgICAgY29sb3I6IHRyYW5zcGFyZW50aXplKDAuOTUsIGZlYXR1cmUuZ2V0KCdjb2xvcicpIHx8IGNvbnRyYXN0aW5nQ29sb3IpLFxuICAgIH0pLFxuICB9KVxuXG5jb25zdCBHRU5FUklDX0RSQVdJTkdfU1RZTEUgPSAoZmVhdHVyZTogb2wuRmVhdHVyZSk6IG9sLnN0eWxlLlN0eWxlW10gPT4gW1xuICBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICBjb2xvcjogZmVhdHVyZS5nZXQoJ2NvbG9yJyksXG4gICAgICB3aWR0aDogTElORV9XSURUSCAqIFNDQUxFX0ZBQ1RPUixcbiAgICB9KSxcbiAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICBjb2xvcjogdHJhbnNwYXJlbnRpemUoMC45NSwgZmVhdHVyZS5nZXQoJ2NvbG9yJykgfHwgY29udHJhc3RpbmdDb2xvciksXG4gICAgfSksXG4gICAgLi4uKGZlYXR1cmUuZ2V0R2VvbWV0cnkoKS5nZXRUeXBlKCkgPT09ICdQb2ludCcgJiYgZmVhdHVyZS5nZXQoJ2J1ZmZlcicpID4gMFxuICAgICAgPyB7fVxuICAgICAgOiB7XG4gICAgICAgICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5DaXJjbGUoe1xuICAgICAgICAgICAgcmFkaXVzOiBQT0lOVF9TSVpFICogU0NBTEVfRkFDVE9SLFxuICAgICAgICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xuICAgICAgICAgICAgICBjb2xvcjogZmVhdHVyZS5nZXQoJ2NvbG9yJyksXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gIH0pLFxuICBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgIHJhZGl1czogUE9JTlRfU0laRSxcbiAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgICAgY29sb3I6IGZlYXR1cmUuZ2V0KCdjb2xvcicpLFxuICAgICAgfSksXG4gICAgfSksXG4gICAgZ2VvbWV0cnk6IChmZWF0dXJlOiBvbC5GZWF0dXJlKTogb2wuZ2VvbS5HZW9tZXRyeSA9PiB7XG4gICAgICBjb25zdCBnZW9tZXRyeSA9IGZlYXR1cmUuZ2V0R2VvbWV0cnkoKVxuICAgICAgbGV0IGNvb3JkaW5hdGVzOiBbbnVtYmVyLCBudW1iZXJdW10gPSBbXVxuICAgICAgaWYgKGdlb21ldHJ5LmdldFR5cGUoKSA9PT0gJ1BvbHlnb24nKSB7XG4gICAgICAgIGNvb3JkaW5hdGVzID0gKGdlb21ldHJ5IGFzIG9sLmdlb20uUG9seWdvbikuZ2V0Q29vcmRpbmF0ZXMoKVswXVxuICAgICAgfSBlbHNlIGlmIChnZW9tZXRyeS5nZXRUeXBlKCkgPT09ICdMaW5lU3RyaW5nJykge1xuICAgICAgICBjb29yZGluYXRlcyA9IChnZW9tZXRyeSBhcyBvbC5nZW9tLkxpbmVTdHJpbmcpLmdldENvb3JkaW5hdGVzKClcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXcgb2wuZ2VvbS5NdWx0aVBvaW50KGNvb3JkaW5hdGVzKVxuICAgIH0sXG4gIH0pLFxuXVxuXG5jb25zdCBEUkFXSU5HX1NUWUxFID0gKFxuICBmZWF0dXJlOiBvbC5GZWF0dXJlXG4pOiBvbC5zdHlsZS5TdHlsZVtdIHwgb2wuc3R5bGUuU3R5bGUgPT4ge1xuICBpZiAoZmVhdHVyZS5nZXRHZW9tZXRyeSgpLmdldFR5cGUoKSA9PT0gJ0NpcmNsZScpIHtcbiAgICByZXR1cm4gQ0lSQ0xFX0RSQVdJTkdfU1RZTEUoZmVhdHVyZSlcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBidWZmZXJTaGFwZSA9IGZlYXR1cmUuZ2V0KEJVRkZFUl9TSEFQRV9QUk9QRVJUWSlcbiAgICBzd2l0Y2ggKGJ1ZmZlclNoYXBlKSB7XG4gICAgICBjYXNlIFBPTFlHT05fTElORV9CVUZGRVJfUFJPUEVSVFlfVkFMVUU6XG4gICAgICAgIHJldHVybiBSRU5ERVJFUl9TVFlMRShmZWF0dXJlKVxuICAgICAgY2FzZSBDSVJDTEVfQlVGRkVSX1BST1BFUlRZX1ZBTFVFOlxuICAgICAgICByZXR1cm4gQ0lSQ0xFX0JVRkZFUl9QUk9QRVJUWV9WQUxVRV9EUkFXSU5HX1NUWUxFKGZlYXR1cmUpXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gR0VORVJJQ19EUkFXSU5HX1NUWUxFKGZlYXR1cmUpXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IFJFTkRFUkVSX1NUWUxFLCBEUkFXSU5HX1NUWUxFIH1cbiJdfQ==