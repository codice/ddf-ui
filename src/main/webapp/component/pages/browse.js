import { __assign, __read } from "tslib";
import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import TextField from '@mui/material/TextField';
import Paper from '@mui/material/Paper';
import * as React from 'react';
import { DarkDivider } from '../dark-divider/dark-divider';
import { FilterBuilderClass, FilterClass, } from '../filter-builder/filter.structure';
import { useQuery, useUserQuery } from '../../js/model/TypedQuery';
import { useLazyResultsSelectedResultsFromSelectionInterface } from '../selection-interface/hooks';
import { Elevations } from '../theme/theme';
import SelectionInterface from '../selection-interface/selection-interface.model';
import _debounce from 'lodash.debounce';
import LinearProgress from '@mui/material/LinearProgress';
import Autocomplete from '@mui/material/Autocomplete';
import Button from '@mui/material/Button';
import QueryFeed from '../result-selector/query-feed';
import Paging from '../result-selector/paging';
import { getSortDirectionOptions } from '../../react-component/query-sort-selection/sort-selection-helpers';
import ResultsVisual from '../visualization/results-visual/results-visual';
import { SplitPane } from '../resizable-grid/resizable-grid';
import { GoldenLayout } from '../golden-layout/golden-layout';
import { Memo } from '../memo/memo';
import { useUpdateEffect } from 'react-use';
import { getDefaultComponentState } from '../visualization/settings-helpers';
var modifySearch = function (_a) {
    var search = _a.search, filter = _a.filter, sortAttribute = _a.sortAttribute, sortDirection = _a.sortDirection;
    var filterBuilder = new FilterBuilderClass({
        type: 'AND',
        filters: [
            new FilterClass({
                type: '=', // =
                property: 'metacard-tags',
                value: 'query', // query
            }),
        ],
    });
    if (filter.length > 0) {
        filterBuilder.filters.push(new FilterClass({
            type: 'ILIKE',
            property: 'title',
            value: "*".concat(filter, "*"),
        }));
    }
    var sorts = [
        {
            attribute: sortAttribute === 'title' ? 'title' : 'metacard.modified',
            direction: sortDirection.toLowerCase(),
        },
    ];
    search.set('filterTree', filterBuilder);
    search.set('sorts', sorts);
    return search;
};
var buildSearchFromSelection = function (_a) {
    var search = _a.search, lazyResults = _a.lazyResults;
    var totalFilterTree = Object.values(lazyResults).reduce(function (filterTree, lazyResult) {
        filterTree.filters.push(new FilterBuilderClass(JSON.parse(lazyResult.plain.metacard.properties.filterTree)));
        return filterTree;
    }, new FilterBuilderClass({ type: 'OR', filters: [] }));
    search.set('filterTree', totalFilterTree);
    return search;
};
var SelectionInfoPane = function (_a) {
    var searchSelectionInterface = _a.searchSelectionInterface;
    var _b = __read(useUserQuery(), 1), search = _b[0];
    var lazyResults = useLazyResultsSelectedResultsFromSelectionInterface({
        selectionInterface: searchSelectionInterface,
    });
    var _c = __read(React.useState(new SelectionInterface({
        currentQuery: buildSearchFromSelection({ lazyResults: lazyResults, search: search }),
    })), 1), selectionInterface = _c[0];
    React.useEffect(function () {
        if (Object.keys(lazyResults).length > 0) {
            buildSearchFromSelection({
                search: search,
                lazyResults: lazyResults,
            });
            selectionInterface.getCurrentQuery().startSearchFromFirstPage();
        }
        else {
            selectionInterface.getCurrentQuery().cancelCurrentSearches();
        }
    }, [lazyResults]);
    return (_jsx(_Fragment, { children: _jsxs("div", { className: "block w-full h-full relative", children: [_jsx("div", { className: Object.keys(lazyResults).length > 0
                        ? 'hidden'
                        : 'block py-2 pr-2 w-full h-full left-0 top-0 absolute z-10', children: _jsxs("div", { className: "p-2 w-full h-full relative", children: [_jsx("div", { className: "opacity-75 bg-black absolute left-0 top-0 w-full h-full z-0" }), _jsx("div", { className: "block text-xl text-white z-10 relative", children: _jsx("span", { className: "bg-black p-2", children: "Select a search(s) from the left to preview." }) })] }) }), _jsx(GoldenLayout, { selectionInterface: selectionInterface })] }) }));
};
var SavedSearches = function () {
    var _a;
    var _b = __read(React.useState(''), 2), filter = _b[0], setFilter = _b[1];
    var _c = __read(React.useState('last modified'), 2), sortAttribute = _c[0], setSortAttribute = _c[1];
    var _d = __read(React.useState('descending'), 2), sortDirection = _d[0], setSortDirection = _d[1];
    var _f = __read(useQuery(), 1), search = _f[0];
    var selectionInterface = React.useMemo(function () {
        return new SelectionInterface({
            currentQuery: search,
        });
    }, []);
    var debouncedUpdate = React.useRef(_debounce(function (_a) {
        var filter = _a.filter, sortAttribute = _a.sortAttribute, sortDirection = _a.sortDirection, search = _a.search;
        modifySearch({ filter: filter, sortAttribute: sortAttribute, sortDirection: sortDirection, search: search });
        selectionInterface.getCurrentQuery().startSearchFromFirstPage();
        setIsUpdating(false);
    }, 500));
    var _g = __read(React.useState(false), 2), isUpdating = _g[0], setIsUpdating = _g[1];
    React.useEffect(function () {
        setIsUpdating(true);
        debouncedUpdate.current({
            filter: filter,
            sortAttribute: sortAttribute,
            sortDirection: sortDirection,
            search: selectionInterface.getCurrentQuery(),
        });
    }, [filter, sortAttribute, sortDirection]);
    useUpdateEffect(function () {
        /**
         * This makes sense, because we only have title and last modified.
         *
         * The natural inclination is inverted for sort direction for alphabetical vs time.
         */
        setSortDirection(sortAttribute === 'title' ? 'ascending' : 'descending');
    }, [sortAttribute]);
    return (_jsxs("div", { className: "w-full h-full flex flex-col flex-nowrap overflow-hidden ", children: [_jsx("div", { className: "shrink-0 w-full pt-2 pr-2", children: _jsxs(Paper, { elevation: Elevations.panels, className: "min-h-16 w-full shrink-0 p-2 flex flex-row items-center flex-wrap", children: [_jsx(TextField, { label: "Filter", size: "small", value: filter, variant: "outlined", autoFocus: true, onChange: function (e) {
                                setFilter(e.target.value);
                            } }), _jsx(Autocomplete, { className: "w-48 ml-2", options: ['title', 'last modified'], 
                            // renderOption={(option) => {
                            //   return <>{option}</>
                            // }}
                            value: sortAttribute, onChange: function (_e, newValue) {
                                setSortAttribute(newValue || 'title');
                            }, renderInput: function (params) {
                                return (_jsx(TextField, __assign({}, params, { label: "Sort by", variant: "outlined", size: "small", inputProps: __assign({}, params.inputProps) })));
                            } }), _jsx(Button, { className: "ml-2", size: "small", variant: "text", onClick: function () {
                                setSortDirection(sortDirection === 'ascending' ? 'descending' : 'ascending');
                            }, children: (_a = getSortDirectionOptions(sortAttribute === 'title' ? 'title' : 'metacard.modified').find(function (option) { return option.value === sortDirection; })) === null || _a === void 0 ? void 0 : _a.label }), _jsx("div", { className: "ml-auto", children: _jsx(QueryFeed, { selectionInterface: selectionInterface }) }), _jsx("div", { className: "ml-2", children: _jsx(Paging, { selectionInterface: selectionInterface }) })] }) }), _jsx(DarkDivider, {}), _jsxs("div", { className: "relative h-full overflow-hidden w-full shrink", children: [isUpdating ? (_jsx(LinearProgress, { variant: "indeterminate", className: "absolute left-0 top-0 w-full h-min" })) : null, _jsx(Memo, { dependencies: [], children: _jsxs(SplitPane, { variant: "horizontal", children: [_jsx("div", { className: "py-2 w-full h-full", children: _jsx(Paper, { elevation: Elevations.panels, className: "w-full h-full", children: _jsx(ResultsVisual, { selectionInterface: selectionInterface, componentState: getDefaultComponentState('results') }) }) }), _jsx(SelectionInfoPane, { searchSelectionInterface: selectionInterface })] }) })] })] }));
};
export default SavedSearches;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJvd3NlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL21haW4vd2ViYXBwL2NvbXBvbmVudC9wYWdlcy9icm93c2UudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxTQUFTLE1BQU0seUJBQXlCLENBQUE7QUFDL0MsT0FBTyxLQUFLLE1BQU0scUJBQXFCLENBQUE7QUFDdkMsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUE7QUFFOUIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDhCQUE4QixDQUFBO0FBQzFELE9BQU8sRUFDTCxrQkFBa0IsRUFDbEIsV0FBVyxHQUNaLE1BQU0sb0NBQW9DLENBQUE7QUFDM0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQTtBQUNsRSxPQUFPLEVBQUUsbURBQW1ELEVBQUUsTUFBTSw4QkFBOEIsQ0FBQTtBQUNsRyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUE7QUFDM0MsT0FBTyxrQkFBa0IsTUFBTSxrREFBa0QsQ0FBQTtBQUNqRixPQUFPLFNBQVMsTUFBTSxpQkFBaUIsQ0FBQTtBQUN2QyxPQUFPLGNBQWMsTUFBTSw4QkFBOEIsQ0FBQTtBQUN6RCxPQUFPLFlBQVksTUFBTSw0QkFBNEIsQ0FBQTtBQUNyRCxPQUFPLE1BQU0sTUFBTSxzQkFBc0IsQ0FBQTtBQUN6QyxPQUFPLFNBQVMsTUFBTSwrQkFBK0IsQ0FBQTtBQUNyRCxPQUFPLE1BQU0sTUFBTSwyQkFBMkIsQ0FBQTtBQUM5QyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxtRUFBbUUsQ0FBQTtBQUMzRyxPQUFPLGFBQWEsTUFBTSxnREFBZ0QsQ0FBQTtBQUMxRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sa0NBQWtDLENBQUE7QUFDNUQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdDQUFnQyxDQUFBO0FBRTdELE9BQU8sRUFB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a0JBQWtCLEVBQUUsa0JBQWtCLEVBQ3RDLGNBQWMsRUFBRSx3QkFBd0IsQ0FBQyxTQUFTLENBQVEsR0FDMUQsR0FDSSxHQUNKLEVBQ04sS0FBQyxpQkFBaUIsSUFBQyx3QkFBd0IsRUFBRSxrQkFBa0IsR0FBSSxJQUN6RCxHQUNQLElBQ0gsSUFDRixDQUNQLENBQUE7QUFDSCxDQUFDLENBQUE7QUFFRCxlQUFlLGFBQWEsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBUZXh0RmllbGQgZnJvbSAnQG11aS9tYXRlcmlhbC9UZXh0RmllbGQnXG5pbXBvcnQgUGFwZXIgZnJvbSAnQG11aS9tYXRlcmlhbC9QYXBlcidcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0J1xuXG5pbXBvcnQgeyBEYXJrRGl2aWRlciB9IGZyb20gJy4uL2RhcmstZGl2aWRlci9kYXJrLWRpdmlkZXInXG5pbXBvcnQge1xuICBGaWx0ZXJCdWlsZGVyQ2xhc3MsXG4gIEZpbHRlckNsYXNzLFxufSBmcm9tICcuLi9maWx0ZXItYnVpbGRlci9maWx0ZXIuc3RydWN0dXJlJ1xuaW1wb3J0IHsgdXNlUXVlcnksIHVzZVVzZXJRdWVyeSB9IGZyb20gJy4uLy4uL2pzL21vZGVsL1R5cGVkUXVlcnknXG5pbXBvcnQgeyB1c2VMYXp5UmVzdWx0c1NlbGVjdGVkUmVzdWx0c0Zyb21TZWxlY3Rpb25JbnRlcmZhY2UgfSBmcm9tICcuLi9zZWxlY3Rpb24taW50ZXJmYWNlL2hvb2tzJ1xuaW1wb3J0IHsgRWxldmF0aW9ucyB9IGZyb20gJy4uL3RoZW1lL3RoZW1lJ1xuaW1wb3J0IFNlbGVjdGlvbkludGVyZmFjZSBmcm9tICcuLi9zZWxlY3Rpb24taW50ZXJmYWNlL3NlbGVjdGlvbi1pbnRlcmZhY2UubW9kZWwnXG5pbXBvcnQgX2RlYm91bmNlIGZyb20gJ2xvZGFzaC5kZWJvdW5jZSdcbmltcG9ydCBMaW5lYXJQcm9ncmVzcyBmcm9tICdAbXVpL21hdGVyaWFsL0xpbmVhclByb2dyZXNzJ1xuaW1wb3J0IEF1dG9jb21wbGV0ZSBmcm9tICdAbXVpL21hdGVyaWFsL0F1dG9jb21wbGV0ZSdcbmltcG9ydCBCdXR0b24gZnJvbSAnQG11aS9tYXRlcmlhbC9CdXR0b24nXG5pbXBvcnQgUXVlcnlGZWVkIGZyb20gJy4uL3Jlc3VsdC1zZWxlY3Rvci9xdWVyeS1mZWVkJ1xuaW1wb3J0IFBhZ2luZyBmcm9tICcuLi9yZXN1bHQtc2VsZWN0b3IvcGFnaW5nJ1xuaW1wb3J0IHsgZ2V0U29ydERpcmVjdGlvbk9wdGlvbnMgfSBmcm9tICcuLi8uLi9yZWFjdC1jb21wb25lbnQvcXVlcnktc29ydC1zZWxlY3Rpb24vc29ydC1zZWxlY3Rpb24taGVscGVycydcbmltcG9ydCBSZXN1bHRzVmlzdWFsIGZyb20gJy4uL3Zpc3VhbGl6YXRpb24vcmVzdWx0cy12aXN1YWwvcmVzdWx0cy12aXN1YWwnXG5pbXBvcnQgeyBTcGxpdFBhbmUgfSBmcm9tICcuLi9yZXNpemFibGUtZ3JpZC9yZXNpemFibGUtZ3JpZCdcbmltcG9ydCB7IEdvbGRlbkxheW91dCB9IGZyb20gJy4uL2dvbGRlbi1sYXlvdXQvZ29sZGVuLWxheW91dCdcbmltcG9ydCB7IExhenlRdWVyeVJlc3VsdHMgfSBmcm9tICcuLi8uLi9qcy9tb2RlbC9MYXp5UXVlcnlSZXN1bHQvTGF6eVF1ZXJ5UmVzdWx0cydcbmltcG9ydCB7IE1lbW8gfSBmcm9tICcuLi9tZW1vL21lbW8nXG5pbXBvcnQgeyB1c2VVcGRhdGVFZmZlY3QgfSBmcm9tICdyZWFjdC11c2UnXG5pbXBvcnQgeyBnZXREZWZhdWx0Q29tcG9uZW50U3RhdGUgfSBmcm9tICcuLi92aXN1YWxpemF0aW9uL3NldHRpbmdzLWhlbHBlcnMnXG5cbnR5cGUgTW9kaWZ5U2VhcmNoUGFyYW1zID0ge1xuICBzZWFyY2g6IGFueVxuICBmaWx0ZXI6IHN0cmluZ1xuICBzb3J0QXR0cmlidXRlOiBTb3J0QXR0cmlidXRlVHlwZVxuICBzb3J0RGlyZWN0aW9uOiBTb3J0RGlyZWN0aW9uVHlwZVxufVxuXG5jb25zdCBtb2RpZnlTZWFyY2ggPSAoe1xuICBzZWFyY2gsXG4gIGZpbHRlcixcbiAgc29ydEF0dHJpYnV0ZSxcbiAgc29ydERpcmVjdGlvbixcbn06IE1vZGlmeVNlYXJjaFBhcmFtcykgPT4ge1xuICBjb25zdCBmaWx0ZXJCdWlsZGVyID0gbmV3IEZpbHRlckJ1aWxkZXJDbGFzcyh7XG4gICAgdHlwZTogJ0FORCcsXG4gICAgZmlsdGVyczogW1xuICAgICAgbmV3IEZpbHRlckNsYXNzKHtcbiAgICAgICAgdHlwZTogJz0nLCAvLyA9XG4gICAgICAgIHByb3BlcnR5OiAnbWV0YWNhcmQtdGFncycsXG4gICAgICAgIHZhbHVlOiAncXVlcnknLCAvLyBxdWVyeVxuICAgICAgfSksXG4gICAgXSxcbiAgfSlcbiAgaWYgKGZpbHRlci5sZW5ndGggPiAwKSB7XG4gICAgZmlsdGVyQnVpbGRlci5maWx0ZXJzLnB1c2goXG4gICAgICBuZXcgRmlsdGVyQ2xhc3Moe1xuICAgICAgICB0eXBlOiAnSUxJS0UnLFxuICAgICAgICBwcm9wZXJ0eTogJ3RpdGxlJyxcbiAgICAgICAgdmFsdWU6IGAqJHtmaWx0ZXJ9KmAsXG4gICAgICB9KVxuICAgIClcbiAgfVxuICBjb25zdCBzb3J0cyA9IFtcbiAgICB7XG4gICAgICBhdHRyaWJ1dGU6IHNvcnRBdHRyaWJ1dGUgPT09ICd0aXRsZScgPyAndGl0bGUnIDogJ21ldGFjYXJkLm1vZGlmaWVkJyxcbiAgICAgIGRpcmVjdGlvbjogc29ydERpcmVjdGlvbi50b0xvd2VyQ2FzZSgpLFxuICAgIH0sXG4gIF1cbiAgc2VhcmNoLnNldCgnZmlsdGVyVHJlZScsIGZpbHRlckJ1aWxkZXIpXG4gIHNlYXJjaC5zZXQoJ3NvcnRzJywgc29ydHMpXG4gIHJldHVybiBzZWFyY2hcbn1cblxudHlwZSBTb3J0QXR0cmlidXRlVHlwZSA9ICd0aXRsZScgfCAnbGFzdCBtb2RpZmllZCdcbnR5cGUgU29ydERpcmVjdGlvblR5cGUgPSAnYXNjZW5kaW5nJyB8ICdkZXNjZW5kaW5nJ1xuXG5jb25zdCBidWlsZFNlYXJjaEZyb21TZWxlY3Rpb24gPSAoe1xuICBzZWFyY2gsXG4gIGxhenlSZXN1bHRzLFxufToge1xuICBzZWFyY2g6IGFueVxuICBsYXp5UmVzdWx0czogTGF6eVF1ZXJ5UmVzdWx0c1sncmVzdWx0cyddXG59KSA9PiB7XG4gIGNvbnN0IHRvdGFsRmlsdGVyVHJlZSA9IE9iamVjdC52YWx1ZXMobGF6eVJlc3VsdHMpLnJlZHVjZShcbiAgICAoZmlsdGVyVHJlZSwgbGF6eVJlc3VsdCkgPT4ge1xuICAgICAgZmlsdGVyVHJlZS5maWx0ZXJzLnB1c2goXG4gICAgICAgIG5ldyBGaWx0ZXJCdWlsZGVyQ2xhc3MoXG4gICAgICAgICAgSlNPTi5wYXJzZShsYXp5UmVzdWx0LnBsYWluLm1ldGFjYXJkLnByb3BlcnRpZXMuZmlsdGVyVHJlZSlcbiAgICAgICAgKVxuICAgICAgKVxuICAgICAgcmV0dXJuIGZpbHRlclRyZWVcbiAgICB9LFxuICAgIG5ldyBGaWx0ZXJCdWlsZGVyQ2xhc3MoeyB0eXBlOiAnT1InLCBmaWx0ZXJzOiBbXSB9KVxuICApXG4gIHNlYXJjaC5zZXQoJ2ZpbHRlclRyZWUnLCB0b3RhbEZpbHRlclRyZWUpXG4gIHJldHVybiBzZWFyY2hcbn1cblxuY29uc3QgU2VsZWN0aW9uSW5mb1BhbmUgPSAoe1xuICBzZWFyY2hTZWxlY3Rpb25JbnRlcmZhY2UsXG59OiB7XG4gIHNlYXJjaFNlbGVjdGlvbkludGVyZmFjZTogYW55XG59KSA9PiB7XG4gIGNvbnN0IFtzZWFyY2hdID0gdXNlVXNlclF1ZXJ5KClcbiAgY29uc3QgbGF6eVJlc3VsdHMgPSB1c2VMYXp5UmVzdWx0c1NlbGVjdGVkUmVzdWx0c0Zyb21TZWxlY3Rpb25JbnRlcmZhY2Uoe1xuICAgIHNlbGVjdGlvbkludGVyZmFjZTogc2VhcmNoU2VsZWN0aW9uSW50ZXJmYWNlLFxuICB9KVxuICBjb25zdCBbc2VsZWN0aW9uSW50ZXJmYWNlXSA9IFJlYWN0LnVzZVN0YXRlKFxuICAgIG5ldyBTZWxlY3Rpb25JbnRlcmZhY2Uoe1xuICAgICAgY3VycmVudFF1ZXJ5OiBidWlsZFNlYXJjaEZyb21TZWxlY3Rpb24oeyBsYXp5UmVzdWx0cywgc2VhcmNoIH0pLFxuICAgIH0pXG4gIClcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoT2JqZWN0LmtleXMobGF6eVJlc3VsdHMpLmxlbmd0aCA+IDApIHtcbiAgICAgIGJ1aWxkU2VhcmNoRnJvbVNlbGVjdGlvbih7XG4gICAgICAgIHNlYXJjaCxcbiAgICAgICAgbGF6eVJlc3VsdHMsXG4gICAgICB9KVxuICAgICAgc2VsZWN0aW9uSW50ZXJmYWNlLmdldEN1cnJlbnRRdWVyeSgpLnN0YXJ0U2VhcmNoRnJvbUZpcnN0UGFnZSgpXG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGVjdGlvbkludGVyZmFjZS5nZXRDdXJyZW50UXVlcnkoKS5jYW5jZWxDdXJyZW50U2VhcmNoZXMoKVxuICAgIH1cbiAgfSwgW2xhenlSZXN1bHRzXSlcbiAgcmV0dXJuIChcbiAgICA8PlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJibG9jayB3LWZ1bGwgaC1mdWxsIHJlbGF0aXZlXCI+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzc05hbWU9e1xuICAgICAgICAgICAgT2JqZWN0LmtleXMobGF6eVJlc3VsdHMpLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgPyAnaGlkZGVuJ1xuICAgICAgICAgICAgICA6ICdibG9jayBweS0yIHByLTIgdy1mdWxsIGgtZnVsbCBsZWZ0LTAgdG9wLTAgYWJzb2x1dGUgei0xMCdcbiAgICAgICAgICB9XG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInAtMiB3LWZ1bGwgaC1mdWxsIHJlbGF0aXZlXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm9wYWNpdHktNzUgYmctYmxhY2sgYWJzb2x1dGUgbGVmdC0wIHRvcC0wIHctZnVsbCBoLWZ1bGwgei0wXCI+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImJsb2NrIHRleHQteGwgdGV4dC13aGl0ZSB6LTEwIHJlbGF0aXZlXCI+XG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImJnLWJsYWNrIHAtMlwiPlxuICAgICAgICAgICAgICAgIFNlbGVjdCBhIHNlYXJjaChzKSBmcm9tIHRoZSBsZWZ0IHRvIHByZXZpZXcuXG4gICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPEdvbGRlbkxheW91dCBzZWxlY3Rpb25JbnRlcmZhY2U9e3NlbGVjdGlvbkludGVyZmFjZX0gLz5cbiAgICAgIDwvZGl2PlxuICAgIDwvPlxuICApXG59XG5cbmNvbnN0IFNhdmVkU2VhcmNoZXMgPSAoKSA9PiB7XG4gIGNvbnN0IFtmaWx0ZXIsIHNldEZpbHRlcl0gPSBSZWFjdC51c2VTdGF0ZSgnJylcbiAgY29uc3QgW3NvcnRBdHRyaWJ1dGUsIHNldFNvcnRBdHRyaWJ1dGVdID0gUmVhY3QudXNlU3RhdGUoXG4gICAgJ2xhc3QgbW9kaWZpZWQnIGFzIFNvcnRBdHRyaWJ1dGVUeXBlXG4gIClcbiAgY29uc3QgW3NvcnREaXJlY3Rpb24sIHNldFNvcnREaXJlY3Rpb25dID0gUmVhY3QudXNlU3RhdGUoXG4gICAgJ2Rlc2NlbmRpbmcnIGFzIFNvcnREaXJlY3Rpb25UeXBlXG4gIClcbiAgY29uc3QgW3NlYXJjaF0gPSB1c2VRdWVyeSgpXG4gIGNvbnN0IHNlbGVjdGlvbkludGVyZmFjZSA9IFJlYWN0LnVzZU1lbW8oKCkgPT4ge1xuICAgIHJldHVybiBuZXcgU2VsZWN0aW9uSW50ZXJmYWNlKHtcbiAgICAgIGN1cnJlbnRRdWVyeTogc2VhcmNoLFxuICAgIH0pXG4gIH0sIFtdKVxuICBjb25zdCBkZWJvdW5jZWRVcGRhdGUgPSBSZWFjdC51c2VSZWYoXG4gICAgX2RlYm91bmNlKFxuICAgICAgKHtcbiAgICAgICAgZmlsdGVyLFxuICAgICAgICBzb3J0QXR0cmlidXRlLFxuICAgICAgICBzb3J0RGlyZWN0aW9uLFxuICAgICAgICBzZWFyY2gsXG4gICAgICB9OiBNb2RpZnlTZWFyY2hQYXJhbXMpID0+IHtcbiAgICAgICAgbW9kaWZ5U2VhcmNoKHsgZmlsdGVyLCBzb3J0QXR0cmlidXRlLCBzb3J0RGlyZWN0aW9uLCBzZWFyY2ggfSlcbiAgICAgICAgc2VsZWN0aW9uSW50ZXJmYWNlLmdldEN1cnJlbnRRdWVyeSgpLnN0YXJ0U2VhcmNoRnJvbUZpcnN0UGFnZSgpXG4gICAgICAgIHNldElzVXBkYXRpbmcoZmFsc2UpXG4gICAgICB9LFxuICAgICAgNTAwXG4gICAgKVxuICApXG4gIGNvbnN0IFtpc1VwZGF0aW5nLCBzZXRJc1VwZGF0aW5nXSA9IFJlYWN0LnVzZVN0YXRlKGZhbHNlKVxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHNldElzVXBkYXRpbmcodHJ1ZSlcbiAgICBkZWJvdW5jZWRVcGRhdGUuY3VycmVudCh7XG4gICAgICBmaWx0ZXIsXG4gICAgICBzb3J0QXR0cmlidXRlLFxuICAgICAgc29ydERpcmVjdGlvbixcbiAgICAgIHNlYXJjaDogc2VsZWN0aW9uSW50ZXJmYWNlLmdldEN1cnJlbnRRdWVyeSgpLFxuICAgIH0pXG4gIH0sIFtmaWx0ZXIsIHNvcnRBdHRyaWJ1dGUsIHNvcnREaXJlY3Rpb25dKVxuICB1c2VVcGRhdGVFZmZlY3QoKCkgPT4ge1xuICAgIC8qKlxuICAgICAqIFRoaXMgbWFrZXMgc2Vuc2UsIGJlY2F1c2Ugd2Ugb25seSBoYXZlIHRpdGxlIGFuZCBsYXN0IG1vZGlmaWVkLlxuICAgICAqXG4gICAgICogVGhlIG5hdHVyYWwgaW5jbGluYXRpb24gaXMgaW52ZXJ0ZWQgZm9yIHNvcnQgZGlyZWN0aW9uIGZvciBhbHBoYWJldGljYWwgdnMgdGltZS5cbiAgICAgKi9cbiAgICBzZXRTb3J0RGlyZWN0aW9uKHNvcnRBdHRyaWJ1dGUgPT09ICd0aXRsZScgPyAnYXNjZW5kaW5nJyA6ICdkZXNjZW5kaW5nJylcbiAgfSwgW3NvcnRBdHRyaWJ1dGVdKVxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwidy1mdWxsIGgtZnVsbCBmbGV4IGZsZXgtY29sIGZsZXgtbm93cmFwIG92ZXJmbG93LWhpZGRlbiBcIj5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwic2hyaW5rLTAgdy1mdWxsIHB0LTIgcHItMlwiPlxuICAgICAgICA8UGFwZXJcbiAgICAgICAgICBlbGV2YXRpb249e0VsZXZhdGlvbnMucGFuZWxzfVxuICAgICAgICAgIGNsYXNzTmFtZT1cIm1pbi1oLTE2IHctZnVsbCBzaHJpbmstMCBwLTIgZmxleCBmbGV4LXJvdyBpdGVtcy1jZW50ZXIgZmxleC13cmFwXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxUZXh0RmllbGRcbiAgICAgICAgICAgIGxhYmVsPVwiRmlsdGVyXCJcbiAgICAgICAgICAgIHNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICB2YWx1ZT17ZmlsdGVyfVxuICAgICAgICAgICAgdmFyaWFudD1cIm91dGxpbmVkXCJcbiAgICAgICAgICAgIGF1dG9Gb2N1c1xuICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICAgIHNldEZpbHRlcihlLnRhcmdldC52YWx1ZSlcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgLz5cbiAgICAgICAgICA8QXV0b2NvbXBsZXRlXG4gICAgICAgICAgICBjbGFzc05hbWU9XCJ3LTQ4IG1sLTJcIlxuICAgICAgICAgICAgb3B0aW9ucz17Wyd0aXRsZScsICdsYXN0IG1vZGlmaWVkJ10gYXMgU29ydEF0dHJpYnV0ZVR5cGVbXX1cbiAgICAgICAgICAgIC8vIHJlbmRlck9wdGlvbj17KG9wdGlvbikgPT4ge1xuICAgICAgICAgICAgLy8gICByZXR1cm4gPD57b3B0aW9ufTwvPlxuICAgICAgICAgICAgLy8gfX1cbiAgICAgICAgICAgIHZhbHVlPXtzb3J0QXR0cmlidXRlfVxuICAgICAgICAgICAgb25DaGFuZ2U9eyhfZSwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgc2V0U29ydEF0dHJpYnV0ZShuZXdWYWx1ZSB8fCAndGl0bGUnKVxuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIHJlbmRlcklucHV0PXsocGFyYW1zKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPFRleHRGaWVsZFxuICAgICAgICAgICAgICAgICAgey4uLnBhcmFtc31cbiAgICAgICAgICAgICAgICAgIGxhYmVsPVwiU29ydCBieVwiXG4gICAgICAgICAgICAgICAgICB2YXJpYW50PVwib3V0bGluZWRcIlxuICAgICAgICAgICAgICAgICAgc2l6ZT1cInNtYWxsXCJcbiAgICAgICAgICAgICAgICAgIGlucHV0UHJvcHM9e3sgLi4ucGFyYW1zLmlucHV0UHJvcHMgfX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9fVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgY2xhc3NOYW1lPVwibWwtMlwiXG4gICAgICAgICAgICBzaXplPVwic21hbGxcIlxuICAgICAgICAgICAgdmFyaWFudD1cInRleHRcIlxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICBzZXRTb3J0RGlyZWN0aW9uKFxuICAgICAgICAgICAgICAgIHNvcnREaXJlY3Rpb24gPT09ICdhc2NlbmRpbmcnID8gJ2Rlc2NlbmRpbmcnIDogJ2FzY2VuZGluZydcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGdldFNvcnREaXJlY3Rpb25PcHRpb25zKFxuICAgICAgICAgICAgICAgIHNvcnRBdHRyaWJ1dGUgPT09ICd0aXRsZScgPyAndGl0bGUnIDogJ21ldGFjYXJkLm1vZGlmaWVkJ1xuICAgICAgICAgICAgICApLmZpbmQoKG9wdGlvbikgPT4gb3B0aW9uLnZhbHVlID09PSBzb3J0RGlyZWN0aW9uKT8ubGFiZWxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1sLWF1dG9cIj5cbiAgICAgICAgICAgIDxRdWVyeUZlZWQgc2VsZWN0aW9uSW50ZXJmYWNlPXtzZWxlY3Rpb25JbnRlcmZhY2V9IC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtbC0yXCI+XG4gICAgICAgICAgICA8UGFnaW5nIHNlbGVjdGlvbkludGVyZmFjZT17c2VsZWN0aW9uSW50ZXJmYWNlfSAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L1BhcGVyPlxuICAgICAgPC9kaXY+XG4gICAgICA8RGFya0RpdmlkZXIgLz5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwicmVsYXRpdmUgaC1mdWxsIG92ZXJmbG93LWhpZGRlbiB3LWZ1bGwgc2hyaW5rXCI+XG4gICAgICAgIHtpc1VwZGF0aW5nID8gKFxuICAgICAgICAgIDxMaW5lYXJQcm9ncmVzc1xuICAgICAgICAgICAgdmFyaWFudD1cImluZGV0ZXJtaW5hdGVcIlxuICAgICAgICAgICAgY2xhc3NOYW1lPVwiYWJzb2x1dGUgbGVmdC0wIHRvcC0wIHctZnVsbCBoLW1pblwiXG4gICAgICAgICAgLz5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICAgIDxNZW1vIGRlcGVuZGVuY2llcz17W119PlxuICAgICAgICAgIDxTcGxpdFBhbmUgdmFyaWFudD1cImhvcml6b250YWxcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicHktMiB3LWZ1bGwgaC1mdWxsXCI+XG4gICAgICAgICAgICAgIDxQYXBlciBlbGV2YXRpb249e0VsZXZhdGlvbnMucGFuZWxzfSBjbGFzc05hbWU9XCJ3LWZ1bGwgaC1mdWxsXCI+XG4gICAgICAgICAgICAgICAgPFJlc3VsdHNWaXN1YWxcbiAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbkludGVyZmFjZT17c2VsZWN0aW9uSW50ZXJmYWNlfVxuICAgICAgICAgICAgICAgICAgY29tcG9uZW50U3RhdGU9e2dldERlZmF1bHRDb21wb25lbnRTdGF0ZSgncmVzdWx0cycpIGFzIGFueX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8L1BhcGVyPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8U2VsZWN0aW9uSW5mb1BhbmUgc2VhcmNoU2VsZWN0aW9uSW50ZXJmYWNlPXtzZWxlY3Rpb25JbnRlcmZhY2V9IC8+XG4gICAgICAgICAgPC9TcGxpdFBhbmU+XG4gICAgICAgIDwvTWVtbz5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICApXG59XG5cbmV4cG9ydCBkZWZhdWx0IFNhdmVkU2VhcmNoZXNcbiJdfQ==