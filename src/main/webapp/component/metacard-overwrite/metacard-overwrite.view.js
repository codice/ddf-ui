import { __assign, __makeTemplateObject, __read } from "tslib";
import { jsxs as _jsxs, jsx as _jsx } from "react/jsx-runtime";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
// @ts-expect-error ts-migrate(7016) FIXME: Could not find a declaration file for module 'drop... Remove this comment to see the full error message
import Dropzone from 'dropzone';
import OverwritesInstance from '../singletons/overwrites-instance';
import React from 'react';
import styled from 'styled-components';
import { readableColor } from 'polished';
import Button from '@mui/material/Button';
import DialogActions from '@mui/material/DialogActions';
import DialogTitle from '@mui/material/DialogTitle';
import DialogContent from '@mui/material/DialogContent';
import { useBackbone } from '../selection-checkbox/useBackbone.hook';
import { useDialog } from '../dialog';
var Root = styled.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  overflow: auto;\n  white-space: nowrap;\n  height: 100%;\n"], ["\n  overflow: auto;\n  white-space: nowrap;\n  height: 100%;\n"])));
var OverwriteStatus = styled.div(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  display: inline-block;\n  white-space: normal;\n  vertical-align: top !important;\n  width: 100%;\n  transform: translateX(0%);\n  transition: transform ", " linear;\n  text-align: center;\n  position: relative;\n  padding: 10px;\n"], ["\n  display: inline-block;\n  white-space: normal;\n  vertical-align: top !important;\n  width: 100%;\n  transform: translateX(0%);\n  transition: transform ", " linear;\n  text-align: center;\n  position: relative;\n  padding: 10px;\n"])), function (props) { return props.theme.coreTransitionTime; });
var OverwriteProgress = styled(OverwriteStatus)(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  line-height: ", ";\n"], ["\n  line-height: ", ";\n"])), function (props) { return props.theme.minimumButtonSize; });
var ProgressText = styled.div(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  padding: 10px;\n  top: 0px;\n  left: 0px;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: 1;\n  font-size: ", ";\n  color: ", ";\n"], ["\n  padding: 10px;\n  top: 0px;\n  left: 0px;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: 1;\n  font-size: ", ";\n  color: ", ";\n"])), function (props) { return props.theme.largeFontSize; }, function (props) { return readableColor(props.theme.backgroundContent); });
var ProgressTextUnder = styled.div(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  font-size: ", ";\n  visibility: hidden;\n"], ["\n  font-size: ", ";\n  visibility: hidden;\n"])), function (props) { return props.theme.largeFontSize; });
var ProgressInfo = styled.div(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n  font-size: ", ";\n  color: ", ";\n"], ["\n  font-size: ", ";\n  color: ", ";\n"])), function (props) { return props.theme.mediumFontSize; }, function (props) { return readableColor(props.theme.backgroundContent); });
var ProgressBar = styled.div(templateObject_7 || (templateObject_7 = __makeTemplateObject(["\n  z-index: 0;\n  top: 0px;\n  left: 0px;\n  position: absolute;\n  width: 0%;\n  height: 100%;\n  background: ", ";\n  transition: width ", " linear;\n"], ["\n  z-index: 0;\n  top: 0px;\n  left: 0px;\n  position: absolute;\n  width: 0%;\n  height: 100%;\n  background: ", ";\n  transition: width ", " linear;\n"])), function (props) { return props.theme.positiveColor; }, function (props) { return props.theme.coreTransitionTime; });
var OverwriteSuccess = styled(OverwriteStatus)(templateObject_8 || (templateObject_8 = __makeTemplateObject(["\n  color: ", ";\n  background: ", ";\n  font-size: ", ";\n  overflow-wrap: break-word;\n  width: 50em;\n"], ["\n  color: ", ";\n  background: ", ";\n  font-size: ", ";\n  overflow-wrap: break-word;\n  width: 50em;\n"])), function (props) { return readableColor(props.theme.positiveColor); }, function (props) { return props.theme.positiveColor; }, function (props) { return props.theme.mediumFontSize; });
var OverwriteError = styled(OverwriteStatus)(templateObject_9 || (templateObject_9 = __makeTemplateObject(["\n  color: ", ";\n  background: ", ";\n  font-size: ", ";\n  overflow-wrap: break-word;\n  width: 50em;\n"], ["\n  color: ", ";\n  background: ", ";\n  font-size: ", ";\n  overflow-wrap: break-word;\n  width: 50em;\n"])), function (props) { return readableColor(props.theme.negativeColor); }, function (props) { return props.theme.negativeColor; }, function (props) { return props.theme.mediumFontSize; });
var ResultMessage = styled.div(templateObject_10 || (templateObject_10 = __makeTemplateObject(["\n  font-size: ", ";\n  margin-left: ", ";\n"], ["\n  font-size: ", ";\n  margin-left: ", ";\n"])), function (props) { return props.theme.largeFontSize; }, function (props) { return props.theme.minimumButtonSize; });
var Sending = function (props) { return (_jsxs(OverwriteProgress, { children: [_jsxs(ProgressTextUnder, { children: ["Uploading File", _jsxs("div", { children: [props.percentage, "%"] }), _jsx(ProgressInfo, { children: "If you leave this view, the overwrite will still continue." })] }), _jsxs(ProgressText, { children: ["Uploading File", _jsxs("div", { children: [Math.floor(props.percentage), "%"] }), _jsx(ProgressInfo, { children: "If you leave this view, the overwrite will still continue." })] }), _jsx(ProgressBar, { style: { width: "".concat(props.percentage, "%") } })] })); };
var Success = function (props) { return (_jsx(OverwriteSuccess, { children: _jsx(ResultMessage, { children: props.message }) })); };
var Error = function (props) { return (_jsx(OverwriteError, { children: _jsx(ResultMessage, { children: props.message }) })); };
var Stages = {
    Sending: Sending,
    Success: Success,
    Error: Error,
};
var defaultState = {
    stage: '',
    percentage: 0,
    message: '',
};
var mapOverwriteModelToState = function (overwriteModel) {
    var currentState = {};
    if (overwriteModel.get('success')) {
        currentState.stage = 'Success';
    }
    else if (overwriteModel.get('error')) {
        currentState.stage = 'Error';
    }
    else if (overwriteModel.get('sending')) {
        currentState.stage = 'Sending';
    }
    else {
        currentState.stage = '';
    }
    currentState.percentage = overwriteModel.get('percentage');
    currentState.message = overwriteModel.escape('message');
    return currentState;
};
var getOverwriteModel = function (_a) {
    var lazyResult = _a.lazyResult;
    if (!lazyResult) {
        return;
    }
    return OverwritesInstance.get(lazyResult.plain.id);
};
export var MetacardOverwrite = function (_a) {
    var title = _a.title, lazyResult = _a.lazyResult, overwriteUrl = _a.overwriteUrl;
    var dialogContext = useDialog();
    var _b = __read(React.useState(null), 2), overwriteModel = _b[0], setOverwriteModel = _b[1];
    var _c = __read(React.useState(null), 2), dropzone = _c[0], setDropzone = _c[1];
    var _d = __read(React.useState(null), 2), dropzoneElement = _d[0], setDropdownElement = _d[1];
    var _e = useBackbone(), listenTo = _e.listenTo, stopListening = _e.stopListening;
    var _f = __read(React.useState(defaultState), 2), state = _f[0], setState = _f[1];
    React.useEffect(function () {
        return function () {
            OverwritesInstance.removeIfUnused(lazyResult === null || lazyResult === void 0 ? void 0 : lazyResult.plain.id);
        };
    }, []);
    React.useEffect(function () {
        if (lazyResult && dropzoneElement) {
            var overrides_1 = {
                'security.access-administrators': lazyResult.plain.metacard.properties['security.access-administrators'] || [],
                'security.access-groups': lazyResult.plain.metacard.properties['security.access-groups'] || [],
                'security.access-groups-read': lazyResult.plain.metacard.properties['security.access-groups-read'] ||
                    [],
                'security.access-individuals': lazyResult.plain.metacard.properties['security.access-individuals'] ||
                    [],
                'security.access-individuals-read': lazyResult.plain.metacard.properties['security.access-individuals-read'] || [],
            };
            setDropzone(new Dropzone(dropzoneElement, {
                paramName: 'parse.resource', //required to parse multipart body
                url: (overwriteUrl ? overwriteUrl : './internal/catalog/') +
                    lazyResult.plain.id,
                maxFilesize: 5000000, //MB
                method: 'put',
                sending: function (_file, _xhr, formData) {
                    Object.keys(overrides_1).forEach(function (attribute) {
                        overrides_1[attribute].forEach(function (value) {
                            formData.append('parse.' + attribute, value);
                        });
                    });
                },
            }));
        }
    }, [dropzoneElement, lazyResult]);
    React.useEffect(function () {
        if (dropzone && lazyResult) {
            if (!getOverwriteModel({ lazyResult: lazyResult })) {
                OverwritesInstance.add({
                    id: lazyResult === null || lazyResult === void 0 ? void 0 : lazyResult.plain.id,
                    dropzone: dropzone,
                    result: lazyResult,
                });
            }
            setOverwriteModel(getOverwriteModel({ lazyResult: lazyResult }));
        }
    }, [dropzone, lazyResult]);
    React.useEffect(function () {
        if (overwriteModel) {
            setState(mapOverwriteModelToState(overwriteModel));
            var callback_1 = function () {
                setState(mapOverwriteModelToState(overwriteModel));
            };
            var eventString_1 = 'change:percentage change:sending change:error change:success';
            listenTo(overwriteModel, eventString_1, callback_1);
            return function () {
                if (overwriteModel) {
                    stopListening(overwriteModel, eventString_1, callback_1);
                }
            };
        }
        return function () { };
    }, [overwriteModel]);
    var startOver = function () {
        OverwritesInstance.remove(lazyResult === null || lazyResult === void 0 ? void 0 : lazyResult.plain.id);
        OverwritesInstance.add({
            id: lazyResult === null || lazyResult === void 0 ? void 0 : lazyResult.plain.id,
            dropzone: dropzone,
            result: lazyResult,
        });
        setOverwriteModel(getOverwriteModel({ lazyResult: lazyResult }));
        setState(defaultState);
    };
    var Component = Stages[state.stage];
    return (_jsxs(Root, { children: [_jsx("div", { style: { display: 'none' }, ref: setDropdownElement }), _jsx(DialogTitle, { children: title }), _jsxs(DialogContent, { style: { width: '50em' }, children: ["Are you sure you want to overwrite the content?", _jsx("br", {}), "WARNING: This will completely overwrite the current content and metadata."] }), Component && _jsx(Component, __assign({}, state)), _jsxs(DialogActions, { children: [_jsx(Button, { onClick: function () {
                            dialogContext.setProps({ open: false });
                            startOver();
                        }, children: "Cancel" }), _jsx(Button, { onClick: function () {
                            dropzoneElement === null || dropzoneElement === void 0 ? void 0 : dropzoneElement.click();
                            startOver();
                        }, children: "Overwrite" })] })] }));
};
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWNhcmQtb3ZlcndyaXRlLnZpZXcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbWFpbi93ZWJhcHAvY29tcG9uZW50L21ldGFjYXJkLW92ZXJ3cml0ZS9tZXRhY2FyZC1vdmVyd3JpdGUudmlldy50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7Ozs7Ozs7OztJQWFJO0FBRUosbUpBQW1KO0FBQ25KLE9BQU8sUUFBUSxNQUFNLFVBQVUsQ0FBQTtBQUMvQixPQUFPLGtCQUFrQixNQUFNLG1DQUFtQyxDQUFBO0FBQ2xFLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQTtBQUN6QixPQUFPLE1BQU0sTUFBTSxtQkFBbUIsQ0FBQTtBQUN0QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ3hDLE9BQU8sTUFBTSxNQUFNLHNCQUFzQixDQUFBO0FBQ3pDLE9BQU8sYUFBYSxNQUFNLDZCQUE2QixDQUFBO0FBQ3ZELE9BQU8sV0FBVyxNQUFNLDJCQUEyQixDQUFBO0FBQ25ELE9BQU8sYUFBYSxNQUFNLDZCQUE2QixDQUFBO0FBR3ZELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQTtBQUNwRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBRXJDLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxHQUFHLG1JQUFBLGdFQUl0QixJQUFBLENBQUE7QUFFRCxJQUFNLGVBQWUsR0FBRyxNQUFNLENBQUMsR0FBRyxnVEFBQSwrSkFNUixFQUF5Qyw0RUFJbEUsS0FKeUIsVUFBQyxLQUFLLElBQUssT0FBQSxLQUFLLENBQUMsS0FBSyxDQUFDLGtCQUFrQixFQUE5QixDQUE4QixDQUlsRSxDQUFBO0FBRUQsSUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsZUFBZSxDQUFDLDZGQUFBLG1CQUNoQyxFQUF3QyxLQUN4RCxLQURnQixVQUFDLEtBQUssSUFBSyxP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SyxDQUFDLENBQUE7SUFDckMsT0FBTyxDQUNMLE1BQUMsSUFBSSxlQUNILGNBQUssS0FBSyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFLEdBQUcsRUFBRSxrQkFBa0IsR0FBSSxFQUM1RCxLQUFDLFdBQVcsY0FBRSxLQUFLLEdBQWUsRUFDbEMsTUFBQyxhQUFhLElBQUMsS0FBSyxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxnRUFFckMsY0FBTSxpRkFHUSxFQUVmLFNBQVMsSUFBSSxLQUFDLFNBQVMsZUFBSyxLQUFLLEVBQUksRUFFdEMsTUFBQyxhQUFhLGVBQ1osS0FBQyxNQUFNLElBQ0wsT0FBTyxFQUFFOzRCQUNQLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQTs0QkFDdkMsU0FBUyxFQUFFLENBQUE7d0JBQ2IsQ0FBQyx1QkFHTSxFQUNULEtBQUMsTUFBTSxJQUNMLE9BQU8sRUFBRTs0QkFDUCxlQUFlLGFBQWYsZUFBZSx1QkFBZixlQUFlLENBQUUsS0FBSyxFQUFFLENBQUE7NEJBQ3hCLFNBQVMsRUFBRSxDQUFBO3dCQUNiLENBQUMsMEJBR00sSUFDSyxJQUNYLENBQ1IsQ0FBQTtBQUNILENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBDb2RpY2UgRm91bmRhdGlvblxuICpcbiAqIFRoaXMgaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXJcbiAqIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlXG4gKiBMaWNlbnNlLCBvciBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0XG4gKiBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlVcbiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuIEEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBpcyBkaXN0cmlidXRlZCBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbSBhbmQgY2FuIGJlIGZvdW5kIGF0XG4gKiA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2xncGwuaHRtbD4uXG4gKlxuICoqL1xuXG4vLyBAdHMtZXhwZWN0LWVycm9yIHRzLW1pZ3JhdGUoNzAxNikgRklYTUU6IENvdWxkIG5vdCBmaW5kIGEgZGVjbGFyYXRpb24gZmlsZSBmb3IgbW9kdWxlICdkcm9wLi4uIFJlbW92ZSB0aGlzIGNvbW1lbnQgdG8gc2VlIHRoZSBmdWxsIGVycm9yIG1lc3NhZ2VcbmltcG9ydCBEcm9wem9uZSBmcm9tICdkcm9wem9uZSdcbmltcG9ydCBPdmVyd3JpdGVzSW5zdGFuY2UgZnJvbSAnLi4vc2luZ2xldG9ucy9vdmVyd3JpdGVzLWluc3RhbmNlJ1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cydcbmltcG9ydCB7IHJlYWRhYmxlQ29sb3IgfSBmcm9tICdwb2xpc2hlZCdcbmltcG9ydCBCdXR0b24gZnJvbSAnQG11aS9tYXRlcmlhbC9CdXR0b24nXG5pbXBvcnQgRGlhbG9nQWN0aW9ucyBmcm9tICdAbXVpL21hdGVyaWFsL0RpYWxvZ0FjdGlvbnMnXG5pbXBvcnQgRGlhbG9nVGl0bGUgZnJvbSAnQG11aS9tYXRlcmlhbC9EaWFsb2dUaXRsZSdcbmltcG9ydCBEaWFsb2dDb250ZW50IGZyb20gJ0BtdWkvbWF0ZXJpYWwvRGlhbG9nQ29udGVudCdcblxuaW1wb3J0IHsgTGF6eVF1ZXJ5UmVzdWx0IH0gZnJvbSAnLi4vLi4vanMvbW9kZWwvTGF6eVF1ZXJ5UmVzdWx0L0xhenlRdWVyeVJlc3VsdCdcbmltcG9ydCB7IHVzZUJhY2tib25lIH0gZnJvbSAnLi4vc2VsZWN0aW9uLWNoZWNrYm94L3VzZUJhY2tib25lLmhvb2snXG5pbXBvcnQgeyB1c2VEaWFsb2cgfSBmcm9tICcuLi9kaWFsb2cnXG5cbmNvbnN0IFJvb3QgPSBzdHlsZWQuZGl2YFxuICBvdmVyZmxvdzogYXV0bztcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgaGVpZ2h0OiAxMDAlO1xuYFxuXG5jb25zdCBPdmVyd3JpdGVTdGF0dXMgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIHdoaXRlLXNwYWNlOiBub3JtYWw7XG4gIHZlcnRpY2FsLWFsaWduOiB0b3AgIWltcG9ydGFudDtcbiAgd2lkdGg6IDEwMCU7XG4gIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgwJSk7XG4gIHRyYW5zaXRpb246IHRyYW5zZm9ybSAkeyhwcm9wcykgPT4gcHJvcHMudGhlbWUuY29yZVRyYW5zaXRpb25UaW1lfSBsaW5lYXI7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBwYWRkaW5nOiAxMHB4O1xuYFxuXG5jb25zdCBPdmVyd3JpdGVQcm9ncmVzcyA9IHN0eWxlZChPdmVyd3JpdGVTdGF0dXMpYFxuICBsaW5lLWhlaWdodDogJHsocHJvcHMpID0+IHByb3BzLnRoZW1lLm1pbmltdW1CdXR0b25TaXplfTtcbmBcblxuY29uc3QgUHJvZ3Jlc3NUZXh0ID0gc3R5bGVkLmRpdmBcbiAgcGFkZGluZzogMTBweDtcbiAgdG9wOiAwcHg7XG4gIGxlZnQ6IDBweDtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xuICB6LWluZGV4OiAxO1xuICBmb250LXNpemU6ICR7KHByb3BzKSA9PiBwcm9wcy50aGVtZS5sYXJnZUZvbnRTaXplfTtcbiAgY29sb3I6ICR7KHByb3BzKSA9PiByZWFkYWJsZUNvbG9yKHByb3BzLnRoZW1lLmJhY2tncm91bmRDb250ZW50KX07XG5gXG5cbmNvbnN0IFByb2dyZXNzVGV4dFVuZGVyID0gc3R5bGVkLmRpdmBcbiAgZm9udC1zaXplOiAkeyhwcm9wcykgPT4gcHJvcHMudGhlbWUubGFyZ2VGb250U2l6ZX07XG4gIHZpc2liaWxpdHk6IGhpZGRlbjtcbmBcblxuY29uc3QgUHJvZ3Jlc3NJbmZvID0gc3R5bGVkLmRpdmBcbiAgZm9udC1zaXplOiAkeyhwcm9wcykgPT4gcHJvcHMudGhlbWUubWVkaXVtRm9udFNpemV9O1xuICBjb2xvcjogJHsocHJvcHMpID0+IHJlYWRhYmxlQ29sb3IocHJvcHMudGhlbWUuYmFja2dyb3VuZENvbnRlbnQpfTtcbmBcblxuY29uc3QgUHJvZ3Jlc3NCYXIgPSBzdHlsZWQuZGl2YFxuICB6LWluZGV4OiAwO1xuICB0b3A6IDBweDtcbiAgbGVmdDogMHB4O1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHdpZHRoOiAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xuICBiYWNrZ3JvdW5kOiAkeyhwcm9wcykgPT4gcHJvcHMudGhlbWUucG9zaXRpdmVDb2xvcn07XG4gIHRyYW5zaXRpb246IHdpZHRoICR7KHByb3BzKSA9PiBwcm9wcy50aGVtZS5jb3JlVHJhbnNpdGlvblRpbWV9IGxpbmVhcjtcbmBcblxuY29uc3QgT3ZlcndyaXRlU3VjY2VzcyA9IHN0eWxlZChPdmVyd3JpdGVTdGF0dXMpYFxuICBjb2xvcjogJHsocHJvcHMpID0+IHJlYWRhYmxlQ29sb3IocHJvcHMudGhlbWUucG9zaXRpdmVDb2xvcil9O1xuICBiYWNrZ3JvdW5kOiAkeyhwcm9wcykgPT4gcHJvcHMudGhlbWUucG9zaXRpdmVDb2xvcn07XG4gIGZvbnQtc2l6ZTogJHsocHJvcHMpID0+IHByb3BzLnRoZW1lLm1lZGl1bUZvbnRTaXplfTtcbiAgb3ZlcmZsb3ctd3JhcDogYnJlYWstd29yZDtcbiAgd2lkdGg6IDUwZW07XG5gXG5cbmNvbnN0IE92ZXJ3cml0ZUVycm9yID0gc3R5bGVkKE92ZXJ3cml0ZVN0YXR1cylgXG4gIGNvbG9yOiAkeyhwcm9wcykgPT4gcmVhZGFibGVDb2xvcihwcm9wcy50aGVtZS5uZWdhdGl2ZUNvbG9yKX07XG4gIGJhY2tncm91bmQ6ICR7KHByb3BzKSA9PiBwcm9wcy50aGVtZS5uZWdhdGl2ZUNvbG9yfTtcbiAgZm9udC1zaXplOiAkeyhwcm9wcykgPT4gcHJvcHMudGhlbWUubWVkaXVtRm9udFNpemV9O1xuICBvdmVyZmxvdy13cmFwOiBicmVhay13b3JkO1xuICB3aWR0aDogNTBlbTtcbmBcblxuY29uc3QgUmVzdWx0TWVzc2FnZSA9IHN0eWxlZC5kaXZgXG4gIGZvbnQtc2l6ZTogJHsocHJvcHMpID0+IHByb3BzLnRoZW1lLmxhcmdlRm9udFNpemV9O1xuICBtYXJnaW4tbGVmdDogJHsocHJvcHMpID0+IHByb3BzLnRoZW1lLm1pbmltdW1CdXR0b25TaXplfTtcbmBcblxuY29uc3QgU2VuZGluZyA9IChwcm9wczogYW55KSA9PiAoXG4gIDxPdmVyd3JpdGVQcm9ncmVzcz5cbiAgICA8UHJvZ3Jlc3NUZXh0VW5kZXI+XG4gICAgICBVcGxvYWRpbmcgRmlsZVxuICAgICAgPGRpdj57cHJvcHMucGVyY2VudGFnZX0lPC9kaXY+XG4gICAgICA8UHJvZ3Jlc3NJbmZvPlxuICAgICAgICBJZiB5b3UgbGVhdmUgdGhpcyB2aWV3LCB0aGUgb3ZlcndyaXRlIHdpbGwgc3RpbGwgY29udGludWUuXG4gICAgICA8L1Byb2dyZXNzSW5mbz5cbiAgICA8L1Byb2dyZXNzVGV4dFVuZGVyPlxuICAgIDxQcm9ncmVzc1RleHQ+XG4gICAgICBVcGxvYWRpbmcgRmlsZVxuICAgICAgPGRpdj57TWF0aC5mbG9vcihwcm9wcy5wZXJjZW50YWdlKX0lPC9kaXY+XG4gICAgICA8UHJvZ3Jlc3NJbmZvPlxuICAgICAgICBJZiB5b3UgbGVhdmUgdGhpcyB2aWV3LCB0aGUgb3ZlcndyaXRlIHdpbGwgc3RpbGwgY29udGludWUuXG4gICAgICA8L1Byb2dyZXNzSW5mbz5cbiAgICA8L1Byb2dyZXNzVGV4dD5cbiAgICA8UHJvZ3Jlc3NCYXIgc3R5bGU9e3sgd2lkdGg6IGAke3Byb3BzLnBlcmNlbnRhZ2V9JWAgfX0gLz5cbiAgPC9PdmVyd3JpdGVQcm9ncmVzcz5cbilcblxuY29uc3QgU3VjY2VzcyA9IChwcm9wczogYW55KSA9PiAoXG4gIDxPdmVyd3JpdGVTdWNjZXNzPlxuICAgIDxSZXN1bHRNZXNzYWdlPntwcm9wcy5tZXNzYWdlfTwvUmVzdWx0TWVzc2FnZT5cbiAgPC9PdmVyd3JpdGVTdWNjZXNzPlxuKVxuXG5jb25zdCBFcnJvciA9IChwcm9wczogYW55KSA9PiAoXG4gIDxPdmVyd3JpdGVFcnJvcj5cbiAgICA8UmVzdWx0TWVzc2FnZT57cHJvcHMubWVzc2FnZX08L1Jlc3VsdE1lc3NhZ2U+XG4gIDwvT3ZlcndyaXRlRXJyb3I+XG4pXG5cbmNvbnN0IFN0YWdlcyA9IHtcbiAgU2VuZGluZyxcbiAgU3VjY2VzcyxcbiAgRXJyb3IsXG59IGFzIHtcbiAgW2tleTogc3RyaW5nXTogYW55XG59XG5cbmNvbnN0IGRlZmF1bHRTdGF0ZSA9IHtcbiAgc3RhZ2U6ICcnLFxuICBwZXJjZW50YWdlOiAwLFxuICBtZXNzYWdlOiAnJyxcbn1cblxuY29uc3QgbWFwT3ZlcndyaXRlTW9kZWxUb1N0YXRlID0gKG92ZXJ3cml0ZU1vZGVsOiBhbnkpID0+IHtcbiAgY29uc3QgY3VycmVudFN0YXRlID0ge30gYXMgYW55XG4gIGlmIChvdmVyd3JpdGVNb2RlbC5nZXQoJ3N1Y2Nlc3MnKSkge1xuICAgIGN1cnJlbnRTdGF0ZS5zdGFnZSA9ICdTdWNjZXNzJ1xuICB9IGVsc2UgaWYgKG92ZXJ3cml0ZU1vZGVsLmdldCgnZXJyb3InKSkge1xuICAgIGN1cnJlbnRTdGF0ZS5zdGFnZSA9ICdFcnJvcidcbiAgfSBlbHNlIGlmIChvdmVyd3JpdGVNb2RlbC5nZXQoJ3NlbmRpbmcnKSkge1xuICAgIGN1cnJlbnRTdGF0ZS5zdGFnZSA9ICdTZW5kaW5nJ1xuICB9IGVsc2Uge1xuICAgIGN1cnJlbnRTdGF0ZS5zdGFnZSA9ICcnXG4gIH1cbiAgY3VycmVudFN0YXRlLnBlcmNlbnRhZ2UgPSBvdmVyd3JpdGVNb2RlbC5nZXQoJ3BlcmNlbnRhZ2UnKVxuICBjdXJyZW50U3RhdGUubWVzc2FnZSA9IG92ZXJ3cml0ZU1vZGVsLmVzY2FwZSgnbWVzc2FnZScpXG5cbiAgcmV0dXJuIGN1cnJlbnRTdGF0ZVxufVxuXG5jb25zdCBnZXRPdmVyd3JpdGVNb2RlbCA9ICh7IGxhenlSZXN1bHQgfTogeyBsYXp5UmVzdWx0OiBMYXp5UXVlcnlSZXN1bHQgfSkgPT4ge1xuICBpZiAoIWxhenlSZXN1bHQpIHtcbiAgICByZXR1cm5cbiAgfVxuICByZXR1cm4gT3ZlcndyaXRlc0luc3RhbmNlLmdldChsYXp5UmVzdWx0LnBsYWluLmlkKVxufVxuXG5leHBvcnQgY29uc3QgTWV0YWNhcmRPdmVyd3JpdGUgPSAoe1xuICB0aXRsZSxcbiAgbGF6eVJlc3VsdCxcbiAgb3ZlcndyaXRlVXJsLFxufToge1xuICB0aXRsZTogc3RyaW5nXG4gIGxhenlSZXN1bHQ6IExhenlRdWVyeVJlc3VsdFxuICBvdmVyd3JpdGVVcmw/OiBzdHJpbmdcbn0pID0+IHtcbiAgY29uc3QgZGlhbG9nQ29udGV4dCA9IHVzZURpYWxvZygpXG4gIGNvbnN0IFtvdmVyd3JpdGVNb2RlbCwgc2V0T3ZlcndyaXRlTW9kZWxdID0gUmVhY3QudXNlU3RhdGU8YW55PihudWxsKVxuICBjb25zdCBbZHJvcHpvbmUsIHNldERyb3B6b25lXSA9IFJlYWN0LnVzZVN0YXRlPGFueT4obnVsbClcbiAgY29uc3QgW2Ryb3B6b25lRWxlbWVudCwgc2V0RHJvcGRvd25FbGVtZW50XSA9XG4gICAgUmVhY3QudXNlU3RhdGU8SFRNTERpdkVsZW1lbnQgfCBudWxsPihudWxsKVxuICBjb25zdCB7IGxpc3RlblRvLCBzdG9wTGlzdGVuaW5nIH0gPSB1c2VCYWNrYm9uZSgpXG4gIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gUmVhY3QudXNlU3RhdGUoZGVmYXVsdFN0YXRlKVxuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIE92ZXJ3cml0ZXNJbnN0YW5jZS5yZW1vdmVJZlVudXNlZChsYXp5UmVzdWx0Py5wbGFpbi5pZClcbiAgICB9XG4gIH0sIFtdKVxuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGxhenlSZXN1bHQgJiYgZHJvcHpvbmVFbGVtZW50KSB7XG4gICAgICBjb25zdCBvdmVycmlkZXMgPSB7XG4gICAgICAgICdzZWN1cml0eS5hY2Nlc3MtYWRtaW5pc3RyYXRvcnMnOlxuICAgICAgICAgIGxhenlSZXN1bHQucGxhaW4ubWV0YWNhcmQucHJvcGVydGllc1tcbiAgICAgICAgICAgICdzZWN1cml0eS5hY2Nlc3MtYWRtaW5pc3RyYXRvcnMnXG4gICAgICAgICAgXSB8fCBbXSxcbiAgICAgICAgJ3NlY3VyaXR5LmFjY2Vzcy1ncm91cHMnOlxuICAgICAgICAgIGxhenlSZXN1bHQucGxhaW4ubWV0YWNhcmQucHJvcGVydGllc1snc2VjdXJpdHkuYWNjZXNzLWdyb3VwcyddIHx8IFtdLFxuICAgICAgICAnc2VjdXJpdHkuYWNjZXNzLWdyb3Vwcy1yZWFkJzpcbiAgICAgICAgICBsYXp5UmVzdWx0LnBsYWluLm1ldGFjYXJkLnByb3BlcnRpZXNbJ3NlY3VyaXR5LmFjY2Vzcy1ncm91cHMtcmVhZCddIHx8XG4gICAgICAgICAgW10sXG4gICAgICAgICdzZWN1cml0eS5hY2Nlc3MtaW5kaXZpZHVhbHMnOlxuICAgICAgICAgIGxhenlSZXN1bHQucGxhaW4ubWV0YWNhcmQucHJvcGVydGllc1snc2VjdXJpdHkuYWNjZXNzLWluZGl2aWR1YWxzJ10gfHxcbiAgICAgICAgICBbXSxcbiAgICAgICAgJ3NlY3VyaXR5LmFjY2Vzcy1pbmRpdmlkdWFscy1yZWFkJzpcbiAgICAgICAgICBsYXp5UmVzdWx0LnBsYWluLm1ldGFjYXJkLnByb3BlcnRpZXNbXG4gICAgICAgICAgICAnc2VjdXJpdHkuYWNjZXNzLWluZGl2aWR1YWxzLXJlYWQnXG4gICAgICAgICAgXSB8fCBbXSxcbiAgICAgIH0gYXMge1xuICAgICAgICBba2V5OiBzdHJpbmddOiBhbnlcbiAgICAgIH1cbiAgICAgIHNldERyb3B6b25lKFxuICAgICAgICBuZXcgRHJvcHpvbmUoZHJvcHpvbmVFbGVtZW50LCB7XG4gICAgICAgICAgcGFyYW1OYW1lOiAncGFyc2UucmVzb3VyY2UnLCAvL3JlcXVpcmVkIHRvIHBhcnNlIG11bHRpcGFydCBib2R5XG4gICAgICAgICAgdXJsOlxuICAgICAgICAgICAgKG92ZXJ3cml0ZVVybCA/IG92ZXJ3cml0ZVVybCA6ICcuL2ludGVybmFsL2NhdGFsb2cvJykgK1xuICAgICAgICAgICAgbGF6eVJlc3VsdC5wbGFpbi5pZCxcbiAgICAgICAgICBtYXhGaWxlc2l6ZTogNTAwMDAwMCwgLy9NQlxuICAgICAgICAgIG1ldGhvZDogJ3B1dCcsXG4gICAgICAgICAgc2VuZGluZyhfZmlsZTogYW55LCBfeGhyOiBhbnksIGZvcm1EYXRhOiBhbnkpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKG92ZXJyaWRlcykuZm9yRWFjaCgoYXR0cmlidXRlKSA9PiB7XG4gICAgICAgICAgICAgIG92ZXJyaWRlc1thdHRyaWJ1dGVdLmZvckVhY2goKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3BhcnNlLicgKyBhdHRyaWJ1dGUsIHZhbHVlKVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgKVxuICAgIH1cbiAgfSwgW2Ryb3B6b25lRWxlbWVudCwgbGF6eVJlc3VsdF0pXG5cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoZHJvcHpvbmUgJiYgbGF6eVJlc3VsdCkge1xuICAgICAgaWYgKCFnZXRPdmVyd3JpdGVNb2RlbCh7IGxhenlSZXN1bHQgfSkpIHtcbiAgICAgICAgT3ZlcndyaXRlc0luc3RhbmNlLmFkZCh7XG4gICAgICAgICAgaWQ6IGxhenlSZXN1bHQ/LnBsYWluLmlkLFxuICAgICAgICAgIGRyb3B6b25lOiBkcm9wem9uZSxcbiAgICAgICAgICByZXN1bHQ6IGxhenlSZXN1bHQsXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBzZXRPdmVyd3JpdGVNb2RlbChnZXRPdmVyd3JpdGVNb2RlbCh7IGxhenlSZXN1bHQgfSkpXG4gICAgfVxuICB9LCBbZHJvcHpvbmUsIGxhenlSZXN1bHRdKVxuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKG92ZXJ3cml0ZU1vZGVsKSB7XG4gICAgICBzZXRTdGF0ZShtYXBPdmVyd3JpdGVNb2RlbFRvU3RhdGUob3ZlcndyaXRlTW9kZWwpKVxuICAgICAgY29uc3QgY2FsbGJhY2sgPSAoKSA9PiB7XG4gICAgICAgIHNldFN0YXRlKG1hcE92ZXJ3cml0ZU1vZGVsVG9TdGF0ZShvdmVyd3JpdGVNb2RlbCkpXG4gICAgICB9XG4gICAgICBjb25zdCBldmVudFN0cmluZyA9XG4gICAgICAgICdjaGFuZ2U6cGVyY2VudGFnZSBjaGFuZ2U6c2VuZGluZyBjaGFuZ2U6ZXJyb3IgY2hhbmdlOnN1Y2Nlc3MnXG4gICAgICBsaXN0ZW5UbyhvdmVyd3JpdGVNb2RlbCwgZXZlbnRTdHJpbmcsIGNhbGxiYWNrKVxuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgaWYgKG92ZXJ3cml0ZU1vZGVsKSB7XG4gICAgICAgICAgc3RvcExpc3RlbmluZyhvdmVyd3JpdGVNb2RlbCwgZXZlbnRTdHJpbmcsIGNhbGxiYWNrKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAoKSA9PiB7fVxuICB9LCBbb3ZlcndyaXRlTW9kZWxdKVxuXG4gIGNvbnN0IHN0YXJ0T3ZlciA9ICgpID0+IHtcbiAgICBPdmVyd3JpdGVzSW5zdGFuY2UucmVtb3ZlKGxhenlSZXN1bHQ/LnBsYWluLmlkKVxuICAgIE92ZXJ3cml0ZXNJbnN0YW5jZS5hZGQoe1xuICAgICAgaWQ6IGxhenlSZXN1bHQ/LnBsYWluLmlkLFxuICAgICAgZHJvcHpvbmU6IGRyb3B6b25lLFxuICAgICAgcmVzdWx0OiBsYXp5UmVzdWx0LFxuICAgIH0pXG4gICAgc2V0T3ZlcndyaXRlTW9kZWwoZ2V0T3ZlcndyaXRlTW9kZWwoeyBsYXp5UmVzdWx0IH0pKVxuICAgIHNldFN0YXRlKGRlZmF1bHRTdGF0ZSlcbiAgfVxuICBjb25zdCBDb21wb25lbnQgPSBTdGFnZXNbc3RhdGUuc3RhZ2VdXG4gIHJldHVybiAoXG4gICAgPFJvb3Q+XG4gICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICdub25lJyB9fSByZWY9e3NldERyb3Bkb3duRWxlbWVudH0gLz5cbiAgICAgIDxEaWFsb2dUaXRsZT57dGl0bGV9PC9EaWFsb2dUaXRsZT5cbiAgICAgIDxEaWFsb2dDb250ZW50IHN0eWxlPXt7IHdpZHRoOiAnNTBlbScgfX0+XG4gICAgICAgIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBvdmVyd3JpdGUgdGhlIGNvbnRlbnQ/XG4gICAgICAgIDxiciAvPlxuICAgICAgICBXQVJOSU5HOiBUaGlzIHdpbGwgY29tcGxldGVseSBvdmVyd3JpdGUgdGhlIGN1cnJlbnQgY29udGVudCBhbmRcbiAgICAgICAgbWV0YWRhdGEuXG4gICAgICA8L0RpYWxvZ0NvbnRlbnQ+XG5cbiAgICAgIHtDb21wb25lbnQgJiYgPENvbXBvbmVudCB7Li4uc3RhdGV9IC8+fVxuXG4gICAgICA8RGlhbG9nQWN0aW9ucz5cbiAgICAgICAgPEJ1dHRvblxuICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgIGRpYWxvZ0NvbnRleHQuc2V0UHJvcHMoeyBvcGVuOiBmYWxzZSB9KVxuICAgICAgICAgICAgc3RhcnRPdmVyKClcbiAgICAgICAgICB9fVxuICAgICAgICA+XG4gICAgICAgICAgQ2FuY2VsXG4gICAgICAgIDwvQnV0dG9uPlxuICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgZHJvcHpvbmVFbGVtZW50Py5jbGljaygpXG4gICAgICAgICAgICBzdGFydE92ZXIoKVxuICAgICAgICAgIH19XG4gICAgICAgID5cbiAgICAgICAgICBPdmVyd3JpdGVcbiAgICAgICAgPC9CdXR0b24+XG4gICAgICA8L0RpYWxvZ0FjdGlvbnM+XG4gICAgPC9Sb290PlxuICApXG59XG4iXX0=