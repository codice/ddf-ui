import { __assign } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import React from 'react';
import { validateWkt, validateDd, validateDms, validateUsng } from './utils';
import { Radio, RadioItem } from '../../react-component/radio/radio';
import { WKT, LatLongDD, LatLongDMS, USNG } from './geo-components';
import Gazetteer from '../../react-component/location/gazetteer';
import CQLUtils from '../../js/CQLUtils';
import immer from 'immer.1.5.0';
var produce = immer;
var inputs = {
    wkt: {
        label: 'WKT',
        Component: WKT,
    },
    dd: {
        label: 'Lat/Lon (DD)',
        Component: LatLongDD,
    },
    dms: {
        label: 'Lat/Lon (DMS)',
        Component: LatLongDMS,
    },
    usng: {
        label: 'USNG/MGRS',
        Component: USNG,
    },
    keyword: {
        label: 'Keyword',
        Component: function (props) {
            var keyword = props.keyword;
            return (_jsx(Gazetteer, { placeholder: 'Enter a location', value: keyword ? keyword.keywordValue : '', setState: props.setState(function (draft, value) {
                    value.type =
                        value.polyType.toLowerCase() === 'polygon'
                            ? 'POLYGON'
                            : 'MULTIPOLYGON';
                    value.keywordValue = value.value;
                    value.mode = 'keyword';
                    value.wkt = CQLUtils.generateFilter(undefined, 'location', value, undefined).value;
                    draft.keyword = value;
                    // onFieldEdit(field.id, location)
                }) }));
        },
    },
};
var validate = function (_a) {
    var state = _a.state, setState = _a.setState;
    var mode = state.mode;
    var validationReport;
    switch (mode) {
        case 'wkt':
            validationReport = validateWkt(state[mode]);
            break;
        case 'dd':
            validationReport = validateDd(state[mode]);
            break;
        case 'dms':
            validationReport = validateDms(state[mode]);
            break;
        case 'usng':
            validationReport = validateUsng(state[mode]);
            break;
    }
    setState(__assign(__assign({}, state), { valid: validationReport ? validationReport.valid : true, error: validationReport ? validationReport.error : false }));
};
var LocationInput = function (props) {
    var mode = props.mode, valid = props.valid, error = props.error, showErrors = props.showErrors, setState = props.setState;
    var input = inputs[mode] || {};
    var _a = input.Component, Component = _a === void 0 ? null : _a;
    React.useEffect(function () {
        validate({
            state: props,
            setState: props.setState(function (draft, value) {
                draft.valid = value.valid;
                draft.error = value.error;
                return draft;
            }),
        });
    }, [props]);
    return (_jsxs("div", { children: [_jsx(Radio, { value: mode, onChange: setState(function (draft, value) { return (draft.mode = value); }), children: Object.keys(inputs).map(function (key) { return (_jsx(RadioItem, { value: key, children: inputs[key].label }, key)); }) }), _jsxs("div", { className: "form-group flow-root mt-2", children: [Component !== null ? _jsx(Component, __assign({}, props)) : null, _jsxs("div", { className: "for-error whitespace-pre-line ".concat(!valid && showErrors ? '' : 'invisible'), style: {
                            width: '400px',
                            maxWidth: '100%',
                        }, children: [_jsx("span", { className: "fa fa-exclamation-triangle" }), " ", error] })] })] }));
};
export default (function (_a) {
    var state = _a.state, setState = _a.setState;
    return (_jsx(LocationInput, __assign({}, state, { setState: function (producer) { return function (value) {
            var nextState = produce(state, function (draft) {
                producer(draft, value);
            });
            setState(nextState);
        }; } })));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9jYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbWFpbi93ZWJhcHAvY29tcG9uZW50L2xvY2F0aW9uLW5ldy9sb2NhdGlvbi50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7Ozs7Ozs7OztJQWFJO0FBQ0osT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQ3pCLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsTUFBTSxTQUFTLENBQUE7QUFDNUUsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQTtBQUNwRSxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFDbkUsT0FBTyxTQUFTLE1BQU0sMENBQTBDLENBQUE7QUFDaEUsT0FBTyxRQUFRLE1BQU0sbUJBQW1CLENBQUE7QUFDeEMsT0FBTyxLQUFLLE1BQU0sYUFBYSxDQUFBO0FBQy9CLElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQTtBQUVyQixJQUFNLE1BQU0sR0FBRztJQUNiLEdBQUcsRUFBRTtRQUNILEtBQUssRUFBRSxLQUFLO1FBQ1osU0FBUyxFQUFFLEdBQUc7S0FDZjtJQUNELEVBQUUsRUFBRTtRQUNGLEtBQUssRUFBRSxjQUFjO1FBQ3JCLFNBQVMsRUFBRSxTQUFTO0tBQ3JCO0lBQ0QsR0FBRyxFQUFFO1FBQ0gsS0FBSyxFQUFFLGVBQWU7UUFDdEIsU0FBUyxFQUFFLFVBQVU7S0FDdEI7SUFDRCxJQUFJLEVBQUU7UUFDSixLQUFLLEVBQUUsV0FBVztRQUNsQixTQUFTLEVBQUUsSUFBSTtLQUNoQjtJQUNELE9BQU8sRUFBRTtRQUNQLEtBQUssRUFBRSxTQUFTO1FBQ2hCLFNBQVMsRUFBRSxVQUFDLEtBQTZCO1lBQy9CLElBQUEsT0FBTyxHQUFLLEtBQUssUUFBVixDQUFV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QUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFLFVBQUMsS0FBVTtnQkFDMUMsUUFBUSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUN4QixDQUFDLENBQUMsQ0FBQTtZQUNGLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUNyQixDQUFDLEVBTDRCLENBSzVCLElBQ0QsQ0FDSDtBQVY0QyxDQVU1QyxFQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIENvZGljZSBGb3VuZGF0aW9uXG4gKlxuICogVGhpcyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlclxuICogR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGVcbiAqIExpY2Vuc2UsIG9yIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXRcbiAqIGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVVxuICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4gQSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGlzIGRpc3RyaWJ1dGVkIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtIGFuZCBjYW4gYmUgZm91bmQgYXRcbiAqIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvbGdwbC5odG1sPi5cbiAqXG4gKiovXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgeyB2YWxpZGF0ZVdrdCwgdmFsaWRhdGVEZCwgdmFsaWRhdGVEbXMsIHZhbGlkYXRlVXNuZyB9IGZyb20gJy4vdXRpbHMnXG5pbXBvcnQgeyBSYWRpbywgUmFkaW9JdGVtIH0gZnJvbSAnLi4vLi4vcmVhY3QtY29tcG9uZW50L3JhZGlvL3JhZGlvJ1xuaW1wb3J0IHsgV0tULCBMYXRMb25nREQsIExhdExvbmdETVMsIFVTTkcgfSBmcm9tICcuL2dlby1jb21wb25lbnRzJ1xuaW1wb3J0IEdhemV0dGVlciBmcm9tICcuLi8uLi9yZWFjdC1jb21wb25lbnQvbG9jYXRpb24vZ2F6ZXR0ZWVyJ1xuaW1wb3J0IENRTFV0aWxzIGZyb20gJy4uLy4uL2pzL0NRTFV0aWxzJ1xuaW1wb3J0IGltbWVyIGZyb20gJ2ltbWVyLjEuNS4wJ1xuY29uc3QgcHJvZHVjZSA9IGltbWVyXG5cbmNvbnN0IGlucHV0cyA9IHtcbiAgd2t0OiB7XG4gICAgbGFiZWw6ICdXS1QnLFxuICAgIENvbXBvbmVudDogV0tULFxuICB9LFxuICBkZDoge1xuICAgIGxhYmVsOiAnTGF0L0xvbiAoREQpJyxcbiAgICBDb21wb25lbnQ6IExhdExvbmdERCxcbiAgfSxcbiAgZG1zOiB7XG4gICAgbGFiZWw6ICdMYXQvTG9uIChETVMpJyxcbiAgICBDb21wb25lbnQ6IExhdExvbmdETVMsXG4gIH0sXG4gIHVzbmc6IHtcbiAgICBsYWJlbDogJ1VTTkcvTUdSUycsXG4gICAgQ29tcG9uZW50OiBVU05HLFxuICB9LFxuICBrZXl3b3JkOiB7XG4gICAgbGFiZWw6ICdLZXl3b3JkJyxcbiAgICBDb21wb25lbnQ6IChwcm9wczogTG9jYXRpb25JbnB1dFByb3BzVHlwZSkgPT4ge1xuICAgICAgY29uc3QgeyBrZXl3b3JkIH0gPSBwcm9wc1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPEdhemV0dGVlclxuICAgICAgICAgIHBsYWNlaG9sZGVyPXsnRW50ZXIgYSBsb2NhdGlvbid9XG4gICAgICAgICAgdmFsdWU9e2tleXdvcmQgPyBrZXl3b3JkLmtleXdvcmRWYWx1ZSA6ICcnfVxuICAgICAgICAgIHNldFN0YXRlPXtwcm9wcy5zZXRTdGF0ZShcbiAgICAgICAgICAgIChkcmFmdDogTG9jYXRpb25JbnB1dFByb3BzVHlwZSwgdmFsdWU6IGFueSkgPT4ge1xuICAgICAgICAgICAgICB2YWx1ZS50eXBlID1cbiAgICAgICAgICAgICAgICB2YWx1ZS5wb2x5VHlwZS50b0xvd2VyQ2FzZSgpID09PSAncG9seWdvbidcbiAgICAgICAgICAgICAgICAgID8gJ1BPTFlHT04nXG4gICAgICAgICAgICAgICAgICA6ICdNVUxUSVBPTFlHT04nXG4gICAgICAgICAgICAgIHZhbHVlLmtleXdvcmRWYWx1ZSA9IHZhbHVlLnZhbHVlXG4gICAgICAgICAgICAgIHZhbHVlLm1vZGUgPSAna2V5d29yZCdcblxuICAgICAgICAgICAgICB2YWx1ZS53a3QgPSBDUUxVdGlscy5nZW5lcmF0ZUZpbHRlcihcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgJ2xvY2F0aW9uJyxcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWRcbiAgICAgICAgICAgICAgKS52YWx1ZVxuICAgICAgICAgICAgICBkcmFmdC5rZXl3b3JkID0gdmFsdWVcbiAgICAgICAgICAgICAgLy8gb25GaWVsZEVkaXQoZmllbGQuaWQsIGxvY2F0aW9uKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICl9XG4gICAgICAgIC8+XG4gICAgICApXG4gICAgfSxcbiAgfSxcbn0gYXMge1xuICBba2V5OiBzdHJpbmddOiB7XG4gICAgbGFiZWw6IHN0cmluZ1xuICAgIENvbXBvbmVudDogYW55XG4gIH1cbn1cblxuY29uc3QgdmFsaWRhdGUgPSAoe1xuICBzdGF0ZSxcbiAgc2V0U3RhdGUsXG59OiB7XG4gIHN0YXRlOiBMb2NhdGlvbklucHV0UHJvcHNUeXBlXG4gIHNldFN0YXRlOiAoc3RhdGU6IExvY2F0aW9uSW5wdXRQcm9wc1R5cGUpID0+IHZvaWRcbn0pID0+IHtcbiAgY29uc3QgbW9kZSA9IHN0YXRlLm1vZGVcbiAgbGV0IHZhbGlkYXRpb25SZXBvcnRcbiAgc3dpdGNoIChtb2RlKSB7XG4gICAgY2FzZSAnd2t0JzpcbiAgICAgIHZhbGlkYXRpb25SZXBvcnQgPSB2YWxpZGF0ZVdrdChzdGF0ZVttb2RlXSlcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnZGQnOlxuICAgICAgdmFsaWRhdGlvblJlcG9ydCA9IHZhbGlkYXRlRGQoc3RhdGVbbW9kZV0pXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2Rtcyc6XG4gICAgICB2YWxpZGF0aW9uUmVwb3J0ID0gdmFsaWRhdGVEbXMoc3RhdGVbbW9kZV0pXG4gICAgICBicmVha1xuICAgIGNhc2UgJ3VzbmcnOlxuICAgICAgdmFsaWRhdGlvblJlcG9ydCA9IHZhbGlkYXRlVXNuZyhzdGF0ZVttb2RlXSlcbiAgICAgIGJyZWFrXG4gIH1cbiAgc2V0U3RhdGUoe1xuICAgIC4uLnN0YXRlLFxuICAgIHZhbGlkOiB2YWxpZGF0aW9uUmVwb3J0ID8gdmFsaWRhdGlvblJlcG9ydC52YWxpZCA6IHRydWUsXG4gICAgZXJyb3I6IHZhbGlkYXRpb25SZXBvcnQgPyB2YWxpZGF0aW9uUmVwb3J0LmVycm9yIDogKGZhbHNlIGFzIGFueSksXG4gIH0pXG59XG5cbmV4cG9ydCB0eXBlIExvY2F0aW9uSW5wdXRQcm9wc1R5cGUgPSB7XG4gIGRkOiB7XG4gICAgYm91bmRpbmdCb3g6IHtcbiAgICAgIG5vcnRoOiBzdHJpbmdcbiAgICAgIHNvdXRoOiBzdHJpbmdcbiAgICAgIGVhc3Q6IHN0cmluZ1xuICAgICAgd2VzdDogc3RyaW5nXG4gICAgfVxuICAgIGNpcmNsZToge1xuICAgICAgcG9pbnQ6IHsgbGF0aXR1ZGU6IHN0cmluZzsgbG9uZ2l0dWRlOiBzdHJpbmcgfVxuICAgICAgcmFkaXVzOiBzdHJpbmdcbiAgICAgIHVuaXRzOiAnbWV0ZXJzJ1xuICAgIH1cbiAgICBsaW5lOiB7XG4gICAgICBsaXN0OiBhbnlbXVxuICAgIH1cbiAgICBwb2ludDogeyBsYXRpdHVkZTogc3RyaW5nOyBsb25naXR1ZGU6IHN0cmluZyB9XG4gICAgcG9seWdvbjogeyBsaXN0OiBhbnlbXSB9XG4gICAgc2hhcGU6ICdwb2ludCdcbiAgfVxuICBrZXl3b3JkOiBhbnlcbiAgZG1zOiBhbnlcbiAgZXJyb3I6IG51bGwgfCBzdHJpbmdcbiAgbW9kZTogJ3drdCcgfCAnZGQnIHwgJ2RtcycgfCAndXNuZycgfCAna2V5d29yZCdcbiAgc2V0U3RhdGU6IGFueVxuICBzaG93RXJyb3JzOiBib29sZWFuXG4gIHVzbmc6IGFueVxuICB2YWxpZDogYm9vbGVhblxuICB3a3Q6IHN0cmluZ1xufVxuXG5jb25zdCBMb2NhdGlvbklucHV0ID0gKHByb3BzOiBMb2NhdGlvbklucHV0UHJvcHNUeXBlKSA9PiB7XG4gIGNvbnN0IHsgbW9kZSwgdmFsaWQsIGVycm9yLCBzaG93RXJyb3JzLCBzZXRTdGF0ZSB9ID0gcHJvcHNcbiAgY29uc3QgaW5wdXQgPSBpbnB1dHNbbW9kZV0gfHwge31cbiAgY29uc3QgeyBDb21wb25lbnQgPSBudWxsIH0gPSBpbnB1dFxuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgdmFsaWRhdGUoe1xuICAgICAgc3RhdGU6IHByb3BzLFxuICAgICAgc2V0U3RhdGU6IHByb3BzLnNldFN0YXRlKChkcmFmdDogYW55LCB2YWx1ZTogYW55KSA9PiB7XG4gICAgICAgIGRyYWZ0LnZhbGlkID0gdmFsdWUudmFsaWRcbiAgICAgICAgZHJhZnQuZXJyb3IgPSB2YWx1ZS5lcnJvclxuICAgICAgICByZXR1cm4gZHJhZnRcbiAgICAgIH0pLFxuICAgIH0pXG4gIH0sIFtwcm9wc10pXG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2PlxuICAgICAgPFJhZGlvXG4gICAgICAgIHZhbHVlPXttb2RlfVxuICAgICAgICBvbkNoYW5nZT17c2V0U3RhdGUoKGRyYWZ0OiBhbnksIHZhbHVlOiBhbnkpID0+IChkcmFmdC5tb2RlID0gdmFsdWUpKX1cbiAgICAgID5cbiAgICAgICAge09iamVjdC5rZXlzKGlucHV0cykubWFwKChrZXkpID0+IChcbiAgICAgICAgICA8UmFkaW9JdGVtIGtleT17a2V5fSB2YWx1ZT17a2V5fT5cbiAgICAgICAgICAgIHtpbnB1dHNba2V5XS5sYWJlbH1cbiAgICAgICAgICA8L1JhZGlvSXRlbT5cbiAgICAgICAgKSl9XG4gICAgICA8L1JhZGlvPlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJmb3JtLWdyb3VwIGZsb3ctcm9vdCBtdC0yXCI+XG4gICAgICAgIHtDb21wb25lbnQgIT09IG51bGwgPyA8Q29tcG9uZW50IHsuLi5wcm9wc30gLz4gOiBudWxsfVxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3NOYW1lPXtgZm9yLWVycm9yIHdoaXRlc3BhY2UtcHJlLWxpbmUgJHtcbiAgICAgICAgICAgICF2YWxpZCAmJiBzaG93RXJyb3JzID8gJycgOiAnaW52aXNpYmxlJ1xuICAgICAgICAgIH1gfVxuICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICB3aWR0aDogJzQwMHB4JyxcbiAgICAgICAgICAgIG1heFdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgfX1cbiAgICAgICAgPlxuICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImZhIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlXCIgLz4ge2Vycm9yfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICApXG59XG5cbmV4cG9ydCBkZWZhdWx0ICh7IHN0YXRlLCBzZXRTdGF0ZSB9OiBhbnkpID0+IChcbiAgPExvY2F0aW9uSW5wdXRcbiAgICB7Li4uc3RhdGV9XG4gICAgc2V0U3RhdGU9eyhwcm9kdWNlcjogYW55KSA9PiAodmFsdWU6IGFueSkgPT4ge1xuICAgICAgY29uc3QgbmV4dFN0YXRlID0gcHJvZHVjZShzdGF0ZSwgKGRyYWZ0OiBhbnkpID0+IHtcbiAgICAgICAgcHJvZHVjZXIoZHJhZnQsIHZhbHVlKVxuICAgICAgfSlcbiAgICAgIHNldFN0YXRlKG5leHRTdGF0ZSlcbiAgICB9fVxuICAvPlxuKVxuIl19