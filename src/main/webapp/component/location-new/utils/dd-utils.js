/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import wkx from 'wkx';
import { computeCircle, toKilometers } from './geo-helper';
import errorMessages from './errors';
var ddRegex = new RegExp('^-?[0-9]*.?[0-9]*$');
var minimumDifference = 0.0001;
function ddCoordinateIsBlank(coordinate) {
    return coordinate.length === 0;
}
function ddPointIsBlank(point) {
    return (ddCoordinateIsBlank(point.latitude) && ddCoordinateIsBlank(point.longitude));
}
// @ts-expect-error ts-migrate(7030) FIXME: Not all code paths return a value.
function inputIsBlank(dd) {
    switch (dd.shape) {
        case 'point':
            return ddPointIsBlank(dd.point);
        case 'circle':
            return ddPointIsBlank(dd.circle.point);
        case 'line':
            return dd.line.list.length === 0;
        case 'polygon':
            return dd.polygon.list.length === 0;
        case 'boundingbox':
            return (ddCoordinateIsBlank(dd.boundingbox.north) &&
                ddCoordinateIsBlank(dd.boundingbox.south) &&
                ddCoordinateIsBlank(dd.boundingbox.east) &&
                ddCoordinateIsBlank(dd.boundingbox.west));
    }
}
/*
 *  Decimal degrees -> WKT conversion utils
 */
function ddPointToWkt(point) {
    return new wkx.Point(point.longitude, point.latitude);
}
function ddToWkt(dd) {
    var _a;
    if (inputIsBlank(dd)) {
        return null;
    }
    var wkt = null;
    var points = [];
    switch (dd.shape) {
        case 'point':
            wkt = ddPointToWkt(dd.point).toWkt();
            break;
        case 'circle':
            if (!isNaN(dd.circle.point.latitude) &&
                !isNaN(dd.circle.point.longitude) &&
                dd.circle.radius > 0) {
                var distance = toKilometers(dd.circle.radius, dd.circle.units);
                wkt = (_a = computeCircle(ddPointToWkt(dd.circle.point), distance, 36)) === null || _a === void 0 ? void 0 : _a.toWkt();
            }
            break;
        case 'line':
            if (dd.line.list.length > 0) {
                dd.line.list.map(function (point) { return points.push(ddPointToWkt(point)); });
                wkt = new wkx.LineString(points).toWkt();
            }
            break;
        case 'polygon':
            if (dd.polygon.list.length > 0) {
                dd.polygon.list.map(function (point) { return points.push(ddPointToWkt(point)); });
                var p1 = points[0];
                var p2 = points[points.length - 1];
                if (p1.x !== p2.x || p1.y !== p2.y) {
                    points.push(new wkx.Point(p1.x, p1.y));
                }
                wkt = new wkx.Polygon(points).toWkt();
            }
            break;
        case 'boundingbox':
            var nw = new wkx.Point(dd.boundingbox.west, dd.boundingbox.north);
            var ne = new wkx.Point(dd.boundingbox.east, dd.boundingbox.north);
            var se = new wkx.Point(dd.boundingbox.east, dd.boundingbox.south);
            var sw = new wkx.Point(dd.boundingbox.west, dd.boundingbox.south);
            wkt = new wkx.Polygon([nw, ne, se, sw, nw]).toWkt();
            break;
    }
    return wkt;
}
/*
 *  Decimal degrees validation utils
 */
function parseDdCoordinate(coordinate) {
    if (ddRegex.exec(coordinate) == null) {
        return null;
    }
    var _coordinate = parseFloat(coordinate);
    if (isNaN(_coordinate)) {
        return null;
    }
    return _coordinate;
}
function inValidRange(coordinate, maximum) {
    return coordinate >= -1 * maximum && coordinate <= maximum;
}
function validateDdPoint(point) {
    var latitude = parseDdCoordinate(point.latitude);
    var longitude = parseDdCoordinate(point.longitude);
    if (latitude && longitude) {
        return inValidRange(latitude, 90) && inValidRange(longitude, 180);
    }
    return false;
}
function validateDdBoundingBox(boundingbox) {
    var north = parseDdCoordinate(boundingbox.north);
    var south = parseDdCoordinate(boundingbox.south);
    var east = parseDdCoordinate(boundingbox.east);
    var west = parseDdCoordinate(boundingbox.west);
    if (north == null || south == null || east == null || west == null) {
        return false;
    }
    if (!inValidRange(north, 90) ||
        !inValidRange(south, 90) ||
        !inValidRange(east, 180) ||
        !inValidRange(west, 180)) {
        return false;
    }
    if (north < south || east < west) {
        return false;
    }
    if (north - south < minimumDifference || east - west < minimumDifference) {
        return false;
    }
    return true;
}
function validateDd(dd) {
    if (inputIsBlank(dd)) {
        return { valid: true, error: null };
    }
    var valid = true;
    var error = null;
    switch (dd.shape) {
        case 'point':
            if (!validateDdPoint(dd.point)) {
                valid = false;
                error = errorMessages.invalidCoordinates;
            }
            break;
        case 'circle':
            var radius = parseFloat(dd.circle.radius);
            if (isNaN(radius) ||
                radius <= 0 ||
                toKilometers(radius, dd.circle.units) > 10000) {
                valid = false;
                error = errorMessages.invalidRadius;
            }
            else if (!validateDdPoint(dd.circle.point)) {
                valid = false;
                error = errorMessages.invalidCoordinates;
            }
            break;
        case 'line':
            if (!dd.line.list.every(validateDdPoint)) {
                valid = false;
                error = errorMessages.invalidList;
            }
            else if (dd.line.list.length < 2) {
                valid = false;
                error = errorMessages.tooFewPointsLine;
            }
            break;
        case 'polygon':
            if (!dd.polygon.list.every(validateDdPoint)) {
                valid = false;
                error = errorMessages.invalidList;
            }
            else if (dd.polygon.list.length < 3) {
                valid = false;
                error = errorMessages.tooFewPointsPolygon;
            }
            break;
        case 'boundingbox':
            if (!validateDdPoint({
                latitude: dd.boundingbox.north,
                longitude: dd.boundingbox.east,
            }) ||
                !validateDdPoint({
                    latitude: dd.boundingbox.south,
                    longitude: dd.boundingbox.west,
                })) {
                valid = false;
                error = errorMessages.invalidCoordinates;
            }
            else if (!validateDdBoundingBox(dd.boundingbox)) {
                valid = false;
                error = errorMessages.invalidBoundingBoxDd;
            }
            break;
    }
    return { valid: valid, error: error };
}
export { ddToWkt, validateDd, validateDdPoint };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGQtdXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbWFpbi93ZWJhcHAvY29tcG9uZW50L2xvY2F0aW9uLW5ldy91dGlscy9kZC11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7OztJQWFJO0FBQ0osT0FBTyxHQUFHLE1BQU0sS0FBSyxDQUFBO0FBRXJCLE9BQU8sRUFBRSxhQUFhLEVBQUUsWUFBWSxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBQzFELE9BQU8sYUFBYSxNQUFNLFVBQVUsQ0FBQTtBQUVwQyxJQUFNLE9BQU8sR0FBRyxJQUFJLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFBO0FBQ2hELElBQU0saUJBQWlCLEdBQUcsTUFBTSxDQUFBO0FBRWhDLFNBQVMsbUJBQW1CLENBQUMsVUFBZTtJQUMxQyxPQUFPLFVBQVUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFBO0FBQ2hDLENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FBQyxLQUFVO0lBQ2hDLE9BQU8sQ0FDTCxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksbUJBQW1CLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUM1RSxDQUFBO0FBQ0gsQ0FBQztBQUVELDhFQUE4RTtBQUM5RSxTQUFTLFlBQVksQ0FBQyxFQUFPO0lBQzNCLFFBQVEsRUFBRSxDQUFDLEtBQUssRUFBRTtRQUNoQixLQUFLLE9BQU87WUFDVixPQUFPLGNBQWMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDakMsS0FBSyxRQUFRO1lBQ1gsT0FBTyxjQUFjLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUN4QyxLQUFLLE1BQU07WUFDVCxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUE7UUFDbEMsS0FBSyxTQUFTO1lBQ1osT0FBTyxF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S0FBSyxDQUFBO2dCQUNiLEtBQUssR0FBRyxhQUFhLENBQUMsbUJBQW1CLENBQUE7YUFDMUM7WUFDRCxNQUFLO1FBQ1AsS0FBSyxhQUFhO1lBQ2hCLElBQ0UsQ0FBQyxlQUFlLENBQUM7Z0JBQ2YsUUFBUSxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSztnQkFDOUIsU0FBUyxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSTthQUMvQixDQUFDO2dCQUNGLENBQUMsZUFBZSxDQUFDO29CQUNmLFFBQVEsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLEtBQUs7b0JBQzlCLFNBQVMsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUk7aUJBQy9CLENBQUMsRUFDRjtnQkFDQSxLQUFLLEdBQUcsS0FBSyxDQUFBO2dCQUNiLEtBQUssR0FBRyxhQUFhLENBQUMsa0JBQWtCLENBQUE7YUFDekM7aUJBQU0sSUFBSSxDQUFDLHFCQUFxQixDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRTtnQkFDakQsS0FBSyxHQUFHLEtBQUssQ0FBQTtnQkFDYixLQUFLLEdBQUcsYUFBYSxDQUFDLG9CQUFvQixDQUFBO2FBQzNDO1lBQ0QsTUFBSztLQUNSO0lBQ0QsT0FBTyxFQUFFLEtBQUssT0FBQSxFQUFFLEtBQUssT0FBQSxFQUFFLENBQUE7QUFDekIsQ0FBQztBQUVELE9BQU8sRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLGVBQWUsRUFBRSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIENvZGljZSBGb3VuZGF0aW9uXG4gKlxuICogVGhpcyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlclxuICogR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGVcbiAqIExpY2Vuc2UsIG9yIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXRcbiAqIGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVVxuICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4gQSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbiAqIGlzIGRpc3RyaWJ1dGVkIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtIGFuZCBjYW4gYmUgZm91bmQgYXRcbiAqIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvbGdwbC5odG1sPi5cbiAqXG4gKiovXG5pbXBvcnQgd2t4IGZyb20gJ3dreCdcblxuaW1wb3J0IHsgY29tcHV0ZUNpcmNsZSwgdG9LaWxvbWV0ZXJzIH0gZnJvbSAnLi9nZW8taGVscGVyJ1xuaW1wb3J0IGVycm9yTWVzc2FnZXMgZnJvbSAnLi9lcnJvcnMnXG5cbmNvbnN0IGRkUmVnZXggPSBuZXcgUmVnRXhwKCdeLT9bMC05XSouP1swLTldKiQnKVxuY29uc3QgbWluaW11bURpZmZlcmVuY2UgPSAwLjAwMDFcblxuZnVuY3Rpb24gZGRDb29yZGluYXRlSXNCbGFuayhjb29yZGluYXRlOiBhbnkpIHtcbiAgcmV0dXJuIGNvb3JkaW5hdGUubGVuZ3RoID09PSAwXG59XG5cbmZ1bmN0aW9uIGRkUG9pbnRJc0JsYW5rKHBvaW50OiBhbnkpIHtcbiAgcmV0dXJuIChcbiAgICBkZENvb3JkaW5hdGVJc0JsYW5rKHBvaW50LmxhdGl0dWRlKSAmJiBkZENvb3JkaW5hdGVJc0JsYW5rKHBvaW50LmxvbmdpdHVkZSlcbiAgKVxufVxuXG4vLyBAdHMtZXhwZWN0LWVycm9yIHRzLW1pZ3JhdGUoNzAzMCkgRklYTUU6IE5vdCBhbGwgY29kZSBwYXRocyByZXR1cm4gYSB2YWx1ZS5cbmZ1bmN0aW9uIGlucHV0SXNCbGFuayhkZDogYW55KSB7XG4gIHN3aXRjaCAoZGQuc2hhcGUpIHtcbiAgICBjYXNlICdwb2ludCc6XG4gICAgICByZXR1cm4gZGRQb2ludElzQmxhbmsoZGQucG9pbnQpXG4gICAgY2FzZSAnY2lyY2xlJzpcbiAgICAgIHJldHVybiBkZFBvaW50SXNCbGFuayhkZC5jaXJjbGUucG9pbnQpXG4gICAgY2FzZSAnbGluZSc6XG4gICAgICByZXR1cm4gZGQubGluZS5saXN0Lmxlbmd0aCA9PT0gMFxuICAgIGNhc2UgJ3BvbHlnb24nOlxuICAgICAgcmV0dXJuIGRkLnBvbHlnb24ubGlzdC5sZW5ndGggPT09IDBcbiAgICBjYXNlICdib3VuZGluZ2JveCc6XG4gICAgICByZXR1cm4gKFxuICAgICAgICBkZENvb3JkaW5hdGVJc0JsYW5rKGRkLmJvdW5kaW5nYm94Lm5vcnRoKSAmJlxuICAgICAgICBkZENvb3JkaW5hdGVJc0JsYW5rKGRkLmJvdW5kaW5nYm94LnNvdXRoKSAmJlxuICAgICAgICBkZENvb3JkaW5hdGVJc0JsYW5rKGRkLmJvdW5kaW5nYm94LmVhc3QpICYmXG4gICAgICAgIGRkQ29vcmRpbmF0ZUlzQmxhbmsoZGQuYm91bmRpbmdib3gud2VzdClcbiAgICAgIClcbiAgfVxufVxuXG4vKlxuICogIERlY2ltYWwgZGVncmVlcyAtPiBXS1QgY29udmVyc2lvbiB1dGlsc1xuICovXG5mdW5jdGlvbiBkZFBvaW50VG9Xa3QocG9pbnQ6IGFueSkge1xuICByZXR1cm4gbmV3IHdreC5Qb2ludChwb2ludC5sb25naXR1ZGUsIHBvaW50LmxhdGl0dWRlKVxufVxuXG5mdW5jdGlvbiBkZFRvV2t0KGRkOiBhbnkpIHtcbiAgaWYgKGlucHV0SXNCbGFuayhkZCkpIHtcbiAgICByZXR1cm4gbnVsbFxuICB9XG5cbiAgbGV0IHdrdCA9IG51bGxcbiAgY29uc3QgcG9pbnRzOiBhbnkgPSBbXVxuICBzd2l0Y2ggKGRkLnNoYXBlKSB7XG4gICAgY2FzZSAncG9pbnQnOlxuICAgICAgd2t0ID0gZGRQb2ludFRvV2t0KGRkLnBvaW50KS50b1drdCgpXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2NpcmNsZSc6XG4gICAgICBpZiAoXG4gICAgICAgICFpc05hTihkZC5jaXJjbGUucG9pbnQubGF0aXR1ZGUpICYmXG4gICAgICAgICFpc05hTihkZC5jaXJjbGUucG9pbnQubG9uZ2l0dWRlKSAmJlxuICAgICAgICBkZC5jaXJjbGUucmFkaXVzID4gMFxuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IGRpc3RhbmNlID0gdG9LaWxvbWV0ZXJzKGRkLmNpcmNsZS5yYWRpdXMsIGRkLmNpcmNsZS51bml0cylcbiAgICAgICAgd2t0ID0gY29tcHV0ZUNpcmNsZShcbiAgICAgICAgICBkZFBvaW50VG9Xa3QoZGQuY2lyY2xlLnBvaW50KSxcbiAgICAgICAgICBkaXN0YW5jZSxcbiAgICAgICAgICAzNlxuICAgICAgICApPy50b1drdCgpXG4gICAgICB9XG4gICAgICBicmVha1xuICAgIGNhc2UgJ2xpbmUnOlxuICAgICAgaWYgKGRkLmxpbmUubGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGRkLmxpbmUubGlzdC5tYXAoKHBvaW50OiBhbnkpID0+IHBvaW50cy5wdXNoKGRkUG9pbnRUb1drdChwb2ludCkpKVxuICAgICAgICB3a3QgPSBuZXcgd2t4LkxpbmVTdHJpbmcocG9pbnRzKS50b1drdCgpXG4gICAgICB9XG4gICAgICBicmVha1xuICAgIGNhc2UgJ3BvbHlnb24nOlxuICAgICAgaWYgKGRkLnBvbHlnb24ubGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGRkLnBvbHlnb24ubGlzdC5tYXAoKHBvaW50OiBhbnkpID0+IHBvaW50cy5wdXNoKGRkUG9pbnRUb1drdChwb2ludCkpKVxuICAgICAgICBjb25zdCBwMSA9IHBvaW50c1swXVxuICAgICAgICBjb25zdCBwMiA9IHBvaW50c1twb2ludHMubGVuZ3RoIC0gMV1cbiAgICAgICAgaWYgKHAxLnggIT09IHAyLnggfHwgcDEueSAhPT0gcDIueSkge1xuICAgICAgICAgIHBvaW50cy5wdXNoKG5ldyB3a3guUG9pbnQocDEueCwgcDEueSkpXG4gICAgICAgIH1cbiAgICAgICAgd2t0ID0gbmV3IHdreC5Qb2x5Z29uKHBvaW50cykudG9Xa3QoKVxuICAgICAgfVxuICAgICAgYnJlYWtcbiAgICBjYXNlICdib3VuZGluZ2JveCc6XG4gICAgICBjb25zdCBudyA9IG5ldyB3a3guUG9pbnQoZGQuYm91bmRpbmdib3gud2VzdCwgZGQuYm91bmRpbmdib3gubm9ydGgpXG4gICAgICBjb25zdCBuZSA9IG5ldyB3a3guUG9pbnQoZGQuYm91bmRpbmdib3guZWFzdCwgZGQuYm91bmRpbmdib3gubm9ydGgpXG4gICAgICBjb25zdCBzZSA9IG5ldyB3a3guUG9pbnQoZGQuYm91bmRpbmdib3guZWFzdCwgZGQuYm91bmRpbmdib3guc291dGgpXG4gICAgICBjb25zdCBzdyA9IG5ldyB3a3guUG9pbnQoZGQuYm91bmRpbmdib3gud2VzdCwgZGQuYm91bmRpbmdib3guc291dGgpXG4gICAgICB3a3QgPSBuZXcgd2t4LlBvbHlnb24oW253LCBuZSwgc2UsIHN3LCBud10pLnRvV2t0KClcbiAgICAgIGJyZWFrXG4gIH1cbiAgcmV0dXJuIHdrdFxufVxuXG4vKlxuICogIERlY2ltYWwgZGVncmVlcyB2YWxpZGF0aW9uIHV0aWxzXG4gKi9cbmZ1bmN0aW9uIHBhcnNlRGRDb29yZGluYXRlKGNvb3JkaW5hdGU6IGFueSkge1xuICBpZiAoZGRSZWdleC5leGVjKGNvb3JkaW5hdGUpID09IG51bGwpIHtcbiAgICByZXR1cm4gbnVsbFxuICB9XG4gIGNvbnN0IF9jb29yZGluYXRlID0gcGFyc2VGbG9hdChjb29yZGluYXRlKVxuICBpZiAoaXNOYU4oX2Nvb3JkaW5hdGUpKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuICByZXR1cm4gX2Nvb3JkaW5hdGVcbn1cblxuZnVuY3Rpb24gaW5WYWxpZFJhbmdlKGNvb3JkaW5hdGU6IGFueSwgbWF4aW11bTogYW55KSB7XG4gIHJldHVybiBjb29yZGluYXRlID49IC0xICogbWF4aW11bSAmJiBjb29yZGluYXRlIDw9IG1heGltdW1cbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVEZFBvaW50KHBvaW50OiBhbnkpIHtcbiAgY29uc3QgbGF0aXR1ZGUgPSBwYXJzZURkQ29vcmRpbmF0ZShwb2ludC5sYXRpdHVkZSlcbiAgY29uc3QgbG9uZ2l0dWRlID0gcGFyc2VEZENvb3JkaW5hdGUocG9pbnQubG9uZ2l0dWRlKVxuICBpZiAobGF0aXR1ZGUgJiYgbG9uZ2l0dWRlKSB7XG4gICAgcmV0dXJuIGluVmFsaWRSYW5nZShsYXRpdHVkZSwgOTApICYmIGluVmFsaWRSYW5nZShsb25naXR1ZGUsIDE4MClcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVEZEJvdW5kaW5nQm94KGJvdW5kaW5nYm94OiBhbnkpIHtcbiAgY29uc3Qgbm9ydGggPSBwYXJzZURkQ29vcmRpbmF0ZShib3VuZGluZ2JveC5ub3J0aClcbiAgY29uc3Qgc291dGggPSBwYXJzZURkQ29vcmRpbmF0ZShib3VuZGluZ2JveC5zb3V0aClcbiAgY29uc3QgZWFzdCA9IHBhcnNlRGRDb29yZGluYXRlKGJvdW5kaW5nYm94LmVhc3QpXG4gIGNvbnN0IHdlc3QgPSBwYXJzZURkQ29vcmRpbmF0ZShib3VuZGluZ2JveC53ZXN0KVxuXG4gIGlmIChub3J0aCA9PSBudWxsIHx8IHNvdXRoID09IG51bGwgfHwgZWFzdCA9PSBudWxsIHx8IHdlc3QgPT0gbnVsbCkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgaWYgKFxuICAgICFpblZhbGlkUmFuZ2Uobm9ydGgsIDkwKSB8fFxuICAgICFpblZhbGlkUmFuZ2Uoc291dGgsIDkwKSB8fFxuICAgICFpblZhbGlkUmFuZ2UoZWFzdCwgMTgwKSB8fFxuICAgICFpblZhbGlkUmFuZ2Uod2VzdCwgMTgwKVxuICApIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIGlmIChub3J0aCA8IHNvdXRoIHx8IGVhc3QgPCB3ZXN0KSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICBpZiAobm9ydGggLSBzb3V0aCA8IG1pbmltdW1EaWZmZXJlbmNlIHx8IGVhc3QgLSB3ZXN0IDwgbWluaW11bURpZmZlcmVuY2UpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIHJldHVybiB0cnVlXG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlRGQoZGQ6IGFueSkge1xuICBpZiAoaW5wdXRJc0JsYW5rKGRkKSkge1xuICAgIHJldHVybiB7IHZhbGlkOiB0cnVlLCBlcnJvcjogbnVsbCB9XG4gIH1cblxuICBsZXQgdmFsaWQgPSB0cnVlXG4gIGxldCBlcnJvciA9IG51bGxcbiAgc3dpdGNoIChkZC5zaGFwZSkge1xuICAgIGNhc2UgJ3BvaW50JzpcbiAgICAgIGlmICghdmFsaWRhdGVEZFBvaW50KGRkLnBvaW50KSkge1xuICAgICAgICB2YWxpZCA9IGZhbHNlXG4gICAgICAgIGVycm9yID0gZXJyb3JNZXNzYWdlcy5pbnZhbGlkQ29vcmRpbmF0ZXNcbiAgICAgIH1cbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnY2lyY2xlJzpcbiAgICAgIGNvbnN0IHJhZGl1cyA9IHBhcnNlRmxvYXQoZGQuY2lyY2xlLnJhZGl1cylcbiAgICAgIGlmIChcbiAgICAgICAgaXNOYU4ocmFkaXVzKSB8fFxuICAgICAgICByYWRpdXMgPD0gMCB8fFxuICAgICAgICB0b0tpbG9tZXRlcnMocmFkaXVzLCBkZC5jaXJjbGUudW5pdHMpID4gMTAwMDBcbiAgICAgICkge1xuICAgICAgICB2YWxpZCA9IGZhbHNlXG4gICAgICAgIGVycm9yID0gZXJyb3JNZXNzYWdlcy5pbnZhbGlkUmFkaXVzXG4gICAgICB9IGVsc2UgaWYgKCF2YWxpZGF0ZURkUG9pbnQoZGQuY2lyY2xlLnBvaW50KSkge1xuICAgICAgICB2YWxpZCA9IGZhbHNlXG4gICAgICAgIGVycm9yID0gZXJyb3JNZXNzYWdlcy5pbnZhbGlkQ29vcmRpbmF0ZXNcbiAgICAgIH1cbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnbGluZSc6XG4gICAgICBpZiAoIWRkLmxpbmUubGlzdC5ldmVyeSh2YWxpZGF0ZURkUG9pbnQpKSB7XG4gICAgICAgIHZhbGlkID0gZmFsc2VcbiAgICAgICAgZXJyb3IgPSBlcnJvck1lc3NhZ2VzLmludmFsaWRMaXN0XG4gICAgICB9IGVsc2UgaWYgKGRkLmxpbmUubGlzdC5sZW5ndGggPCAyKSB7XG4gICAgICAgIHZhbGlkID0gZmFsc2VcbiAgICAgICAgZXJyb3IgPSBlcnJvck1lc3NhZ2VzLnRvb0Zld1BvaW50c0xpbmVcbiAgICAgIH1cbiAgICAgIGJyZWFrXG4gICAgY2FzZSAncG9seWdvbic6XG4gICAgICBpZiAoIWRkLnBvbHlnb24ubGlzdC5ldmVyeSh2YWxpZGF0ZURkUG9pbnQpKSB7XG4gICAgICAgIHZhbGlkID0gZmFsc2VcbiAgICAgICAgZXJyb3IgPSBlcnJvck1lc3NhZ2VzLmludmFsaWRMaXN0XG4gICAgICB9IGVsc2UgaWYgKGRkLnBvbHlnb24ubGlzdC5sZW5ndGggPCAzKSB7XG4gICAgICAgIHZhbGlkID0gZmFsc2VcbiAgICAgICAgZXJyb3IgPSBlcnJvck1lc3NhZ2VzLnRvb0Zld1BvaW50c1BvbHlnb25cbiAgICAgIH1cbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnYm91bmRpbmdib3gnOlxuICAgICAgaWYgKFxuICAgICAgICAhdmFsaWRhdGVEZFBvaW50KHtcbiAgICAgICAgICBsYXRpdHVkZTogZGQuYm91bmRpbmdib3gubm9ydGgsXG4gICAgICAgICAgbG9uZ2l0dWRlOiBkZC5ib3VuZGluZ2JveC5lYXN0LFxuICAgICAgICB9KSB8fFxuICAgICAgICAhdmFsaWRhdGVEZFBvaW50KHtcbiAgICAgICAgICBsYXRpdHVkZTogZGQuYm91bmRpbmdib3guc291dGgsXG4gICAgICAgICAgbG9uZ2l0dWRlOiBkZC5ib3VuZGluZ2JveC53ZXN0LFxuICAgICAgICB9KVxuICAgICAgKSB7XG4gICAgICAgIHZhbGlkID0gZmFsc2VcbiAgICAgICAgZXJyb3IgPSBlcnJvck1lc3NhZ2VzLmludmFsaWRDb29yZGluYXRlc1xuICAgICAgfSBlbHNlIGlmICghdmFsaWRhdGVEZEJvdW5kaW5nQm94KGRkLmJvdW5kaW5nYm94KSkge1xuICAgICAgICB2YWxpZCA9IGZhbHNlXG4gICAgICAgIGVycm9yID0gZXJyb3JNZXNzYWdlcy5pbnZhbGlkQm91bmRpbmdCb3hEZFxuICAgICAgfVxuICAgICAgYnJlYWtcbiAgfVxuICByZXR1cm4geyB2YWxpZCwgZXJyb3IgfVxufVxuXG5leHBvcnQgeyBkZFRvV2t0LCB2YWxpZGF0ZURkLCB2YWxpZGF0ZURkUG9pbnQgfVxuIl19