/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import wkx from 'wkx';
import { computeCircle, toKilometers } from './geo-helper';
import errorMessages from './errors';
var ddRegex = new RegExp('^-?[0-9]*.?[0-9]*$');
var minimumDifference = 0.0001;
function ddCoordinateIsBlank(coordinate) {
    return coordinate.length === 0;
}
function ddPointIsBlank(point) {
    return (ddCoordinateIsBlank(point.latitude) && ddCoordinateIsBlank(point.longitude));
}
// @ts-expect-error ts-migrate(7030) FIXME: Not all code paths return a value.
function inputIsBlank(dd) {
    switch (dd.shape) {
        case 'point':
            return ddPointIsBlank(dd.point);
        case 'circle':
            return ddPointIsBlank(dd.circle.point);
        case 'line':
            return dd.line.list.length === 0;
        case 'polygon':
            return dd.polygon.list.length === 0;
        case 'boundingbox':
            return (ddCoordinateIsBlank(dd.boundingbox.north) &&
                ddCoordinateIsBlank(dd.boundingbox.south) &&
                ddCoordinateIsBlank(dd.boundingbox.east) &&
                ddCoordinateIsBlank(dd.boundingbox.west));
    }
}
/*
 *  Decimal degrees -> WKT conversion utils
 */
function ddPointToWkt(point) {
    return new wkx.Point(point.longitude, point.latitude);
}
function ddToWkt(dd) {
    var _a;
    if (inputIsBlank(dd)) {
        return null;
    }
    var wkt = null;
    var points = [];
    switch (dd.shape) {
        case 'point':
            wkt = ddPointToWkt(dd.point).toWkt();
            break;
        case 'circle':
            if (!isNaN(dd.circle.point.latitude) &&
                !isNaN(dd.circle.point.longitude) &&
                dd.circle.radius > 0) {
                var distance = toKilometers(dd.circle.radius, dd.circle.units);
                wkt = (_a = computeCircle(ddPointToWkt(dd.circle.point), distance, 36)) === null || _a === void 0 ? void 0 : _a.toWkt();
            }
            break;
        case 'line':
            if (dd.line.list.length > 0) {
                dd.line.list.map(function (point) { return points.push(ddPointToWkt(point)); });
                wkt = new wkx.LineString(points).toWkt();
            }
            break;
        case 'polygon':
            if (dd.polygon.list.length > 0) {
                dd.polygon.list.map(function (point) { return points.push(ddPointToWkt(point)); });
                var p1 = points[0];
                var p2 = points[points.length - 1];
                if (p1.x !== p2.x || p1.y !== p2.y) {
                    points.push(new wkx.Point(p1.x, p1.y));
                }
                wkt = new wkx.Polygon(points).toWkt();
            }
            break;
        case 'boundingbox':
            var nw = new wkx.Point(dd.boundingbox.west, dd.boundingbox.north);
            var ne = new wkx.Point(dd.boundingbox.east, dd.boundingbox.north);
            var se = new wkx.Point(dd.boundingbox.east, dd.boundingbox.south);
            var sw = new wkx.Point(dd.boundingbox.west, dd.boundingbox.south);
            wkt = new wkx.Polygon([nw, ne, se, sw, nw]).toWkt();
            break;
    }
    return wkt;
}
/*
 *  Decimal degrees validation utils
 */
function parseDdCoordinate(coordinate) {
    if (ddRegex.exec(coordinate) == null) {
        return null;
    }
    var _coordinate = parseFloat(coordinate);
    if (isNaN(_coordinate)) {
        return null;
    }
    return _coordinate;
}
function inValidRange(coordinate, maximum) {
    return coordinate >= -1 * maximum && coordinate <= maximum;
}
function validateDdPoint(point) {
    var latitude = parseDdCoordinate(point.latitude);
    var longitude = parseDdCoordinate(point.longitude);
    if (latitude && longitude) {
        return inValidRange(latitude, 90) && inValidRange(longitude, 180);
    }
    return false;
}
function validateDdBoundingBox(boundingbox) {
    var north = parseDdCoordinate(boundingbox.north);
    var south = parseDdCoordinate(boundingbox.south);
    var east = parseDdCoordinate(boundingbox.east);
    var west = parseDdCoordinate(boundingbox.west);
    if (north == null || south == null || east == null || west == null) {
        return false;
    }
    if (!inValidRange(north, 90) ||
        !inValidRange(south, 90) ||
        !inValidRange(east, 180) ||
        !inValidRange(west, 180)) {
        return false;
    }
    if (north < south || east < west) {
        return false;
    }
    if (north - south < minimumDifference || east - west < minimumDifference) {
        return false;
    }
    return true;
}
function validateDd(dd) {
    if (inputIsBlank(dd)) {
        return { valid: true, error: null };
    }
    var valid = true;
    var error = null;
    switch (dd.shape) {
        case 'point':
            if (!validateDdPoint(dd.point)) {
                valid = false;
                error = errorMessages.invalidCoordinates;
            }
            break;
        case 'circle':
            var radius = parseFloat(dd.circle.radius);
            if (isNaN(radius) ||
                radius <= 0 ||
                toKilometers(radius, dd.circle.units) > 10000) {
                valid = false;
                error = errorMessages.invalidRadius;
            }
            else if (!validateDdPoint(dd.circle.point)) {
                valid = false;
                error = errorMessages.invalidCoordinates;
            }
            break;
        case 'line':
            if (!dd.line.list.every(validateDdPoint)) {
                valid = false;
                error = errorMessages.invalidList;
            }
            else if (dd.line.list.length < 2) {
                valid = false;
                error = errorMessages.tooFewPointsLine;
            }
            break;
        case 'polygon':
            if (!dd.polygon.list.every(validateDdPoint)) {
                valid = false;
                error = errorMessages.invalidList;
            }
            else if (dd.polygon.list.length < 3) {
                valid = false;
                error = errorMessages.tooFewPointsPolygon;
            }
            break;
        case 'boundingbox':
            if (!validateDdPoint({
                latitude: dd.boundingbox.north,
                longitude: dd.boundingbox.east,
            }) ||
                !validateDdPoint({
                    latitude: dd.boundingbox.south,
                    longitude: dd.boundingbox.west,
                })) {
                valid = false;
                error = errorMessages.invalidCoordinates;
            }
            else if (!validateDdBoundingBox(dd.boundingbox)) {
                valid = false;
                error = errorMessages.invalidBoundingBoxDd;
            }
            break;
    }
    return { valid: valid, error: error };
}
export { ddToWkt, validateDd, validateDdPoint };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGQtdXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbWFpbi93ZWJhcHAvY29tcG9uZW50L2xvY2F0aW9uLW5ldy91dGlscy9kZC11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7OztJQWFJO0FBQ0osT0FBTyxHQUFHLE1BQU0sS0FBSyxDQUFBO0FBRXJCLE9BQU8sRUFBRSxhQUFhLEVBQUUsWUFBWSxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBQzFELE9BQU8sYUFBYSxNQUFNLFVBQVUsQ0FBQTtBQUVwQyxJQUFNLE9BQU8sR0FBRyxJQUFJLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFBO0FBQ2hELElBQU0saUJBQWlCLEdBQUcsTUFBTSxDQUFBO0FBRWhDLFNBQVMsbUJBQW1CLENBQUMsVUFBZTtJQUMxQyxPQUFPLFVBQVUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFBO0FBQ2hDLENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FBQyxLQUFVO0lBQ2hDLE9BQU8sQ0FDTCxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksbUJBQW1CLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUM1RSxDQUFBO0FBQ0gsQ0FBQztBQUVELDhFQUE4RTtBQUM5RSxTQUFTLFlBQVksQ0FBQyxFQUFPO0lBQzNCLFFBQVEsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2pCLEtBQUssT0FBTztZQUNWLE9BQU8sY0FBYyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNqQyxLQUFLLFFBQVE7WUFDWCxPQUFPLGNBQWMsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ3hDLEtBQUssTUFBTTtZQUNULE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQTtRQUNsQyxLQUFLLFNBQVM7WUFDWixP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b250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBDb2RpY2UgRm91bmRhdGlvblxuICpcbiAqIFRoaXMgaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXJcbiAqIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlXG4gKiBMaWNlbnNlLCBvciBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0XG4gKiBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlVcbiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuIEEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBpcyBkaXN0cmlidXRlZCBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbSBhbmQgY2FuIGJlIGZvdW5kIGF0XG4gKiA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2xncGwuaHRtbD4uXG4gKlxuICoqL1xuaW1wb3J0IHdreCBmcm9tICd3a3gnXG5cbmltcG9ydCB7IGNvbXB1dGVDaXJjbGUsIHRvS2lsb21ldGVycyB9IGZyb20gJy4vZ2VvLWhlbHBlcidcbmltcG9ydCBlcnJvck1lc3NhZ2VzIGZyb20gJy4vZXJyb3JzJ1xuXG5jb25zdCBkZFJlZ2V4ID0gbmV3IFJlZ0V4cCgnXi0/WzAtOV0qLj9bMC05XSokJylcbmNvbnN0IG1pbmltdW1EaWZmZXJlbmNlID0gMC4wMDAxXG5cbmZ1bmN0aW9uIGRkQ29vcmRpbmF0ZUlzQmxhbmsoY29vcmRpbmF0ZTogYW55KSB7XG4gIHJldHVybiBjb29yZGluYXRlLmxlbmd0aCA9PT0gMFxufVxuXG5mdW5jdGlvbiBkZFBvaW50SXNCbGFuayhwb2ludDogYW55KSB7XG4gIHJldHVybiAoXG4gICAgZGRDb29yZGluYXRlSXNCbGFuayhwb2ludC5sYXRpdHVkZSkgJiYgZGRDb29yZGluYXRlSXNCbGFuayhwb2ludC5sb25naXR1ZGUpXG4gIClcbn1cblxuLy8gQHRzLWV4cGVjdC1lcnJvciB0cy1taWdyYXRlKDcwMzApIEZJWE1FOiBOb3QgYWxsIGNvZGUgcGF0aHMgcmV0dXJuIGEgdmFsdWUuXG5mdW5jdGlvbiBpbnB1dElzQmxhbmsoZGQ6IGFueSkge1xuICBzd2l0Y2ggKGRkLnNoYXBlKSB7XG4gICAgY2FzZSAncG9pbnQnOlxuICAgICAgcmV0dXJuIGRkUG9pbnRJc0JsYW5rKGRkLnBvaW50KVxuICAgIGNhc2UgJ2NpcmNsZSc6XG4gICAgICByZXR1cm4gZGRQb2ludElzQmxhbmsoZGQuY2lyY2xlLnBvaW50KVxuICAgIGNhc2UgJ2xpbmUnOlxuICAgICAgcmV0dXJuIGRkLmxpbmUubGlzdC5sZW5ndGggPT09IDBcbiAgICBjYXNlICdwb2x5Z29uJzpcbiAgICAgIHJldHVybiBkZC5wb2x5Z29uLmxpc3QubGVuZ3RoID09PSAwXG4gICAgY2FzZSAnYm91bmRpbmdib3gnOlxuICAgICAgcmV0dXJuIChcbiAgICAgICAgZGRDb29yZGluYXRlSXNCbGFuayhkZC5ib3VuZGluZ2JveC5ub3J0aCkgJiZcbiAgICAgICAgZGRDb29yZGluYXRlSXNCbGFuayhkZC5ib3VuZGluZ2JveC5zb3V0aCkgJiZcbiAgICAgICAgZGRDb29yZGluYXRlSXNCbGFuayhkZC5ib3VuZGluZ2JveC5lYXN0KSAmJlxuICAgICAgICBkZENvb3JkaW5hdGVJc0JsYW5rKGRkLmJvdW5kaW5nYm94Lndlc3QpXG4gICAgICApXG4gIH1cbn1cblxuLypcbiAqICBEZWNpbWFsIGRlZ3JlZXMgLT4gV0tUIGNvbnZlcnNpb24gdXRpbHNcbiAqL1xuZnVuY3Rpb24gZGRQb2ludFRvV2t0KHBvaW50OiBhbnkpIHtcbiAgcmV0dXJuIG5ldyB3a3guUG9pbnQocG9pbnQubG9uZ2l0dWRlLCBwb2ludC5sYXRpdHVkZSlcbn1cblxuZnVuY3Rpb24gZGRUb1drdChkZDogYW55KSB7XG4gIGlmIChpbnB1dElzQmxhbmsoZGQpKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIGxldCB3a3QgPSBudWxsXG4gIGNvbnN0IHBvaW50czogYW55ID0gW11cbiAgc3dpdGNoIChkZC5zaGFwZSkge1xuICAgIGNhc2UgJ3BvaW50JzpcbiAgICAgIHdrdCA9IGRkUG9pbnRUb1drdChkZC5wb2ludCkudG9Xa3QoKVxuICAgICAgYnJlYWtcbiAgICBjYXNlICdjaXJjbGUnOlxuICAgICAgaWYgKFxuICAgICAgICAhaXNOYU4oZGQuY2lyY2xlLnBvaW50LmxhdGl0dWRlKSAmJlxuICAgICAgICAhaXNOYU4oZGQuY2lyY2xlLnBvaW50LmxvbmdpdHVkZSkgJiZcbiAgICAgICAgZGQuY2lyY2xlLnJhZGl1cyA+IDBcbiAgICAgICkge1xuICAgICAgICBjb25zdCBkaXN0YW5jZSA9IHRvS2lsb21ldGVycyhkZC5jaXJjbGUucmFkaXVzLCBkZC5jaXJjbGUudW5pdHMpXG4gICAgICAgIHdrdCA9IGNvbXB1dGVDaXJjbGUoXG4gICAgICAgICAgZGRQb2ludFRvV2t0KGRkLmNpcmNsZS5wb2ludCksXG4gICAgICAgICAgZGlzdGFuY2UsXG4gICAgICAgICAgMzZcbiAgICAgICAgKT8udG9Xa3QoKVxuICAgICAgfVxuICAgICAgYnJlYWtcbiAgICBjYXNlICdsaW5lJzpcbiAgICAgIGlmIChkZC5saW5lLmxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICBkZC5saW5lLmxpc3QubWFwKChwb2ludDogYW55KSA9PiBwb2ludHMucHVzaChkZFBvaW50VG9Xa3QocG9pbnQpKSlcbiAgICAgICAgd2t0ID0gbmV3IHdreC5MaW5lU3RyaW5nKHBvaW50cykudG9Xa3QoKVxuICAgICAgfVxuICAgICAgYnJlYWtcbiAgICBjYXNlICdwb2x5Z29uJzpcbiAgICAgIGlmIChkZC5wb2x5Z29uLmxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICBkZC5wb2x5Z29uLmxpc3QubWFwKChwb2ludDogYW55KSA9PiBwb2ludHMucHVzaChkZFBvaW50VG9Xa3QocG9pbnQpKSlcbiAgICAgICAgY29uc3QgcDEgPSBwb2ludHNbMF1cbiAgICAgICAgY29uc3QgcDIgPSBwb2ludHNbcG9pbnRzLmxlbmd0aCAtIDFdXG4gICAgICAgIGlmIChwMS54ICE9PSBwMi54IHx8IHAxLnkgIT09IHAyLnkpIHtcbiAgICAgICAgICBwb2ludHMucHVzaChuZXcgd2t4LlBvaW50KHAxLngsIHAxLnkpKVxuICAgICAgICB9XG4gICAgICAgIHdrdCA9IG5ldyB3a3guUG9seWdvbihwb2ludHMpLnRvV2t0KClcbiAgICAgIH1cbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnYm91bmRpbmdib3gnOlxuICAgICAgY29uc3QgbncgPSBuZXcgd2t4LlBvaW50KGRkLmJvdW5kaW5nYm94Lndlc3QsIGRkLmJvdW5kaW5nYm94Lm5vcnRoKVxuICAgICAgY29uc3QgbmUgPSBuZXcgd2t4LlBvaW50KGRkLmJvdW5kaW5nYm94LmVhc3QsIGRkLmJvdW5kaW5nYm94Lm5vcnRoKVxuICAgICAgY29uc3Qgc2UgPSBuZXcgd2t4LlBvaW50KGRkLmJvdW5kaW5nYm94LmVhc3QsIGRkLmJvdW5kaW5nYm94LnNvdXRoKVxuICAgICAgY29uc3Qgc3cgPSBuZXcgd2t4LlBvaW50KGRkLmJvdW5kaW5nYm94Lndlc3QsIGRkLmJvdW5kaW5nYm94LnNvdXRoKVxuICAgICAgd2t0ID0gbmV3IHdreC5Qb2x5Z29uKFtudywgbmUsIHNlLCBzdywgbnddKS50b1drdCgpXG4gICAgICBicmVha1xuICB9XG4gIHJldHVybiB3a3Rcbn1cblxuLypcbiAqICBEZWNpbWFsIGRlZ3JlZXMgdmFsaWRhdGlvbiB1dGlsc1xuICovXG5mdW5jdGlvbiBwYXJzZURkQ29vcmRpbmF0ZShjb29yZGluYXRlOiBhbnkpIHtcbiAgaWYgKGRkUmVnZXguZXhlYyhjb29yZGluYXRlKSA9PSBudWxsKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuICBjb25zdCBfY29vcmRpbmF0ZSA9IHBhcnNlRmxvYXQoY29vcmRpbmF0ZSlcbiAgaWYgKGlzTmFOKF9jb29yZGluYXRlKSkge1xuICAgIHJldHVybiBudWxsXG4gIH1cbiAgcmV0dXJuIF9jb29yZGluYXRlXG59XG5cbmZ1bmN0aW9uIGluVmFsaWRSYW5nZShjb29yZGluYXRlOiBhbnksIG1heGltdW06IGFueSkge1xuICByZXR1cm4gY29vcmRpbmF0ZSA+PSAtMSAqIG1heGltdW0gJiYgY29vcmRpbmF0ZSA8PSBtYXhpbXVtXG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlRGRQb2ludChwb2ludDogYW55KSB7XG4gIGNvbnN0IGxhdGl0dWRlID0gcGFyc2VEZENvb3JkaW5hdGUocG9pbnQubGF0aXR1ZGUpXG4gIGNvbnN0IGxvbmdpdHVkZSA9IHBhcnNlRGRDb29yZGluYXRlKHBvaW50LmxvbmdpdHVkZSlcbiAgaWYgKGxhdGl0dWRlICYmIGxvbmdpdHVkZSkge1xuICAgIHJldHVybiBpblZhbGlkUmFuZ2UobGF0aXR1ZGUsIDkwKSAmJiBpblZhbGlkUmFuZ2UobG9uZ2l0dWRlLCAxODApXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlRGRCb3VuZGluZ0JveChib3VuZGluZ2JveDogYW55KSB7XG4gIGNvbnN0IG5vcnRoID0gcGFyc2VEZENvb3JkaW5hdGUoYm91bmRpbmdib3gubm9ydGgpXG4gIGNvbnN0IHNvdXRoID0gcGFyc2VEZENvb3JkaW5hdGUoYm91bmRpbmdib3guc291dGgpXG4gIGNvbnN0IGVhc3QgPSBwYXJzZURkQ29vcmRpbmF0ZShib3VuZGluZ2JveC5lYXN0KVxuICBjb25zdCB3ZXN0ID0gcGFyc2VEZENvb3JkaW5hdGUoYm91bmRpbmdib3gud2VzdClcblxuICBpZiAobm9ydGggPT0gbnVsbCB8fCBzb3V0aCA9PSBudWxsIHx8IGVhc3QgPT0gbnVsbCB8fCB3ZXN0ID09IG51bGwpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIGlmIChcbiAgICAhaW5WYWxpZFJhbmdlKG5vcnRoLCA5MCkgfHxcbiAgICAhaW5WYWxpZFJhbmdlKHNvdXRoLCA5MCkgfHxcbiAgICAhaW5WYWxpZFJhbmdlKGVhc3QsIDE4MCkgfHxcbiAgICAhaW5WYWxpZFJhbmdlKHdlc3QsIDE4MClcbiAgKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICBpZiAobm9ydGggPCBzb3V0aCB8fCBlYXN0IDwgd2VzdCkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgaWYgKG5vcnRoIC0gc291dGggPCBtaW5pbXVtRGlmZmVyZW5jZSB8fCBlYXN0IC0gd2VzdCA8IG1pbmltdW1EaWZmZXJlbmNlKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICByZXR1cm4gdHJ1ZVxufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZURkKGRkOiBhbnkpIHtcbiAgaWYgKGlucHV0SXNCbGFuayhkZCkpIHtcbiAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSwgZXJyb3I6IG51bGwgfVxuICB9XG5cbiAgbGV0IHZhbGlkID0gdHJ1ZVxuICBsZXQgZXJyb3IgPSBudWxsXG4gIHN3aXRjaCAoZGQuc2hhcGUpIHtcbiAgICBjYXNlICdwb2ludCc6XG4gICAgICBpZiAoIXZhbGlkYXRlRGRQb2ludChkZC5wb2ludCkpIHtcbiAgICAgICAgdmFsaWQgPSBmYWxzZVxuICAgICAgICBlcnJvciA9IGVycm9yTWVzc2FnZXMuaW52YWxpZENvb3JkaW5hdGVzXG4gICAgICB9XG4gICAgICBicmVha1xuICAgIGNhc2UgJ2NpcmNsZSc6XG4gICAgICBjb25zdCByYWRpdXMgPSBwYXJzZUZsb2F0KGRkLmNpcmNsZS5yYWRpdXMpXG4gICAgICBpZiAoXG4gICAgICAgIGlzTmFOKHJhZGl1cykgfHxcbiAgICAgICAgcmFkaXVzIDw9IDAgfHxcbiAgICAgICAgdG9LaWxvbWV0ZXJzKHJhZGl1cywgZGQuY2lyY2xlLnVuaXRzKSA+IDEwMDAwXG4gICAgICApIHtcbiAgICAgICAgdmFsaWQgPSBmYWxzZVxuICAgICAgICBlcnJvciA9IGVycm9yTWVzc2FnZXMuaW52YWxpZFJhZGl1c1xuICAgICAgfSBlbHNlIGlmICghdmFsaWRhdGVEZFBvaW50KGRkLmNpcmNsZS5wb2ludCkpIHtcbiAgICAgICAgdmFsaWQgPSBmYWxzZVxuICAgICAgICBlcnJvciA9IGVycm9yTWVzc2FnZXMuaW52YWxpZENvb3JkaW5hdGVzXG4gICAgICB9XG4gICAgICBicmVha1xuICAgIGNhc2UgJ2xpbmUnOlxuICAgICAgaWYgKCFkZC5saW5lLmxpc3QuZXZlcnkodmFsaWRhdGVEZFBvaW50KSkge1xuICAgICAgICB2YWxpZCA9IGZhbHNlXG4gICAgICAgIGVycm9yID0gZXJyb3JNZXNzYWdlcy5pbnZhbGlkTGlzdFxuICAgICAgfSBlbHNlIGlmIChkZC5saW5lLmxpc3QubGVuZ3RoIDwgMikge1xuICAgICAgICB2YWxpZCA9IGZhbHNlXG4gICAgICAgIGVycm9yID0gZXJyb3JNZXNzYWdlcy50b29GZXdQb2ludHNMaW5lXG4gICAgICB9XG4gICAgICBicmVha1xuICAgIGNhc2UgJ3BvbHlnb24nOlxuICAgICAgaWYgKCFkZC5wb2x5Z29uLmxpc3QuZXZlcnkodmFsaWRhdGVEZFBvaW50KSkge1xuICAgICAgICB2YWxpZCA9IGZhbHNlXG4gICAgICAgIGVycm9yID0gZXJyb3JNZXNzYWdlcy5pbnZhbGlkTGlzdFxuICAgICAgfSBlbHNlIGlmIChkZC5wb2x5Z29uLmxpc3QubGVuZ3RoIDwgMykge1xuICAgICAgICB2YWxpZCA9IGZhbHNlXG4gICAgICAgIGVycm9yID0gZXJyb3JNZXNzYWdlcy50b29GZXdQb2ludHNQb2x5Z29uXG4gICAgICB9XG4gICAgICBicmVha1xuICAgIGNhc2UgJ2JvdW5kaW5nYm94JzpcbiAgICAgIGlmIChcbiAgICAgICAgIXZhbGlkYXRlRGRQb2ludCh7XG4gICAgICAgICAgbGF0aXR1ZGU6IGRkLmJvdW5kaW5nYm94Lm5vcnRoLFxuICAgICAgICAgIGxvbmdpdHVkZTogZGQuYm91bmRpbmdib3guZWFzdCxcbiAgICAgICAgfSkgfHxcbiAgICAgICAgIXZhbGlkYXRlRGRQb2ludCh7XG4gICAgICAgICAgbGF0aXR1ZGU6IGRkLmJvdW5kaW5nYm94LnNvdXRoLFxuICAgICAgICAgIGxvbmdpdHVkZTogZGQuYm91bmRpbmdib3gud2VzdCxcbiAgICAgICAgfSlcbiAgICAgICkge1xuICAgICAgICB2YWxpZCA9IGZhbHNlXG4gICAgICAgIGVycm9yID0gZXJyb3JNZXNzYWdlcy5pbnZhbGlkQ29vcmRpbmF0ZXNcbiAgICAgIH0gZWxzZSBpZiAoIXZhbGlkYXRlRGRCb3VuZGluZ0JveChkZC5ib3VuZGluZ2JveCkpIHtcbiAgICAgICAgdmFsaWQgPSBmYWxzZVxuICAgICAgICBlcnJvciA9IGVycm9yTWVzc2FnZXMuaW52YWxpZEJvdW5kaW5nQm94RGRcbiAgICAgIH1cbiAgICAgIGJyZWFrXG4gIH1cbiAgcmV0dXJuIHsgdmFsaWQsIGVycm9yIH1cbn1cblxuZXhwb3J0IHsgZGRUb1drdCwgdmFsaWRhdGVEZCwgdmFsaWRhdGVEZFBvaW50IH1cbiJdfQ==