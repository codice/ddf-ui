import { __assign, __read } from "tslib";
import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import * as React from 'react';
import Button from '@mui/material/Button';
import Grid from '@mui/material/Grid';
import FilterLeaf from './filter-leaf';
import { useTheme } from '@mui/material/styles';
import { HoverButton } from '../button/hover';
import { FilterBuilderClass, FilterClass, isFilterBuilderClass, } from './filter.structure';
import TextField from '@mui/material/TextField';
import MenuItem from '@mui/material/MenuItem';
import AddIcon from '@mui/icons-material/Add';
import { Memo } from '../memo/memo';
var OperatorData = [
    {
        label: 'AND',
        value: 'AND',
    },
    {
        label: 'OR',
        value: 'OR',
    },
];
var ChildFilter = function (_a) {
    var parentFilter = _a.parentFilter, filter = _a.filter, setFilter = _a.setFilter, index = _a.index, isFirst = _a.isFirst, errorListener = _a.errorListener;
    return (_jsxs(_Fragment, { children: [!isFirst ? (_jsxs(Grid, { "data-id": "filter-settings-container", container: true, direction: "row", alignItems: "center", justifyContent: "center", wrap: "nowrap", className: "relative", children: [_jsx(Grid, { item: true, className: "p-2", children: _jsx(TextField, { "data-id": "filter-operator-select", value: parentFilter.type, onChange: function (e) {
                                var newOperator = e.target.value;
                                setFilter(new FilterBuilderClass(__assign(__assign({}, parentFilter), { type: newOperator })));
                            }, select: true, variant: "outlined", size: "small", children: OperatorData.map(function (operatorInfo) {
                                return (_jsx(MenuItem, { value: operatorInfo.value, children: operatorInfo.label }, operatorInfo.value));
                            }) }) }), _jsx(Grid, { item: true, className: "ml-auto position absolute right-0", children: _jsx(Button, { "data-id": "remove-child-filter-button", color: "primary", onClick: function () {
                                var newFilters = parentFilter.filters.slice(0);
                                newFilters.splice(index, 1);
                                setFilter(new FilterBuilderClass(__assign(__assign({}, parentFilter), { filters: newFilters })));
                            }, children: "Remove" }) })] })) : null, isFilterBuilderClass(filter) ? (_jsx(FilterBranch, { filter: filter, setFilter: function (newChildFilter) {
                    var newFilters = parentFilter.filters.slice(0);
                    newFilters.splice(index, 1, newChildFilter);
                    setFilter(new FilterBuilderClass(__assign(__assign({}, parentFilter), { filters: newFilters })));
                }, errorListener: errorListener })) : (_jsx(FilterLeaf, { filter: filter, setFilter: function (newChildFilter) {
                    var newFilters = parentFilter.filters.slice(0);
                    newFilters.splice(index, 1, newChildFilter);
                    setFilter(new FilterBuilderClass(__assign(__assign({}, parentFilter), { filters: newFilters })));
                }, errorListener: errorListener }))] }));
};
var FilterBranch = function (_a) {
    var filter = _a.filter, setFilter = _a.setFilter, _b = _a.root, root = _b === void 0 ? false : _b, errorListener = _a.errorListener;
    var _c = __read(React.useState(false), 2), hover = _c[0], setHover = _c[1];
    var theme = useTheme();
    /**
     * Any non root branches lacking filters are pruned.
     */
    React.useEffect(function () {
        filter.filters.forEach(function (childFilter, index) {
            if (isFilterBuilderClass(childFilter) &&
                childFilter.filters.length === 0) {
                var newFilters = filter.filters.slice(0);
                newFilters.splice(index, 1);
                setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { filters: newFilters })));
            }
        });
    }, [filter]);
    return (_jsx("div", { onMouseOver: function () {
            setHover(true);
        }, onMouseOut: function () {
            setHover(false);
        }, children: _jsx("div", { className: root
                ? ' shadow-none'
                : 'px-3 py-2 MuiPaper-box-shadow border-black border-2 border-opacity-30', children: _jsx("div", { className: " relative", children: _jsxs("div", { "data-id": root ? 'root-filter-group-container' : 'filter-group-container', className: "".concat(filter.negated ? 'border px-3 py-4 mt-2' : '', " transition-all duration-200"), style: {
                        borderColor: theme.palette.primary.main,
                    }, children: [_jsx(Grid, { item: true, className: "w-full filter-actions", children: _jsxs(Grid, { container: true, direction: "row", alignItems: "center", className: "w-full", children: [_jsx(Grid, { item: true, children: _jsxs(Button, { "data-id": "add-field-button", color: "primary", onClick: function () {
                                                setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { filters: filter.filters.concat([new FilterClass()]) })));
                                            }, children: [_jsx(AddIcon, { className: "Mui-text-text-primary" }), "Field"] }) }), _jsx(Grid, { item: true, children: _jsxs(Button, { "data-id": "add-group-button", color: "primary", onClick: function () {
                                                setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { filters: filter.filters.concat([
                                                        new FilterBuilderClass(),
                                                    ]) })));
                                            }, children: [_jsx(AddIcon, { className: "Mui-text-text-primary" }), "Group"] }) }), filter.filters.length !== 0 ? (_jsx(Grid, { item: true, className: "ml-auto", children: _jsx(Button, { "data-id": "remove-first-filter-button", color: "primary", onClick: function () {
                                                var newFilters = filter.filters.slice(0);
                                                newFilters.splice(0, 1);
                                                setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { filters: newFilters })));
                                            }, children: "Remove" }) })) : null] }) }), filter.negated ? (_jsx(_Fragment, { children: _jsx(HoverButton, { className: "absolute top-0 left-1/2 transform -translate-y-1/2 -translate-x-1/2 py-0 px-1 text-xs z-10", color: "primary", variant: "contained", onClick: function () {
                                    setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { negated: !filter.negated })));
                                }, children: function (_a) {
                                    var hover = _a.hover;
                                    if (hover) {
                                        return _jsx(_Fragment, { children: "Remove Not" });
                                    }
                                    else {
                                        return _jsx(_Fragment, { children: "NOT" });
                                    }
                                } }) })) : (_jsx(_Fragment, { children: _jsx(Button, { "data-id": "not-group-button", className: "".concat(hover ? 'opacity-25' : 'opacity-0', " hover:opacity-100 focus:opacity-100 transition-opacity duration-200 absolute top-0 left-1/2 transform -translate-y-1/2 -translate-x-1/2 py-0 px-1 text-xs z-10"), color: "primary", variant: "contained", onClick: function () {
                                    setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { negated: !filter.negated })));
                                }, children: "+ Not Group" }) })), _jsx(Memo, { dependencies: [filter], children: _jsx(_Fragment, { children: filter.filters.map(function (childFilter, index) {
                                    return (_jsx(ChildFilter, { parentFilter: filter, filter: childFilter, setFilter: setFilter, index: index, isFirst: index === 0, isLast: index === filter.filters.length - 1, errorListener: errorListener }, childFilter.id));
                                }) }) })] }) }) }) }));
};
export default FilterBranch;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWJyYW5jaC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3dlYmFwcC9jb21wb25lbnQvZmlsdGVyLWJ1aWxkZXIvZmlsdGVyLWJyYW5jaC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQTtBQUU5QixPQUFPLE1BQU0sTUFBTSxzQkFBc0IsQ0FBQTtBQUN6QyxPQUFPLElBQUksTUFBTSxvQkFBb0IsQ0FBQTtBQUNyQyxPQUFPLFVBQVUsTUFBTSxlQUFlLENBQUE7QUFDdEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQTtBQUM3QyxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLFdBQVcsRUFDWCxvQkFBb0IsR0FDckIsTUFBTSxvQkFBb0IsQ0FBQTtBQUMzQixPQUFPLFNBQVMsTUFBTSx5QkFBeUIsQ0FBQTtBQUMvQyxPQUFPLFFBQVEsTUFBTSx3QkFBd0IsQ0FBQTtBQUM3QyxPQUFPLE9BQU8sTUFBTSx5QkFBeUIsQ0FBQTtBQUU3QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBRW5DLElBQU0sWUFBWSxHQUFHO0lBQ25CO1FBQ0UsS0FBSyxFQUFFLEtBQUs7UUFDWixLQUFLLEVBQUUsS0FBSztLQUNiO0lBQ0Q7UUFDRSxLQUFLLEVBQUUsSUFBSTtRQUNYLEtBQUssRUFBRSxJQUFJO0tBQ1o7Q0FDRixDQUFBO0FBY0QsSUFBTSxXQUFXLEdBQUcsVUFBQyxFQU9GO1FBTmpCLFlBQVksa0JBQUEsRUFDWixNQUFNLFlBQUEsRUFDTixTQUFTLGVBQUEsRUFDVCxLQUFLLFdBQUEsRUFDTCxPQUFPLGFBQUEsRUFDUCxhQUFhLG1CQUFBO0lBRWIsT0FBTyxDQUNMLDhCQUNHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxD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QU8sRUFBQyxXQUFXLEVBQ25CLE9BQU8sRUFBRTtvQ0FDUCxTQUFTLENBQ1AsSUFBSSxrQkFBa0IsdUJBQ2pCLE1BQU0sS0FDVCxPQUFPLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxJQUN4QixDQUNILENBQUE7Z0NBQ0gsQ0FBQyw0QkFHTSxHQUNSLENBQ0osRUFDRCxLQUFDLElBQUksSUFBQyxZQUFZLEVBQUUsQ0FBQyxNQUFNLENBQUMsWUFDMUIsNEJBQ0csTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBQyxXQUFXLEVBQUUsS0FBSztvQ0FDckMsT0FBTyxDQUNMLEtBQUMsV0FBVyxJQUVWLFlBQVksRUFBRSxNQUFNLEVBQ3BCLE1BQU0sRUFBRSxXQUFXLEVBQ25CLFNBQVMsRUFBRSxTQUFTLEVBQ3BCLEtBQUssRUFBRSxLQUFLLEVBQ1osT0FBTyxFQUFFLEtBQUssS0FBSyxDQUFDLEVBQ3BCLE1BQU0sRUFBRSxLQUFLLEtBQUssTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUMzQyxhQUFhLEVBQUUsYUFBYSxJQVB2QixXQUFXLENBQUMsRUFBRSxDQVFuQixDQUNILENBQUE7Z0NBQ0gsQ0FBQyxDQUFDLEdBQ0QsR0FDRSxJQUNILEdBQ0YsR0FDRixHQUNGLENBQ1AsQ0FBQTtBQUNILENBQUMsQ0FBQTtBQUNELGVBQWUsWUFBWSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnXG5cbmltcG9ydCBCdXR0b24gZnJvbSAnQG11aS9tYXRlcmlhbC9CdXR0b24nXG5pbXBvcnQgR3JpZCBmcm9tICdAbXVpL21hdGVyaWFsL0dyaWQnXG5pbXBvcnQgRmlsdGVyTGVhZiBmcm9tICcuL2ZpbHRlci1sZWFmJ1xuaW1wb3J0IHsgdXNlVGhlbWUgfSBmcm9tICdAbXVpL21hdGVyaWFsL3N0eWxlcydcbmltcG9ydCB7IEhvdmVyQnV0dG9uIH0gZnJvbSAnLi4vYnV0dG9uL2hvdmVyJ1xuaW1wb3J0IHtcbiAgRmlsdGVyQnVpbGRlckNsYXNzLFxuICBGaWx0ZXJDbGFzcyxcbiAgaXNGaWx0ZXJCdWlsZGVyQ2xhc3MsXG59IGZyb20gJy4vZmlsdGVyLnN0cnVjdHVyZSdcbmltcG9ydCBUZXh0RmllbGQgZnJvbSAnQG11aS9tYXRlcmlhbC9UZXh0RmllbGQnXG5pbXBvcnQgTWVudUl0ZW0gZnJvbSAnQG11aS9tYXRlcmlhbC9NZW51SXRlbSdcbmltcG9ydCBBZGRJY29uIGZyb20gJ0BtdWkvaWNvbnMtbWF0ZXJpYWwvQWRkJ1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJ1xuaW1wb3J0IHsgTWVtbyB9IGZyb20gJy4uL21lbW8vbWVtbydcbmltcG9ydCB7IFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICcuLi8uLi9yZWFjdC1jb21wb25lbnQvbG9jYXRpb24vdmFsaWRhdG9ycydcbmNvbnN0IE9wZXJhdG9yRGF0YSA9IFtcbiAge1xuICAgIGxhYmVsOiAnQU5EJyxcbiAgICB2YWx1ZTogJ0FORCcsXG4gIH0sXG4gIHtcbiAgICBsYWJlbDogJ09SJyxcbiAgICB2YWx1ZTogJ09SJyxcbiAgfSxcbl1cblxudHlwZSBDaGlsZEZpbHRlclByb3BzID0ge1xuICBwYXJlbnRGaWx0ZXI6IEZpbHRlckJ1aWxkZXJDbGFzc1xuICBmaWx0ZXI6IEZpbHRlckJ1aWxkZXJDbGFzcyB8IEZpbHRlckNsYXNzXG4gIHNldEZpbHRlcjogKGZpbHRlcjogRmlsdGVyQnVpbGRlckNsYXNzKSA9PiB2b2lkXG4gIGluZGV4OiBudW1iZXJcbiAgaXNGaXJzdDogYm9vbGVhblxuICBpc0xhc3Q6IGJvb2xlYW5cbiAgZXJyb3JMaXN0ZW5lcj86ICh2YWxpZGF0aW9uUmVzdWx0czoge1xuICAgIFtrZXk6IHN0cmluZ106IFZhbGlkYXRpb25SZXN1bHQgfCB1bmRlZmluZWRcbiAgfSkgPT4gdm9pZFxufVxuXG5jb25zdCBDaGlsZEZpbHRlciA9ICh7XG4gIHBhcmVudEZpbHRlcixcbiAgZmlsdGVyLFxuICBzZXRGaWx0ZXIsXG4gIGluZGV4LFxuICBpc0ZpcnN0LFxuICBlcnJvckxpc3RlbmVyLFxufTogQ2hpbGRGaWx0ZXJQcm9wcykgPT4ge1xuICByZXR1cm4gKFxuICAgIDw+XG4gICAgICB7IWlzRmlyc3QgPyAoXG4gICAgICAgIDxHcmlkXG4gICAgICAgICAgZGF0YS1pZD17YGZpbHRlci1zZXR0aW5ncy1jb250YWluZXJgfVxuICAgICAgICAgIGNvbnRhaW5lclxuICAgICAgICAgIGRpcmVjdGlvbj1cInJvd1wiXG4gICAgICAgICAgYWxpZ25JdGVtcz1cImNlbnRlclwiXG4gICAgICAgICAganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIlxuICAgICAgICAgIHdyYXA9XCJub3dyYXBcIlxuICAgICAgICAgIGNsYXNzTmFtZT1cInJlbGF0aXZlXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxHcmlkIGl0ZW0gY2xhc3NOYW1lPVwicC0yXCI+XG4gICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgIGRhdGEtaWQ9XCJmaWx0ZXItb3BlcmF0b3Itc2VsZWN0XCJcbiAgICAgICAgICAgICAgdmFsdWU9e3BhcmVudEZpbHRlci50eXBlfVxuICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdPcGVyYXRvciA9IGUudGFyZ2V0LnZhbHVlIGFzIEZpbHRlckJ1aWxkZXJDbGFzc1sndHlwZSddXG4gICAgICAgICAgICAgICAgc2V0RmlsdGVyKFxuICAgICAgICAgICAgICAgICAgbmV3IEZpbHRlckJ1aWxkZXJDbGFzcyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnBhcmVudEZpbHRlcixcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogbmV3T3BlcmF0b3IsXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgc2VsZWN0XG4gICAgICAgICAgICAgIHZhcmlhbnQ9XCJvdXRsaW5lZFwiXG4gICAgICAgICAgICAgIHNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtPcGVyYXRvckRhdGEubWFwKChvcGVyYXRvckluZm8pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgPE1lbnVJdGVtIGtleT17b3BlcmF0b3JJbmZvLnZhbHVlfSB2YWx1ZT17b3BlcmF0b3JJbmZvLnZhbHVlfT5cbiAgICAgICAgICAgICAgICAgICAge29wZXJhdG9ySW5mby5sYWJlbH1cbiAgICAgICAgICAgICAgICAgIDwvTWVudUl0ZW0+XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgIDwvVGV4dEZpZWxkPlxuICAgICAgICAgIDwvR3JpZD5cbiAgICAgICAgICA8R3JpZCBpdGVtIGNsYXNzTmFtZT1cIm1sLWF1dG8gcG9zaXRpb24gYWJzb2x1dGUgcmlnaHQtMFwiPlxuICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICBkYXRhLWlkPVwicmVtb3ZlLWNoaWxkLWZpbHRlci1idXR0b25cIlxuICAgICAgICAgICAgICBjb2xvcj1cInByaW1hcnlcIlxuICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3RmlsdGVycyA9IHBhcmVudEZpbHRlci5maWx0ZXJzLnNsaWNlKDApXG4gICAgICAgICAgICAgICAgbmV3RmlsdGVycy5zcGxpY2UoaW5kZXgsIDEpXG4gICAgICAgICAgICAgICAgc2V0RmlsdGVyKFxuICAgICAgICAgICAgICAgICAgbmV3IEZpbHRlckJ1aWxkZXJDbGFzcyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnBhcmVudEZpbHRlcixcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyczogbmV3RmlsdGVycyxcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBSZW1vdmVcbiAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgIDwvR3JpZD5cbiAgICAgICAgPC9HcmlkPlxuICAgICAgKSA6IG51bGx9XG4gICAgICB7aXNGaWx0ZXJCdWlsZGVyQ2xhc3MoZmlsdGVyKSA/IChcbiAgICAgICAgPEZpbHRlckJyYW5jaFxuICAgICAgICAgIGZpbHRlcj17ZmlsdGVyfVxuICAgICAgICAgIHNldEZpbHRlcj17KG5ld0NoaWxkRmlsdGVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuZXdGaWx0ZXJzID0gcGFyZW50RmlsdGVyLmZpbHRlcnMuc2xpY2UoMClcbiAgICAgICAgICAgIG5ld0ZpbHRlcnMuc3BsaWNlKGluZGV4LCAxLCBuZXdDaGlsZEZpbHRlcilcbiAgICAgICAgICAgIHNldEZpbHRlcihcbiAgICAgICAgICAgICAgbmV3IEZpbHRlckJ1aWxkZXJDbGFzcyh7XG4gICAgICAgICAgICAgICAgLi4ucGFyZW50RmlsdGVyLFxuICAgICAgICAgICAgICAgIGZpbHRlcnM6IG5ld0ZpbHRlcnMsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgfX1cbiAgICAgICAgICBlcnJvckxpc3RlbmVyPXtlcnJvckxpc3RlbmVyfVxuICAgICAgICAvPlxuICAgICAgKSA6IChcbiAgICAgICAgPEZpbHRlckxlYWZcbiAgICAgICAgICBmaWx0ZXI9e2ZpbHRlcn1cbiAgICAgICAgICBzZXRGaWx0ZXI9eyhuZXdDaGlsZEZpbHRlcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgbmV3RmlsdGVycyA9IHBhcmVudEZpbHRlci5maWx0ZXJzLnNsaWNlKDApXG4gICAgICAgICAgICBuZXdGaWx0ZXJzLnNwbGljZShpbmRleCwgMSwgbmV3Q2hpbGRGaWx0ZXIpXG4gICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgIG5ldyBGaWx0ZXJCdWlsZGVyQ2xhc3Moe1xuICAgICAgICAgICAgICAgIC4uLnBhcmVudEZpbHRlcixcbiAgICAgICAgICAgICAgICBmaWx0ZXJzOiBuZXdGaWx0ZXJzLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgIH19XG4gICAgICAgICAgZXJyb3JMaXN0ZW5lcj17ZXJyb3JMaXN0ZW5lcn1cbiAgICAgICAgLz5cbiAgICAgICl9XG4gICAgPC8+XG4gIClcbn1cblxudHlwZSBQcm9wcyA9IHtcbiAgZmlsdGVyOiBGaWx0ZXJCdWlsZGVyQ2xhc3NcbiAgc2V0RmlsdGVyOiAoZmlsdGVyOiBGaWx0ZXJCdWlsZGVyQ2xhc3MpID0+IHZvaWRcbiAgcm9vdD86IGJvb2xlYW5cbiAgZXJyb3JMaXN0ZW5lcj86ICh2YWxpZGF0aW9uUmVzdWx0czoge1xuICAgIFtrZXk6IHN0cmluZ106IFZhbGlkYXRpb25SZXN1bHQgfCB1bmRlZmluZWRcbiAgfSkgPT4gdm9pZFxufVxuXG5jb25zdCBGaWx0ZXJCcmFuY2ggPSAoe1xuICBmaWx0ZXIsXG4gIHNldEZpbHRlcixcbiAgcm9vdCA9IGZhbHNlLFxuICBlcnJvckxpc3RlbmVyLFxufTogUHJvcHMpID0+IHtcbiAgY29uc3QgW2hvdmVyLCBzZXRIb3Zlcl0gPSBSZWFjdC51c2VTdGF0ZShmYWxzZSlcbiAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpXG5cbiAgLyoqXG4gICAqIEFueSBub24gcm9vdCBicmFuY2hlcyBsYWNraW5nIGZpbHRlcnMgYXJlIHBydW5lZC5cbiAgICovXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZmlsdGVyLmZpbHRlcnMuZm9yRWFjaCgoY2hpbGRGaWx0ZXIsIGluZGV4KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGlzRmlsdGVyQnVpbGRlckNsYXNzKGNoaWxkRmlsdGVyKSAmJlxuICAgICAgICBjaGlsZEZpbHRlci5maWx0ZXJzLmxlbmd0aCA9PT0gMFxuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IG5ld0ZpbHRlcnMgPSBmaWx0ZXIuZmlsdGVycy5zbGljZSgwKVxuICAgICAgICBuZXdGaWx0ZXJzLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgc2V0RmlsdGVyKFxuICAgICAgICAgIG5ldyBGaWx0ZXJCdWlsZGVyQ2xhc3Moe1xuICAgICAgICAgICAgLi4uZmlsdGVyLFxuICAgICAgICAgICAgZmlsdGVyczogbmV3RmlsdGVycyxcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICB9XG4gICAgfSlcbiAgfSwgW2ZpbHRlcl0pXG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBvbk1vdXNlT3Zlcj17KCkgPT4ge1xuICAgICAgICBzZXRIb3Zlcih0cnVlKVxuICAgICAgfX1cbiAgICAgIG9uTW91c2VPdXQ9eygpID0+IHtcbiAgICAgICAgc2V0SG92ZXIoZmFsc2UpXG4gICAgICB9fVxuICAgID5cbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3NOYW1lPXtcbiAgICAgICAgICByb290XG4gICAgICAgICAgICA/ICcgc2hhZG93LW5vbmUnXG4gICAgICAgICAgICA6ICdweC0zIHB5LTIgTXVpUGFwZXItYm94LXNoYWRvdyBib3JkZXItYmxhY2sgYm9yZGVyLTIgYm9yZGVyLW9wYWNpdHktMzAnXG4gICAgICAgIH1cbiAgICAgID5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCIgcmVsYXRpdmVcIj5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBkYXRhLWlkPXtcbiAgICAgICAgICAgICAgcm9vdCA/ICdyb290LWZpbHRlci1ncm91cC1jb250YWluZXInIDogJ2ZpbHRlci1ncm91cC1jb250YWluZXInXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2Ake1xuICAgICAgICAgICAgICBmaWx0ZXIubmVnYXRlZCA/ICdib3JkZXIgcHgtMyBweS00IG10LTInIDogJydcbiAgICAgICAgICAgIH0gdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tMjAwYH1cbiAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgIGJvcmRlckNvbG9yOiB0aGVtZS5wYWxldHRlLnByaW1hcnkubWFpbixcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgPlxuICAgICAgICAgICAgPEdyaWQgaXRlbSBjbGFzc05hbWU9XCJ3LWZ1bGwgZmlsdGVyLWFjdGlvbnNcIj5cbiAgICAgICAgICAgICAgPEdyaWRcbiAgICAgICAgICAgICAgICBjb250YWluZXJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb249XCJyb3dcIlxuICAgICAgICAgICAgICAgIGFsaWduSXRlbXM9XCJjZW50ZXJcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cInctZnVsbFwiXG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8R3JpZCBpdGVtPlxuICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBkYXRhLWlkPVwiYWRkLWZpZWxkLWJ1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgRmlsdGVyQnVpbGRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZmlsdGVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBmaWx0ZXIuZmlsdGVycy5jb25jYXQoW25ldyBGaWx0ZXJDbGFzcygpXSksXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPEFkZEljb24gY2xhc3NOYW1lPVwiTXVpLXRleHQtdGV4dC1wcmltYXJ5XCIgLz5cbiAgICAgICAgICAgICAgICAgICAgRmllbGRcbiAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgIDwvR3JpZD5cbiAgICAgICAgICAgICAgICA8R3JpZCBpdGVtPlxuICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBkYXRhLWlkPVwiYWRkLWdyb3VwLWJ1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgRmlsdGVyQnVpbGRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZmlsdGVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBmaWx0ZXIuZmlsdGVycy5jb25jYXQoW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGaWx0ZXJCdWlsZGVyQ2xhc3MoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPEFkZEljb24gY2xhc3NOYW1lPVwiTXVpLXRleHQtdGV4dC1wcmltYXJ5XCIgLz5cbiAgICAgICAgICAgICAgICAgICAgR3JvdXBcbiAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgIDwvR3JpZD5cbiAgICAgICAgICAgICAgICB7ZmlsdGVyLmZpbHRlcnMubGVuZ3RoICE9PSAwID8gKFxuICAgICAgICAgICAgICAgICAgPEdyaWQgaXRlbSBjbGFzc05hbWU9XCJtbC1hdXRvXCI+XG4gICAgICAgICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICBkYXRhLWlkPVwicmVtb3ZlLWZpcnN0LWZpbHRlci1idXR0b25cIlxuICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3RmlsdGVycyA9IGZpbHRlci5maWx0ZXJzLnNsaWNlKDApXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdGaWx0ZXJzLnNwbGljZSgwLCAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0RmlsdGVyKFxuICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgRmlsdGVyQnVpbGRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyczogbmV3RmlsdGVycyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgUmVtb3ZlXG4gICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgPC9HcmlkPlxuICAgICAgICAgICAgICAgICkgOiBudWxsfVxuICAgICAgICAgICAgICA8L0dyaWQ+XG4gICAgICAgICAgICA8L0dyaWQ+XG4gICAgICAgICAgICB7ZmlsdGVyLm5lZ2F0ZWQgPyAoXG4gICAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgPEhvdmVyQnV0dG9uXG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2BhYnNvbHV0ZSB0b3AtMCBsZWZ0LTEvMiB0cmFuc2Zvcm0gLXRyYW5zbGF0ZS15LTEvMiAtdHJhbnNsYXRlLXgtMS8yIHB5LTAgcHgtMSB0ZXh0LXhzIHotMTBgfVxuICAgICAgICAgICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9XCJjb250YWluZWRcIlxuICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgbmV3IEZpbHRlckJ1aWxkZXJDbGFzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZWdhdGVkOiAhZmlsdGVyLm5lZ2F0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICB7KHsgaG92ZXIgfSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaG92ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gPD5SZW1vdmUgTm90PC8+XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDw+Tk9UPC8+XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgPC9Ib3ZlckJ1dHRvbj5cbiAgICAgICAgICAgICAgPC8+XG4gICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICAgIGRhdGEtaWQ9XCJub3QtZ3JvdXAtYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7XG4gICAgICAgICAgICAgICAgICAgIGhvdmVyID8gJ29wYWNpdHktMjUnIDogJ29wYWNpdHktMCdcbiAgICAgICAgICAgICAgICAgIH0gaG92ZXI6b3BhY2l0eS0xMDAgZm9jdXM6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IGR1cmF0aW9uLTIwMCBhYnNvbHV0ZSB0b3AtMCBsZWZ0LTEvMiB0cmFuc2Zvcm0gLXRyYW5zbGF0ZS15LTEvMiAtdHJhbnNsYXRlLXgtMS8yIHB5LTAgcHgtMSB0ZXh0LXhzIHotMTBgfVxuICAgICAgICAgICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9XCJjb250YWluZWRcIlxuICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgbmV3IEZpbHRlckJ1aWxkZXJDbGFzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZWdhdGVkOiAhZmlsdGVyLm5lZ2F0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICArIE5vdCBHcm91cFxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICA8TWVtbyBkZXBlbmRlbmNpZXM9e1tmaWx0ZXJdfT5cbiAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICB7ZmlsdGVyLmZpbHRlcnMubWFwKChjaGlsZEZpbHRlciwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIDxDaGlsZEZpbHRlclxuICAgICAgICAgICAgICAgICAgICAgIGtleT17Y2hpbGRGaWx0ZXIuaWR9XG4gICAgICAgICAgICAgICAgICAgICAgcGFyZW50RmlsdGVyPXtmaWx0ZXJ9XG4gICAgICAgICAgICAgICAgICAgICAgZmlsdGVyPXtjaGlsZEZpbHRlcn1cbiAgICAgICAgICAgICAgICAgICAgICBzZXRGaWx0ZXI9e3NldEZpbHRlcn1cbiAgICAgICAgICAgICAgICAgICAgICBpbmRleD17aW5kZXh9XG4gICAgICAgICAgICAgICAgICAgICAgaXNGaXJzdD17aW5kZXggPT09IDB9XG4gICAgICAgICAgICAgICAgICAgICAgaXNMYXN0PXtpbmRleCA9PT0gZmlsdGVyLmZpbHRlcnMubGVuZ3RoIC0gMX1cbiAgICAgICAgICAgICAgICAgICAgICBlcnJvckxpc3RlbmVyPXtlcnJvckxpc3RlbmVyfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgIDwvTWVtbz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKVxufVxuZXhwb3J0IGRlZmF1bHQgRmlsdGVyQnJhbmNoXG4iXX0=