import { __assign, __read } from "tslib";
import * as React from 'react';
import { hot } from 'react-hot-loader';
import Button from '@mui/material/Button';
import Grid from '@mui/material/Grid';
import FilterLeaf from './filter-leaf';
import { useTheme } from '@mui/material/styles';
import { HoverButton } from '../button/hover';
import { FilterBuilderClass, FilterClass, isFilterBuilderClass, } from './filter.structure';
import TextField from '@mui/material/TextField';
import MenuItem from '@mui/material/MenuItem';
import AddIcon from '@mui/icons-material/Add';
import { Memo } from '../memo/memo';
var OperatorData = [
    {
        label: 'AND',
        value: 'AND',
    },
    {
        label: 'OR',
        value: 'OR',
    },
];
var ChildFilter = function (_a) {
    var parentFilter = _a.parentFilter, filter = _a.filter, setFilter = _a.setFilter, index = _a.index, isFirst = _a.isFirst, errorListener = _a.errorListener;
    return (React.createElement(React.Fragment, null,
        !isFirst ? (React.createElement(Grid, { "data-id": "filter-settings-container", container: true, direction: "row", alignItems: "center", justifyContent: "center", wrap: "nowrap", className: "relative" },
            React.createElement(Grid, { item: true, className: "p-2" },
                React.createElement(TextField, { "data-id": "filter-operator-select", value: parentFilter.type, onChange: function (e) {
                        var newOperator = e.target.value;
                        setFilter(new FilterBuilderClass(__assign(__assign({}, parentFilter), { type: newOperator })));
                    }, select: true, variant: "outlined", size: "small" }, OperatorData.map(function (operatorInfo) {
                    return (React.createElement(MenuItem, { key: operatorInfo.value, value: operatorInfo.value }, operatorInfo.label));
                }))),
            React.createElement(Grid, { item: true, className: "ml-auto position absolute right-0" },
                React.createElement(Button, { "data-id": "remove-child-filter-button", color: "primary", onClick: function () {
                        var newFilters = parentFilter.filters.slice(0);
                        newFilters.splice(index, 1);
                        setFilter(new FilterBuilderClass(__assign(__assign({}, parentFilter), { filters: newFilters })));
                    } }, "Remove")))) : null,
        isFilterBuilderClass(filter) ? (React.createElement(FilterBranch, { filter: filter, setFilter: function (newChildFilter) {
                var newFilters = parentFilter.filters.slice(0);
                newFilters.splice(index, 1, newChildFilter);
                setFilter(new FilterBuilderClass(__assign(__assign({}, parentFilter), { filters: newFilters })));
            }, errorListener: errorListener })) : (React.createElement(FilterLeaf, { filter: filter, setFilter: function (newChildFilter) {
                var newFilters = parentFilter.filters.slice(0);
                newFilters.splice(index, 1, newChildFilter);
                setFilter(new FilterBuilderClass(__assign(__assign({}, parentFilter), { filters: newFilters })));
            }, errorListener: errorListener }))));
};
var FilterBranch = function (_a) {
    var filter = _a.filter, setFilter = _a.setFilter, _b = _a.root, root = _b === void 0 ? false : _b, errorListener = _a.errorListener;
    var _c = __read(React.useState(false), 2), hover = _c[0], setHover = _c[1];
    var theme = useTheme();
    /**
     * Any non root branches lacking filters are pruned.
     */
    React.useEffect(function () {
        filter.filters.forEach(function (childFilter, index) {
            if (isFilterBuilderClass(childFilter) &&
                childFilter.filters.length === 0) {
                var newFilters = filter.filters.slice(0);
                newFilters.splice(index, 1);
                setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { filters: newFilters })));
            }
        });
    }, [filter]);
    return (React.createElement("div", { onMouseOver: function () {
            setHover(true);
        }, onMouseOut: function () {
            setHover(false);
        } },
        React.createElement("div", { className: root
                ? ' shadow-none'
                : 'px-3 py-2 MuiPaper-box-shadow border-black border-2 border-opacity-30' },
            React.createElement("div", { className: " relative" },
                React.createElement("div", { "data-id": root ? 'root-filter-group-container' : 'filter-group-container', className: "".concat(filter.negated ? 'border px-3 py-4 mt-2' : '', " transition-all duration-200"), style: {
                        borderColor: theme.palette.primary.main,
                    } },
                    React.createElement(Grid, { item: true, className: "w-full filter-actions" },
                        React.createElement(Grid, { container: true, direction: "row", alignItems: "center", className: "w-full" },
                            React.createElement(Grid, { item: true },
                                React.createElement(Button, { "data-id": "add-field-button", color: "primary", onClick: function () {
                                        setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { filters: filter.filters.concat([new FilterClass()]) })));
                                    } },
                                    React.createElement(AddIcon, { className: "Mui-text-text-primary" }),
                                    "Field")),
                            React.createElement(Grid, { item: true },
                                React.createElement(Button, { "data-id": "add-group-button", color: "primary", onClick: function () {
                                        setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { filters: filter.filters.concat([
                                                new FilterBuilderClass(),
                                            ]) })));
                                    } },
                                    React.createElement(AddIcon, { className: "Mui-text-text-primary" }),
                                    "Group")),
                            filter.filters.length !== 0 ? (React.createElement(Grid, { item: true, className: "ml-auto" },
                                React.createElement(Button, { "data-id": "remove-first-filter-button", color: "primary", onClick: function () {
                                        var newFilters = filter.filters.slice(0);
                                        newFilters.splice(0, 1);
                                        setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { filters: newFilters })));
                                    } }, "Remove"))) : null)),
                    filter.negated ? (React.createElement(React.Fragment, null,
                        React.createElement(HoverButton, { className: "absolute top-0 left-1/2 transform -translate-y-1/2 -translate-x-1/2 py-0 px-1 text-xs z-10", color: "primary", variant: "contained", onClick: function () {
                                setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { negated: !filter.negated })));
                            } }, function (_a) {
                            var hover = _a.hover;
                            if (hover) {
                                return React.createElement(React.Fragment, null, "Remove Not");
                            }
                            else {
                                return React.createElement(React.Fragment, null, "NOT");
                            }
                        }))) : (React.createElement(React.Fragment, null,
                        React.createElement(Button, { "data-id": "not-group-button", className: "".concat(hover ? 'opacity-25' : 'opacity-0', " hover:opacity-100 focus:opacity-100 transition-opacity duration-200 absolute top-0 left-1/2 transform -translate-y-1/2 -translate-x-1/2 py-0 px-1 text-xs z-10"), color: "primary", variant: "contained", onClick: function () {
                                setFilter(new FilterBuilderClass(__assign(__assign({}, filter), { negated: !filter.negated })));
                            } }, "+ Not Group"))),
                    React.createElement(Memo, { dependencies: [filter] },
                        React.createElement(React.Fragment, null, filter.filters.map(function (childFilter, index) {
                            return (React.createElement(ChildFilter, { key: childFilter.id, parentFilter: filter, filter: childFilter, setFilter: setFilter, index: index, isFirst: index === 0, isLast: index === filter.filters.length - 1, errorListener: errorListener }));
                        }))))))));
};
export default hot(module)(FilterBranch);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWJyYW5jaC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3dlYmFwcC9jb21wb25lbnQvZmlsdGVyLWJ1aWxkZXIvZmlsdGVyLWJyYW5jaC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQzlCLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUN0QyxPQUFPLE1BQU0sTUFBTSxzQkFBc0IsQ0FBQTtBQUN6QyxPQUFPLElBQUksTUFBTSxvQkFBb0IsQ0FBQTtBQUNyQyxPQUFPLFVBQVUsTUFBTSxlQUFlLENBQUE7QUFDdEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQTtBQUM3QyxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLFdBQVcsRUFDWCxvQkFBb0IsR0FDckIsTUFBTSxvQkFBb0IsQ0FBQTtBQUMzQixPQUFPLFNBQVMsTUFBTSx5QkFBeUIsQ0FBQTtBQUMvQyxPQUFPLFFBQVEsTUFBTSx3QkFBd0IsQ0FBQTtBQUM3QyxPQUFPLE9BQU8sTUFBTSx5QkFBeUIsQ0FBQTtBQUU3QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBRW5DLElBQU0sWUFBWSxHQUFHO0lBQ25CO1FBQ0UsS0FBSyxFQUFFLEtBQUs7UUFDWixLQUFLLEVBQUUsS0FBSztLQUNiO0lBQ0Q7UUFDRSxLQUFLLEVBQUUsSUFBSTtRQUNYLEtBQUssRUFBRSxJQUFJO0tBQ1o7Q0FDRixDQUFBO0FBY0QsSUFBTSxXQUFXLEdBQUcsVUFBQyxFQU9GO1FBTmpCLFlBQVksa0JBQUEsRUFDWixNQUFNLFlBQUEsRUFDTixTQUFTLGVBQUEsRUFDVCxLQUFLLFdBQUEsRUFDTCxPQUFPLGFBQUEsRUFDUCxhQUFhLG1CQUFBO0lBRWIs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QyxDQUFDLENBQUMsV0FBVyxvS0FDNkgsRUFDakssS0FBSyxFQUFDLFNBQVMsRUFDZixPQUFPLEVBQUMsV0FBVyxFQUNuQixPQUFPLEVBQUU7Z0NBQ1AsU0FBUyxDQUNQLElBQUksa0JBQWtCLHVCQUNqQixNQUFNLEtBQ1QsT0FBTyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sSUFDeEIsQ0FDSCxDQUFBOzRCQUNILENBQUMsa0JBR00sQ0FDUixDQUNKO29CQUNELG9CQUFDLElBQUksSUFBQyxZQUFZLEVBQUUsQ0FBQyxNQUFNLENBQUM7d0JBQzFCLDBDQUNHLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQUMsV0FBVyxFQUFFLEtBQUs7NEJBQ3JDLE9BQU8sQ0FDTCxvQkFBQyxXQUFXLElBQ1YsR0FBRyxFQUFFLFdBQVcsQ0FBQyxFQUFFLEVBQ25CLFlBQVksRUFBRSxNQUFNLEVBQ3BCLE1BQU0sRUFBRSxXQUFXLEVBQ25CLFNBQVMsRUFBRSxTQUFTLEVBQ3BCLEtBQUssRUFBRSxLQUFLLEVBQ1osT0FBTyxFQUFFLEtBQUssS0FBSyxDQUFDLEVBQ3BCLE1BQU0sRUFBRSxLQUFLLEtBQUssTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUMzQyxhQUFhLEVBQUUsYUFBYSxHQUM1QixDQUNILENBQUE7d0JBQ0gsQ0FBQyxDQUFDLENBQ0QsQ0FDRSxDQUNILENBQ0YsQ0FDRixDQUNGLENBQ1AsQ0FBQTtBQUNILENBQUMsQ0FBQTtBQUNELGVBQWUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBob3QgfSBmcm9tICdyZWFjdC1ob3QtbG9hZGVyJ1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdAbXVpL21hdGVyaWFsL0J1dHRvbidcbmltcG9ydCBHcmlkIGZyb20gJ0BtdWkvbWF0ZXJpYWwvR3JpZCdcbmltcG9ydCBGaWx0ZXJMZWFmIGZyb20gJy4vZmlsdGVyLWxlYWYnXG5pbXBvcnQgeyB1c2VUaGVtZSB9IGZyb20gJ0BtdWkvbWF0ZXJpYWwvc3R5bGVzJ1xuaW1wb3J0IHsgSG92ZXJCdXR0b24gfSBmcm9tICcuLi9idXR0b24vaG92ZXInXG5pbXBvcnQge1xuICBGaWx0ZXJCdWlsZGVyQ2xhc3MsXG4gIEZpbHRlckNsYXNzLFxuICBpc0ZpbHRlckJ1aWxkZXJDbGFzcyxcbn0gZnJvbSAnLi9maWx0ZXIuc3RydWN0dXJlJ1xuaW1wb3J0IFRleHRGaWVsZCBmcm9tICdAbXVpL21hdGVyaWFsL1RleHRGaWVsZCdcbmltcG9ydCBNZW51SXRlbSBmcm9tICdAbXVpL21hdGVyaWFsL01lbnVJdGVtJ1xuaW1wb3J0IEFkZEljb24gZnJvbSAnQG11aS9pY29ucy1tYXRlcmlhbC9BZGQnXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnXG5pbXBvcnQgeyBNZW1vIH0gZnJvbSAnLi4vbWVtby9tZW1vJ1xuaW1wb3J0IHsgVmFsaWRhdGlvblJlc3VsdCB9IGZyb20gJy4uLy4uL3JlYWN0LWNvbXBvbmVudC9sb2NhdGlvbi92YWxpZGF0b3JzJ1xuY29uc3QgT3BlcmF0b3JEYXRhID0gW1xuICB7XG4gICAgbGFiZWw6ICdBTkQnLFxuICAgIHZhbHVlOiAnQU5EJyxcbiAgfSxcbiAge1xuICAgIGxhYmVsOiAnT1InLFxuICAgIHZhbHVlOiAnT1InLFxuICB9LFxuXVxuXG50eXBlIENoaWxkRmlsdGVyUHJvcHMgPSB7XG4gIHBhcmVudEZpbHRlcjogRmlsdGVyQnVpbGRlckNsYXNzXG4gIGZpbHRlcjogRmlsdGVyQnVpbGRlckNsYXNzIHwgRmlsdGVyQ2xhc3NcbiAgc2V0RmlsdGVyOiAoZmlsdGVyOiBGaWx0ZXJCdWlsZGVyQ2xhc3MpID0+IHZvaWRcbiAgaW5kZXg6IG51bWJlclxuICBpc0ZpcnN0OiBib29sZWFuXG4gIGlzTGFzdDogYm9vbGVhblxuICBlcnJvckxpc3RlbmVyPzogKHZhbGlkYXRpb25SZXN1bHRzOiB7XG4gICAgW2tleTogc3RyaW5nXTogVmFsaWRhdGlvblJlc3VsdCB8IHVuZGVmaW5lZFxuICB9KSA9PiB2b2lkXG59XG5cbmNvbnN0IENoaWxkRmlsdGVyID0gKHtcbiAgcGFyZW50RmlsdGVyLFxuICBmaWx0ZXIsXG4gIHNldEZpbHRlcixcbiAgaW5kZXgsXG4gIGlzRmlyc3QsXG4gIGVycm9yTGlzdGVuZXIsXG59OiBDaGlsZEZpbHRlclByb3BzKSA9PiB7XG4gIHJldHVybiAoXG4gICAgPD5cbiAgICAgIHshaXNGaXJzdCA/IChcbiAgICAgICAgPEdyaWRcbiAgICAgICAgICBkYXRhLWlkPXtgZmlsdGVyLXNldHRpbmdzLWNvbnRhaW5lcmB9XG4gICAgICAgICAgY29udGFpbmVyXG4gICAgICAgICAgZGlyZWN0aW9uPVwicm93XCJcbiAgICAgICAgICBhbGlnbkl0ZW1zPVwiY2VudGVyXCJcbiAgICAgICAgICBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiXG4gICAgICAgICAgd3JhcD1cIm5vd3JhcFwiXG4gICAgICAgICAgY2xhc3NOYW1lPVwicmVsYXRpdmVcIlxuICAgICAgICA+XG4gICAgICAgICAgPEdyaWQgaXRlbSBjbGFzc05hbWU9XCJwLTJcIj5cbiAgICAgICAgICAgIDxUZXh0RmllbGRcbiAgICAgICAgICAgICAgZGF0YS1pZD1cImZpbHRlci1vcGVyYXRvci1zZWxlY3RcIlxuICAgICAgICAgICAgICB2YWx1ZT17cGFyZW50RmlsdGVyLnR5cGV9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld09wZXJhdG9yID0gZS50YXJnZXQudmFsdWUgYXMgRmlsdGVyQnVpbGRlckNsYXNzWyd0eXBlJ11cbiAgICAgICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgICAgICBuZXcgRmlsdGVyQnVpbGRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFyZW50RmlsdGVyLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBuZXdPcGVyYXRvcixcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICBzZWxlY3RcbiAgICAgICAgICAgICAgdmFyaWFudD1cIm91dGxpbmVkXCJcbiAgICAgICAgICAgICAgc2l6ZT1cInNtYWxsXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge09wZXJhdG9yRGF0YS5tYXAoKG9wZXJhdG9ySW5mbykgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICA8TWVudUl0ZW0ga2V5PXtvcGVyYXRvckluZm8udmFsdWV9IHZhbHVlPXtvcGVyYXRvckluZm8udmFsdWV9PlxuICAgICAgICAgICAgICAgICAgICB7b3BlcmF0b3JJbmZvLmxhYmVsfVxuICAgICAgICAgICAgICAgICAgPC9NZW51SXRlbT5cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9UZXh0RmllbGQ+XG4gICAgICAgICAgPC9HcmlkPlxuICAgICAgICAgIDxHcmlkIGl0ZW0gY2xhc3NOYW1lPVwibWwtYXV0byBwb3NpdGlvbiBhYnNvbHV0ZSByaWdodC0wXCI+XG4gICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgIGRhdGEtaWQ9XCJyZW1vdmUtY2hpbGQtZmlsdGVyLWJ1dHRvblwiXG4gICAgICAgICAgICAgIGNvbG9yPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdGaWx0ZXJzID0gcGFyZW50RmlsdGVyLmZpbHRlcnMuc2xpY2UoMClcbiAgICAgICAgICAgICAgICBuZXdGaWx0ZXJzLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgICAgICBuZXcgRmlsdGVyQnVpbGRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFyZW50RmlsdGVyLFxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBuZXdGaWx0ZXJzLFxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIH19XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIFJlbW92ZVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgPC9HcmlkPlxuICAgICAgICA8L0dyaWQ+XG4gICAgICApIDogbnVsbH1cbiAgICAgIHtpc0ZpbHRlckJ1aWxkZXJDbGFzcyhmaWx0ZXIpID8gKFxuICAgICAgICA8RmlsdGVyQnJhbmNoXG4gICAgICAgICAgZmlsdGVyPXtmaWx0ZXJ9XG4gICAgICAgICAgc2V0RmlsdGVyPXsobmV3Q2hpbGRGaWx0ZXIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0ZpbHRlcnMgPSBwYXJlbnRGaWx0ZXIuZmlsdGVycy5zbGljZSgwKVxuICAgICAgICAgICAgbmV3RmlsdGVycy5zcGxpY2UoaW5kZXgsIDEsIG5ld0NoaWxkRmlsdGVyKVxuICAgICAgICAgICAgc2V0RmlsdGVyKFxuICAgICAgICAgICAgICBuZXcgRmlsdGVyQnVpbGRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAuLi5wYXJlbnRGaWx0ZXIsXG4gICAgICAgICAgICAgICAgZmlsdGVyczogbmV3RmlsdGVycyxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9fVxuICAgICAgICAgIGVycm9yTGlzdGVuZXI9e2Vycm9yTGlzdGVuZXJ9XG4gICAgICAgIC8+XG4gICAgICApIDogKFxuICAgICAgICA8RmlsdGVyTGVhZlxuICAgICAgICAgIGZpbHRlcj17ZmlsdGVyfVxuICAgICAgICAgIHNldEZpbHRlcj17KG5ld0NoaWxkRmlsdGVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuZXdGaWx0ZXJzID0gcGFyZW50RmlsdGVyLmZpbHRlcnMuc2xpY2UoMClcbiAgICAgICAgICAgIG5ld0ZpbHRlcnMuc3BsaWNlKGluZGV4LCAxLCBuZXdDaGlsZEZpbHRlcilcbiAgICAgICAgICAgIHNldEZpbHRlcihcbiAgICAgICAgICAgICAgbmV3IEZpbHRlckJ1aWxkZXJDbGFzcyh7XG4gICAgICAgICAgICAgICAgLi4ucGFyZW50RmlsdGVyLFxuICAgICAgICAgICAgICAgIGZpbHRlcnM6IG5ld0ZpbHRlcnMsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgfX1cbiAgICAgICAgICBlcnJvckxpc3RlbmVyPXtlcnJvckxpc3RlbmVyfVxuICAgICAgICAvPlxuICAgICAgKX1cbiAgICA8Lz5cbiAgKVxufVxuXG50eXBlIFByb3BzID0ge1xuICBmaWx0ZXI6IEZpbHRlckJ1aWxkZXJDbGFzc1xuICBzZXRGaWx0ZXI6IChmaWx0ZXI6IEZpbHRlckJ1aWxkZXJDbGFzcykgPT4gdm9pZFxuICByb290PzogYm9vbGVhblxuICBlcnJvckxpc3RlbmVyPzogKHZhbGlkYXRpb25SZXN1bHRzOiB7XG4gICAgW2tleTogc3RyaW5nXTogVmFsaWRhdGlvblJlc3VsdCB8IHVuZGVmaW5lZFxuICB9KSA9PiB2b2lkXG59XG5cbmNvbnN0IEZpbHRlckJyYW5jaCA9ICh7XG4gIGZpbHRlcixcbiAgc2V0RmlsdGVyLFxuICByb290ID0gZmFsc2UsXG4gIGVycm9yTGlzdGVuZXIsXG59OiBQcm9wcykgPT4ge1xuICBjb25zdCBbaG92ZXIsIHNldEhvdmVyXSA9IFJlYWN0LnVzZVN0YXRlKGZhbHNlKVxuICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKClcblxuICAvKipcbiAgICogQW55IG5vbiByb290IGJyYW5jaGVzIGxhY2tpbmcgZmlsdGVycyBhcmUgcHJ1bmVkLlxuICAgKi9cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBmaWx0ZXIuZmlsdGVycy5mb3JFYWNoKChjaGlsZEZpbHRlciwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgaXNGaWx0ZXJCdWlsZGVyQ2xhc3MoY2hpbGRGaWx0ZXIpICYmXG4gICAgICAgIGNoaWxkRmlsdGVyLmZpbHRlcnMubGVuZ3RoID09PSAwXG4gICAgICApIHtcbiAgICAgICAgY29uc3QgbmV3RmlsdGVycyA9IGZpbHRlci5maWx0ZXJzLnNsaWNlKDApXG4gICAgICAgIG5ld0ZpbHRlcnMuc3BsaWNlKGluZGV4LCAxKVxuICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgbmV3IEZpbHRlckJ1aWxkZXJDbGFzcyh7XG4gICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICBmaWx0ZXJzOiBuZXdGaWx0ZXJzLFxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9KVxuICB9LCBbZmlsdGVyXSlcblxuICByZXR1cm4gKFxuICAgIDxkaXZcbiAgICAgIG9uTW91c2VPdmVyPXsoKSA9PiB7XG4gICAgICAgIHNldEhvdmVyKHRydWUpXG4gICAgICB9fVxuICAgICAgb25Nb3VzZU91dD17KCkgPT4ge1xuICAgICAgICBzZXRIb3ZlcihmYWxzZSlcbiAgICAgIH19XG4gICAgPlxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9e1xuICAgICAgICAgIHJvb3RcbiAgICAgICAgICAgID8gJyBzaGFkb3ctbm9uZSdcbiAgICAgICAgICAgIDogJ3B4LTMgcHktMiBNdWlQYXBlci1ib3gtc2hhZG93IGJvcmRlci1ibGFjayBib3JkZXItMiBib3JkZXItb3BhY2l0eS0zMCdcbiAgICAgICAgfVxuICAgICAgPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIiByZWxhdGl2ZVwiPlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGRhdGEtaWQ9e1xuICAgICAgICAgICAgICByb290ID8gJ3Jvb3QtZmlsdGVyLWdyb3VwLWNvbnRhaW5lcicgOiAnZmlsdGVyLWdyb3VwLWNvbnRhaW5lcidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7XG4gICAgICAgICAgICAgIGZpbHRlci5uZWdhdGVkID8gJ2JvcmRlciBweC0zIHB5LTQgbXQtMicgOiAnJ1xuICAgICAgICAgICAgfSB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDBgfVxuICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IHRoZW1lLnBhbGV0dGUucHJpbWFyeS5tYWluLFxuICAgICAgICAgICAgfX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8R3JpZCBpdGVtIGNsYXNzTmFtZT1cInctZnVsbCBmaWx0ZXItYWN0aW9uc1wiPlxuICAgICAgICAgICAgICA8R3JpZFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lclxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbj1cInJvd1wiXG4gICAgICAgICAgICAgICAgYWxpZ25JdGVtcz1cImNlbnRlclwiXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwidy1mdWxsXCJcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxHcmlkIGl0ZW0+XG4gICAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGRhdGEtaWQ9XCJhZGQtZmllbGQtYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIHNldEZpbHRlcihcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGaWx0ZXJCdWlsZGVyQ2xhc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IGZpbHRlci5maWx0ZXJzLmNvbmNhdChbbmV3IEZpbHRlckNsYXNzKCldKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICA8QWRkSWNvbiBjbGFzc05hbWU9XCJNdWktdGV4dC10ZXh0LXByaW1hcnlcIiAvPlxuICAgICAgICAgICAgICAgICAgICBGaWVsZFxuICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICAgICAgPC9HcmlkPlxuICAgICAgICAgICAgICAgIDxHcmlkIGl0ZW0+XG4gICAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGRhdGEtaWQ9XCJhZGQtZ3JvdXAtYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIHNldEZpbHRlcihcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGaWx0ZXJCdWlsZGVyQ2xhc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IGZpbHRlci5maWx0ZXJzLmNvbmNhdChbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEZpbHRlckJ1aWxkZXJDbGFzcygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICA8QWRkSWNvbiBjbGFzc05hbWU9XCJNdWktdGV4dC10ZXh0LXByaW1hcnlcIiAvPlxuICAgICAgICAgICAgICAgICAgICBHcm91cFxuICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICAgICAgPC9HcmlkPlxuICAgICAgICAgICAgICAgIHtmaWx0ZXIuZmlsdGVycy5sZW5ndGggIT09IDAgPyAoXG4gICAgICAgICAgICAgICAgICA8R3JpZCBpdGVtIGNsYXNzTmFtZT1cIm1sLWF1dG9cIj5cbiAgICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgIGRhdGEtaWQ9XCJyZW1vdmUtZmlyc3QtZmlsdGVyLWJ1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdGaWx0ZXJzID0gZmlsdGVyLmZpbHRlcnMuc2xpY2UoMClcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZpbHRlcnMuc3BsaWNlKDAsIDEpXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGaWx0ZXJCdWlsZGVyQ2xhc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLmZpbHRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBuZXdGaWx0ZXJzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICBSZW1vdmVcbiAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICAgICAgICA8L0dyaWQ+XG4gICAgICAgICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAgICAgIDwvR3JpZD5cbiAgICAgICAgICAgIDwvR3JpZD5cbiAgICAgICAgICAgIHtmaWx0ZXIubmVnYXRlZCA/IChcbiAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICA8SG92ZXJCdXR0b25cbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YGFic29sdXRlIHRvcC0wIGxlZnQtMS8yIHRyYW5zZm9ybSAtdHJhbnNsYXRlLXktMS8yIC10cmFuc2xhdGUteC0xLzIgcHktMCBweC0xIHRleHQteHMgei0xMGB9XG4gICAgICAgICAgICAgICAgICBjb2xvcj1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgdmFyaWFudD1cImNvbnRhaW5lZFwiXG4gICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNldEZpbHRlcihcbiAgICAgICAgICAgICAgICAgICAgICBuZXcgRmlsdGVyQnVpbGRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmZpbHRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lZ2F0ZWQ6ICFmaWx0ZXIubmVnYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIHsoeyBob3ZlciB9KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChob3Zlcikge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA8PlJlbW92ZSBOb3Q8Lz5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gPD5OT1Q8Lz5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICA8L0hvdmVyQnV0dG9uPlxuICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgZGF0YS1pZD1cIm5vdC1ncm91cC1idXR0b25cIlxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtcbiAgICAgICAgICAgICAgICAgICAgaG92ZXIgPyAnb3BhY2l0eS0yNScgOiAnb3BhY2l0eS0wJ1xuICAgICAgICAgICAgICAgICAgfSBob3ZlcjpvcGFjaXR5LTEwMCBmb2N1czpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkgZHVyYXRpb24tMjAwIGFic29sdXRlIHRvcC0wIGxlZnQtMS8yIHRyYW5zZm9ybSAtdHJhbnNsYXRlLXktMS8yIC10cmFuc2xhdGUteC0xLzIgcHktMCBweC0xIHRleHQteHMgei0xMGB9XG4gICAgICAgICAgICAgICAgICBjb2xvcj1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgdmFyaWFudD1cImNvbnRhaW5lZFwiXG4gICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNldEZpbHRlcihcbiAgICAgICAgICAgICAgICAgICAgICBuZXcgRmlsdGVyQnVpbGRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmZpbHRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lZ2F0ZWQ6ICFmaWx0ZXIubmVnYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICsgTm90IEdyb3VwXG4gICAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIDxNZW1vIGRlcGVuZGVuY2llcz17W2ZpbHRlcl19PlxuICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgIHtmaWx0ZXIuZmlsdGVycy5tYXAoKGNoaWxkRmlsdGVyLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgICAgPENoaWxkRmlsdGVyXG4gICAgICAgICAgICAgICAgICAgICAga2V5PXtjaGlsZEZpbHRlci5pZH1cbiAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRGaWx0ZXI9e2ZpbHRlcn1cbiAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXI9e2NoaWxkRmlsdGVyfVxuICAgICAgICAgICAgICAgICAgICAgIHNldEZpbHRlcj17c2V0RmlsdGVyfVxuICAgICAgICAgICAgICAgICAgICAgIGluZGV4PXtpbmRleH1cbiAgICAgICAgICAgICAgICAgICAgICBpc0ZpcnN0PXtpbmRleCA9PT0gMH1cbiAgICAgICAgICAgICAgICAgICAgICBpc0xhc3Q9e2luZGV4ID09PSBmaWx0ZXIuZmlsdGVycy5sZW5ndGggLSAxfVxuICAgICAgICAgICAgICAgICAgICAgIGVycm9yTGlzdGVuZXI9e2Vycm9yTGlzdGVuZXJ9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgPC9NZW1vPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICApXG59XG5leHBvcnQgZGVmYXVsdCBob3QobW9kdWxlKShGaWx0ZXJCcmFuY2gpXG4iXX0=