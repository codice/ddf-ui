import { __assign, __read } from "tslib";
import React from 'react';
import MinimizeIcon from '@mui/icons-material/Minimize';
import CloseIcon from '@mui/icons-material/Close';
import PopoutIcon from '@mui/icons-material/OpenInNew';
import Button from '@mui/material/Button';
import Paper from '@mui/material/Paper';
import { Elevations } from '../theme/theme';
import ExtensionPoints from '../../extension-points/extension-points';
import { CloseOnClickTooltip, MinimizedHeight, adjustStackInMinimizedPlaceIfNecessary, getBottomItem, getRootColumnContent, layoutAlreadyHasMinimizedStack, rootIsEmpty, rootIsNotAColumn, useIsMaximized, useRoot, useStackSize, } from './stack-toolbar';
import { Grid } from '@mui/material';
import _ from 'underscore';
function useStackRelatedToTab(tab) {
    var _a = __read(React.useState(tab.contentItem.parent), 2), stack = _a[0], setStack = _a[1];
    React.useEffect(function () {
        setStack(tab.contentItem.parent);
    }, [tab]);
    return stack;
}
// add the tab to the existing minimized stack
function addTabToExistingMinimizedStack(_a) {
    var tab = _a.tab, stack = _a.stack;
    var bottomItem = getBottomItem(stack);
    if (bottomItem) {
        stack.removeChild(tab.contentItem, true); // for some reason removeChild is overly restrictive on type of "thing" so we have to cast
        bottomItem.addChild(tab.contentItem, undefined);
    }
}
// we have to move each item individually because golden layout doesn't support moving an entire stack, and addChild does not work as documentation says (it doesn't remove the existing automatically)
function createNewStackFromExistingTab(_a) {
    var tab = _a.tab, stack = _a.stack;
    var existingItem = tab.contentItem;
    var newStackItem = stack.layoutManager._$normalizeContentItem({
        type: 'stack',
    });
    stack.removeChild(existingItem, true); // for some reason removeChild is overly restrictive on type of "thing" so we have to cast
    newStackItem.addChild(existingItem, undefined);
    return newStackItem;
}
function createAndAddNewMinimizedStackForTab(_a) {
    var _b;
    var tab = _a.tab, stack = _a.stack, goldenLayoutRoot = _a.goldenLayoutRoot;
    var newStackItem = createNewStackFromExistingTab({ stack: stack, tab: tab });
    if (rootIsNotAColumn(goldenLayoutRoot)) {
        var existingRootContent = getRootColumnContent(goldenLayoutRoot);
        goldenLayoutRoot.removeChild(existingRootContent, true); // for some reason removeChild is overly restrictive on type of "thing" so we have to cast
        // we need a column for minimize to work, so make a new column and add the existing root to it
        var newColumnItem = stack.layoutManager._$normalizeContentItem({
            type: 'column',
        });
        newColumnItem.addChild(existingRootContent);
        newColumnItem.addChild(newStackItem);
        goldenLayoutRoot.addChild(newColumnItem);
    }
    else if (rootIsEmpty(goldenLayoutRoot)) {
        var newColumnItem = stack.layoutManager._$normalizeContentItem({
            type: 'column',
        });
        newColumnItem.addChild(newStackItem);
        goldenLayoutRoot.addChild(newColumnItem);
    }
    else {
        (_b = getRootColumnContent(goldenLayoutRoot)) === null || _b === void 0 ? void 0 : _b.addChild(newStackItem);
    }
}
// keep track of pixel height on each stack, which allows us to detect when a stack is "minimized" later on
function usePixelHeightTrackingForTab(tab, stack, height) {
    React.useEffect(function () {
        if (stack) {
            ;
            stack.pixelHeight = height;
        }
    }, [height, stack]);
    var goldenLayoutRoot = useRoot(stack);
    var minimizeCallback = React.useCallback(function () {
        if (!goldenLayoutRoot) {
            return;
        }
        if (layoutAlreadyHasMinimizedStack({ stack: stack })) {
            // minimized area exists, add this to it
            addTabToExistingMinimizedStack({ tab: tab, stack: stack });
        }
        else {
            // rearrange layout if necessary and move the stack
            createAndAddNewMinimizedStackForTab({ tab: tab, stack: stack, goldenLayoutRoot: goldenLayoutRoot });
        }
        adjustStackInMinimizedPlaceIfNecessary({ goldenLayoutRoot: goldenLayoutRoot });
    }, [stack, goldenLayoutRoot]);
    return { minimizeCallback: minimizeCallback };
}
function useCanBeMinimizedTab(_a) {
    var stack = _a.stack, height = _a.height, width = _a.width;
    var _b = __read(React.useState(stack.contentItems.length), 2), itemCount = _b[0], setItemCount = _b[1];
    var _c = __read(React.useState(true), 2), canBeMinimized = _c[0], setCanBeMinimized = _c[1];
    React.useEffect(function () {
        var rootContent = getRootColumnContent(stack);
        if ((rootContent === null || rootContent === void 0 ? void 0 : rootContent.isStack) && (rootContent === null || rootContent === void 0 ? void 0 : rootContent.contentItems.length) === 1) {
            setCanBeMinimized(false);
        }
        else {
            setCanBeMinimized(true);
        }
    }, [stack, height, width, itemCount]);
    React.useEffect(function () {
        if (stack) {
            var callback_1 = function () {
                setItemCount(stack.contentItems.length);
            };
            stack.on('itemCreated', callback_1);
            stack.on('itemDestroyed', callback_1);
            return function () {
                stack.off('itemCreated', callback_1);
                stack.off('itemDestroyed', callback_1);
            };
        }
        return function () { };
    }, [stack]);
    return canBeMinimized;
}
export var GoldenLayoutComponentHeader = function (_a) {
    var viz = _a.viz, tab = _a.tab, options = _a.options, componentState = _a.componentState, container = _a.container, name = _a.name;
    var relatedStack = useStackRelatedToTab(tab);
    var _b = useStackSize(relatedStack), height = _b.height, width = _b.width;
    var minimizeCallback = usePixelHeightTrackingForTab(tab, relatedStack, height).minimizeCallback;
    var canBeMinimized = useCanBeMinimizedTab({
        stack: relatedStack,
        width: width,
        height: height,
    });
    var isMaximized = useIsMaximized({ stack: relatedStack });
    var isMinimized = height && height <= MinimizedHeight;
    return (React.createElement(ExtensionPoints.providers, null,
        React.createElement("div", { "data-id": "".concat(name, "-tab"), className: "flex flex-row items-center flex-nowrap" },
            React.createElement(Grid, { item: true, className: "px-1 text-base" },
                React.createElement("div", null, tab.titleElement.text())),
            React.createElement(Grid, { item: true }, viz.header ? (React.createElement(viz.header, __assign({}, _.extend({}, options, componentState, {
                container: container,
            })))) : null),
            isMinimized || isMaximized || !canBeMinimized ? (React.createElement(React.Fragment, null)) : (React.createElement(Grid, { item: true },
                React.createElement(CloseOnClickTooltip, { title: React.createElement(Paper, { elevation: Elevations.overlays, className: "p-1" }, "Minimize visual to bottom of layout") },
                    React.createElement(Button, { onClick: minimizeCallback },
                        React.createElement(MinimizeIcon, { fontSize: "small" }))))),
            React.createElement(Grid, { item: true }, !tab.contentItem.layoutManager.isSubWindow &&
                tab.closeElement[0].style.display !== 'none' ? (React.createElement(CloseOnClickTooltip, { title: React.createElement(Paper, { elevation: Elevations.overlays, className: "p-1" }, "Open visual in new window") },
                React.createElement(Button, { "data-id": "popout-tab-button", onClick: function () {
                        tab.contentItem.popout();
                    } },
                    React.createElement(PopoutIcon, { fontSize: "small" })))) : null),
            React.createElement(Grid, { item: true }, tab.closeElement[0].style.display !== 'none' ? (React.createElement(CloseOnClickTooltip, { title: React.createElement(Paper, { elevation: Elevations.overlays, className: "p-1" }, "Close visual") },
                React.createElement(Button, { "data-id": "close-tab-button", onClick: function (e) {
                        ;
                        tab._onCloseClickFn(e);
                    } },
                    React.createElement(CloseIcon, { fontSize: "small" })))) : null))));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlzdWFsLXRvb2xiYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbWFpbi93ZWJhcHAvY29tcG9uZW50L2dvbGRlbi1sYXlvdXQvdmlzdWFsLXRvb2xiYXIudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDekIsT0FBTyxZQUFZLE1BQU0sOEJBQThCLENBQUE7QUFDdkQsT0FBTyxTQUFTLE1BQU0sMkJBQTJCLENBQUE7QUFDakQsT0FBTyxVQUFVLE1BQU0sK0JBQStCLENBQUE7QUFFdEQsT0FBTyxNQUFNLE1BQU0sc0JBQXNCLENBQUE7QUFDekMsT0FBTyxLQUFLLE1BQU0scUJBQXFCLENBQUE7QUFDdkMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQzNDLE9BQU8sZUFBZSxNQUFNLHlDQUF5QyxDQUFBO0FBQ3JFLE9BQU8sRUFDTCxtQkFBbUIsRUFDbkIsZUFBZSxFQUNmLHNDQUFzQyxFQUN0QyxhQUFhLEVBQ2Isb0JBQW9CLEVBQ3BCLDhCQUE4QixFQUM5QixXQUFXLEVBQ1gsZ0JBQWdCLEVBQ2hCLGNBQWMsRUFDZCxPQUFPLEVBQ1AsWUFBWSxHQUNiLE1BQU0saUJBQWlCLENBQUE7QUFDeEIsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUNwQyxPQUFPLENBQUMsTUFBTSxZQUFZLENBQUE7QUFFMUIsU0FBUyxvQkFBb0IsQ0FBQyxHQUFxQjtJQUMzQyxJQUFBLEtBQUEsT0FBb0IsS0FBSyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFBLEVBQXpELEtBQUssUUFBQSxFQUFFLFFBQVEsUUFBMEMsQ0FBQTtJQUNoRSxLQUFLLENBQUMsU0FBUyxDQUFDO1FBQ2QsUUFBUSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDbEMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUNULE9BQU8sS0FBb0QsQ0FBQTtBQUM3RCxDQUFDO0FBRUQsOENBQThDO0FBQzlDLFNBQVMsOEJBQThCLENBQUMsRUFNdkM7UUFMQyxHQUFHLFNBQUEsRUFDSCxLQUFLLFdBQUE7SUFLTCxJQUFNLFVBQVUsR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDdkMsSUFBSSxVQUFVLEVBQUU7UUFDZCxLQUFLLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxXQUFrQixFQUFFLElBQUksQ0FBQyxDQUFBLENBQUMsMEZBQTBGO1FBQzFJLFVBQVUsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQTtLQUNoRDtBQUNILENBQUM7QUFFRCx1TUFBdU07QUFDdk0sU0FBUyw2QkFBNkIsQ0FBQyxFQU10QztRQUxDLEdBQUcsU0FBQSxFQUNILEtBQUssV0FBQTtJQUtMLElBQU0sWUFBWSxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUE7SUFDcEMsSUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxzQkFBc0IsQ0FBQztRQUM5RCxJQUFJLEVBQUUsT0FBTztLQUNkLENBQUMsQ0FBQTtJQUNGLEtBQUssQ0FBQyxXQUFXLENBQUMsWUFBbUIsRUFBRSxJQUFJLENBQUMsQ0FBQSxDQUFDLDBGQUEwRjtJQUN2SSxZQUFZLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUM5QyxPQUFPLFlBQVksQ0FBQTtBQUNyQixDQUFDO0FBRUQsU0FBUyxtQ0FBbUMsQ0FBQyxFQVE1Qzs7UUFQQyxHQUFHLFNBQUEsRUFDSCxLQUFLLFdBQUEsRUFDTCxnQkFBZ0Isc0JBQUE7SUFNaEIsSUFBTSxZQUFZLEdBQUcsNkJBQTZCLENBQUMsRUFBRSxLQUFLLE9BQUEsRUFBRSxHQUFHLEtBQUEsRUFBRSxDQUFDLENBQUE7SUFDbEUsSUFBSSxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFO1FBQ3RDLElBQU0sbUJBQW1CLEdBQUcsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtRQUNsRSxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsbUJBQTBCLEVBQUUsSUFBSSxDQUFDLENBQUEsQ0FBQywwRkFBMEY7UUFFekosOEZBQThGO1FBQzlGLElBQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUM7WUFDL0QsSUFBSSxFQUFFLFFBQVE7U0FDZixDQUFDLENBQUE7UUFDRixhQUFhLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLENBQUE7UUFDM0MsYUFBYSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQTtRQUVwQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLENBQUE7S0FDekM7U0FBTSxJQUFJLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFO1FBQ3hDLElBQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUM7WUFDL0QsSUFBSSxFQUFFLFFBQVE7U0FDZixDQUFDLENBQUE7UUFDRixhQUFhLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFBO1FBRXBDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQTtLQUN6QztTQUFNO1FBQ0wsTUFBQSxvQkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQywwQ0FBRSxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUE7S0FDL0Q7QUFDSCxDQUFDO0FBRUQsMkdBQTJHO0FBQzNHLFNBQVMsNEJBQTRCLENBQ25DLEdBQWdELEVBQ2hELEtBQWtELEVBQ2xELE1BQTBCO0lBRTFCLEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDZCxJQUFJLEtBQUssRUFBRTtZQUNULENBQUM7WUFBQyxLQUFhLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQTtTQUNyQztJQUNILENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQ25CLElBQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBRXZDLElBQU0sZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQztRQUN6QyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDckIsT0FBTTtTQUNQO1FBQ0QsSUFBSSw4QkFBOEIsQ0FBQyxFQUFFLEtBQUssT0FBQSxFQUFFLENBQUMsRUFBRTtZQUM3Qyx3Q0FBd0M7WUFDeEMsOEJBQThCLENBQUMsRUFBRSxHQUFHLEtBQUEsRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFDLENBQUE7U0FDL0M7YUFBTTtZQUNMLG1EQUFtRDtZQUNuRCxtQ0FBbUMsQ0FBQyxFQUFFLEdBQUcsS0FBQSxFQUFFLEtBQUssT0FBQSxFQUFFLGdCQUFnQixrQkFBQSxFQUFFLENBQUMsQ0FBQTtTQUN0RTtRQUNELHNDQUFzQyxDQUFDLEVBQUUsZ0JBQWdCLGtCQUFBLEVBQUUsQ0FBQyxDQUFBO0lBQzlELENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUE7SUFFN0IsT0FBTyxFQUFFLGdCQUFnQixrQkFBQSxFQUFFLENBQUE7QUFDN0IsQ0FBQztBQUVELFNBQVMsb0JBQW9CLENBQUMsRUFRN0I7UUFQQyxLQUFLLFdBQUEsRUFDTCxNQUFNLFlBQUEsRUFDTixLQUFLLFdBQUE7SUFNQyxJQUFBLEtBQUEsT0FBNEIsS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFBLEVBQXBFLFNBQVMsUUFBQSxFQUFFLFlBQVksUUFBNkMsQ0FBQTtJQUNyRSxJQUFBLEtBQUEsT0FBc0MsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBQSxFQUF6RCxjQUFjLFFBQUEsRUFBRSxpQkFBaUIsUUFBd0IsQ0FBQTtJQUNoRSxLQUFLLENBQUMsU0FBUyxDQUFDO1FBQ2QsSUFBTSxXQUFXLEdBQUcsb0JBQW9CLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDL0MsSUFBSSxDQUFBLFdBQVcsYUFBWCxXQUFXLHVCQUFYLFdBQVcsQ0FBRSxPQUFPLEtBQUksQ0FBQSxXQUFXLGFBQVgsV0FBVyx1QkFBWCxXQUFXLENBQUUsWUFBWSxDQUFDLE1BQU0sTUFBSyxDQUFDLEVBQUU7WUFDbEUsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDekI7YUFBTTtZQUNMLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFBO1NBQ3hCO0lBQ0gsQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQTtJQUNyQyxLQUFLLENBQUMsU0FBUyxDQUFDO1FBQ2QsSUFBSSxLQUFLLEVBQUU7WUFDVCxJQUFNLFVBQVEsR0FBRztnQkFDZixZQUFZLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUN6QyxDQUFDLENBQUE7WUFDRCxLQUFLLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxVQUFRLENBQUMsQ0FBQTtZQUNqQyxLQUFLLENBQUMsRUFBRSxDQUFDLGVBQWUsRUFBRSxVQUFRLENBQUMsQ0FBQTtZQUNuQyxPQUFPO2dCQUNMLEtBQUssQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFVBQVEsQ0FBQyxDQUFBO2dCQUNsQyxLQUFLLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxVQUFRLENBQUMsQ0FBQTtZQUN0QyxDQUFDLENBQUE7U0FDRjtRQUNELE9BQU8sY0FBTyxDQUFDLENBQUE7SUFDakIsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtJQUNYLE9BQU8sY0FBYyxDQUFBO0FBQ3ZCLENBQUM7QUFFRCxNQUFNLENBQUMsSUFBTSwyQkFBMkIsR0FBRyxVQUFDLEVBYzNDO1FBYkMsR0FBRyxTQUFBLEVBQ0gsR0FBRyxTQUFBLEVBQ0gsT0FBTyxhQUFBLEVBQ1AsY0FBYyxvQkFBQSxFQUNkLFNBQVMsZUFBQSxFQUNULElBQUksVUFBQTtJQVNKLElBQU0sWUFBWSxHQUFHLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3hDLElBQUEsS0FBb0IsWUFBWSxDQUFDLFlBQVksQ0FBQyxFQUE1QyxNQUFNLFlBQUEsRUFBRSxLQUFLLFdBQStCLENBQUE7SUFDNUMsSUFBQSxnQkFBZ0IsR0FBSyw0QkFBNEIsQ0FDdkQsR0FBVSxFQUNWLFlBQVksRUFDWixNQUFNLENBQ1AsaUJBSnVCLENBSXZCO0lBQ0QsSUFBTSxjQUFjLEdBQUcsb0JBQW9CLENBQUM7UUFDMUMsS0FBSyxFQUFFLFlBQVk7UUFDbkIsS0FBSyxPQUFBO1FBQ0wsTUFBTSxRQUFBO0tBQ1AsQ0FBQyxDQUFBO0lBQ0YsSUFBTSxXQUFXLEdBQUcsY0FBYyxDQUFDLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUE7SUFDM0QsSUFBTSxXQUFXLEdBQUcsTUFBTSxJQUFJLE1BQU0sSUFBSSxlQUFlLENBQUE7SUFDdkQsT0FBTyxDQUNMLG9CQUFDLGVBQWUsQ0FBQyxTQUFTO1FBQ3hCLHdDQUNXLFVBQUcsSUFBSSxTQUFNLEVBQ3RCLFNBQVMsRUFBRSx3Q0FBd0M7WUFFbkQsb0JBQUMsSUFBSSxJQUFDLElBQUksUUFBQyxTQUFTLEVBQUMsZ0JBQWdCO2dCQUNuQyxpQ0FBTSxHQUFHLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFPLENBQy9CO1lBQ1Asb0JBQUMsSUFBSSxJQUFDLElBQUksVUFDUCxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUNaLG9CQUFDLEdBQUcsQ0FBQyxNQUFNLGVBQ0wsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRTtnQkFDeEMsU0FBUyxXQUFBO2FBQ1YsQ0FBQyxFQUNGLENBQ0gsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUNIO1lBQ04sV0FBVyxJQUFJLFdBQVcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FDL0MseUNBQUssQ0FDTixDQUFDLENBQUMsQ0FBQyxDQUNGLG9CQUFDLElBQUksSUFBQyxJQUFJO2dCQUNSLG9CQUFDLG1CQUFtQixJQUNsQixLQUFLLEVBQ0gsb0JBQUMsS0FBSyxJQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBQyxLQUFLLDBDQUU5QztvQkFHVixvQkFBQyxNQUFNLElBQUMsT0FBTyxFQUFFLGdCQUFnQjt3QkFDL0Isb0JBQUMsWUFBWSxJQUFDLFFBQVEsRUFBQyxPQUFPLEdBQUcsQ0FDMUIsQ0FDVyxDQUNqQixDQUNSO1lBRUQsb0JBQUMsSUFBSSxJQUFDLElBQUksVUFDUCxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFdBQVc7Z0JBQzNDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQzdDLG9CQUFDLG1CQUFtQixJQUNsQixLQUFLLEVBQ0gsb0JBQUMsS0FBSyxJQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBQyxLQUFLLGdDQUU5QztnQkFHVixvQkFBQyxNQUFNLGVBQ0csbUJBQW1CLEVBQzNCLE9BQU8sRUFBRTt3QkFDUCxHQUFHLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFBO29CQUMxQixDQUFDO29CQUVELG9CQUFDLFVBQVUsSUFBQyxRQUFRLEVBQUMsT0FBTyxHQUFHLENBQ3hCLENBQ1csQ0FDdkIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUNIO1lBQ1Asb0JBQUMsSUFBSSxJQUFDLElBQUksVUFDUCxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUM5QyxvQkFBQyxtQkFBbUIsSUFDbEIsS0FBSyxFQUNILG9CQUFDLEtBQUssSUFBQyxTQUFTLEVBQUUsVUFBVSxDQUFDLFFBQVEsRUFBRSxTQUFTLEVBQUMsS0FBSyxtQkFFOUM7Z0JBR1Ysb0JBQUMsTUFBTSxlQUNHLGtCQUFrQixFQUMxQixPQUFPLEVBQUUsVUFBQyxDQUFDO3dCQUNULENBQUM7d0JBQUMsR0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtvQkFDbEMsQ0FBQztvQkFFRCxvQkFBQyxTQUFTLElBQUMsUUFBUSxFQUFDLE9BQU8sR0FBRyxDQUN2QixDQUNXLENBQ3ZCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDSCxDQUNILENBQ29CLENBQzdCLENBQUE7QUFDSCxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgR29sZGVuTGF5b3V0IGZyb20gJ2dvbGRlbi1sYXlvdXQnXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgTWluaW1pemVJY29uIGZyb20gJ0BtdWkvaWNvbnMtbWF0ZXJpYWwvTWluaW1pemUnXG5pbXBvcnQgQ2xvc2VJY29uIGZyb20gJ0BtdWkvaWNvbnMtbWF0ZXJpYWwvQ2xvc2UnXG5pbXBvcnQgUG9wb3V0SWNvbiBmcm9tICdAbXVpL2ljb25zLW1hdGVyaWFsL09wZW5Jbk5ldydcblxuaW1wb3J0IEJ1dHRvbiBmcm9tICdAbXVpL21hdGVyaWFsL0J1dHRvbidcbmltcG9ydCBQYXBlciBmcm9tICdAbXVpL21hdGVyaWFsL1BhcGVyJ1xuaW1wb3J0IHsgRWxldmF0aW9ucyB9IGZyb20gJy4uL3RoZW1lL3RoZW1lJ1xuaW1wb3J0IEV4dGVuc2lvblBvaW50cyBmcm9tICcuLi8uLi9leHRlbnNpb24tcG9pbnRzL2V4dGVuc2lvbi1wb2ludHMnXG5pbXBvcnQge1xuICBDbG9zZU9uQ2xpY2tUb29sdGlwLFxuICBNaW5pbWl6ZWRIZWlnaHQsXG4gIGFkanVzdFN0YWNrSW5NaW5pbWl6ZWRQbGFjZUlmTmVjZXNzYXJ5LFxuICBnZXRCb3R0b21JdGVtLFxuICBnZXRSb290Q29sdW1uQ29udGVudCxcbiAgbGF5b3V0QWxyZWFkeUhhc01pbmltaXplZFN0YWNrLFxuICByb290SXNFbXB0eSxcbiAgcm9vdElzTm90QUNvbHVtbixcbiAgdXNlSXNNYXhpbWl6ZWQsXG4gIHVzZVJvb3QsXG4gIHVzZVN0YWNrU2l6ZSxcbn0gZnJvbSAnLi9zdGFjay10b29sYmFyJ1xuaW1wb3J0IHsgR3JpZCB9IGZyb20gJ0BtdWkvbWF0ZXJpYWwnXG5pbXBvcnQgXyBmcm9tICd1bmRlcnNjb3JlJ1xuXG5mdW5jdGlvbiB1c2VTdGFja1JlbGF0ZWRUb1RhYih0YWI6IEdvbGRlbkxheW91dC5UYWIpIHtcbiAgY29uc3QgW3N0YWNrLCBzZXRTdGFja10gPSBSZWFjdC51c2VTdGF0ZSh0YWIuY29udGVudEl0ZW0ucGFyZW50KVxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHNldFN0YWNrKHRhYi5jb250ZW50SXRlbS5wYXJlbnQpXG4gIH0sIFt0YWJdKVxuICByZXR1cm4gc3RhY2sgYXMgR29sZGVuTGF5b3V0LlRhYiAmIEdvbGRlbkxheW91dC5Db250ZW50SXRlbVxufVxuXG4vLyBhZGQgdGhlIHRhYiB0byB0aGUgZXhpc3RpbmcgbWluaW1pemVkIHN0YWNrXG5mdW5jdGlvbiBhZGRUYWJUb0V4aXN0aW5nTWluaW1pemVkU3RhY2soe1xuICB0YWIsXG4gIHN0YWNrLFxufToge1xuICB0YWI6IEdvbGRlbkxheW91dC5UYWIgJiBHb2xkZW5MYXlvdXQuQ29udGVudEl0ZW1cbiAgc3RhY2s6IEdvbGRlbkxheW91dC5UYWIgJiBHb2xkZW5MYXlvdXQuQ29udGVudEl0ZW1cbn0pIHtcbiAgY29uc3QgYm90dG9tSXRlbSA9IGdldEJvdHRvbUl0ZW0oc3RhY2spXG4gIGlmIChib3R0b21JdGVtKSB7XG4gICAgc3RhY2sucmVtb3ZlQ2hpbGQodGFiLmNvbnRlbnRJdGVtIGFzIGFueSwgdHJ1ZSkgLy8gZm9yIHNvbWUgcmVhc29uIHJlbW92ZUNoaWxkIGlzIG92ZXJseSByZXN0cmljdGl2ZSBvbiB0eXBlIG9mIFwidGhpbmdcIiBzbyB3ZSBoYXZlIHRvIGNhc3RcbiAgICBib3R0b21JdGVtLmFkZENoaWxkKHRhYi5jb250ZW50SXRlbSwgdW5kZWZpbmVkKVxuICB9XG59XG5cbi8vIHdlIGhhdmUgdG8gbW92ZSBlYWNoIGl0ZW0gaW5kaXZpZHVhbGx5IGJlY2F1c2UgZ29sZGVuIGxheW91dCBkb2Vzbid0IHN1cHBvcnQgbW92aW5nIGFuIGVudGlyZSBzdGFjaywgYW5kIGFkZENoaWxkIGRvZXMgbm90IHdvcmsgYXMgZG9jdW1lbnRhdGlvbiBzYXlzIChpdCBkb2Vzbid0IHJlbW92ZSB0aGUgZXhpc3RpbmcgYXV0b21hdGljYWxseSlcbmZ1bmN0aW9uIGNyZWF0ZU5ld1N0YWNrRnJvbUV4aXN0aW5nVGFiKHtcbiAgdGFiLFxuICBzdGFjayxcbn06IHtcbiAgdGFiOiBHb2xkZW5MYXlvdXQuVGFiICYgR29sZGVuTGF5b3V0LkNvbnRlbnRJdGVtXG4gIHN0YWNrOiBHb2xkZW5MYXlvdXQuVGFiICYgR29sZGVuTGF5b3V0LkNvbnRlbnRJdGVtXG59KSB7XG4gIGNvbnN0IGV4aXN0aW5nSXRlbSA9IHRhYi5jb250ZW50SXRlbVxuICBjb25zdCBuZXdTdGFja0l0ZW0gPSBzdGFjay5sYXlvdXRNYW5hZ2VyLl8kbm9ybWFsaXplQ29udGVudEl0ZW0oe1xuICAgIHR5cGU6ICdzdGFjaycsXG4gIH0pXG4gIHN0YWNrLnJlbW92ZUNoaWxkKGV4aXN0aW5nSXRlbSBhcyBhbnksIHRydWUpIC8vIGZvciBzb21lIHJlYXNvbiByZW1vdmVDaGlsZCBpcyBvdmVybHkgcmVzdHJpY3RpdmUgb24gdHlwZSBvZiBcInRoaW5nXCIgc28gd2UgaGF2ZSB0byBjYXN0XG4gIG5ld1N0YWNrSXRlbS5hZGRDaGlsZChleGlzdGluZ0l0ZW0sIHVuZGVmaW5lZClcbiAgcmV0dXJuIG5ld1N0YWNrSXRlbVxufVxuXG5mdW5jdGlvbiBjcmVhdGVBbmRBZGROZXdNaW5pbWl6ZWRTdGFja0ZvclRhYih7XG4gIHRhYixcbiAgc3RhY2ssXG4gIGdvbGRlbkxheW91dFJvb3QsXG59OiB7XG4gIHRhYjogR29sZGVuTGF5b3V0LlRhYiAmIEdvbGRlbkxheW91dC5Db250ZW50SXRlbVxuICBzdGFjazogR29sZGVuTGF5b3V0LlRhYiAmIEdvbGRlbkxheW91dC5Db250ZW50SXRlbVxuICBnb2xkZW5MYXlvdXRSb290OiBHb2xkZW5MYXlvdXQuQ29udGVudEl0ZW1cbn0pIHtcbiAgY29uc3QgbmV3U3RhY2tJdGVtID0gY3JlYXRlTmV3U3RhY2tGcm9tRXhpc3RpbmdUYWIoeyBzdGFjaywgdGFiIH0pXG4gIGlmIChyb290SXNOb3RBQ29sdW1uKGdvbGRlbkxheW91dFJvb3QpKSB7XG4gICAgY29uc3QgZXhpc3RpbmdSb290Q29udGVudCA9IGdldFJvb3RDb2x1bW5Db250ZW50KGdvbGRlbkxheW91dFJvb3QpXG4gICAgZ29sZGVuTGF5b3V0Um9vdC5yZW1vdmVDaGlsZChleGlzdGluZ1Jvb3RDb250ZW50IGFzIGFueSwgdHJ1ZSkgLy8gZm9yIHNvbWUgcmVhc29uIHJlbW92ZUNoaWxkIGlzIG92ZXJseSByZXN0cmljdGl2ZSBvbiB0eXBlIG9mIFwidGhpbmdcIiBzbyB3ZSBoYXZlIHRvIGNhc3RcblxuICAgIC8vIHdlIG5lZWQgYSBjb2x1bW4gZm9yIG1pbmltaXplIHRvIHdvcmssIHNvIG1ha2UgYSBuZXcgY29sdW1uIGFuZCBhZGQgdGhlIGV4aXN0aW5nIHJvb3QgdG8gaXRcbiAgICBjb25zdCBuZXdDb2x1bW5JdGVtID0gc3RhY2subGF5b3V0TWFuYWdlci5fJG5vcm1hbGl6ZUNvbnRlbnRJdGVtKHtcbiAgICAgIHR5cGU6ICdjb2x1bW4nLFxuICAgIH0pXG4gICAgbmV3Q29sdW1uSXRlbS5hZGRDaGlsZChleGlzdGluZ1Jvb3RDb250ZW50KVxuICAgIG5ld0NvbHVtbkl0ZW0uYWRkQ2hpbGQobmV3U3RhY2tJdGVtKVxuXG4gICAgZ29sZGVuTGF5b3V0Um9vdC5hZGRDaGlsZChuZXdDb2x1bW5JdGVtKVxuICB9IGVsc2UgaWYgKHJvb3RJc0VtcHR5KGdvbGRlbkxheW91dFJvb3QpKSB7XG4gICAgY29uc3QgbmV3Q29sdW1uSXRlbSA9IHN0YWNrLmxheW91dE1hbmFnZXIuXyRub3JtYWxpemVDb250ZW50SXRlbSh7XG4gICAgICB0eXBlOiAnY29sdW1uJyxcbiAgICB9KVxuICAgIG5ld0NvbHVtbkl0ZW0uYWRkQ2hpbGQobmV3U3RhY2tJdGVtKVxuXG4gICAgZ29sZGVuTGF5b3V0Um9vdC5hZGRDaGlsZChuZXdDb2x1bW5JdGVtKVxuICB9IGVsc2Uge1xuICAgIGdldFJvb3RDb2x1bW5Db250ZW50KGdvbGRlbkxheW91dFJvb3QpPy5hZGRDaGlsZChuZXdTdGFja0l0ZW0pXG4gIH1cbn1cblxuLy8ga2VlcCB0cmFjayBvZiBwaXhlbCBoZWlnaHQgb24gZWFjaCBzdGFjaywgd2hpY2ggYWxsb3dzIHVzIHRvIGRldGVjdCB3aGVuIGEgc3RhY2sgaXMgXCJtaW5pbWl6ZWRcIiBsYXRlciBvblxuZnVuY3Rpb24gdXNlUGl4ZWxIZWlnaHRUcmFja2luZ0ZvclRhYihcbiAgdGFiOiBHb2xkZW5MYXlvdXQuVGFiICYgR29sZGVuTGF5b3V0LkNvbnRlbnRJdGVtLFxuICBzdGFjazogR29sZGVuTGF5b3V0LlRhYiAmIEdvbGRlbkxheW91dC5Db250ZW50SXRlbSxcbiAgaGVpZ2h0OiBudW1iZXIgfCB1bmRlZmluZWRcbikge1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChzdGFjaykge1xuICAgICAgOyhzdGFjayBhcyBhbnkpLnBpeGVsSGVpZ2h0ID0gaGVpZ2h0XG4gICAgfVxuICB9LCBbaGVpZ2h0LCBzdGFja10pXG4gIGNvbnN0IGdvbGRlbkxheW91dFJvb3QgPSB1c2VSb290KHN0YWNrKVxuXG4gIGNvbnN0IG1pbmltaXplQ2FsbGJhY2sgPSBSZWFjdC51c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKCFnb2xkZW5MYXlvdXRSb290KSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgaWYgKGxheW91dEFscmVhZHlIYXNNaW5pbWl6ZWRTdGFjayh7IHN0YWNrIH0pKSB7XG4gICAgICAvLyBtaW5pbWl6ZWQgYXJlYSBleGlzdHMsIGFkZCB0aGlzIHRvIGl0XG4gICAgICBhZGRUYWJUb0V4aXN0aW5nTWluaW1pemVkU3RhY2soeyB0YWIsIHN0YWNrIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHJlYXJyYW5nZSBsYXlvdXQgaWYgbmVjZXNzYXJ5IGFuZCBtb3ZlIHRoZSBzdGFja1xuICAgICAgY3JlYXRlQW5kQWRkTmV3TWluaW1pemVkU3RhY2tGb3JUYWIoeyB0YWIsIHN0YWNrLCBnb2xkZW5MYXlvdXRSb290IH0pXG4gICAgfVxuICAgIGFkanVzdFN0YWNrSW5NaW5pbWl6ZWRQbGFjZUlmTmVjZXNzYXJ5KHsgZ29sZGVuTGF5b3V0Um9vdCB9KVxuICB9LCBbc3RhY2ssIGdvbGRlbkxheW91dFJvb3RdKVxuXG4gIHJldHVybiB7IG1pbmltaXplQ2FsbGJhY2sgfVxufVxuXG5mdW5jdGlvbiB1c2VDYW5CZU1pbmltaXplZFRhYih7XG4gIHN0YWNrLFxuICBoZWlnaHQsXG4gIHdpZHRoLFxufToge1xuICBzdGFjazogR29sZGVuTGF5b3V0LlRhYiAmIEdvbGRlbkxheW91dC5Db250ZW50SXRlbVxuICBoZWlnaHQ/OiBudW1iZXJcbiAgd2lkdGg/OiBudW1iZXJcbn0pIHtcbiAgY29uc3QgW2l0ZW1Db3VudCwgc2V0SXRlbUNvdW50XSA9IFJlYWN0LnVzZVN0YXRlKHN0YWNrLmNvbnRlbnRJdGVtcy5sZW5ndGgpXG4gIGNvbnN0IFtjYW5CZU1pbmltaXplZCwgc2V0Q2FuQmVNaW5pbWl6ZWRdID0gUmVhY3QudXNlU3RhdGUodHJ1ZSlcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCByb290Q29udGVudCA9IGdldFJvb3RDb2x1bW5Db250ZW50KHN0YWNrKVxuICAgIGlmIChyb290Q29udGVudD8uaXNTdGFjayAmJiByb290Q29udGVudD8uY29udGVudEl0ZW1zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgc2V0Q2FuQmVNaW5pbWl6ZWQoZmFsc2UpXG4gICAgfSBlbHNlIHtcbiAgICAgIHNldENhbkJlTWluaW1pemVkKHRydWUpXG4gICAgfVxuICB9LCBbc3RhY2ssIGhlaWdodCwgd2lkdGgsIGl0ZW1Db3VudF0pXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHN0YWNrKSB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9ICgpID0+IHtcbiAgICAgICAgc2V0SXRlbUNvdW50KHN0YWNrLmNvbnRlbnRJdGVtcy5sZW5ndGgpXG4gICAgICB9XG4gICAgICBzdGFjay5vbignaXRlbUNyZWF0ZWQnLCBjYWxsYmFjaylcbiAgICAgIHN0YWNrLm9uKCdpdGVtRGVzdHJveWVkJywgY2FsbGJhY2spXG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBzdGFjay5vZmYoJ2l0ZW1DcmVhdGVkJywgY2FsbGJhY2spXG4gICAgICAgIHN0YWNrLm9mZignaXRlbURlc3Ryb3llZCcsIGNhbGxiYWNrKVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gKCkgPT4ge31cbiAgfSwgW3N0YWNrXSlcbiAgcmV0dXJuIGNhbkJlTWluaW1pemVkXG59XG5cbmV4cG9ydCBjb25zdCBHb2xkZW5MYXlvdXRDb21wb25lbnRIZWFkZXIgPSAoe1xuICB2aXosXG4gIHRhYixcbiAgb3B0aW9ucyxcbiAgY29tcG9uZW50U3RhdGUsXG4gIGNvbnRhaW5lcixcbiAgbmFtZSxcbn06IHtcbiAgdml6OiBhbnlcbiAgdGFiOiBHb2xkZW5MYXlvdXQuVGFiICYgR29sZGVuTGF5b3V0LkNvbnRlbnRJdGVtXG4gIG9wdGlvbnM6IGFueVxuICBjb21wb25lbnRTdGF0ZTogYW55XG4gIGNvbnRhaW5lcjogYW55XG4gIG5hbWU6IGFueVxufSkgPT4ge1xuICBjb25zdCByZWxhdGVkU3RhY2sgPSB1c2VTdGFja1JlbGF0ZWRUb1RhYih0YWIpXG4gIGNvbnN0IHsgaGVpZ2h0LCB3aWR0aCB9ID0gdXNlU3RhY2tTaXplKHJlbGF0ZWRTdGFjaylcbiAgY29uc3QgeyBtaW5pbWl6ZUNhbGxiYWNrIH0gPSB1c2VQaXhlbEhlaWdodFRyYWNraW5nRm9yVGFiKFxuICAgIHRhYiBhcyBhbnksXG4gICAgcmVsYXRlZFN0YWNrLFxuICAgIGhlaWdodFxuICApXG4gIGNvbnN0IGNhbkJlTWluaW1pemVkID0gdXNlQ2FuQmVNaW5pbWl6ZWRUYWIoe1xuICAgIHN0YWNrOiByZWxhdGVkU3RhY2ssXG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0LFxuICB9KVxuICBjb25zdCBpc01heGltaXplZCA9IHVzZUlzTWF4aW1pemVkKHsgc3RhY2s6IHJlbGF0ZWRTdGFjayB9KVxuICBjb25zdCBpc01pbmltaXplZCA9IGhlaWdodCAmJiBoZWlnaHQgPD0gTWluaW1pemVkSGVpZ2h0XG4gIHJldHVybiAoXG4gICAgPEV4dGVuc2lvblBvaW50cy5wcm92aWRlcnM+XG4gICAgICA8ZGl2XG4gICAgICAgIGRhdGEtaWQ9e2Ake25hbWV9LXRhYmB9XG4gICAgICAgIGNsYXNzTmFtZT17YGZsZXggZmxleC1yb3cgaXRlbXMtY2VudGVyIGZsZXgtbm93cmFwYH1cbiAgICAgID5cbiAgICAgICAgPEdyaWQgaXRlbSBjbGFzc05hbWU9XCJweC0xIHRleHQtYmFzZVwiPlxuICAgICAgICAgIDxkaXY+e3RhYi50aXRsZUVsZW1lbnQudGV4dCgpfTwvZGl2PlxuICAgICAgICA8L0dyaWQ+XG4gICAgICAgIDxHcmlkIGl0ZW0+XG4gICAgICAgICAge3Zpei5oZWFkZXIgPyAoXG4gICAgICAgICAgICA8dml6LmhlYWRlclxuICAgICAgICAgICAgICB7Li4uXy5leHRlbmQoe30sIG9wdGlvbnMsIGNvbXBvbmVudFN0YXRlLCB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLFxuICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgIDwvR3JpZD5cbiAgICAgICAge2lzTWluaW1pemVkIHx8IGlzTWF4aW1pemVkIHx8ICFjYW5CZU1pbmltaXplZCA/IChcbiAgICAgICAgICA8PjwvPlxuICAgICAgICApIDogKFxuICAgICAgICAgIDxHcmlkIGl0ZW0+XG4gICAgICAgICAgICA8Q2xvc2VPbkNsaWNrVG9vbHRpcFxuICAgICAgICAgICAgICB0aXRsZT17XG4gICAgICAgICAgICAgICAgPFBhcGVyIGVsZXZhdGlvbj17RWxldmF0aW9ucy5vdmVybGF5c30gY2xhc3NOYW1lPVwicC0xXCI+XG4gICAgICAgICAgICAgICAgICBNaW5pbWl6ZSB2aXN1YWwgdG8gYm90dG9tIG9mIGxheW91dFxuICAgICAgICAgICAgICAgIDwvUGFwZXI+XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXttaW5pbWl6ZUNhbGxiYWNrfT5cbiAgICAgICAgICAgICAgICA8TWluaW1pemVJY29uIGZvbnRTaXplPVwic21hbGxcIiAvPlxuICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgIDwvQ2xvc2VPbkNsaWNrVG9vbHRpcD5cbiAgICAgICAgICA8L0dyaWQ+XG4gICAgICAgICl9XG5cbiAgICAgICAgPEdyaWQgaXRlbT5cbiAgICAgICAgICB7IXRhYi5jb250ZW50SXRlbS5sYXlvdXRNYW5hZ2VyLmlzU3ViV2luZG93ICYmXG4gICAgICAgICAgdGFiLmNsb3NlRWxlbWVudFswXS5zdHlsZS5kaXNwbGF5ICE9PSAnbm9uZScgPyAoXG4gICAgICAgICAgICA8Q2xvc2VPbkNsaWNrVG9vbHRpcFxuICAgICAgICAgICAgICB0aXRsZT17XG4gICAgICAgICAgICAgICAgPFBhcGVyIGVsZXZhdGlvbj17RWxldmF0aW9ucy5vdmVybGF5c30gY2xhc3NOYW1lPVwicC0xXCI+XG4gICAgICAgICAgICAgICAgICBPcGVuIHZpc3VhbCBpbiBuZXcgd2luZG93XG4gICAgICAgICAgICAgICAgPC9QYXBlcj5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgZGF0YS1pZD1cInBvcG91dC10YWItYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICB0YWIuY29udGVudEl0ZW0ucG9wb3V0KClcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPFBvcG91dEljb24gZm9udFNpemU9XCJzbWFsbFwiIC8+XG4gICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgPC9DbG9zZU9uQ2xpY2tUb29sdGlwPlxuICAgICAgICAgICkgOiBudWxsfVxuICAgICAgICA8L0dyaWQ+XG4gICAgICAgIDxHcmlkIGl0ZW0+XG4gICAgICAgICAge3RhYi5jbG9zZUVsZW1lbnRbMF0uc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnID8gKFxuICAgICAgICAgICAgPENsb3NlT25DbGlja1Rvb2x0aXBcbiAgICAgICAgICAgICAgdGl0bGU9e1xuICAgICAgICAgICAgICAgIDxQYXBlciBlbGV2YXRpb249e0VsZXZhdGlvbnMub3ZlcmxheXN9IGNsYXNzTmFtZT1cInAtMVwiPlxuICAgICAgICAgICAgICAgICAgQ2xvc2UgdmlzdWFsXG4gICAgICAgICAgICAgICAgPC9QYXBlcj5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgZGF0YS1pZD1cImNsb3NlLXRhYi1idXR0b25cIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICA7KHRhYiBhcyBhbnkpLl9vbkNsb3NlQ2xpY2tGbihlKVxuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8Q2xvc2VJY29uIGZvbnRTaXplPVwic21hbGxcIiAvPlxuICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgIDwvQ2xvc2VPbkNsaWNrVG9vbHRpcD5cbiAgICAgICAgICApIDogbnVsbH1cbiAgICAgICAgPC9HcmlkPlxuICAgICAgPC9kaXY+XG4gICAgPC9FeHRlbnNpb25Qb2ludHMucHJvdmlkZXJzPlxuICApXG59XG4iXX0=