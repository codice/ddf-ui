/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import { __assign } from "tslib";
import * as React from 'react';
import { isResourceSizeFilterClass, ResourceSizeFilterClass, sizeUnits, } from '../filter-builder/filter.structure';
import { EnterKeySubmitProps } from '../custom-events/enter-key-submit';
import { NumberField } from './number';
import Autocomplete from '@mui/material/Autocomplete';
import LinearProgress from '@mui/material/LinearProgress';
import TextField from '@mui/material/TextField';
import { castAndParseUnit, castAndParseValue } from './resource-size-range';
var defaultValue = 0;
var defaultUnit = 'B';
var parseFilter = function (props) {
    var _a;
    var filter = props.filter;
    var newValue = castAndParseValue(filter.value, defaultValue);
    var newUnit = castAndParseUnit((_a = filter.context) === null || _a === void 0 ? void 0 : _a.units, defaultUnit);
    return new ResourceSizeFilterClass(__assign(__assign({}, filter), { value: newValue, context: __assign(__assign({}, filter.context), { units: newUnit }) }));
};
export var UnitSelector = function (_a) {
    var value = _a.value, onChange = _a.onChange;
    return (React.createElement(Autocomplete, { value: value, onChange: function (_event, newValue) {
            onChange(newValue || defaultUnit);
        }, options: sizeUnits, className: "min-w-24 ml-2", renderInput: function (params) { return React.createElement(TextField, __assign({}, params, { size: "small" })); }, disableClearable: true }));
};
var ValidatedResourceSizeField = function (props) {
    React.useEffect(function () {
        var timeoutId = window.setTimeout(function () {
            if (!isResourceSizeFilterClass(props.filter)) {
                props.setFilter(parseFilter(props));
            }
        }, 250);
        return function () {
            window.clearTimeout(timeoutId);
        };
    }, [props]);
    if (!isResourceSizeFilterClass(props.filter)) {
        return React.createElement(LinearProgress, null);
    }
    return React.createElement(ResourceSizeField, { filter: props.filter, setFilter: props.setFilter });
};
var ResourceSizeField = function (_a) {
    var filter = _a.filter, setFilter = _a.setFilter;
    var handleValueChange = function (newValue) {
        setFilter(new ResourceSizeFilterClass(__assign(__assign({}, filter), { value: newValue })));
    };
    var handleUnitChange = function (newUnit) {
        setFilter(new ResourceSizeFilterClass(__assign(__assign({}, filter), { context: { units: newUnit } })));
    };
    return (React.createElement("div", { className: "flex flex-row items-start" },
        React.createElement(NumberField, __assign({ type: "float", value: filter.value.toString(), onChange: handleValueChange }, EnterKeySubmitProps)),
        React.createElement(UnitSelector, { value: filter.context.units, onChange: handleUnitChange })));
};
export { ValidatedResourceSizeField as ResourceSizeField };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzb3VyY2Utc2l6ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3dlYmFwcC9jb21wb25lbnQvZmllbGRzL3Jlc291cmNlLXNpemUudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7O0lBYUk7O0FBRUosT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDOUIsT0FBTyxFQUVMLHlCQUF5QixFQUN6Qix1QkFBdUIsRUFDdkIsU0FBUyxHQUNWLE1BQU0sb0NBQW9DLENBQUE7QUFDM0MsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUNBQW1DLENBQUE7QUFDdkUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUN0QyxPQUFPLFlBQVksTUFBTSw0QkFBNEIsQ0FBQTtBQUNyRCxPQUFPLGNBQWMsTUFBTSw4QkFBOEIsQ0FBQTtBQUN6RCxPQUFPLFNBQVMsTUFBTSx5QkFBeUIsQ0FBQTtBQUMvQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQTtBQVkzRSxJQUFNLFlBQVksR0FBRyxDQUFDLENBQUE7QUFDdEIsSUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFBO0FBRXZCLElBQU0sV0FBVyxHQUFHLFVBQUMsS0FBd0I7O0lBQ25DLElBQUEsTUFBTSxHQUFLLEtBQUssT0FBVixDQUFVO0lBQ3hCLElBQUksUUFBUSxHQUFHLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsWUFBWSxDQUFDLENBQUE7SUFDNUQsSUFBSSxPQUFPLEdBQUcsZ0JBQWdCLENBQUMsTUFBQSxNQUFNLENBQUMsT0FBTywwQ0FBRSxLQUFLLEVBQUUsV0FBVyxDQUFDLENBQUE7SUFFbEUsT0FBTyxJQUFJLHVCQUF1Qix1QkFDN0IsTUFBTSxLQUNULEtBQUssRUFBRSxRQUFRLEVBQ2YsT0FBTyx3QkFBTyxNQUFNLENBQUMsT0FBTyxLQUFFLEtBQUssRUFBRSxPQUFPLE9BQzVDLENBQUE7QUFDSixDQUFDLENBQUE7QUFPRCxNQUFNLENBQUMsSUFBTSxZQUFZLEdBQWdDLFVBQUMsRUFHekQ7UUFGQyxLQUFLLFdBQUEsRUFDTCxRQUFRLGNBQUE7SUFFUixPQUFPLENBQ0wsb0JBQUMsWUFBWSxJQUNYLEtBQUssRUFBRSxLQUFLLEVBQ1osUUFBUSxFQUFFLFVBQUMsTUFBTSxFQUFFLFFBQVE7WUFDekIsUUFBUSxDQUFDLFFBQVEsSUFBSSxXQUFXLENBQUMsQ0FBQTtRQUNuQyxDQUFDLEVBQ0QsT0FBTyxFQUFFLFNBQVMsRUFDbEIsU0FBUyxFQUFDLGVBQWUsRUFDekIsV0FBVyxFQUFFLFVBQUMsTUFBTSxJQUFLLE9BQUEsb0JBQUMsU0FBUyxlQUFLLE1BQU0sSUFBRSxJQUFJLEVBQUMsT0FBTyxJQUFHLEVBQXRDLENBQXNDLEVBQy9ELGdCQUFnQixTQUNoQixDQUNILENBQUE7QUFDSCxDQUFDLENBQUE7QUFFRCxJQUFNLDBCQUEwQixHQUFnQyxVQUFDLEtBQUs7SUFDcEUsS0FBSyxDQUFDLFNBQVMsQ0FBQztRQUNkLElBQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUM7WUFDbEMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDNUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTthQUNwQztRQUNILENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUNQLE9BQU87WUFDTCxNQUFNLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ2hDLENBQUMsQ0FBQTtJQUNILENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7SUFFWCxJQUFJLENBQUMseUJBQXlCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQzVDLE9BQU8sb0JBQUMsY0FBYyxPQUFHLENBQUE7S0FDMUI7SUFFRCxPQUFPLG9CQUFDLGlCQUFpQixJQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUyxHQUFJLENBQUE7QUFDaEYsQ0FBQyxDQUFBO0FBRUQsSUFBTSxpQkFBaUIsR0FBcUMsVUFBQyxFQUc1RDtRQUZDLE1BQU0sWUFBQSxFQUNOLFNBQVMsZUFBQTtJQUVULElBQU0saUJBQWlCLEdBQUcsVUFBQyxRQUFnQjtRQUN6QyxTQUFTLENBQ1AsSUFBSSx1QkFBdUIsdUJBQ3RCLE1BQU0sS0FDVCxLQUFLLEVBQUUsUUFBUSxJQUNmLENBQ0gsQ0FBQTtJQUNILENBQUMsQ0FBQTtJQUVELElBQU0sZ0JBQWdCLEdBQUcsVUFBQyxPQUFlO1FBQ3ZDLFNBQVMsQ0FDUCxJQUFJLHVCQUF1Qix1QkFDdEIsTUFBTSxLQUNULE9BQU8sRUFBRSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsSUFDM0IsQ0FDSCxDQUFBO0lBQ0gsQ0FBQyxDQUFBO0lBRUQsT0FBTyxDQUNMLDZCQUFLLFNBQVMsRUFBQywyQkFBMkI7UUFDeEMsb0JBQUMsV0FBVyxhQUNWLElBQUksRUFBQyxPQUFPLEVBQ1osS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLEVBQzlCLFFBQVEsRUFBRSxpQkFBaUIsSUFDdkIsbUJBQW1CLEVBQ3ZCO1FBQ0Ysb0JBQUMsWUFBWSxJQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLEdBQUksQ0FDckUsQ0FDUCxDQUFBO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsT0FBTyxFQUFFLDBCQUEwQixJQUFJLGlCQUFpQixFQUFFLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgQ29kaWNlIEZvdW5kYXRpb25cbiAqXG4gKiBUaGlzIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyXG4gKiBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZVxuICogTGljZW5zZSwgb3IgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dFxuICogZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VXG4gKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLiBBIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogaXMgZGlzdHJpYnV0ZWQgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0gYW5kIGNhbiBiZSBmb3VuZCBhdFxuICogPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3BsLmh0bWw+LlxuICpcbiAqKi9cblxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQge1xuICBGaWx0ZXJDbGFzcyxcbiAgaXNSZXNvdXJjZVNpemVGaWx0ZXJDbGFzcyxcbiAgUmVzb3VyY2VTaXplRmlsdGVyQ2xhc3MsXG4gIHNpemVVbml0cyxcbn0gZnJvbSAnLi4vZmlsdGVyLWJ1aWxkZXIvZmlsdGVyLnN0cnVjdHVyZSdcbmltcG9ydCB7IEVudGVyS2V5U3VibWl0UHJvcHMgfSBmcm9tICcuLi9jdXN0b20tZXZlbnRzL2VudGVyLWtleS1zdWJtaXQnXG5pbXBvcnQgeyBOdW1iZXJGaWVsZCB9IGZyb20gJy4vbnVtYmVyJ1xuaW1wb3J0IEF1dG9jb21wbGV0ZSBmcm9tICdAbXVpL21hdGVyaWFsL0F1dG9jb21wbGV0ZSdcbmltcG9ydCBMaW5lYXJQcm9ncmVzcyBmcm9tICdAbXVpL21hdGVyaWFsL0xpbmVhclByb2dyZXNzJ1xuaW1wb3J0IFRleHRGaWVsZCBmcm9tICdAbXVpL21hdGVyaWFsL1RleHRGaWVsZCdcbmltcG9ydCB7IGNhc3RBbmRQYXJzZVVuaXQsIGNhc3RBbmRQYXJzZVZhbHVlIH0gZnJvbSAnLi9yZXNvdXJjZS1zaXplLXJhbmdlJ1xuXG50eXBlIEdlbmVyaWNGaWx0ZXJUeXBlID0ge1xuICBmaWx0ZXI6IEZpbHRlckNsYXNzXG4gIHNldEZpbHRlcjogKGZpbHRlcjogRmlsdGVyQ2xhc3MpID0+IHZvaWRcbn1cblxudHlwZSBSZXNvdXJjZVNpemVGaWVsZFByb3BzID0ge1xuICBmaWx0ZXI6IFJlc291cmNlU2l6ZUZpbHRlckNsYXNzXG4gIHNldEZpbHRlcjogKGZpbHRlcjogUmVzb3VyY2VTaXplRmlsdGVyQ2xhc3MpID0+IHZvaWRcbn1cblxuY29uc3QgZGVmYXVsdFZhbHVlID0gMFxuY29uc3QgZGVmYXVsdFVuaXQgPSAnQidcblxuY29uc3QgcGFyc2VGaWx0ZXIgPSAocHJvcHM6IEdlbmVyaWNGaWx0ZXJUeXBlKTogUmVzb3VyY2VTaXplRmlsdGVyQ2xhc3MgPT4ge1xuICBjb25zdCB7IGZpbHRlciB9ID0gcHJvcHNcbiAgbGV0IG5ld1ZhbHVlID0gY2FzdEFuZFBhcnNlVmFsdWUoZmlsdGVyLnZhbHVlLCBkZWZhdWx0VmFsdWUpXG4gIGxldCBuZXdVbml0ID0gY2FzdEFuZFBhcnNlVW5pdChmaWx0ZXIuY29udGV4dD8udW5pdHMsIGRlZmF1bHRVbml0KVxuXG4gIHJldHVybiBuZXcgUmVzb3VyY2VTaXplRmlsdGVyQ2xhc3Moe1xuICAgIC4uLmZpbHRlcixcbiAgICB2YWx1ZTogbmV3VmFsdWUsXG4gICAgY29udGV4dDogeyAuLi5maWx0ZXIuY29udGV4dCwgdW5pdHM6IG5ld1VuaXQgfSxcbiAgfSlcbn1cblxudHlwZSBVbml0U2VsZWN0b3JQcm9wcyA9IHtcbiAgdmFsdWU6IHN0cmluZ1xuICBvbkNoYW5nZTogKG5ld1ZhbHVlOiBzdHJpbmcpID0+IHZvaWRcbn1cblxuZXhwb3J0IGNvbnN0IFVuaXRTZWxlY3RvcjogUmVhY3QuRkM8VW5pdFNlbGVjdG9yUHJvcHM+ID0gKHtcbiAgdmFsdWUsXG4gIG9uQ2hhbmdlLFxufSkgPT4ge1xuICByZXR1cm4gKFxuICAgIDxBdXRvY29tcGxldGVcbiAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgIG9uQ2hhbmdlPXsoX2V2ZW50LCBuZXdWYWx1ZSkgPT4ge1xuICAgICAgICBvbkNoYW5nZShuZXdWYWx1ZSB8fCBkZWZhdWx0VW5pdClcbiAgICAgIH19XG4gICAgICBvcHRpb25zPXtzaXplVW5pdHN9XG4gICAgICBjbGFzc05hbWU9XCJtaW4tdy0yNCBtbC0yXCJcbiAgICAgIHJlbmRlcklucHV0PXsocGFyYW1zKSA9PiA8VGV4dEZpZWxkIHsuLi5wYXJhbXN9IHNpemU9XCJzbWFsbFwiIC8+fVxuICAgICAgZGlzYWJsZUNsZWFyYWJsZVxuICAgIC8+XG4gIClcbn1cblxuY29uc3QgVmFsaWRhdGVkUmVzb3VyY2VTaXplRmllbGQ6IFJlYWN0LkZDPEdlbmVyaWNGaWx0ZXJUeXBlPiA9IChwcm9wcykgPT4ge1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHRpbWVvdXRJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICghaXNSZXNvdXJjZVNpemVGaWx0ZXJDbGFzcyhwcm9wcy5maWx0ZXIpKSB7XG4gICAgICAgIHByb3BzLnNldEZpbHRlcihwYXJzZUZpbHRlcihwcm9wcykpXG4gICAgICB9XG4gICAgfSwgMjUwKVxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRpbWVvdXRJZClcbiAgICB9XG4gIH0sIFtwcm9wc10pXG5cbiAgaWYgKCFpc1Jlc291cmNlU2l6ZUZpbHRlckNsYXNzKHByb3BzLmZpbHRlcikpIHtcbiAgICByZXR1cm4gPExpbmVhclByb2dyZXNzIC8+XG4gIH1cblxuICByZXR1cm4gPFJlc291cmNlU2l6ZUZpZWxkIGZpbHRlcj17cHJvcHMuZmlsdGVyfSBzZXRGaWx0ZXI9e3Byb3BzLnNldEZpbHRlcn0gLz5cbn1cblxuY29uc3QgUmVzb3VyY2VTaXplRmllbGQ6IFJlYWN0LkZDPFJlc291cmNlU2l6ZUZpZWxkUHJvcHM+ID0gKHtcbiAgZmlsdGVyLFxuICBzZXRGaWx0ZXIsXG59KSA9PiB7XG4gIGNvbnN0IGhhbmRsZVZhbHVlQ2hhbmdlID0gKG5ld1ZhbHVlOiBudW1iZXIpID0+IHtcbiAgICBzZXRGaWx0ZXIoXG4gICAgICBuZXcgUmVzb3VyY2VTaXplRmlsdGVyQ2xhc3Moe1xuICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgIHZhbHVlOiBuZXdWYWx1ZSxcbiAgICAgIH0pXG4gICAgKVxuICB9XG5cbiAgY29uc3QgaGFuZGxlVW5pdENoYW5nZSA9IChuZXdVbml0OiBzdHJpbmcpID0+IHtcbiAgICBzZXRGaWx0ZXIoXG4gICAgICBuZXcgUmVzb3VyY2VTaXplRmlsdGVyQ2xhc3Moe1xuICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgIGNvbnRleHQ6IHsgdW5pdHM6IG5ld1VuaXQgfSxcbiAgICAgIH0pXG4gICAgKVxuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1yb3cgaXRlbXMtc3RhcnRcIj5cbiAgICAgIDxOdW1iZXJGaWVsZFxuICAgICAgICB0eXBlPVwiZmxvYXRcIlxuICAgICAgICB2YWx1ZT17ZmlsdGVyLnZhbHVlLnRvU3RyaW5nKCl9XG4gICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVWYWx1ZUNoYW5nZX1cbiAgICAgICAgey4uLkVudGVyS2V5U3VibWl0UHJvcHN9XG4gICAgICAvPlxuICAgICAgPFVuaXRTZWxlY3RvciB2YWx1ZT17ZmlsdGVyLmNvbnRleHQudW5pdHN9IG9uQ2hhbmdlPXtoYW5kbGVVbml0Q2hhbmdlfSAvPlxuICAgIDwvZGl2PlxuICApXG59XG5cbmV4cG9ydCB7IFZhbGlkYXRlZFJlc291cmNlU2l6ZUZpZWxkIGFzIFJlc291cmNlU2l6ZUZpZWxkIH1cbiJdfQ==