import { __assign } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import * as React from 'react';
import { isResourceSizeFilterClass, ResourceSizeFilterClass, sizeUnits, } from '../filter-builder/filter.structure';
import { EnterKeySubmitProps } from '../custom-events/enter-key-submit';
import { NumberField } from './number';
import Autocomplete from '@mui/material/Autocomplete';
import LinearProgress from '@mui/material/LinearProgress';
import TextField from '@mui/material/TextField';
import { castAndParseUnit, castAndParseValue } from './resource-size-range';
var defaultValue = 0;
var defaultUnit = 'B';
var parseFilter = function (props) {
    var _a;
    var filter = props.filter;
    var newValue = castAndParseValue(filter.value, defaultValue);
    var newUnit = castAndParseUnit((_a = filter.context) === null || _a === void 0 ? void 0 : _a.units, defaultUnit);
    return new ResourceSizeFilterClass(__assign(__assign({}, filter), { value: newValue, context: __assign(__assign({}, filter.context), { units: newUnit }) }));
};
export var UnitSelector = function (_a) {
    var value = _a.value, onChange = _a.onChange;
    return (_jsx(Autocomplete, { value: value, onChange: function (_event, newValue) {
            onChange(newValue || defaultUnit);
        }, options: sizeUnits, className: "min-w-24 ml-2", renderInput: function (params) { return _jsx(TextField, __assign({}, params, { size: "small" })); }, disableClearable: true }));
};
var ValidatedResourceSizeField = function (props) {
    React.useEffect(function () {
        var timeoutId = window.setTimeout(function () {
            if (!isResourceSizeFilterClass(props.filter)) {
                props.setFilter(parseFilter(props));
            }
        }, 250);
        return function () {
            window.clearTimeout(timeoutId);
        };
    }, [props]);
    if (!isResourceSizeFilterClass(props.filter)) {
        return _jsx(LinearProgress, {});
    }
    return _jsx(ResourceSizeField, { filter: props.filter, setFilter: props.setFilter });
};
var ResourceSizeField = function (_a) {
    var filter = _a.filter, setFilter = _a.setFilter;
    var handleValueChange = function (newValue) {
        setFilter(new ResourceSizeFilterClass(__assign(__assign({}, filter), { value: newValue })));
    };
    var handleUnitChange = function (newUnit) {
        setFilter(new ResourceSizeFilterClass(__assign(__assign({}, filter), { context: { units: newUnit } })));
    };
    return (_jsxs("div", { className: "flex flex-row items-start", children: [_jsx(NumberField, __assign({ type: "float", value: filter.value.toString(), onChange: handleValueChange }, EnterKeySubmitProps)), _jsx(UnitSelector, { value: filter.context.units, onChange: handleUnitChange })] }));
};
export { ValidatedResourceSizeField as ResourceSizeField };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzb3VyY2Utc2l6ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3dlYmFwcC9jb21wb25lbnQvZmllbGRzL3Jlc291cmNlLXNpemUudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7Ozs7Ozs7SUFhSTtBQUVKLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQzlCLE9BQU8sRUFFTCx5QkFBeUIsRUFDekIsdUJBQXVCLEVBQ3ZCLFNBQVMsR0FDVixNQUFNLG9DQUFvQyxDQUFBO0FBQzNDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFBO0FBQ3ZFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDdEMsT0FBTyxZQUFZLE1BQU0sNEJBQTRCLENBQUE7QUFDckQsT0FBTyxjQUFjLE1BQU0sOEJBQThCLENBQUE7QUFDekQsT0FBTyxTQUFTLE1BQU0seUJBQXlCLENBQUE7QUFDL0MsT0FBTyxFQUFFLGdCQUFnQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFZM0UsSUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFBO0FBQ3RCLElBQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQTtBQUV2QixJQUFNLFdBQVcsR0FBRyxVQUFDLEtBQXdCOztJQUNuQyxJQUFBLE1BQU0sR0FBSyxLQUFLLE9BQVYsQ0FBVTtJQUN4QixJQUFJLFFBQVEsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFBO0lBQzVELElBQUksT0FBTyxHQUFHLGdCQUFnQixDQUFDLE1BQUEsTUFBTSxDQUFDLE9BQU8sMENBQUUsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFBO0lBRWxFLE9BQU8sSUFBSSx1QkFBdUIsdUJBQzdCLE1BQU0sS0FDVCxLQUFLLEVBQUUsUUFBUSxFQUNmLE9BQU8sd0JBQU8sTUFBTSxDQUFDLE9BQU8sS0FBRSxLQUFLLEVBQUUsT0FBTyxPQUM1QyxDQUFBO0FBQ0osQ0FBQyxDQUFBO0FBT0QsTUFBTSxDQUFDLElBQU0sWUFBWSxHQUFnQyxVQUFDLEVBR3pEO1FBRkMsS0FBSyxXQUFBLEVBQ0wsUUFBUSxjQUFBO0lBRVIsT0FBTyxDQUNMLEtBQUMsWUFBWSxJQUNYLEtBQUssRUFBRSxLQUFLLEVBQ1osUUFBUSxFQUFFLFVBQUMsTUFBTSxFQUFFLFFBQVE7WUFDekIsUUFBUSxDQUFDLFFBQVEsSUFBSSxXQUFXLENBQUMsQ0FBQTtRQUNuQyxDQUFDLEVBQ0QsT0FBTyxFQUFFLFNBQVMsRUFDbEIsU0FBUyxFQUFDLGVBQWUsRUFDekIsV0FBVyxFQUFFLFVBQUMsTUFBTSxJQUFLLE9BQUEsS0FBQyxTQUFTLGVBQUssTUFBTSxJQUFFLElBQUksRUFBQyxPQUFPLElBQUcsRUFBdEMsQ0FBc0MsRUFDL0QsZ0JBQWdCLFNBQ2hCLENBQ0gsQ0FBQTtBQUNILENBQUMsQ0FBQTtBQUVELElBQU0sMEJBQTBCLEdBQWdDLFVBQUMsS0FBSztJQUNwRSxLQUFLLENBQUMsU0FBUyxDQUFDO1FBQ2QsSUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQztZQUNsQyxJQUFJLENBQUMseUJBQXlCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7Z0JBQzdDLEtBQUssQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7WUFDckMsQ0FBQztRQUNILENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUNQLE9BQU87WUFDTCxNQUFNLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ2hDLENBQUMsQ0FBQTtJQUNILENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7SUFFWCxJQUFJLENBQUMseUJBQXlCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDN0MsT0FBTyxLQUFDLGNBQWMsS0FBRyxDQUFBO0lBQzNCLENBQUM7SUFFRCxPQUFPLEtBQUMsaUJBQWlCLElBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTLEdBQUksQ0FBQTtBQUNoRixDQUFDLENBQUE7QUFFRCxJQUFNLGlCQUFpQixHQUFxQyxVQUFDLEVBRzVEO1FBRkMsTUFBTSxZQUFBLEVBQ04sU0FBUyxlQUFBO0lBRVQsSUFBTSxpQkFBaUIsR0FBRyxVQUFDLFFBQWdCO1FBQ3pDLFNBQVMsQ0FDUCxJQUFJLHVCQUF1Qix1QkFDdEIsTUFBTSxLQUNULEtBQUssRUFBRSxRQUFRLElBQ2YsQ0FDSCxDQUFBO0lBQ0gsQ0FBQyxDQUFBO0lBRUQsSUFBTSxnQkFBZ0IsR0FBRyxVQUFDLE9BQWU7UUFDdkMsU0FBUyxDQUNQLElBQUksdUJBQXVCLHVCQUN0QixNQUFNLEtBQ1QsT0FBTyxFQUFFLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUMzQixDQUNILENBQUE7SUFDSCxDQUFDLENBQUE7SUFFRCxPQUFPLENBQ0wsZUFBSyxTQUFTLEVBQUMsMkJBQTJCLGFBQ3hDLEtBQUMsV0FBVyxhQUNWLElBQUksRUFBQyxPQUFPLEVBQ1osS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLEVBQzlCLFFBQVEsRUFBRSxpQkFBaUIsSUFDdkIsbUJBQW1CLEVBQ3ZCLEVBQ0YsS0FBQyxZQUFZLElBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxnQkFBZ0IsR0FBSSxJQUNyRSxDQUNQLENBQUE7QUFDSCxDQUFDLENBQUE7QUFFRCxPQUFPLEVBQUUsMEJBQTBCLElBQUksaUJBQWlCLEVBQUUsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBDb2RpY2UgRm91bmRhdGlvblxuICpcbiAqIFRoaXMgaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXJcbiAqIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlXG4gKiBMaWNlbnNlLCBvciBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0XG4gKiBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlVcbiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuIEEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBpcyBkaXN0cmlidXRlZCBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbSBhbmQgY2FuIGJlIGZvdW5kIGF0XG4gKiA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2xncGwuaHRtbD4uXG4gKlxuICoqL1xuXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB7XG4gIEZpbHRlckNsYXNzLFxuICBpc1Jlc291cmNlU2l6ZUZpbHRlckNsYXNzLFxuICBSZXNvdXJjZVNpemVGaWx0ZXJDbGFzcyxcbiAgc2l6ZVVuaXRzLFxufSBmcm9tICcuLi9maWx0ZXItYnVpbGRlci9maWx0ZXIuc3RydWN0dXJlJ1xuaW1wb3J0IHsgRW50ZXJLZXlTdWJtaXRQcm9wcyB9IGZyb20gJy4uL2N1c3RvbS1ldmVudHMvZW50ZXIta2V5LXN1Ym1pdCdcbmltcG9ydCB7IE51bWJlckZpZWxkIH0gZnJvbSAnLi9udW1iZXInXG5pbXBvcnQgQXV0b2NvbXBsZXRlIGZyb20gJ0BtdWkvbWF0ZXJpYWwvQXV0b2NvbXBsZXRlJ1xuaW1wb3J0IExpbmVhclByb2dyZXNzIGZyb20gJ0BtdWkvbWF0ZXJpYWwvTGluZWFyUHJvZ3Jlc3MnXG5pbXBvcnQgVGV4dEZpZWxkIGZyb20gJ0BtdWkvbWF0ZXJpYWwvVGV4dEZpZWxkJ1xuaW1wb3J0IHsgY2FzdEFuZFBhcnNlVW5pdCwgY2FzdEFuZFBhcnNlVmFsdWUgfSBmcm9tICcuL3Jlc291cmNlLXNpemUtcmFuZ2UnXG5cbnR5cGUgR2VuZXJpY0ZpbHRlclR5cGUgPSB7XG4gIGZpbHRlcjogRmlsdGVyQ2xhc3NcbiAgc2V0RmlsdGVyOiAoZmlsdGVyOiBGaWx0ZXJDbGFzcykgPT4gdm9pZFxufVxuXG50eXBlIFJlc291cmNlU2l6ZUZpZWxkUHJvcHMgPSB7XG4gIGZpbHRlcjogUmVzb3VyY2VTaXplRmlsdGVyQ2xhc3NcbiAgc2V0RmlsdGVyOiAoZmlsdGVyOiBSZXNvdXJjZVNpemVGaWx0ZXJDbGFzcykgPT4gdm9pZFxufVxuXG5jb25zdCBkZWZhdWx0VmFsdWUgPSAwXG5jb25zdCBkZWZhdWx0VW5pdCA9ICdCJ1xuXG5jb25zdCBwYXJzZUZpbHRlciA9IChwcm9wczogR2VuZXJpY0ZpbHRlclR5cGUpOiBSZXNvdXJjZVNpemVGaWx0ZXJDbGFzcyA9PiB7XG4gIGNvbnN0IHsgZmlsdGVyIH0gPSBwcm9wc1xuICBsZXQgbmV3VmFsdWUgPSBjYXN0QW5kUGFyc2VWYWx1ZShmaWx0ZXIudmFsdWUsIGRlZmF1bHRWYWx1ZSlcbiAgbGV0IG5ld1VuaXQgPSBjYXN0QW5kUGFyc2VVbml0KGZpbHRlci5jb250ZXh0Py51bml0cywgZGVmYXVsdFVuaXQpXG5cbiAgcmV0dXJuIG5ldyBSZXNvdXJjZVNpemVGaWx0ZXJDbGFzcyh7XG4gICAgLi4uZmlsdGVyLFxuICAgIHZhbHVlOiBuZXdWYWx1ZSxcbiAgICBjb250ZXh0OiB7IC4uLmZpbHRlci5jb250ZXh0LCB1bml0czogbmV3VW5pdCB9LFxuICB9KVxufVxuXG50eXBlIFVuaXRTZWxlY3RvclByb3BzID0ge1xuICB2YWx1ZTogc3RyaW5nXG4gIG9uQ2hhbmdlOiAobmV3VmFsdWU6IHN0cmluZykgPT4gdm9pZFxufVxuXG5leHBvcnQgY29uc3QgVW5pdFNlbGVjdG9yOiBSZWFjdC5GQzxVbml0U2VsZWN0b3JQcm9wcz4gPSAoe1xuICB2YWx1ZSxcbiAgb25DaGFuZ2UsXG59KSA9PiB7XG4gIHJldHVybiAoXG4gICAgPEF1dG9jb21wbGV0ZVxuICAgICAgdmFsdWU9e3ZhbHVlfVxuICAgICAgb25DaGFuZ2U9eyhfZXZlbnQsIG5ld1ZhbHVlKSA9PiB7XG4gICAgICAgIG9uQ2hhbmdlKG5ld1ZhbHVlIHx8IGRlZmF1bHRVbml0KVxuICAgICAgfX1cbiAgICAgIG9wdGlvbnM9e3NpemVVbml0c31cbiAgICAgIGNsYXNzTmFtZT1cIm1pbi13LTI0IG1sLTJcIlxuICAgICAgcmVuZGVySW5wdXQ9eyhwYXJhbXMpID0+IDxUZXh0RmllbGQgey4uLnBhcmFtc30gc2l6ZT1cInNtYWxsXCIgLz59XG4gICAgICBkaXNhYmxlQ2xlYXJhYmxlXG4gICAgLz5cbiAgKVxufVxuXG5jb25zdCBWYWxpZGF0ZWRSZXNvdXJjZVNpemVGaWVsZDogUmVhY3QuRkM8R2VuZXJpY0ZpbHRlclR5cGU+ID0gKHByb3BzKSA9PiB7XG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgdGltZW91dElkID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCFpc1Jlc291cmNlU2l6ZUZpbHRlckNsYXNzKHByb3BzLmZpbHRlcikpIHtcbiAgICAgICAgcHJvcHMuc2V0RmlsdGVyKHBhcnNlRmlsdGVyKHByb3BzKSlcbiAgICAgIH1cbiAgICB9LCAyNTApXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGltZW91dElkKVxuICAgIH1cbiAgfSwgW3Byb3BzXSlcblxuICBpZiAoIWlzUmVzb3VyY2VTaXplRmlsdGVyQ2xhc3MocHJvcHMuZmlsdGVyKSkge1xuICAgIHJldHVybiA8TGluZWFyUHJvZ3Jlc3MgLz5cbiAgfVxuXG4gIHJldHVybiA8UmVzb3VyY2VTaXplRmllbGQgZmlsdGVyPXtwcm9wcy5maWx0ZXJ9IHNldEZpbHRlcj17cHJvcHMuc2V0RmlsdGVyfSAvPlxufVxuXG5jb25zdCBSZXNvdXJjZVNpemVGaWVsZDogUmVhY3QuRkM8UmVzb3VyY2VTaXplRmllbGRQcm9wcz4gPSAoe1xuICBmaWx0ZXIsXG4gIHNldEZpbHRlcixcbn0pID0+IHtcbiAgY29uc3QgaGFuZGxlVmFsdWVDaGFuZ2UgPSAobmV3VmFsdWU6IG51bWJlcikgPT4ge1xuICAgIHNldEZpbHRlcihcbiAgICAgIG5ldyBSZXNvdXJjZVNpemVGaWx0ZXJDbGFzcyh7XG4gICAgICAgIC4uLmZpbHRlcixcbiAgICAgICAgdmFsdWU6IG5ld1ZhbHVlLFxuICAgICAgfSlcbiAgICApXG4gIH1cblxuICBjb25zdCBoYW5kbGVVbml0Q2hhbmdlID0gKG5ld1VuaXQ6IHN0cmluZykgPT4ge1xuICAgIHNldEZpbHRlcihcbiAgICAgIG5ldyBSZXNvdXJjZVNpemVGaWx0ZXJDbGFzcyh7XG4gICAgICAgIC4uLmZpbHRlcixcbiAgICAgICAgY29udGV4dDogeyB1bml0czogbmV3VW5pdCB9LFxuICAgICAgfSlcbiAgICApXG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LXJvdyBpdGVtcy1zdGFydFwiPlxuICAgICAgPE51bWJlckZpZWxkXG4gICAgICAgIHR5cGU9XCJmbG9hdFwiXG4gICAgICAgIHZhbHVlPXtmaWx0ZXIudmFsdWUudG9TdHJpbmcoKX1cbiAgICAgICAgb25DaGFuZ2U9e2hhbmRsZVZhbHVlQ2hhbmdlfVxuICAgICAgICB7Li4uRW50ZXJLZXlTdWJtaXRQcm9wc31cbiAgICAgIC8+XG4gICAgICA8VW5pdFNlbGVjdG9yIHZhbHVlPXtmaWx0ZXIuY29udGV4dC51bml0c30gb25DaGFuZ2U9e2hhbmRsZVVuaXRDaGFuZ2V9IC8+XG4gICAgPC9kaXY+XG4gIClcbn1cblxuZXhwb3J0IHsgVmFsaWRhdGVkUmVzb3VyY2VTaXplRmllbGQgYXMgUmVzb3VyY2VTaXplRmllbGQgfVxuIl19