import { __assign } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import * as React from 'react';
import { ResourceSizeRangeFilterClass, sizeUnits, isResourceSizeRangeFilterClass, } from '../filter-builder/filter.structure';
import { EnterKeySubmitProps } from '../custom-events/enter-key-submit';
import { NumberField } from './number';
import Autocomplete from '@mui/material/Autocomplete';
import TextField from '@mui/material/TextField';
import LinearProgress from '@mui/material/LinearProgress';
var defaultValue = {
    start: 0,
    end: 1,
    startUnits: 'B',
    endUnits: 'B',
};
function castAndParseFilterValue(value) {
    var castedValue = value;
    try {
        return {
            start: castAndParseValue(castedValue.start, defaultValue.start),
            end: castAndParseValue(castedValue.end, defaultValue.end),
        };
    }
    catch (e) {
        return {
            start: defaultValue.start,
            end: defaultValue.end,
        };
    }
}
function parseFilterContext(context) {
    var castedContext = context;
    try {
        return {
            startUnits: castAndParseUnit(castedContext.startUnits, defaultValue.startUnits),
            endUnits: castAndParseUnit(castedContext.endUnits, defaultValue.endUnits),
        };
    }
    catch (e) {
        return {
            startUnits: defaultValue.startUnits,
            endUnits: defaultValue.endUnits,
        };
    }
}
export function castAndParseValue(value, defaultValue) {
    try {
        var castedValue = value;
        if (typeof castedValue === 'number' && !isNaN(castedValue)) {
            return castedValue;
        }
    }
    catch (e) {
        // If casting fails, fall through to default
    }
    return defaultValue;
}
export function castAndParseUnit(unit, defaultValue) {
    try {
        var castedUnit = unit;
        if (sizeUnits.includes(castedUnit)) {
            return castedUnit;
        }
    }
    catch (e) {
        // If casting fails, fall through to default
    }
    return defaultValue;
}
function parseFilter(props) {
    var filter = props.filter;
    var newValue = castAndParseFilterValue(filter.value);
    var newContext = parseFilterContext(filter.context);
    return new ResourceSizeRangeFilterClass(__assign(__assign({}, filter), { value: {
            start: newValue.start,
            end: newValue.end,
        }, context: {
            startUnits: newContext.startUnits,
            endUnits: newContext.endUnits,
        } }));
}
var ResourceSizeRangeFieldWrapper = function (_a) {
    var filter = _a.filter, setFilter = _a.setFilter;
    React.useEffect(function () {
        var timeoutId = window.setTimeout(function () {
            if (!isResourceSizeRangeFilterClass(filter)) {
                setFilter(parseFilter({ filter: filter, setFilter: setFilter }));
            }
        }, 250);
        return function () {
            window.clearTimeout(timeoutId);
        };
    }, [filter]);
    if (!isResourceSizeRangeFilterClass(filter)) {
        return _jsx(LinearProgress, {});
    }
    return _jsx(ResourceSizeRangeField, { filter: filter, setFilter: setFilter });
};
var ResourceSizeRangeField = function (_a) {
    var filter = _a.filter, setFilter = _a.setFilter;
    return (_jsxs("div", { className: "flex flex-col space-y-4", children: [_jsxs("div", { className: "flex flex-row items-start", children: [_jsx(NumberField, __assign({ value: filter.value.start.toString(), TextFieldProps: { label: 'From' }, type: "float", onChange: function (val) {
                            setFilter(new ResourceSizeRangeFilterClass(__assign(__assign({}, filter), { value: { start: val, end: filter.value.end } })));
                        } }, EnterKeySubmitProps)), _jsx(Autocomplete, { value: filter.context.startUnits, onChange: function (_, newValue) {
                            return setFilter(new ResourceSizeRangeFilterClass(__assign(__assign({}, filter), { context: {
                                    startUnits: newValue || 'B',
                                    endUnits: filter.context.endUnits,
                                } })));
                        }, className: "min-w-24 ml-2", options: sizeUnits, renderInput: function (params) { return _jsx(TextField, __assign({}, params, { size: "small" })); }, fullWidth: true })] }), _jsxs("div", { className: "flex flex-row items-start", children: [_jsx(NumberField, __assign({ value: filter.value.end.toString(), TextFieldProps: { label: 'To' }, type: "float", onChange: function (val) {
                            setFilter(new ResourceSizeRangeFilterClass(__assign(__assign({}, filter), { value: { start: filter.value.start, end: val } })));
                        } }, EnterKeySubmitProps)), _jsx(Autocomplete, { value: filter.context.endUnits, className: "min-w-24 ml-2", onChange: function (_, newValue) {
                            setFilter(new ResourceSizeRangeFilterClass(__assign(__assign({}, filter), { context: {
                                    startUnits: filter.context.startUnits,
                                    endUnits: newValue || 'B',
                                } })));
                        }, options: sizeUnits, renderInput: function (params) { return _jsx(TextField, __assign({}, params, { size: "small" })); }, fullWidth: true })] })] }));
};
export { ResourceSizeRangeFieldWrapper as ResourceSizeRangeField };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzb3VyY2Utc2l6ZS1yYW5nZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3dlYmFwcC9jb21wb25lbnQvZmllbGRzL3Jlc291cmNlLXNpemUtcmFuZ2UudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7Ozs7Ozs7SUFhSTtBQUVKLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQzlCLE9BQU8sRUFDTCw0QkFBNEIsRUFFNUIsU0FBUyxFQUNULDhCQUE4QixHQUMvQixNQUFNLG9DQUFvQyxDQUFBO0FBQzNDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFBO0FBQ3ZFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDdEMsT0FBTyxZQUFZLE1BQU0sNEJBQTRCLENBQUE7QUFDckQsT0FBTyxTQUFTLE1BQU0seUJBQXlCLENBQUE7QUFDL0MsT0FBTyxjQUFjLE1BQU0sOEJBQThCLENBQUE7QUFZekQsSUFBTSxZQUFZLEdBQUc7SUFDbkIsS0FBSyxFQUFFLENBQUM7SUFDUixHQUFHLEVBQUUsQ0FBQztJQUNOLFVBQVUsRUFBRSxHQUFHO0lBQ2YsUUFBUSxFQUFFLEdBQUc7Q0FDZCxDQUFBO0FBRUQsU0FBUyx1QkFBdUIsQ0FDOUIsS0FBYztJQUVkLElBQU0sV0FBVyxHQUFHLEtBQThDLENBQUE7SUFDbEUsSUFBSSxDQUFDO1FBQ0gsT0FBTztZQUNMLEtBQUssRUFBRSxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFlBQVksQ0FBQyxLQUFLLENBQUM7WUFDL0QsR0FBRyxFQUFFLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsWUFBWSxDQUFDLEdBQUcsQ0FBQztTQUMxRCxDQUFBO0lBQ0gsQ0FBQztJQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDWCxPQUFPO1lBQ0wsS0FBSyxFQUFFLFlBQVksQ0FBQyxL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QUFBO0FBRUQsT0FBTyxFQUFFLDZCQUE2QixJQUFJLHNCQUFzQixFQUFFLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgQ29kaWNlIEZvdW5kYXRpb25cbiAqXG4gKiBUaGlzIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyXG4gKiBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZVxuICogTGljZW5zZSwgb3IgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dFxuICogZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VXG4gKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLiBBIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuICogaXMgZGlzdHJpYnV0ZWQgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0gYW5kIGNhbiBiZSBmb3VuZCBhdFxuICogPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3BsLmh0bWw+LlxuICpcbiAqKi9cblxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQge1xuICBSZXNvdXJjZVNpemVSYW5nZUZpbHRlckNsYXNzLFxuICBGaWx0ZXJDbGFzcyxcbiAgc2l6ZVVuaXRzLFxuICBpc1Jlc291cmNlU2l6ZVJhbmdlRmlsdGVyQ2xhc3MsXG59IGZyb20gJy4uL2ZpbHRlci1idWlsZGVyL2ZpbHRlci5zdHJ1Y3R1cmUnXG5pbXBvcnQgeyBFbnRlcktleVN1Ym1pdFByb3BzIH0gZnJvbSAnLi4vY3VzdG9tLWV2ZW50cy9lbnRlci1rZXktc3VibWl0J1xuaW1wb3J0IHsgTnVtYmVyRmllbGQgfSBmcm9tICcuL251bWJlcidcbmltcG9ydCBBdXRvY29tcGxldGUgZnJvbSAnQG11aS9tYXRlcmlhbC9BdXRvY29tcGxldGUnXG5pbXBvcnQgVGV4dEZpZWxkIGZyb20gJ0BtdWkvbWF0ZXJpYWwvVGV4dEZpZWxkJ1xuaW1wb3J0IExpbmVhclByb2dyZXNzIGZyb20gJ0BtdWkvbWF0ZXJpYWwvTGluZWFyUHJvZ3Jlc3MnXG5cbnR5cGUgR2VuZXJpY0ZpbHRlclR5cGUgPSB7XG4gIGZpbHRlcjogRmlsdGVyQ2xhc3NcbiAgc2V0RmlsdGVyOiAoZmlsdGVyOiBGaWx0ZXJDbGFzcykgPT4gdm9pZFxufVxuXG50eXBlIFJlc291cmNlU2l6ZVJhbmdlRmllbGRQcm9wcyA9IHtcbiAgZmlsdGVyOiBSZXNvdXJjZVNpemVSYW5nZUZpbHRlckNsYXNzXG4gIHNldEZpbHRlcjogKGZpbHRlcjogUmVzb3VyY2VTaXplUmFuZ2VGaWx0ZXJDbGFzcykgPT4gdm9pZFxufVxuXG5jb25zdCBkZWZhdWx0VmFsdWUgPSB7XG4gIHN0YXJ0OiAwLFxuICBlbmQ6IDEsXG4gIHN0YXJ0VW5pdHM6ICdCJyxcbiAgZW5kVW5pdHM6ICdCJyxcbn1cblxuZnVuY3Rpb24gY2FzdEFuZFBhcnNlRmlsdGVyVmFsdWUoXG4gIHZhbHVlOiB1bmtub3duXG4pOiBSZXNvdXJjZVNpemVSYW5nZUZpbHRlckNsYXNzWyd2YWx1ZSddIHtcbiAgY29uc3QgY2FzdGVkVmFsdWUgPSB2YWx1ZSBhcyBSZXNvdXJjZVNpemVSYW5nZUZpbHRlckNsYXNzWyd2YWx1ZSddXG4gIHRyeSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXJ0OiBjYXN0QW5kUGFyc2VWYWx1ZShjYXN0ZWRWYWx1ZS5zdGFydCwgZGVmYXVsdFZhbHVlLnN0YXJ0KSxcbiAgICAgIGVuZDogY2FzdEFuZFBhcnNlVmFsdWUoY2FzdGVkVmFsdWUuZW5kLCBkZWZhdWx0VmFsdWUuZW5kKSxcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhcnQ6IGRlZmF1bHRWYWx1ZS5zdGFydCxcbiAgICAgIGVuZDogZGVmYXVsdFZhbHVlLmVuZCxcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gcGFyc2VGaWx0ZXJDb250ZXh0KFxuICBjb250ZXh0OiB1bmtub3duXG4pOiBSZXNvdXJjZVNpemVSYW5nZUZpbHRlckNsYXNzWydjb250ZXh0J10ge1xuICBjb25zdCBjYXN0ZWRDb250ZXh0ID0gY29udGV4dCBhcyBSZXNvdXJjZVNpemVSYW5nZUZpbHRlckNsYXNzWydjb250ZXh0J11cbiAgdHJ5IHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhcnRVbml0czogY2FzdEFuZFBhcnNlVW5pdChcbiAgICAgICAgY2FzdGVkQ29udGV4dC5zdGFydFVuaXRzLFxuICAgICAgICBkZWZhdWx0VmFsdWUuc3RhcnRVbml0c1xuICAgICAgKSxcbiAgICAgIGVuZFVuaXRzOiBjYXN0QW5kUGFyc2VVbml0KGNhc3RlZENvbnRleHQuZW5kVW5pdHMsIGRlZmF1bHRWYWx1ZS5lbmRVbml0cyksXG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXJ0VW5pdHM6IGRlZmF1bHRWYWx1ZS5zdGFydFVuaXRzLFxuICAgICAgZW5kVW5pdHM6IGRlZmF1bHRWYWx1ZS5lbmRVbml0cyxcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhc3RBbmRQYXJzZVZhbHVlKFxuICB2YWx1ZTogdW5rbm93bixcbiAgZGVmYXVsdFZhbHVlOiBudW1iZXJcbik6IG51bWJlciB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2FzdGVkVmFsdWUgPSB2YWx1ZSBhcyBudW1iZXJcbiAgICBpZiAodHlwZW9mIGNhc3RlZFZhbHVlID09PSAnbnVtYmVyJyAmJiAhaXNOYU4oY2FzdGVkVmFsdWUpKSB7XG4gICAgICByZXR1cm4gY2FzdGVkVmFsdWVcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBJZiBjYXN0aW5nIGZhaWxzLCBmYWxsIHRocm91Z2ggdG8gZGVmYXVsdFxuICB9XG4gIHJldHVybiBkZWZhdWx0VmFsdWVcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhc3RBbmRQYXJzZVVuaXQodW5pdDogdW5rbm93biwgZGVmYXVsdFZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xuICB0cnkge1xuICAgIGNvbnN0IGNhc3RlZFVuaXQgPSB1bml0IGFzIHN0cmluZ1xuICAgIGlmIChzaXplVW5pdHMuaW5jbHVkZXMoY2FzdGVkVW5pdCkpIHtcbiAgICAgIHJldHVybiBjYXN0ZWRVbml0XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gSWYgY2FzdGluZyBmYWlscywgZmFsbCB0aHJvdWdoIHRvIGRlZmF1bHRcbiAgfVxuICByZXR1cm4gZGVmYXVsdFZhbHVlXG59XG5cbmZ1bmN0aW9uIHBhcnNlRmlsdGVyKHByb3BzOiBHZW5lcmljRmlsdGVyVHlwZSk6IFJlc291cmNlU2l6ZVJhbmdlRmlsdGVyQ2xhc3Mge1xuICBjb25zdCB7IGZpbHRlciB9ID0gcHJvcHNcbiAgbGV0IG5ld1ZhbHVlID0gY2FzdEFuZFBhcnNlRmlsdGVyVmFsdWUoZmlsdGVyLnZhbHVlKVxuICBsZXQgbmV3Q29udGV4dCA9IHBhcnNlRmlsdGVyQ29udGV4dChmaWx0ZXIuY29udGV4dClcblxuICByZXR1cm4gbmV3IFJlc291cmNlU2l6ZVJhbmdlRmlsdGVyQ2xhc3Moe1xuICAgIC4uLmZpbHRlcixcbiAgICB2YWx1ZToge1xuICAgICAgc3RhcnQ6IG5ld1ZhbHVlLnN0YXJ0LFxuICAgICAgZW5kOiBuZXdWYWx1ZS5lbmQsXG4gICAgfSxcbiAgICBjb250ZXh0OiB7XG4gICAgICBzdGFydFVuaXRzOiBuZXdDb250ZXh0LnN0YXJ0VW5pdHMsXG4gICAgICBlbmRVbml0czogbmV3Q29udGV4dC5lbmRVbml0cyxcbiAgICB9LFxuICB9KVxufVxuXG5jb25zdCBSZXNvdXJjZVNpemVSYW5nZUZpZWxkV3JhcHBlcjogUmVhY3QuRkM8R2VuZXJpY0ZpbHRlclR5cGU+ID0gKHtcbiAgZmlsdGVyLFxuICBzZXRGaWx0ZXIsXG59KSA9PiB7XG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgdGltZW91dElkID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCFpc1Jlc291cmNlU2l6ZVJhbmdlRmlsdGVyQ2xhc3MoZmlsdGVyKSkge1xuICAgICAgICBzZXRGaWx0ZXIocGFyc2VGaWx0ZXIoeyBmaWx0ZXIsIHNldEZpbHRlciB9KSlcbiAgICAgIH1cbiAgICB9LCAyNTApXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGltZW91dElkKVxuICAgIH1cbiAgfSwgW2ZpbHRlcl0pXG5cbiAgaWYgKCFpc1Jlc291cmNlU2l6ZVJhbmdlRmlsdGVyQ2xhc3MoZmlsdGVyKSkge1xuICAgIHJldHVybiA8TGluZWFyUHJvZ3Jlc3MgLz5cbiAgfVxuXG4gIHJldHVybiA8UmVzb3VyY2VTaXplUmFuZ2VGaWVsZCBmaWx0ZXI9e2ZpbHRlcn0gc2V0RmlsdGVyPXtzZXRGaWx0ZXJ9IC8+XG59XG5cbmNvbnN0IFJlc291cmNlU2l6ZVJhbmdlRmllbGQ6IFJlYWN0LkZDPFJlc291cmNlU2l6ZVJhbmdlRmllbGRQcm9wcz4gPSAoe1xuICBmaWx0ZXIsXG4gIHNldEZpbHRlcixcbn0pID0+IHtcbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wgc3BhY2UteS00XCI+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1yb3cgaXRlbXMtc3RhcnRcIj5cbiAgICAgICAgPE51bWJlckZpZWxkXG4gICAgICAgICAgdmFsdWU9e2ZpbHRlci52YWx1ZS5zdGFydC50b1N0cmluZygpfVxuICAgICAgICAgIFRleHRGaWVsZFByb3BzPXt7IGxhYmVsOiAnRnJvbScgfX1cbiAgICAgICAgICB0eXBlPVwiZmxvYXRcIlxuICAgICAgICAgIG9uQ2hhbmdlPXsodmFsKSA9PiB7XG4gICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgIG5ldyBSZXNvdXJjZVNpemVSYW5nZUZpbHRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHsgc3RhcnQ6IHZhbCwgZW5kOiBmaWx0ZXIudmFsdWUuZW5kIH0sXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgfX1cbiAgICAgICAgICB7Li4uRW50ZXJLZXlTdWJtaXRQcm9wc31cbiAgICAgICAgLz5cbiAgICAgICAgPEF1dG9jb21wbGV0ZVxuICAgICAgICAgIHZhbHVlPXtmaWx0ZXIuY29udGV4dC5zdGFydFVuaXRzfVxuICAgICAgICAgIG9uQ2hhbmdlPXsoXywgbmV3VmFsdWUpID0+XG4gICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgIG5ldyBSZXNvdXJjZVNpemVSYW5nZUZpbHRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgICAgICAgc3RhcnRVbml0czogbmV3VmFsdWUgfHwgJ0InLFxuICAgICAgICAgICAgICAgICAgZW5kVW5pdHM6IGZpbHRlci5jb250ZXh0LmVuZFVuaXRzLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgfVxuICAgICAgICAgIGNsYXNzTmFtZT1cIm1pbi13LTI0IG1sLTJcIlxuICAgICAgICAgIG9wdGlvbnM9e3NpemVVbml0c31cbiAgICAgICAgICByZW5kZXJJbnB1dD17KHBhcmFtcykgPT4gPFRleHRGaWVsZCB7Li4ucGFyYW1zfSBzaXplPVwic21hbGxcIiAvPn1cbiAgICAgICAgICBmdWxsV2lkdGhcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtcm93IGl0ZW1zLXN0YXJ0XCI+XG4gICAgICAgIDxOdW1iZXJGaWVsZFxuICAgICAgICAgIHZhbHVlPXtmaWx0ZXIudmFsdWUuZW5kLnRvU3RyaW5nKCl9XG4gICAgICAgICAgVGV4dEZpZWxkUHJvcHM9e3sgbGFiZWw6ICdUbycgfX1cbiAgICAgICAgICB0eXBlPVwiZmxvYXRcIlxuICAgICAgICAgIG9uQ2hhbmdlPXsodmFsKSA9PiB7XG4gICAgICAgICAgICBzZXRGaWx0ZXIoXG4gICAgICAgICAgICAgIG5ldyBSZXNvdXJjZVNpemVSYW5nZUZpbHRlckNsYXNzKHtcbiAgICAgICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHsgc3RhcnQ6IGZpbHRlci52YWx1ZS5zdGFydCwgZW5kOiB2YWwgfSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9fVxuICAgICAgICAgIHsuLi5FbnRlcktleVN1Ym1pdFByb3BzfVxuICAgICAgICAvPlxuICAgICAgICA8QXV0b2NvbXBsZXRlXG4gICAgICAgICAgdmFsdWU9e2ZpbHRlci5jb250ZXh0LmVuZFVuaXRzfVxuICAgICAgICAgIGNsYXNzTmFtZT1cIm1pbi13LTI0IG1sLTJcIlxuICAgICAgICAgIG9uQ2hhbmdlPXsoXywgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgICAgIHNldEZpbHRlcihcbiAgICAgICAgICAgICAgbmV3IFJlc291cmNlU2l6ZVJhbmdlRmlsdGVyQ2xhc3Moe1xuICAgICAgICAgICAgICAgIC4uLmZpbHRlcixcbiAgICAgICAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAgICAgICBzdGFydFVuaXRzOiBmaWx0ZXIuY29udGV4dC5zdGFydFVuaXRzLFxuICAgICAgICAgICAgICAgICAgZW5kVW5pdHM6IG5ld1ZhbHVlIHx8ICdCJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgIH19XG4gICAgICAgICAgb3B0aW9ucz17c2l6ZVVuaXRzfVxuICAgICAgICAgIHJlbmRlcklucHV0PXsocGFyYW1zKSA9PiA8VGV4dEZpZWxkIHsuLi5wYXJhbXN9IHNpemU9XCJzbWFsbFwiIC8+fVxuICAgICAgICAgIGZ1bGxXaWR0aFxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIClcbn1cblxuZXhwb3J0IHsgUmVzb3VyY2VTaXplUmFuZ2VGaWVsZFdyYXBwZXIgYXMgUmVzb3VyY2VTaXplUmFuZ2VGaWVsZCB9XG4iXX0=